(self.webpackChunkvideo2earn_app=self.webpackChunkvideo2earn_app||[]).push([[399],{53399:function(module,__unused_webpack_exports,__webpack_require__){(function(W,T){if(!0)module.exports=T(__webpack_require__(28901));else var I,m})(typeof self!="undefined"?self:this,function(__WEBPACK_EXTERNAL_MODULE__4119__){return function(){var __webpack_modules__={4537:function(W){"use strict";W.exports=function(T,I){for(var m=new Array(arguments.length-1),h=0,_=2,d=!0;_<arguments.length;)m[h++]=arguments[_++];return new Promise(function(l,a){m[h]=function(c){if(d)if(d=!1,c)a(c);else{for(var o=new Array(arguments.length-1),n=0;n<o.length;)o[n++]=arguments[n];l.apply(null,o)}};try{T.apply(I||null,m)}catch(c){d&&(d=!1,a(c))}})}},7419:function(W,T){"use strict";var I=T;I.length=function(l){var a=l.length;if(!a)return 0;for(var c=0;--a%4>1&&l.charAt(a)==="=";)++c;return Math.ceil(3*l.length)/4-c};for(var m=new Array(64),h=new Array(123),_=0;_<64;)h[m[_]=_<26?_+65:_<52?_+71:_<62?_-4:_-59|43]=_++;I.encode=function(l,a,c){for(var o,n=null,t=[],e=0,r=0;a<c;){var i=l[a++];switch(r){case 0:t[e++]=m[i>>2],o=(3&i)<<4,r=1;break;case 1:t[e++]=m[o|i>>4],o=(15&i)<<2,r=2;break;case 2:t[e++]=m[o|i>>6],t[e++]=m[63&i],r=0}e>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,t)),e=0)}return r&&(t[e++]=m[o],t[e++]=61,r===1&&(t[e++]=61)),n?(e&&n.push(String.fromCharCode.apply(String,t.slice(0,e))),n.join("")):String.fromCharCode.apply(String,t.slice(0,e))};var d="invalid encoding";I.decode=function(l,a,c){for(var o,n=c,t=0,e=0;e<l.length;){var r=l.charCodeAt(e++);if(r===61&&t>1)break;if((r=h[r])===void 0)throw Error(d);switch(t){case 0:o=r,t=1;break;case 1:a[c++]=o<<2|(48&r)>>4,o=r,t=2;break;case 2:a[c++]=(15&o)<<4|(60&r)>>2,o=r,t=3;break;case 3:a[c++]=(3&o)<<6|r,t=0}}if(t===1)throw Error(d);return c-n},I.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}},9211:function(W){"use strict";function T(){this._listeners={}}W.exports=T,T.prototype.on=function(I,m,h){return(this._listeners[I]||(this._listeners[I]=[])).push({fn:m,ctx:h||this}),this},T.prototype.off=function(I,m){if(I===void 0)this._listeners={};else if(m===void 0)this._listeners[I]=[];else for(var h=this._listeners[I],_=0;_<h.length;)h[_].fn===m?h.splice(_,1):++_;return this},T.prototype.emit=function(I){var m=this._listeners[I];if(m){for(var h=[],_=1;_<arguments.length;)h.push(arguments[_++]);for(_=0;_<m.length;)m[_].fn.apply(m[_++].ctx,h)}return this}},945:function(W){"use strict";function T(d){return typeof Float32Array!="undefined"?function(){var l=new Float32Array([-0]),a=new Uint8Array(l.buffer),c=a[3]===128;function o(r,i,s){l[0]=r,i[s]=a[0],i[s+1]=a[1],i[s+2]=a[2],i[s+3]=a[3]}function n(r,i,s){l[0]=r,i[s]=a[3],i[s+1]=a[2],i[s+2]=a[1],i[s+3]=a[0]}function t(r,i){return a[0]=r[i],a[1]=r[i+1],a[2]=r[i+2],a[3]=r[i+3],l[0]}function e(r,i){return a[3]=r[i],a[2]=r[i+1],a[1]=r[i+2],a[0]=r[i+3],l[0]}d.writeFloatLE=c?o:n,d.writeFloatBE=c?n:o,d.readFloatLE=c?t:e,d.readFloatBE=c?e:t}():function(){function l(c,o,n,t){var e=o<0?1:0;if(e&&(o=-o),o===0)c(1/o>0?0:2147483648,n,t);else if(isNaN(o))c(2143289344,n,t);else if(o>34028234663852886e22)c((e<<31|2139095040)>>>0,n,t);else if(o<11754943508222875e-54)c((e<<31|Math.round(o/1401298464324817e-60))>>>0,n,t);else{var r=Math.floor(Math.log(o)/Math.LN2);c((e<<31|r+127<<23|8388607&Math.round(o*Math.pow(2,-r)*8388608))>>>0,n,t)}}function a(c,o,n){var t=c(o,n),e=2*(t>>31)+1,r=t>>>23&255,i=8388607&t;return r===255?i?NaN:e*(1/0):r===0?1401298464324817e-60*e*i:e*Math.pow(2,r-150)*(i+8388608)}d.writeFloatLE=l.bind(null,I),d.writeFloatBE=l.bind(null,m),d.readFloatLE=a.bind(null,h),d.readFloatBE=a.bind(null,_)}(),typeof Float64Array!="undefined"?function(){var l=new Float64Array([-0]),a=new Uint8Array(l.buffer),c=a[7]===128;function o(r,i,s){l[0]=r,i[s]=a[0],i[s+1]=a[1],i[s+2]=a[2],i[s+3]=a[3],i[s+4]=a[4],i[s+5]=a[5],i[s+6]=a[6],i[s+7]=a[7]}function n(r,i,s){l[0]=r,i[s]=a[7],i[s+1]=a[6],i[s+2]=a[5],i[s+3]=a[4],i[s+4]=a[3],i[s+5]=a[2],i[s+6]=a[1],i[s+7]=a[0]}function t(r,i){return a[0]=r[i],a[1]=r[i+1],a[2]=r[i+2],a[3]=r[i+3],a[4]=r[i+4],a[5]=r[i+5],a[6]=r[i+6],a[7]=r[i+7],l[0]}function e(r,i){return a[7]=r[i],a[6]=r[i+1],a[5]=r[i+2],a[4]=r[i+3],a[3]=r[i+4],a[2]=r[i+5],a[1]=r[i+6],a[0]=r[i+7],l[0]}d.writeDoubleLE=c?o:n,d.writeDoubleBE=c?n:o,d.readDoubleLE=c?t:e,d.readDoubleBE=c?e:t}():function(){function l(c,o,n,t,e,r){var i=t<0?1:0;if(i&&(t=-t),t===0)c(0,e,r+o),c(1/t>0?0:2147483648,e,r+n);else if(isNaN(t))c(0,e,r+o),c(2146959360,e,r+n);else if(t>17976931348623157e292)c(0,e,r+o),c((i<<31|2146435072)>>>0,e,r+n);else{var s;if(t<22250738585072014e-324)c((s=t/5e-324)>>>0,e,r+o),c((i<<31|s/4294967296)>>>0,e,r+n);else{var u=Math.floor(Math.log(t)/Math.LN2);u===1024&&(u=1023),c(4503599627370496*(s=t*Math.pow(2,-u))>>>0,e,r+o),c((i<<31|u+1023<<20|1048576*s&1048575)>>>0,e,r+n)}}}function a(c,o,n,t,e){var r=c(t,e+o),i=c(t,e+n),s=2*(i>>31)+1,u=i>>>20&2047,p=4294967296*(1048575&i)+r;return u===2047?p?NaN:s*(1/0):u===0?5e-324*s*p:s*Math.pow(2,u-1075)*(p+4503599627370496)}d.writeDoubleLE=l.bind(null,I,0,4),d.writeDoubleBE=l.bind(null,m,4,0),d.readDoubleLE=a.bind(null,h,0,4),d.readDoubleBE=a.bind(null,_,4,0)}(),d}function I(d,l,a){l[a]=255&d,l[a+1]=d>>>8&255,l[a+2]=d>>>16&255,l[a+3]=d>>>24}function m(d,l,a){l[a]=d>>>24,l[a+1]=d>>>16&255,l[a+2]=d>>>8&255,l[a+3]=255&d}function h(d,l){return(d[l]|d[l+1]<<8|d[l+2]<<16|d[l+3]<<24)>>>0}function _(d,l){return(d[l]<<24|d[l+1]<<16|d[l+2]<<8|d[l+3])>>>0}W.exports=T(T)},7199:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(W){}return null}module.exports=inquire},6662:function(W){"use strict";W.exports=function(T,I,m){var h=m||8192,_=h>>>1,d=null,l=h;return function(a){if(a<1||a>_)return T(a);l+a>h&&(d=T(h),l=0);var c=I.call(d,l,l+=a);return 7&l&&(l=1+(7|l)),c}}},4997:function(W,T){"use strict";var I=T;I.length=function(m){for(var h=0,_=0,d=0;d<m.length;++d)(_=m.charCodeAt(d))<128?h+=1:_<2048?h+=2:(64512&_)==55296&&(64512&m.charCodeAt(d+1))==56320?(++d,h+=4):h+=3;return h},I.read=function(m,h,_){if(_-h<1)return"";for(var d,l=null,a=[],c=0;h<_;)(d=m[h++])<128?a[c++]=d:d>191&&d<224?a[c++]=(31&d)<<6|63&m[h++]:d>239&&d<365?(d=((7&d)<<18|(63&m[h++])<<12|(63&m[h++])<<6|63&m[h++])-65536,a[c++]=55296+(d>>10),a[c++]=56320+(1023&d)):a[c++]=(15&d)<<12|(63&m[h++])<<6|63&m[h++],c>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,a)),c=0);return l?(c&&l.push(String.fromCharCode.apply(String,a.slice(0,c))),l.join("")):String.fromCharCode.apply(String,a.slice(0,c))},I.write=function(m,h,_){for(var d,l,a=_,c=0;c<m.length;++c)(d=m.charCodeAt(c))<128?h[_++]=d:d<2048?(h[_++]=d>>6|192,h[_++]=63&d|128):(64512&d)==55296&&(64512&(l=m.charCodeAt(c+1)))==56320?(d=65536+((1023&d)<<10)+(1023&l),++c,h[_++]=d>>18|240,h[_++]=d>>12&63|128,h[_++]=d>>6&63|128,h[_++]=63&d|128):(h[_++]=d>>12|224,h[_++]=d>>6&63|128,h[_++]=63&d|128);return _-a}},2100:function(W,T,I){"use strict";W.exports=I(9482)},9482:function(W,T,I){"use strict";var m=T;function h(){m.util._configure(),m.Writer._configure(m.BufferWriter),m.Reader._configure(m.BufferReader)}m.build="minimal",m.Writer=I(1173),m.BufferWriter=I(3155),m.Reader=I(1408),m.BufferReader=I(593),m.util=I(9693),m.rpc=I(5994),m.roots=I(5054),m.configure=h,h()},1408:function(W,T,I){"use strict";W.exports=a;var m,h=I(9693),_=h.LongBits,d=h.utf8;function l(i,s){return RangeError("index out of range: "+i.pos+" + "+(s||1)+" > "+i.len)}function a(i){this.buf=i,this.pos=0,this.len=i.length}var c,o=typeof Uint8Array!="undefined"?function(i){if(i instanceof Uint8Array||Array.isArray(i))return new a(i);throw Error("illegal buffer")}:function(i){if(Array.isArray(i))return new a(i);throw Error("illegal buffer")},n=function(){return h.Buffer?function(i){return(a.create=function(s){return h.Buffer.isBuffer(s)?new m(s):o(s)})(i)}:o};function t(){var i=new _(0,0),s=0;if(!(this.len-this.pos>4)){for(;s<3;++s){if(this.pos>=this.len)throw l(this);if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*s)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(127&this.buf[this.pos++])<<7*s)>>>0,i}for(;s<4;++s)if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*s)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(127&this.buf[this.pos])<<28)>>>0,i.hi=(i.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return i;if(s=0,this.len-this.pos>4){for(;s<5;++s)if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*s+3)>>>0,this.buf[this.pos++]<128)return i}else for(;s<5;++s){if(this.pos>=this.len)throw l(this);if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*s+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}function e(i,s){return(i[s-4]|i[s-3]<<8|i[s-2]<<16|i[s-1]<<24)>>>0}function r(){if(this.pos+8>this.len)throw l(this,8);return new _(e(this.buf,this.pos+=4),e(this.buf,this.pos+=4))}a.create=n(),a.prototype._slice=h.Array.prototype.subarray||h.Array.prototype.slice,a.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return c;if((this.pos+=5)>this.len)throw this.pos=this.len,l(this,10);return c}),a.prototype.int32=function(){return 0|this.uint32()},a.prototype.sint32=function(){var i=this.uint32();return i>>>1^-(1&i)|0},a.prototype.bool=function(){return this.uint32()!==0},a.prototype.fixed32=function(){if(this.pos+4>this.len)throw l(this,4);return e(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw l(this,4);return 0|e(this.buf,this.pos+=4)},a.prototype.float=function(){if(this.pos+4>this.len)throw l(this,4);var i=h.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i},a.prototype.double=function(){if(this.pos+8>this.len)throw l(this,4);var i=h.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i},a.prototype.bytes=function(){var i=this.uint32(),s=this.pos,u=this.pos+i;if(u>this.len)throw l(this,i);return this.pos+=i,Array.isArray(this.buf)?this.buf.slice(s,u):s===u?new this.buf.constructor(0):this._slice.call(this.buf,s,u)},a.prototype.string=function(){var i=this.bytes();return d.read(i,0,i.length)},a.prototype.skip=function(i){if(typeof i=="number"){if(this.pos+i>this.len)throw l(this,i);this.pos+=i}else do if(this.pos>=this.len)throw l(this);while(128&this.buf[this.pos++]);return this},a.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=7&this.uint32())!=4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this},a._configure=function(i){m=i,a.create=n(),m._configure();var s=h.Long?"toLong":"toNumber";h.merge(a.prototype,{int64:function(){return t.call(this)[s](!1)},uint64:function(){return t.call(this)[s](!0)},sint64:function(){return t.call(this).zzDecode()[s](!1)},fixed64:function(){return r.call(this)[s](!0)},sfixed64:function(){return r.call(this)[s](!1)}})}},593:function(W,T,I){"use strict";W.exports=_;var m=I(1408);(_.prototype=Object.create(m.prototype)).constructor=_;var h=I(9693);function _(d){m.call(this,d)}_._configure=function(){h.Buffer&&(_.prototype._slice=h.Buffer.prototype.slice)},_.prototype.string=function(){var d=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+d,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+d,this.len))},_._configure()},5054:function(W){"use strict";W.exports={}},5994:function(W,T,I){"use strict";T.Service=I(7948)},7948:function(W,T,I){"use strict";W.exports=h;var m=I(9693);function h(_,d,l){if(typeof _!="function")throw TypeError("rpcImpl must be a function");m.EventEmitter.call(this),this.rpcImpl=_,this.requestDelimited=Boolean(d),this.responseDelimited=Boolean(l)}(h.prototype=Object.create(m.EventEmitter.prototype)).constructor=h,h.prototype.rpcCall=function _(d,l,a,c,o){if(!c)throw TypeError("request must be specified");var n=this;if(!o)return m.asPromise(_,n,d,l,a,c);if(n.rpcImpl)try{return n.rpcImpl(d,l[n.requestDelimited?"encodeDelimited":"encode"](c).finish(),function(t,e){if(t)return n.emit("error",t,d),o(t);if(e!==null){if(!(e instanceof a))try{e=a[n.responseDelimited?"decodeDelimited":"decode"](e)}catch(r){return n.emit("error",r,d),o(r)}return n.emit("data",e,d),o(null,e)}n.end(!0)})}catch(t){return n.emit("error",t,d),void setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},h.prototype.end=function(_){return this.rpcImpl&&(_||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:function(W,T,I){"use strict";W.exports=h;var m=I(9693);function h(a,c){this.lo=a>>>0,this.hi=c>>>0}var _=h.zero=new h(0,0);_.toNumber=function(){return 0},_.zzEncode=_.zzDecode=function(){return this},_.length=function(){return 1};var d=h.zeroHash="\0\0\0\0\0\0\0\0";h.fromNumber=function(a){if(a===0)return _;var c=a<0;c&&(a=-a);var o=a>>>0,n=(a-o)/4294967296>>>0;return c&&(n=~n>>>0,o=~o>>>0,++o>4294967295&&(o=0,++n>4294967295&&(n=0))),new h(o,n)},h.from=function(a){if(typeof a=="number")return h.fromNumber(a);if(m.isString(a)){if(!m.Long)return h.fromNumber(parseInt(a,10));a=m.Long.fromString(a)}return a.low||a.high?new h(a.low>>>0,a.high>>>0):_},h.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var c=1+~this.lo>>>0,o=~this.hi>>>0;return c||(o=o+1>>>0),-(c+4294967296*o)}return this.lo+4294967296*this.hi},h.prototype.toLong=function(a){return m.Long?new m.Long(0|this.lo,0|this.hi,Boolean(a)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(a)}};var l=String.prototype.charCodeAt;h.fromHash=function(a){return a===d?_:new h((l.call(a,0)|l.call(a,1)<<8|l.call(a,2)<<16|l.call(a,3)<<24)>>>0,(l.call(a,4)|l.call(a,5)<<8|l.call(a,6)<<16|l.call(a,7)<<24)>>>0)},h.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},h.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},h.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},h.prototype.length=function(){var a=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,o=this.hi>>>24;return o===0?c===0?a<16384?a<128?1:2:a<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:o<128?9:10}},9693:function(W,T,I){"use strict";var m=T;function h(d,l,a){for(var c=Object.keys(l),o=0;o<c.length;++o)d[c[o]]!==void 0&&a||(d[c[o]]=l[c[o]]);return d}function _(d){function l(a,c){if(!(this instanceof l))return new l(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,l):Object.defineProperty(this,"stack",{value:new Error().stack||""}),c&&h(this,c)}return(l.prototype=Object.create(Error.prototype)).constructor=l,Object.defineProperty(l.prototype,"name",{get:function(){return d}}),l.prototype.toString=function(){return this.name+": "+this.message},l}m.asPromise=I(4537),m.base64=I(7419),m.EventEmitter=I(9211),m.float=I(945),m.inquire=I(7199),m.utf8=I(4997),m.pool=I(6662),m.LongBits=I(1945),m.isNode=Boolean(I.g!==void 0&&I.g&&I.g.process&&I.g.process.versions&&I.g.process.versions.node),m.global=m.isNode&&I.g||typeof window!="undefined"&&window||typeof self!="undefined"&&self||this,m.emptyArray=Object.freeze?Object.freeze([]):[],m.emptyObject=Object.freeze?Object.freeze({}):{},m.isInteger=Number.isInteger||function(d){return typeof d=="number"&&isFinite(d)&&Math.floor(d)===d},m.isString=function(d){return typeof d=="string"||d instanceof String},m.isObject=function(d){return d&&typeof d=="object"},m.isset=m.isSet=function(d,l){var a=d[l];return!(a==null||!d.hasOwnProperty(l))&&(typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0)},m.Buffer=function(){try{var d=m.inquire("buffer").Buffer;return d.prototype.utf8Write?d:null}catch(l){return null}}(),m._Buffer_from=null,m._Buffer_allocUnsafe=null,m.newBuffer=function(d){return typeof d=="number"?m.Buffer?m._Buffer_allocUnsafe(d):new m.Array(d):m.Buffer?m._Buffer_from(d):typeof Uint8Array=="undefined"?d:new Uint8Array(d)},m.Array=typeof Uint8Array!="undefined"?Uint8Array:Array,m.Long=m.global.dcodeIO&&m.global.dcodeIO.Long||m.global.Long||m.inquire("long"),m.key2Re=/^true|false|0|1$/,m.key32Re=/^-?(?:0|[1-9][0-9]*)$/,m.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,m.longToHash=function(d){return d?m.LongBits.from(d).toHash():m.LongBits.zeroHash},m.longFromHash=function(d,l){var a=m.LongBits.fromHash(d);return m.Long?m.Long.fromBits(a.lo,a.hi,l):a.toNumber(Boolean(l))},m.merge=h,m.lcFirst=function(d){return d.charAt(0).toLowerCase()+d.substring(1)},m.newError=_,m.ProtocolError=_("ProtocolError"),m.oneOfGetter=function(d){for(var l={},a=0;a<d.length;++a)l[d[a]]=1;return function(){for(var c=Object.keys(this),o=c.length-1;o>-1;--o)if(l[c[o]]===1&&this[c[o]]!==void 0&&this[c[o]]!==null)return c[o]}},m.oneOfSetter=function(d){return function(l){for(var a=0;a<d.length;++a)d[a]!==l&&delete this[d[a]]}},m.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},m._configure=function(){var d=m.Buffer;d?(m._Buffer_from=d.from!==Uint8Array.from&&d.from||function(l,a){return new d(l,a)},m._Buffer_allocUnsafe=d.allocUnsafe||function(l){return new d(l)}):m._Buffer_from=m._Buffer_allocUnsafe=null}},1173:function(W,T,I){"use strict";W.exports=n;var m,h=I(9693),_=h.LongBits,d=h.base64,l=h.utf8;function a(p,f,E){this.fn=p,this.len=f,this.next=void 0,this.val=E}function c(){}function o(p){this.head=p.head,this.tail=p.tail,this.len=p.len,this.next=p.states}function n(){this.len=0,this.head=new a(c,0,0),this.tail=this.head,this.states=null}var t=function(){return h.Buffer?function(){return(n.create=function(){return new m})()}:function(){return new n}};function e(p,f,E){f[E]=255&p}function r(p,f){this.len=p,this.next=void 0,this.val=f}function i(p,f,E){for(;p.hi;)f[E++]=127&p.lo|128,p.lo=(p.lo>>>7|p.hi<<25)>>>0,p.hi>>>=7;for(;p.lo>127;)f[E++]=127&p.lo|128,p.lo=p.lo>>>7;f[E++]=p.lo}function s(p,f,E){f[E]=255&p,f[E+1]=p>>>8&255,f[E+2]=p>>>16&255,f[E+3]=p>>>24}n.create=t(),n.alloc=function(p){return new h.Array(p)},h.Array!==Array&&(n.alloc=h.pool(n.alloc,h.Array.prototype.subarray)),n.prototype._push=function(p,f,E){return this.tail=this.tail.next=new a(p,f,E),this.len+=f,this},r.prototype=Object.create(a.prototype),r.prototype.fn=function(p,f,E){for(;p>127;)f[E++]=127&p|128,p>>>=7;f[E]=p},n.prototype.uint32=function(p){return this.len+=(this.tail=this.tail.next=new r((p>>>=0)<128?1:p<16384?2:p<2097152?3:p<268435456?4:5,p)).len,this},n.prototype.int32=function(p){return p<0?this._push(i,10,_.fromNumber(p)):this.uint32(p)},n.prototype.sint32=function(p){return this.uint32((p<<1^p>>31)>>>0)},n.prototype.uint64=function(p){var f=_.from(p);return this._push(i,f.length(),f)},n.prototype.int64=n.prototype.uint64,n.prototype.sint64=function(p){var f=_.from(p).zzEncode();return this._push(i,f.length(),f)},n.prototype.bool=function(p){return this._push(e,1,p?1:0)},n.prototype.fixed32=function(p){return this._push(s,4,p>>>0)},n.prototype.sfixed32=n.prototype.fixed32,n.prototype.fixed64=function(p){var f=_.from(p);return this._push(s,4,f.lo)._push(s,4,f.hi)},n.prototype.sfixed64=n.prototype.fixed64,n.prototype.float=function(p){return this._push(h.float.writeFloatLE,4,p)},n.prototype.double=function(p){return this._push(h.float.writeDoubleLE,8,p)};var u=h.Array.prototype.set?function(p,f,E){f.set(p,E)}:function(p,f,E){for(var y=0;y<p.length;++y)f[E+y]=p[y]};n.prototype.bytes=function(p){var f=p.length>>>0;if(!f)return this._push(e,1,0);if(h.isString(p)){var E=n.alloc(f=d.length(p));d.decode(p,E,0),p=E}return this.uint32(f)._push(u,f,p)},n.prototype.string=function(p){var f=l.length(p);return f?this.uint32(f)._push(l.write,f,p):this._push(e,1,0)},n.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new a(c,0,0),this.len=0,this},n.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(c,0,0),this.len=0),this},n.prototype.ldelim=function(){var p=this.head,f=this.tail,E=this.len;return this.reset().uint32(E),E&&(this.tail.next=p.next,this.tail=f,this.len+=E),this},n.prototype.finish=function(){for(var p=this.head.next,f=this.constructor.alloc(this.len),E=0;p;)p.fn(p.val,f,E),E+=p.len,p=p.next;return f},n._configure=function(p){m=p,n.create=t(),m._configure()}},3155:function(W,T,I){"use strict";W.exports=_;var m=I(1173);(_.prototype=Object.create(m.prototype)).constructor=_;var h=I(9693);function _(){m.call(this)}function d(l,a,c){l.length<40?h.utf8.write(l,a,c):a.utf8Write?a.utf8Write(l,c):a.write(l,c)}_._configure=function(){_.alloc=h._Buffer_allocUnsafe,_.writeBytesBuffer=h.Buffer&&h.Buffer.prototype instanceof Uint8Array&&h.Buffer.prototype.set.name==="set"?function(l,a,c){a.set(l,c)}:function(l,a,c){if(l.copy)l.copy(a,c,0,l.length);else for(var o=0;o<l.length;)a[c++]=l[o++]}},_.prototype.bytes=function(l){h.isString(l)&&(l=h._Buffer_from(l,"base64"));var a=l.length>>>0;return this.uint32(a),a&&this._push(_.writeBytesBuffer,a,l),this},_.prototype.string=function(l){var a=h.Buffer.byteLength(l);return this.uint32(a),a&&this._push(d,a,l),this},_._configure()},4095:function(W,T){"use strict";var I=this&&this.__assign||function(){return I=Object.assign||function(h){for(var _,d=1,l=arguments.length;d<l;d++)for(var a in _=arguments[d])Object.prototype.hasOwnProperty.call(_,a)&&(h[a]=_[a]);return h},I.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoAudioEffectPlayer=void 0;var m=function(){function h(_,d){this.zegoWebRTC=_,this.stream=d}return h.prototype.start=function(_,d,l,a){this.zegoWebRTC.playEffect(I({stream:this.stream,effectID:_},d||{}),l,a)},h.prototype.stop=function(_){return this.zegoWebRTC.stopEffect(this.stream,_)},h.prototype.pause=function(_){return this.zegoWebRTC.pauseEffect(this.stream,_)},h.prototype.resume=function(_){return this.zegoWebRTC.resumeEffect(this.stream,_)},h.prototype.setVolume=function(_,d){return this.zegoWebRTC.setEffectVolume(_,d)},h.prototype.getTotalDuration=function(_){return this.zegoWebRTC.getEffectDuration(_)},h.prototype.getCurrentProgress=function(_){return this.zegoWebRTC.getEffectCurrentProgress(this.stream,_)},h.prototype.seekTo=function(_,d){return this.zegoWebRTC.seekAudioEffect(this.stream,_,d)},h}();T.ZegoAudioEffectPlayer=m},8835:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRealTimeSequentialDataManager=void 0;var m=I(3504),h=function(){function _(d,l){this.dataChannelManager=new m.DataChannelListener(d,l)}return _.prototype.startBroadcasting=function(d){return this.dataChannelManager.startBroadcasting(d)},_.prototype.stopBroadcasting=function(d){return this.dataChannelManager.stopBroadcasting(d)},_.prototype.sendRealTimeSequentialData=function(d,l){return this.dataChannelManager.sendRealTimeSequentialData(d,l)},_.prototype.startSubscribing=function(d){return this.dataChannelManager.startSubscribing(d)},_.prototype.stopSubscribing=function(d){return this.dataChannelManager.stopSubscribing(d)},_.prototype.on=function(d,l){this.dataChannelManager.on(d,l)},_.prototype.off=function(d,l){this.dataChannelManager.off(d,l)},_}();T.ZegoRealTimeSequentialDataManager=h},1297:function(W,T){"use strict";var I,m,h;Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRangeAudioMode=T.ZegoRangeAudioMicrophoneState=T.ZegoMixStreamRenderMode=void 0,(h=T.ZegoMixStreamRenderMode||(T.ZegoMixStreamRenderMode={}))[h.AspectFill=0]="AspectFill",h[h.AspectFit=1]="AspectFit",(m=T.ZegoRangeAudioMicrophoneState||(T.ZegoRangeAudioMicrophoneState={}))[m.Off=0]="Off",m[m.TurningOn=1]="TurningOn",m[m.On=2]="On",(I=T.ZegoRangeAudioMode||(T.ZegoRangeAudioMode={}))[I.World=0]="World",I[I.Team=1]="Team"},3116:function(W,T,I){"use strict";var m=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoExpressRangeAudio=void 0;var h=m(I(2760)),_=function(){function d(l){this.zegoAudioListener=h.default.getInstance(l)}return d.getInstance=function(l){if(!d.instance){if(!l)throw Error("create instance failed.");d.instance=new d(l)}return d.instance},d.prototype.on=function(l,a){return this.zegoAudioListener.on(l,a)},d.prototype.off=function(l,a){return this.zegoAudioListener.off(l,a)},d.prototype.setAudioReceiveRange=function(l){this.zegoAudioListener.setAudioReceiveRange(l)},d.prototype.updateSelfPosition=function(l,a,c,o){this.zegoAudioListener.updateSelfPosition(l,a,c,o)},d.prototype.updateAudioSource=function(l,a){this.zegoAudioListener.updateAudioSource(l,a)},d.prototype.enableSpatializer=function(l){return this.zegoAudioListener.enableSpatializer(l)},d.prototype.enableMicrophone=function(l){return this.zegoAudioListener.enableMicrophone(l)},d.prototype.enableSpeaker=function(l){return this.zegoAudioListener.enableSpeaker(l)},d.prototype.setRangeAudioMode=function(l){this.zegoAudioListener.setRangeAudioMode(l)},d.prototype.setTeamID=function(l){this.zegoAudioListener.setRangeAudioTeamID(l)},d.prototype.isAudioContextRunning=function(){return this.zegoAudioListener.getAudioContextState()==="running"},d.prototype.resumeAudioContext=function(){return this.zegoAudioListener.resumeAudioContext()},d}();T.ZegoExpressRangeAudio=_},4780:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(u,p){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,E){f.__proto__=E}||function(f,E){for(var y in E)Object.prototype.hasOwnProperty.call(E,y)&&(f[y]=E[y])},m(u,p)},function(u,p){function f(){this.constructor=u}m(u,p),u.prototype=p===null?Object.create(p):(f.prototype=p.prototype,new f)}),_=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoExpressEngine=T.ClientUtil=void 0;var d=I(9880),l=_(I(3126)),a=_(I(9869)),c=_(I(3824)),o=_(I(7526)),n=_(I(577)),t=I(2777),e=I(4897),r=I(957);d.ZegoExpressEngine.use(l.default),d.ZegoExpressEngine.use(a.default),d.ZegoExpressEngine.use(c.default),d.ZegoExpressEngine.use(o.default),d.ZegoExpressEngine.use(n.default),d.ZegoExpressEngine.use(t.RangeAudio),d.ZegoExpressEngine.use(e.DataChannel),d.ZegoExpressEngine.use(r.BeautyEffect);var i=I(9880);Object.defineProperty(T,"ClientUtil",{enumerable:!0,get:function(){return i.ClientUtil}});var s=function(u){function p(){return u!==null&&u.apply(this,arguments)||this}return h(p,u),p}(d.ZegoExpressEngine);T.ZegoExpressEngine=s},9880:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(o,n){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},m(o,n)},function(o,n){function t(){this.constructor=o}m(o,n),o.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)});Object.defineProperty(T,"__esModule",{value:!0}),T.ClientUtil=T.ZegoExpressEngine=void 0;var _=I(4119),d=I(5321),l=I(4095),a=function(o){function n(t,e){var r=this;return _.ZegoExpressWebRTMEngine.version="2.15.1",(r=o.call(this,t,e,0,arguments[2])||this).zegoWebRTC=new d.ZegoWebRTC(r.logger,r.dataReport,r.zegoWebRTM),r}return h(n,o),n.use=function(t){_.ZegoExpressWebRTMEngine.use(t),d.ZegoWebRTC.use(t)},n.prototype.checkSystemRequirements=function(t,e){return e===void 0&&(e=0),this.zegoWebRTC.checkSystemRequirements(e,t)},n.prototype.off=function(t,e){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.off(t,e):!!this.zegoWebRTC.stateCenter.listenerList[t]&&this.zegoWebRTC.off(t,e)},n.prototype.on=function(t,e){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.on(t,e):!!this.zegoWebRTC.stateCenter.listenerList[t]&&this.zegoWebRTC.on(t,e)},n.prototype.createStream=function(t){return this.zegoWebRTC.createStream(t)},n.prototype.getPublishingStreamQuality=function(t){return this.zegoWebRTC.getPublishingStreamQuality(t)},n.prototype.getElectronScreenSources=function(){return this.zegoWebRTC.getElectronScreenSources()},n.prototype.destroyStream=function(t){return this.zegoWebRTC.destroyStream(t)},n.prototype.startPublishingStream=function(t,e,r){return this.zegoWebRTC.startPublishingStream(t,e,r)},n.prototype.stopPublishingStream=function(t){return this.zegoWebRTC.stopPublishingStream(t)},n.prototype.setVideoConfig=function(t,e){return this.zegoWebRTC.setVideoConfig(t,e)},n.prototype.setAudioConfig=function(t,e){return this.zegoWebRTC.setAudioConfig(t,e)},n.prototype.replaceTrack=function(t,e){return this.zegoWebRTC.replaceTrack(t,e)},n.prototype.setCaptureVolume=function(t,e){return this.zegoWebRTC.setCaptureVolume(t,e)},n.prototype.setDummyCaptureImagePath=function(t,e){return this.zegoWebRTC.setDummyCaptureImagePath(t,e)},n.prototype.setStreamExtraInfo=function(t,e){return this.zegoWebRTC.setStreamExtraInfo(t,e)},n.prototype.addPublishCdnUrl=function(t,e){return arguments.length===3?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(t,e)},n.prototype.removePublishCdnUrl=function(t,e){return arguments.length===3?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(t,e)},n.prototype.mutePublishStreamVideo=function(t,e,r){return this.zegoWebRTC.mutePublishStreamVideo(t,e,r)},n.prototype.mutePublishStreamAudio=function(t,e){return this.zegoWebRTC.mutePublishStreamAudio(t,e)},n.prototype.setEffectsBeauty=function(t,e,r){return this.zegoWebRTC.setBeautyEffect(t,e,r)},n.prototype.startPlayingStream=function(t,e){return this.zegoWebRTC.startPlayingStream(t,e)},n.prototype.stopPlayingStream=function(t){return this.zegoWebRTC.stopPlayingStream(t)},n.prototype.mutePlayStreamVideo=function(t,e){return this.zegoWebRTC.mutePlayStreamVideo(t,e)},n.prototype.mutePlayStreamAudio=function(t,e){return this.zegoWebRTC.mutePlayStreamAudio(t,e)},n.prototype.getPlayingStreamQuality=function(t){return this.zegoWebRTC.getPlayingStreamQuality(t)},n.prototype.startMixerTask=function(t){return this.zegoWebRTC.startMixerTask(t)},n.prototype.stopMixerTask=function(t){return this.zegoWebRTC.stopMixerTask(t)},n.prototype.setMixerTaskConfig=function(t){return this.zegoWebRTC.setMixerTaskConfig(t)},n.prototype.startMixingAudio=function(t,e){return this.zegoWebRTC.startMixingAudio(t,e)},n.prototype.stopMixingAudio=function(t,e){return this.zegoWebRTC.stopMixingAudio(t,e)},n.prototype.setMixingAudioVolume=function(t,e,r){return this.zegoWebRTC.setMixingAudioVolume(t,e,r)},n.prototype.createAudioEffectPlayer=function(t){if(t instanceof MediaStream)return new l.ZegoAudioEffectPlayer(this.zegoWebRTC,t);throw Error("Param localStream is not instance of MediaStream.")},n.prototype.loadAudioEffect=function(t,e){var r=this;return new Promise(function(i,s){r.zegoWebRTC.preloadEffect(t,e,function(u){u&&s(u),i(t)})})},n.prototype.unloadAudioEffect=function(t,e){return this.zegoWebRTC.unloadEffect(t)},n.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},n.prototype.getCameras=function(){return this.zegoWebRTC.getCameras()},n.prototype.getMicrophones=function(){return this.zegoWebRTC.getMicrophones()},n.prototype.getSpeakers=function(){return this.zegoWebRTC.getSpeakers()},n.prototype.useVideoDevice=function(t,e){return this.zegoWebRTC.useVideoDevice(t,e)},n.prototype.useAudioDevice=function(t,e){return this.zegoWebRTC.useAudioDevice(t,e)},n.prototype.useAudioOutputDevice=function(t,e){return this.zegoWebRTC.setAudioOutputDevice(t,e)},n.prototype.setSoundLevelDelegate=function(t,e,r){return this.zegoWebRTC.setSoundLevelDelegate(t,e,r==null?void 0:r.enableInBackground)},n.prototype.isMicrophoneMuted=function(){return this.zegoWebRTC.isMicrophoneMuted()},n.prototype.muteMicrophone=function(t){return this.zegoWebRTC.muteMicrophone(t)},n.prototype.enableVideoCaptureDevice=function(t,e){return this.zegoWebRTC.enableCameraCapturing(t,e)},n.prototype.createRangeAudioInstance=function(){return this.zegoWebRTC.createRangeAudioInstance()},n.prototype.createRealTimeSequentialDataManager=function(t){return this.zegoWebRTC.createRealTimeSequentialDataManager(t)},n.prototype.destroyRealTimeSequentialDataManager=function(t){this.zegoWebRTC.destroyRealTimeSequentialDataManager(t)},n}(_.ZegoExpressWebRTMEngine);T.ZegoExpressEngine=a;var c=I(608);Object.defineProperty(T,"ClientUtil",{enumerable:!0,get:function(){return c.ClientUtil}})},1089:function(W,T){"use strict";var I,m;Object.defineProperty(T,"__esModule",{value:!0}),T.ZEGO_WECHATMINI_ACTION=T.ZEGO_WEBRTC_ACTION=void 0,(m=T.ZEGO_WEBRTC_ACTION||(T.ZEGO_WEBRTC_ACTION={})).CONSTRUCTOR="zc.0",m.CHECK_SUPPORT="zc.csr",m.CREATE_STREAM="zc.cs",m.DESTROY_STREAM="zc.ds",m.START_PUBLISHING_STREAM="zc.sps.0",m.START_PLAYING_STREAM="zc.sps.1",m.STOP_PUBLISHING_STREAM="zc.sps.0.0",m.STOP_PLAYING_STREAM="zc.sps.1.0",m.ON_STREAM="zc.os",m.ON_PUSH_STREAM_UPDATE="zc.opsu",m.BIND_WINDOW_LISTENER="zc.wl",m.SET_AUDIO_OUTPUT="zc.sao",m.SET_CUSTOM_SIGNAL_URL="zc.scsu",m.SET_TURN_OVER_TCP_ONLY="zc.stoto",m.RDH_ACTIVE="zc.rdh.a",m.RDH_MAX_TIME="zc.rdh.m",m.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",m.PUBLISH_STATE_HANDLE="zc.psh.0",m.PLAY_STATE_HANDLE="zc.psh.1",m.STATECENTER_ACTION_LISTENER="zc.sc.al",m.STATECENTER_SET_SETTING="zc.sc.ss",m.SIGNAL_SET_SESSION_INFO="zc.s.ssi",m.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",m.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",m.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",m.SIGNAL_UPDATE_TOKEN="zc.s.ut",m.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",m.SIGNAL_CONNECT_SERVER="zc.s.cs.0",m.SIGNAL_START_CONNECT_TIMER="zc.s.sct",m.SIGNAL_DISCONNECT_SERVER="zc.s.dc",m.SIGNAL_CREATE_SESSION="zc.s.cs.1",m.SIGNAL_REMOVE_SESSION="zc.s.rs",m.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",m.SIGNAL_SEND_MESSAGE="zc.s.sm",m.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",m.SIGNAL_ADD_SESSION="zc.s.as",m.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",m.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",m.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",m.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",m.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",m.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",m.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",m.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",m.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",m.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",m.SIGNAL_SEND_HEARTBEAT="zc.s.sh",m.SIGNAL_QUALITY_REPORT="zc.s.qr",m.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",m.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",m.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",m.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",m.SIGNAL_SEND_NET_PROBE="zc.s.snp",m.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",m.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",m.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",m.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",m.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",m.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",m.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",m.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",m.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",m.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",m.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",m.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",m.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",m.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",m.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",m.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",m.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",m.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",m.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",m.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",m.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",m.PUBLISHER_STATE_ERROR="zc.p.0.psr",m.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",m.PUBLISHER_ON_DISCONNECT="zc.p.0.od",m.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",m.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",m.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",m.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",m.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC="zc.p.0.orumd",m.PLAYER_START_PLAY="zc.p.1.sp.0",m.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",m.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",m.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",m.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",m.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",m.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",m.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",m.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",m.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",m.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",m.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",m.PLAYER_RESET_PLAY="zc.p.rp.1",m.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",m.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",m.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",m.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",m.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",m.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",m.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",m.PLAYER_STATE_ERROR="zc.p.psr.1",m.PLAYER_STOP_PLAY="zc.p.1.sp.1",m.PLAYER_ON_DISCONNECT="zc.p.od.1",m.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",m.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",m.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",m.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",m.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe",m.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",m.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",m.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl",m.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2="zc.sh.sbr",m.ANALOGSOCKET_UPDATE_MEDIA_READY_STATE="zc.as.umrs",m.ANALOGSOCKET_UPDATE_ACCESS_READY_STATE="zc.as.uars",m.ANALOGSOCKET_SET_MEDIA_SERVER_STATE="zc.as.smss",m.ANALOGSOCKET_SET_ACCESS_SERVER_STATE="zc.as.sass",m.ANALOGSOCKET_SEND="zc.as.s.0",m.ANALOGSOCKET_OPEN="zc.as.op",(I=T.ZEGO_WECHATMINI_ACTION||(T.ZEGO_WECHATMINI_ACTION={})).ADD_PUBLISH_CDN_URL="zw.apcu",I.REMOVE_PUBLISH_CDN_URL="zw.rpcu",I.STOP_MIXER_TASK="zw.smt",I.ON_STREAM="zw.os",I.ON_PUSH_STREAM_UPDATE="zw.opsu",I.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",I.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",I.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",I.WECHATMINI_BIND_LISTENER="zw.w.bl",I.WECHATMINI_DELETE_LISTENER="zw.w.dl",I.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",I.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",I.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",I.WECHATMINI_GET_NEXT_URL="zw.w.gnu",I.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",I.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",I.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",I.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",I.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",I.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",I.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",I.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",I.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",I.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",I.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",I.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",I.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",I.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",I.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",I.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",I.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",I.STREAMCENTERWECHAT_RESET="zw.scw.r.0",I.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",I.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",I.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",I.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",I.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",I.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",I.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",I.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",I.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",I.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",I.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",I.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",I.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",I.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",I.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",I.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",I.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",I.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"},9595:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RTC=T.ZegoSettingConfig=void 0;var I=function(){function m(){this.defaultSetting={publish_video_codec:"H264",camera_video_bitrate:800,screen_video_bitrate:1500,custom_video_bitrate:0,l3_play_buffer_ms:500,AEC:!0,AGC:!0,ANS:!0,resource_mode:0,bitrate_mode:"default"},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return m.getInstance=function(){return m.instance||(m.instance=new m),m.instance},m.prototype.setSetting=function(h,_){var d=Array.isArray(_)&&_.length>0;for(var l in h)for(var a in h[l])if(!a.endsWith("_ctrlmode")){if(d&&_.indexOf(a)==-1)continue;var c=h[l][a+"_ctrlmode"];c===1||c===2?this.setting[a]=h[l][a]:this.defaultSetting[a]&&(this.setting[a]=this.defaultSetting[a]),typeof c=="number"&&(this.setting[a+"_ctrlmode"]=h[l][a+"_ctrlmode"])}},m.prototype.getSetting=function(h,_){return _===void 0&&(_=!1),_?this.setting[h+"_ctrlmode"]==2?this.setting[h]:void 0:this.setting[h]},m}();T.ZegoSettingConfig=I,T.RTC="rtc"},7325:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StateCenter=void 0;var m=I(6706),h=I(608),_=I(1089),d=I(9595),l=I(6706),a=I(3529),c=function(){function o(n,t){this.logger=n,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=l.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.isMultiRoom=!1,this.browser="",this.playAccelerate=!0,this.logReportCallback=h.ClientUtil.logReportCallback,this.unregisterCallback=h.ClientUtil.unregisterCallback,this.checkIllegalCharacters=h.ClientUtil.checkIllegalCharacters,this.decodeServerError=h.ClientUtil.decodeServerError,this.getLiveRoomError=h.ClientUtil.getLiveRoomError,this.getServerError=h.ClientUtil.getServerError,this.mergeStreamList=h.ClientUtil.mergeStreamList,this.checkInteger=h.ClientUtil.checkInteger,this.isUrl=h.ClientUtil.isUrl,this.actionSuccessCallback=h.ClientUtil.actionSuccessCallback,this.checkValidNumber=h.ClientUtil.checkValidNumber,this.getDevices=h.ClientUtil.getDevices,this.settingConfig=new d.ZegoSettingConfig}return o.prototype.getRequestId=function(){return this.idName+"-"+l.getSeq()},o.prototype.getSignalCmdContent=function(n,t,e,r){var i={request_id:t,room_id:n,from_userid:this.idName,from_username:this.nickName,to_userid:e};return r!=null&&(i.result=r),JSON.stringify(i)},o.prototype.actionListener=function(n){for(var t=this,e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(n)&&this.listenerList[n]){var i=m.getReportSeq();this.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(i,{listener:n,params:e}),this.dataReport.uploadReport(i)}this.listenerList[n]&&this.listenerList[n].forEach(function(s){try{setTimeout(function(){s.apply(void 0,e)},0)}catch(u){t.logger.error(_.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+n+" "+u)}})},o.prototype.getRoomByRoomID=function(n){return this.roomList.find(function(t){return t.roomID==n})},o.prototype.getPlayRoom=function(n){return this.roomList.find(function(t){return!!t.streamList.find(function(e){return e.stream_id==n})})},o}();T.StateCenter=c},5740:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoStreamCenter=void 0,T.ZegoStreamCenter=function(){this.publisherList={},this.playerList={}}},7560:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StreamHandler=void 0;var m=I(6706),h=I(2752),_=I(1089),d=function(){function l(a,c,o,n,t){this.logger=a,this.stateCenter=c,this.rtm=o,this.streamCenter=n,this.roomID=t,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return l.prototype.setCDNInfo=function(a,c){a.urlFlv=c.urls_flv instanceof Array?c.urls_flv[0]||"":typeof c.urls_flv=="string"?c.urls_flv:"",a.urlHls=c.urls_m3u8 instanceof Array?c.urls_m3u8[0]||"":typeof c.urls_m3u8=="string"?c.urls_m3u8:"",a.urlHttpsFlv=c.urls_https_flv instanceof Array?c.urls_https_flv[0]||"":typeof c.urls_https_flv=="string"?c.urls_https_flv:"",a.urlHttpsHls=c.urls_https_m3u8 instanceof Array?c.urls_https_m3u8[0]||"":typeof c.urls_https_m3u8=="string"?c.urls_https_m3u8:"",a.urlRtmp=c.urls_rtmp instanceof Array?c.urls_rtmp[0]||"":typeof c.urls_rtmp=="string"?c.urls_rtmp:""},l.prototype.onStreamUpdated=function(a,c,o){},l.prototype.onStreamExtraInfoUpdated=function(a,c){},l.prototype.handleStreamStart=function(a,c){this.logger.info("zb.sh.hss call stream update"),this.room=c,a.body?(this.streamListHBMergeInterval=a.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=a.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(a.body.stream_seq,a.body.stream_info||[]),this.handleReconnectStream(a.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},l.prototype.onPublishStateUpdate=function(a,c,o){},l.prototype.updateStreamInfo=function(a,c,o,n){var t,e,r=this;o===void 0&&(o=""),this.logger.info("zb.sh.usi call");var i=o,s=(t=this.room)===null||t===void 0?void 0:t.streamList.find(function(S){return S.stream_id===a});s||this.logger.warn("zb.sh.usi stream not in room cmd "+c);var u={stream_id:a,extra_info:i};c!==2002&&c!==2003||(u.stream_sid=(s==null?void 0:s.stream_sid)||"");var p=JSON.stringify(u),f={sub_cmd:c,stream_msg:p,third_token:(e=this.room)===null||e===void 0?void 0:e.token},E=this.room;this.room.streamInfoList[a]={};var y=function(S,k){r.handleStreamUpdateRsp(S,a,c)},b=function(S,k){var O=r.room;if(O&&!O.isResetRoom&&!r.rtm.isDisConnect()&&S.code&&S.code==h.errorCodeList.TIMEOUT.code&&O.streamInfoList[a].seq==k)c==2001&&r.stateCenter.publishStreamList[a]&&r.stateCenter.publishStreamList[a].state==m.ENUM_PUBLISH_STREAM_STATE.update_info||c==2002?setTimeout(function(){r.updateStreamInfo(a,c,o,n)},0):n&&n(h.errorCodeList.TIMEOUT);else if(S.body&&S.body.err_code){var g=r.stateCenter.getServerError(S.body.err_code,r.stateCenter.useNetAgent,S.body.err_message);[1011,1000002002].includes(g.code)&&(g=h.errorCodeList.TOKEN_EXPIRED),n&&n(g,k),c===m.ENUM_STREAM_SUB_CMD.liveBegin&&r.onPublishStateUpdate(m.ENUM_PUBLISH_STATE_UPDATE.error,a,g)}};this.stateCenter.useNetAgent?this.rtm.liveRoomHandler.sendStreamUpdate(f,y,b,{sessionID:E==null?void 0:E.sessionID,roomID:E==null?void 0:E.roomID,roomSessionID:E==null?void 0:E.roomSessionID}):this.room.streamInfoList[a].seq=this.rtm.service.sendMessage("stream",f,y,b,void 0,{sessionID:E==null?void 0:E.sessionID,roomID:E==null?void 0:E.roomID,roomSessionID:E==null?void 0:E.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+c)},l.prototype.handleStreamUpdateRsp=function(a,c,o){var n,t,e;if(this.rtm.isDisConnect())this.logger.warn("zb.sh.hsur not login");else if(a.body.err_code==0){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+a.body.stream_seq),this.streamSeq=a.body.stream_seq;var r=this.room;if(r)if(((n=a==null?void 0:a.body)===null||n===void 0?void 0:n.token_remain_time)&&(this.stateCenter.getRoomByRoomID((t=a==null?void 0:a.header)===null||t===void 0?void 0:t.room_id)?this.rtm.resetRoomTokenTimer(a.header.room_id,a.body.token_remain_time):this.logger.error("zb.sh.hsur room no found ignore "+JSON.stringify((e=a.header)===null||e===void 0?void 0:e.room_id))),this.stateCenter.useNetAgent)this.handleStreamSync(a,c,o);else for(var i=0;i<a.body.stream_info.length;i++){var s=a.body.stream_info[i].stream_id;this.handleStreamRsp(r,s,a.body.stream_info[i],o),delete r.streamInfoList[s]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+a.body.err_code)},l.prototype.handleStreamSync=function(a,c,o){if(a.body.stream_seq>this.streamSeq)this.fetchStreamList();else{var n=this.room.streamList.find(function(t){return t.stream_id==c});n&&a.body.stream_ver>n.stream_ver?this.fetchStreamList(c):this.handleStreamRsp(this.room,c,{stream_id:c,stream_sid:a.body.stream_sid,stream_ver:a.body.stream_ver,stream_nid:a.body.stream_nid},o)}},l.prototype.handleStreamRsp=function(a,c,o,n){var t=this.stateCenter.publishStreamList[c];t?t.state==m.ENUM_PUBLISH_STREAM_STATE.update_info&&(t.state=m.ENUM_PUBLISH_STREAM_STATE.publishing,this.logger.info("hsur.0 cmd "+n),n===2001||a.streamList.find(function(e){return e.stream_id==c})||a.streamList.push(o),this.onPublishStateUpdate(m.ENUM_PUBLISH_STATE_UPDATE.start,c,{code:0,message:""})):this.logger.info("hsur.0 stream is not exist")},l.prototype.handleFetchStreamListRsp=function(a,c){if(this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,a.body.err_code===0)if(this.streamSeq!==a.body.stream_seq){var o=a.body.stream_info;c&&(o=a.body.stream_info.filter(function(n){return n.stream_id===c})),this.handleFullUpdateStream(a.body.stream_seq,o),this.logger.info("zb.sh.hfslr call success")}else this.logger.info("zb.sh.hfslr same seq");else this.logger.info("zb.sh.hfslr server error=",a.body.err_code)},l.prototype.handleFullUpdateStream=function(a,c){var o=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=a,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),this.stateCenter.mergeStreamList(this.stateCenter.idName,this.room.streamList,c,function(n,t,e){n.length!==0&&(o.logger.debug("zb.sh.hfus callback addstream"),o.onStreamUpdated(o.roomID,m.ENUM_STREAM_UPDATE_TYPE.added,o.makeCallbackStreamList(n))),t.length!==0&&(o.logger.debug("zb.sh.hfus callback delstream"),o.onStreamUpdated(o.roomID,m.ENUM_STREAM_UPDATE_TYPE.deleted,o.makeCallbackStreamList(t))),e.length!==0&&(o.logger.debug("zb.sh.hfus callback updatestream"),o.onStreamExtraInfoUpdated(o.roomID,o.makeCallbackStreamList(e)))}),this.logger.info("zb.sh.hfus call success")},l.prototype.handlePushStreamUpdateMsg=function(a){if(this.logger.warn("zb.sh.hpsum call "+JSON.stringify(a)),a.body.stream_info&&a.body.stream_info.length!==0){if(a.body.stream_info.length+this.streamSeq!==a.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=a.body.stream_seq,a.body.stream_cmd){case m.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(a.body.stream_info);break;case m.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(a.body.stream_info);break;case m.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(a.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},l.prototype.handlePriPushStreamUpdateMsg=function(a){if(this.logger.info("zb.sh.hpsum call"),a.body.streams_info&&a.body.streams_info.length!==0){if(a.body.streams_info.length+this.streamSeq!==a.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(a.body.stream_cmd,a.body.stream_seq,a.body.streams_info);switch(this.streamSeq=a.body.stream_seq,a.body.stream_cmd){case m.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(a.body.streams_info);break;case m.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(a.body.streams_info);break;case m.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(a.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},l.prototype.handleAddedStreamList=function(a){this.logger.debug("zb.sh.hasl call");for(var c,o=[],n=0;n<a.length;n++)if(a[n].anchor_id_name!=this.stateCenter.idName&&a[n].id_name!=this.stateCenter.idName&&a[n].user_id!==this.stateCenter.idName){c=!1;for(var t=0;t<this.room.streamList.length;t++)if(a[n].stream_id===this.room.streamList[t].stream_id){c=!0;break}c||o.push(a[n])}else this.logger.debug("hdsl.0 have self stream added");if(o.length!==0){this.logger.debug("zb.sh.hasl callback addstream");for(var e=0;e<o.length;e++)this.room.streamList.push(o[e]);this.onStreamUpdated(this.roomID,m.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(o))}this.logger.info("zb.sh.hasl call success")},l.prototype.handleDeletedStreamList=function(a){this.logger.debug("zb.sh.hdsl call");for(var c=[],o=0;o<a.length;o++)if(a[o].anchor_id_name!=this.stateCenter.idName&&a[o].id_name!=this.stateCenter.idName&&a[o].user_id!==this.stateCenter.idName){for(var n=this.room.streamList.length-1;n>=0;n--)if(a[o].stream_id===this.room.streamList[n].stream_id){this.room.streamList.splice(n--,1),c.push(a[o]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");c.length!==0&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,m.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(c))),this.logger.info("zb.sh.hdsl call")},l.prototype.handleUpdatedStreamList=function(a){this.logger.debug("zb.sh.husl call");for(var c=[],o=0;o<a.length;o++)if(a[o].anchor_id_name!=this.stateCenter.idName&&a[o].id_name!=this.stateCenter.idName&&a[o].user_id!==this.stateCenter.idName){for(var n=0;n<this.room.streamList.length;n++)if(a[o].stream_id===this.room.streamList[n].stream_id){a[o].extra_info!==this.room.streamList[n].extra_info&&(this.room.streamList[n]=a[o],c.push(a[o]));break}}else this.logger.debug("hsul.0 have self stream updated");c.length!==0&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(c))),this.logger.info("zb.sh.husl call success")},l.prototype.fetchStreamList=function(a){var c,o,n,t=this;if(this.logger.info("zb.sh.fsl call"),this.rtm.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else{if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),this.stateCenter.useNetAgent)this.rtm.liveRoomHandler.getStreamList({},function(r){t.handleFetchStreamListRsp(r,a)},function(r){},{roomID:(c=this.room)===null||c===void 0?void 0:c.roomID,sessionID:(o=this.room)===null||o===void 0?void 0:o.sessionID,roomSessionID:(n=this.room)===null||n===void 0?void 0:n.roomSessionID});else{var e=this.room;this.rtm.service.sendMessage("stream_info",{reserve:0},this.handleFetchStreamListRsp.bind(this),function(r,i){},void 0,{roomID:e==null?void 0:e.roomID,sessionID:e==null?void 0:e.sessionID,roomSessionID:e==null?void 0:e.roomSessionID})}this.logger.info("zb.sh.fsl call success")}},l.prototype.handleReconnectStream=function(a){var c,o;this.logger.info("zb.sh.hrs call");var n=this.streamCenter.publisherList,t=this.streamCenter.playerList,e=function(u){if(((o=(c=n[u])===null||c===void 0?void 0:c.room)===null||o===void 0?void 0:o.roomID)!==r.roomID)return"continue";if(n[u].publisher.state!=m.ENUM_PUBLISH_STATE.publishing||a.find(function(E){return E.stream_id==u})){if(n[u].publisher.state==m.ENUM_PUBLISH_STATE.stop&&a.find(function(E){return E.stream_id==u})){f=void 0,f=r.stateCenter.type==="PUBLIC"?m.ENUM_STREAM_SUB_CMD.liveEnd:m.ENUM_STREAM_CMD_PRI.liveEnd,r.updateStreamInfo(u,f);for(var p=0;p<r.room.streamList.length;p++)if(r.room.streamList[p].stream_id==u){r.room.streamList.splice(p--,1);break}}}else{var f=void 0;f=r.stateCenter.type==="PUBLIC"?m.ENUM_STREAM_SUB_CMD.liveBegin:m.ENUM_STREAM_CMD_PRI.liveBegin,r.updateStreamInfo(u,f,r.stateCenter.publishStreamList[u].extra_info)}},r=this;for(var i in n)e(i);for(var i in n)n[i].room.roomID===this.roomID&&n[i].isReDispatch&&(this.logger.info("zb.sh.hrs "+i+"retry dispatch"),(s=n[i].retryDispatchHandler).stopMaxTime(),s.invalid(),s.initStream(i,n[i].publishOption,!0),s.active(0),n[i].isReDispatch=!1);for(var i in t){var s;t[i].room.roomID===this.roomID&&t[i].isReDispatch&&(this.logger.info("zb.sh.hrs "+i+"retry dispatch"),(s=t[i].retryDispatchHandler).stopMaxTime(),s.invalid(),s.initStream(i,t[i].playOption,!1),s.active(0),t[i].isReDispatch=!1)}this.logger.info("zb.sh.hrs end")},l.prototype.makeCallbackStreamList=function(a){var c,o=[];if(this.stateCenter.useNetAgent&&(c=this.stateCenter.appConfig.media_config.play_config.resource_info.find(function(k){return k.resource_type===m.SignalResourceType.CDN})),a&&a.length>0)for(var n=0;n<a.length;n++){var t=[],e=[],r=[],i=a[n].stream_id;if(c){for(var s=0;s<c.service_info.length;s++){var u=c.service_info[s],p=u.protocol,f=u.url_template;switch(p){case m.ProtocolType.FLV:var E=f.replace("{STREAM_NAME}",i);t.push(E);break;case m.ProtocolType.HLS:var y=f.replace("{STREAM_NAME}",i);e.push(y);break;case m.ProtocolType.RTMP:var b=f.replace("{STREAM_NAME}",i);r.push(b)}}a[n].urls_flv=t,a[n].urls_m3u8=e,a[n].urls_rtmp=r}var S={user:{userID:a[n].anchor_id_name||a[n].id_name,userName:a[n].anchor_nick_name||a[n].nick_name},extraInfo:a[n].extra_info,streamID:a[n].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:a[n].stream_gid,closeType:a[n].close_type};this.setCDNInfo(S,a[n]),o.push(S)}return o},l.prototype.sendBizChannelRequest=function(a,c,o,n){var t=this;n===void 0&&(n=!1),a=Object.assign(a,{is_retry_req:n?1:0});var e=this.room;this.rtm.service.sendMessage("biz_channel",a,function(r,i){c(r.header.seq,r.body.cmd,r.body.rsp_body)},function(r,i){var s=r.body.err_code,u=r.body.rsp_body;typeof s!="number"||s!==2002?o(s,i,u):t.sendBizChannelRequest(a,c,o,!0)},void 0,{roomID:e==null?void 0:e.roomID,sessionID:e==null?void 0:e.sessionID,roomSessionID:e==null?void 0:e.roomSessionID})},l.prototype.sendBizChannelRequestV2=function(a,c,o,n){var t=this,e=a.server,r=a.location,i=a.cmd,s=a.channel,u=this.rtm.netAgent,p=this.room,f=void 0,E=c.timestamp;c&&(f=JSON.stringify(c));var y={cmd:i,req_body:f,appid:this.stateCenter.appid,timestamp:E||Math.ceil(new Date().getTime()/1e3),token:p==null?void 0:p.token,user_id:this.stateCenter.idName,channel:s||"media"};this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2+" "+JSON.stringify(y)+" request "+JSON.stringify(a)),u.startHttpRequest({service:e,headers:[],body:y,idName:this.stateCenter.idName,method_no:2,ack:!1,location:r},function(b){t.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2+" rsp "+JSON.stringify(b.body));var S=b.status_code,k=b.body;if(S===200){var O=k;if(typeof k=="string")try{O=JSON.parse(k)}catch(L){throw n(S),L}var g=O.err_code,v=O.rsp_body,R=void 0;try{R=JSON.parse(v)}catch(L){R=v}if(g!==0)return typeof g=="number"&&g===2002?void t.sendBizChannelRequest(c,o,n,!0):void n(S,g,R);o(R)}else n(S)},function(b){n(-1,b==null?void 0:b.code,void 0,b)})},l.prototype.updateStreamExtraInfo=function(a,c,o,n){},l.prototype.setStreamExtraInfo=function(a,c,o,n){},l.prototype._publishTarget=function(a,c,o){},l.prototype.patchStreamList=function(a){var c=this;if(typeof a.body.StreamRefresh=="number"&&a.body.StreamRefresh!==0)return this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" stream refresh "),void this.fetchStreamList();a.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+a.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){c.handleMergeTimeout()},this.streamListHBMergeInterval)),this.minStreamSeq=a.body.stream_seq},l.prototype.mergeStreamByStreamSeq=function(a,c,o){var n=this;this.streamSeqMergeMap||(this.logger.warn(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+c),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){n.handleMergeTimeout()},this.streamListMergeInterval)),this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+a+" "+c+" "+o),this.streamSeqMergeMap[c]={cmd:a,streamList:o}},l.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var a=Object.keys(this.streamSeqMergeMap).map(function(c){return+c}).sort(function(c,o){return c-o});a[a.length-1]-a[0]+1===a.length||a[a.length-1]>=this.minStreamSeq?this.mergeStream(a):(this.streamSeqMergeMap=null,this.fetchStreamList())}},l.prototype.mergeStream=function(a){var c=this;this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+a.join(","));var o=a[a.length-1],n=[];a.forEach(function(t){if(c.streamSeqMergeMap&&c.streamSeqMergeMap[t])switch(c.streamSeqMergeMap[t].cmd){case m.ENUM_STREAM_UPDATE_CMD.added:c.streamSeqMergeMap[t].streamList.forEach(function(e){var r=n.findIndex(function(i){return i.stream_id==e.stream_id});r!==-1&&n.splice(r),n.push(e)});break;case m.ENUM_STREAM_UPDATE_CMD.deleted:c.streamSeqMergeMap[t].streamList.forEach(function(e){var r=n.findIndex(function(i){return i.stream_id==e.stream_id});r!==-1&&n.splice(r)});break;case m.ENUM_STREAM_UPDATE_CMD.updated:c.streamSeqMergeMap[t].streamList.forEach(function(e){var r=n.findIndex(function(i){return i.stream_id==e.stream_id});r!==-1&&n.splice(r),n.push(e)})}}),this.streamSeqMergeMap=null,this.logger.info(_.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+n),this.handleFullUpdateStream(o,n)},l.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},l}();T.StreamHandler=d},6706:function(W,T,I){"use strict";var m,h,_,d,l,a,c,o,n,t,e,r,i,s,u;Object.defineProperty(T,"__esModule",{value:!0}),T.E_CLIENT_TYPE=T.ENUM_SOURCE_TYPE=T.ENUM_DISPATCH_TYPE=T.ENUM_BROADCASTER_STATUS=T.ENUM_PLAY_SOURCE_TYPE=T.ENUM_PUBLISH_STATE_NEGO=T.ENUM_PUSH_SIGNAL_SUB_CMD=T.ENUM_SIGNAL_SUB_CMD=T.QUALITYLEVEL=T.SERVER_ERROR_CODE=T.ENUM_STREAM_UPDATE_CMD_PRI=T.ENUM_STREAM_UPDATE_CMD=T.MINIUM_HEARTBEAT_INTERVAL=T.STREAM_DELETE_REASON=T.ENUM_NETWORK_STATE=T.ENUM_RUN_STATE=T.ENUM_STREAM_UPDATE_TYPE=T.ENUM_STREAM_CMD_PRI=T.ENUM_STREAM_SUB_CMD=T.ENUM_PUBLISH_STREAM_STATE=T.MAX_RETRY_CONNECT_INTERVAL=T.MAX_TRANS_DATA_LENGTH=T.MAX_TRANS_TYPE_LENGTH=T.MAX_MESSAGE_LENGTH=T.MAX_ROOM_ID_LENGTH=T.MAX_USER_NAME_LENGTH=T.MAX_USER_ID_LENGTH=T.MAX_STREAM_ID_LENGTH=T.MAX_TRY_HEARTBEAT_COUNT=T.SEND_MSG_TIMEOUT=T.SEND_MSG_RESET=T.MAX_TRY_CONNECT_COUNT=T.streamMap=T.ENUM_CONNECT_STATE=T.ProtocolType=T.SignalResourceType=T.ENUM_PROBE_STATE=T.ENUM_PLAY_STATE_NEGO=T.ENUM_PLAYER_STATE=T.ENUM_PLAY_STATE=T.ENUM_PUBLISH_STATE=T.ENUM_SCREEM_RESOLUTION_TYPE=T.ENUM_RESOLUTION_TYPE=T.ENUM_SIGNAL_STATE=T.ERROR_CODES=T.ENUM_REMOTE_TYPE=T.LOG_LEVEL=T.ENUM_LOG_LEVEL=T.ROOMVERSION=T.PROTO_VERSION=void 0,T.ZegoExpressWebRTM=T.ZegoDataReport=T.ZegoLogger=T.ZegoExpressWebRTMEngine=T.getReportSeq=T.getSeq=T.QUALITY_CONSTANT=T.QualityGrade=T.REPORT_ACTION=T.ENUM_RETRY_STATE=T.ENUM_PLAY_STATE_UPDATE=T.ENUM_PUBLISH_STATE_UPDATE=T.LinkedList=T.ListNode=void 0,T.PROTO_VERSION="2.15.1",T.ROOMVERSION="V1",(u=T.ENUM_LOG_LEVEL||(T.ENUM_LOG_LEVEL={}))[u.debug=0]="debug",u[u.info=1]="info",u[u.warn=2]="warn",u[u.error=3]="error",u[u.report=99]="report",u[u.disable=100]="disable",T.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},(s=T.ENUM_REMOTE_TYPE||(T.ENUM_REMOTE_TYPE={}))[s.disable=0]="disable",s[s.websocket=1]="websocket",s[s.https=2]="https",T.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},(i=T.ENUM_SIGNAL_STATE||(T.ENUM_SIGNAL_STATE={}))[i.disconnected=0]="disconnected",i[i.connecting=1]="connecting",i[i.connected=2]="connected",T.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},T.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},T.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},T.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},T.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},T.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(r=T.ENUM_PROBE_STATE||(T.ENUM_PROBE_STATE={}))[r.tryProbe=0]="tryProbe",r[r.probed=2]="probed",(e=T.SignalResourceType||(T.SignalResourceType={}))[e.CDN=0]="CDN",e[e.RTC=1]="RTC",e[e.L3=2]="L3",(t=T.ProtocolType||(T.ProtocolType={}))[t.UDP=0]="UDP",t[t.RTMP=1]="RTMP",t[t.FLV=2]="FLV",t[t.HLS=3]="HLS",t[t.WEBRTC=4]="WEBRTC",T.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},T.streamMap={"/lr/push/stream_add":12001,"/lr/push/stream_delete":12002,"/lr/push/stream_update":12003},T.MAX_TRY_CONNECT_COUNT=3,T.SEND_MSG_RESET=2,T.SEND_MSG_TIMEOUT=1,T.MAX_TRY_HEARTBEAT_COUNT=5,T.MAX_STREAM_ID_LENGTH=256,T.MAX_USER_ID_LENGTH=64,T.MAX_USER_NAME_LENGTH=256,T.MAX_ROOM_ID_LENGTH=128,T.MAX_MESSAGE_LENGTH=1024,T.MAX_TRANS_TYPE_LENGTH=128,T.MAX_TRANS_DATA_LENGTH=4096,T.MAX_RETRY_CONNECT_INTERVAL=12,T.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},T.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},T.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},T.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},(n=T.ENUM_RUN_STATE||(T.ENUM_RUN_STATE={}))[n.logout=0]="logout",n[n.trylogin=1]="trylogin",n[n.login=2]="login",(o=T.ENUM_NETWORK_STATE||(T.ENUM_NETWORK_STATE={}))[o.offline=0]="offline",o[o.online=1]="online",T.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},function(S){S[S.UNKNOWN=0]="UNKNOWN",S[S.CDN=1]="CDN",S[S.RTC=2]="RTC",S[S.L3=3]="L3"}(m||(m={})),T.MINIUM_HEARTBEAT_INTERVAL=3e3,T.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},T.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},T.SERVER_ERROR_CODE=1e4,(c=T.QUALITYLEVEL||(T.QUALITYLEVEL={}))[c.low=1]="low",c[c.stantard=2]="stantard",c[c.hight=3]="hight",c[c.custome=4]="custome",T.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},T.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},T.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(a=T.ENUM_PLAY_SOURCE_TYPE||(T.ENUM_PLAY_SOURCE_TYPE={}))[a.cdn=0]="cdn",a[a.ultra=1]="ultra",(l=T.ENUM_BROADCASTER_STATUS||(T.ENUM_BROADCASTER_STATUS={}))[l.stop=0]="stop",l[l.start=1]="start",(d=T.ENUM_DISPATCH_TYPE||(T.ENUM_DISPATCH_TYPE={}))[d.cdn=0]="cdn",d[d.ultra=1]="ultra",d[d.customUrl=2]="customUrl",(_=T.ENUM_SOURCE_TYPE||(T.ENUM_SOURCE_TYPE={}))[_.CDN=0]="CDN",_[_.BGP=1]="BGP",(h=T.E_CLIENT_TYPE||(T.E_CLIENT_TYPE={}))[h.ClientType_None=0]="ClientType_None",h[h.ClientType_H5=1]="ClientType_H5",h[h.ClientType_SmallPragram=2]="ClientType_SmallPragram",h[h.ClientType_Webrtc=3]="ClientType_Webrtc";var p=function(){function S(k,O){k===void 0&&(k=null),O===void 0&&(O=null),this._id=null,this.next=null,this.prev=null,this._id=k,this._data=O}return Object.defineProperty(S.prototype,"id",{get:function(){return this._id?this._id:null},set:function(k){this._id=k},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"data",{get:function(){return this._data},set:function(k){this._data=k},enumerable:!1,configurable:!0}),S.prototype.hasNext=function(){return this.next&&this.next.id},S.prototype.hasPrev=function(){return this.prev&&this.prev.id},S}();T.ListNode=p;var f,E,y=function(){function S(){this.start=new p,this.end=new p,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return S.prototype.insertBefore=function(k,O){var g=new p(this._idCounter,O);return g.next=k,g.prev=k.prev,k.prev&&(k.prev.next=g),k.prev=g,++this._idCounter,++this._numNodes,g},S.prototype.addLast=function(k){return this.insertBefore(this.end,k)},S.prototype.add=function(k){return this.addLast(k)},S.prototype.getFirst=function(){return this._numNodes===0?null:this.start.next},S.prototype.getLast=function(){return this._numNodes===0?null:this.end.prev},S.prototype.size=function(){return this._numNodes},S.prototype.getFromFirst=function(k){var O=0,g=this.start.next;if(k>=0)for(;O<k&&g!==null;)g=g.next,++O;else g=null;if(g===null)throw"Index out of bounds.";return g},S.prototype.get=function(k){return k===0?this.getFirst():k===this._numNodes-1?this.getLast():this.getFromFirst(k)},S.prototype.remove=function(k){return k.prev&&(k.prev.next=k.next),k.next&&(k.next.prev=k.prev),--this._numNodes,k},S.prototype.removeFirst=function(){var k=null;return this._numNodes>0&&this.start.next&&(k=this.remove(this.start.next)),k},S.prototype.removeLast=function(){var k=null;return this._numNodes>0&&this.end.prev&&(k=this.remove(this.end.prev)),k},S.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},S.prototype.each=function(k){for(var O=this.start;O.hasNext();)k(O=O.next)},S.prototype.find=function(k){for(var O=this.start,g=!1,v=null;O.hasNext()&&!g;)k(O=O.next)&&(v=O,g=!0);return v},S.prototype.map=function(k){for(var O=this.start,g=[];O.hasNext();)k(O=O.next)&&g.push(O);return g},S.prototype.push=function(k){return this.addLast(k)},S.prototype.unshift=function(k){this._numNodes>0?this.insertBefore(this.start.next,k):this.insertBefore(this.end,k)},S.prototype.pop=function(){return this.removeLast()},S.prototype.shift=function(){return this.removeFirst()},S}();T.LinkedList=y,T.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},T.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},T.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},T.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},(E=T.QualityGrade||(T.QualityGrade={}))[E.Unknown=-1]="Unknown",E[E.Excellent=0]="Excellent",E[E.Good=1]="Good",E[E.Middle=2]="Middle",E[E.Poor=3]="Poor",E[E.Die=4]="Die",(f=T.QUALITY_CONSTANT||(T.QUALITY_CONSTANT={}))[f.MinQuality=0]="MinQuality",f[f.DieQuality=0]="DieQuality",f[f.PoorMinQuality=1]="PoorMinQuality",f[f.MiddleMinQuality=30]="MiddleMinQuality",f[f.GoodMinQuality=60]="GoodMinQuality",f[f.ExcellentMinQuality=85]="ExcellentMinQuality",f[f.MaxQuality=100]="MaxQuality";var b=I(4119);Object.defineProperty(T,"getSeq",{enumerable:!0,get:function(){return b.getSeq}}),Object.defineProperty(T,"getReportSeq",{enumerable:!0,get:function(){return b.getReportSeq}}),Object.defineProperty(T,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return b.ZegoExpressWebRTMEngine}}),Object.defineProperty(T,"ZegoLogger",{enumerable:!0,get:function(){return b.ZegoLogger}}),Object.defineProperty(T,"ZegoDataReport",{enumerable:!0,get:function(){return b.ZegoDataReport}}),Object.defineProperty(T,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return b.ZegoExpressWebRTM}})},2752:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},GET_CONFIG_FAIL:{code:1101002,message:"get app config fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_DEVICE_NO_ALLOWED:{code:1103064,message:"get device not allowed"},PUBLISHER_DEVICE_NO_READABLE:{code:1103065,message:"device is not readable"},PUBLISHER_OVER_CONSTRAINED:{code:1103066,message:"device does not meet constraints"},PUBLISHER_UPDATE_SDP_TIMEOUT:{code:1103067,message:"update sdp time out"},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},VIDEO_EFFECT_IS_STARTING:{code:1103073,message:"video effect is starting, please operate after video effect is started"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},PLAYER_STREAM_NOT_EXIST:{code:1104039,message:"play stream not found"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},3529:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoWechatLogEvent=T.ZegoRTCLogEvent=void 0;var m=I(2752),h=function(_){return _};T.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:m.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:m.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:m.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:m.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:m.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:m.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL,kDeviceNoAllowedError:m.errorCodeList.PUBLISHER_DEVICE_NO_ALLOWED,kDeviceNoReadableError:m.errorCodeList.PUBLISHER_DEVICE_NO_READABLE,kDeviceOverConstrainedError:m.errorCodeList.PUBLISHER_OVER_CONSTRAINED},stream_type:h,screen:h,camera:h,custom:h},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:m.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:m.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:m.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:m.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:m.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:m.errorCodeList.PUBLISH_NO_PREVIEW,kPublishEffectIsStarting:m.errorCodeList.VIDEO_EFFECT_IS_STARTING,kPublishNoLoginError:m.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:m.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:m.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishTokenExpiredError:m.errorCodeList.TOKEN_EXPIRED,kPublishSessionClosedError:m.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:m.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:m.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:m.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:m.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:m.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:m.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:m.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:m.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:m.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:m.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:m.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:m.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:m.errorCodeList.PUBLISHER_TTL_OVERTIME,kUpdateMediaDescriptionTimeOut:m.errorCodeList.PUBLISHER_UPDATE_SDP_TIMEOUT,kUpdateMediaDescriptionError:m.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL},publishOption:h,message:h,session_id:h,stream:h,video_en_codec_id:h,cap_w:h,cap_h:h,w:h,h,video_en_fps:h,video_en_bps:h,audio_c_channel_count:h,audio_en_bps:h,aec_level:h,ans_level:h,agc:h,traffic_control_min_video_bitrate:h,use_na:h},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:h,w:h,h},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:h,w:h,h},kZegoTaskRePublish:{event:"/sdk/republish",stream:h},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:m.errorCodeList.PUBLISHER_PARAM},stream:h},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:m.errorCodeList.STREAM_ID_NULL,kPlayParamError:m.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:m.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:m.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:m.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:m.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:m.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:m.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:m.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:m.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:m.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayStreamNotFound:m.errorCodeList.PLAYER_STREAM_NOT_EXIST,kPlayRetryTimeoutError:m.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:m.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:m.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:m.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:m.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:m.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:m.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:m.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:m.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:m.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:m.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:m.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:m.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:m.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:m.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:m.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:m.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:h,message:h,session_id:h,stream:h,audio_activate:h,video_activate:h,use_na:h},kZegoTaskRePlay:{event:"/sdk/replay",stream:h},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:m.errorCodeList.PUBLISHER_PARAM},stream:h},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:m.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:h},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:m.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:h,device:h},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:m.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:h,device:h},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:m.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:m.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:h,interrupt:h},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:h},kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:h,status:h},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:h,status:h},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:m.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:h,stream:h,device:h,reason:h},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:h,update_stream:h},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:h},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:h,fft_consumed:h},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:m.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"}},T.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:m.errorCodeList.WX_GET_SETTING_FAIL},capability:h},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:m.errorCodeList.STREAM_ID_NULL,kPublishParamError:m.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:m.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:m.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:m.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:m.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:m.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:m.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:m.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:m.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:m.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:h,stream:h,message:h},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:m.errorCodeList.STREAM_ID_NULL,kPlayParamError:m.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:m.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:m.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:m.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:m.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:m.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:m.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:m.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:m.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:m.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:m.errorCodeList.PLAYER_IS_PLAYING},playOption:h,message:h,session_id:h,stream:h,audio_activate:h,video_activate:h},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:m.errorCodeList.PUBLISHER_PARAM},stream:h},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:m.errorCodeList.PUBLISHER_PARAM},stream:h},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:h,update_stream:h},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:h}}},2367:function(W,T){"use strict";var I;Object.defineProperty(T,"__esModule",{value:!0}),T.ZEGO_WEBRTC_ACTION=void 0,(I=T.ZEGO_WEBRTC_ACTION||(T.ZEGO_WEBRTC_ACTION={})).SET_VIDEO_CONFIG="zc.svc",I.SET_AUDIO_CONFIG="zc.sac",I.REPLACE_TRACK="zc.rp",I.SET_BEAUTY_EFFECT="zc.sbe",I.ENABLE_STREAM="zc.es",I.ENABLE_MIC_ONLY="zc.emo",I.ACTIVATE_SEI_INSERT="zc.asi",I.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",I.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",I.MUTE_MIC="zc.mm",I.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",I.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1",I.ADD_TRACK="zc.at",I.REMOVE_TRACK="zc.rt",I.HANDLE_TRACK="zc.ht"},4495:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},m.apply(this,arguments)},h=this&&this.__awaiter||function(o,n,t,e){return new(t||(t=Promise))(function(r,i){function s(f){try{p(e.next(f))}catch(E){i(E)}}function u(f){try{p(e.throw(f))}catch(E){i(E)}}function p(f){var E;f.done?r(f.value):(E=f.value,E instanceof t?E:new t(function(y){y(E)})).then(s,u)}p((e=e.apply(o,n||[])).next())})},_=this&&this.__generator||function(o,n){var t,e,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(p){return function(f){return function(E){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(r=2&E[0]?e.return:E[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,E[1])).done)return r;switch(e=0,r&&(E=[2&E[0],r.value]),E[0]){case 0:case 1:r=E;break;case 4:return s.label++,{value:E[1],done:!1};case 5:s.label++,e=E[1],E=[0];continue;case 7:E=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||E[0]!==6&&E[0]!==2)){s=0;continue}if(E[0]===3&&(!r||E[1]>r[0]&&E[1]<r[3])){s.label=E[1];break}if(E[0]===6&&s.label<r[1]){s.label=r[1],r=E;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(E);break}r[2]&&s.ops.pop(),s.trys.pop();continue}E=n.call(o,s)}catch(y){E=[6,y],e=0}finally{t=r=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([p,f])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.AdvancedModule=void 0;var d=I(2367),l=I(5098),a=I(8706),c=function(){function o(n,t,e,r){this.logger=n,this.dataReport=t,this.streamCenter=e,this.stateCenter=r,this.screenShotReady=!1}return o.prototype.setVideoConfig=function(n,t){var e=this;return this.logger.info(d.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" call"),new Promise(function(r,i){var s=e.stateCenter.getReportSeq();return e.dataReport.newReport(s,a.ZegoRTCLogEvent.kZegoSetVideoConfig.event),n instanceof MediaStream?t&&typeof t=="object"&&Object.keys(t).length!=0?t.width&&!e.stateCenter.checkValidNumber(t.width)?(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints width integer number, range[1, 10000]"),e.dataReport.addMsgInfo(s,{error:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints width integer number, range[1, 10000]"}),e.dataReport.uploadReport(s),void i({errorCode:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):t.height&&!e.stateCenter.checkValidNumber(t.height)?(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints height integer number, range[1, 10000]"),e.dataReport.addMsgInfo(s,{error:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints height integer number, range[1, 10000]"}),e.dataReport.uploadReport(s),void i({errorCode:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):void e.setPublishStreamConstraints(n,t,function(u){e.dataReport.uploadReport(s),r(u)}):(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints wrong"),e.dataReport.addMsgInfo(s,a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError),e.dataReport.uploadReport(s),void i({errorCode:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" localStream not found"),e.dataReport.addMsgInfo(s,a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kLocalStreamError),e.dataReport.uploadReport(s),void i({errorCode:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" localStream no found"}))})},o.prototype.setAudioConfig=function(n,t){var e=this;return this.logger.info(d.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" call"),new Promise(function(r){var i=e.stateCenter.getReportSeq();return e.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoSetAudioConfig.event),n instanceof MediaStream?!t||typeof t!="object"||Object.keys(t).length==0||t.AEC!==void 0&&typeof t.AEC!="boolean"||t.AGC!==void 0&&typeof t.AGC!="boolean"||t.ANS!==void 0&&typeof t.ANS!="boolean"?(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" constraints wrong"),e.dataReport.addMsgInfo(i,a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),e.dataReport.uploadReport(i),void r({errorCode:a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" constraints wrong"})):void e.setPublishStreamConstraints(n,t,function(s){e.dataReport.uploadReport(i),r(s)}):(e.logger.error(d.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" localStream not found"),e.dataReport.addMsgInfo(i,a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),e.dataReport.uploadReport(i),void r({errorCode:a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" localStream no found"}))})},o.prototype.enableStream=function(n,t){if(this.logger.info(d.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" call"),typeof t.video!="boolean"&&typeof t.audio!="boolean")return this.logger.error(d.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" option error"),!1;var e=!0,r=!0;return typeof t.video=="boolean"&&(e=this.enableCamera(n,t.video,t.retain)),typeof t.audio=="boolean"&&(r=this.enableMicrophone(n,t.audio)),e&&r},o.prototype.enableMicrophoneOnly=function(n){if(this.logger.info(d.ZEGO_WEBRTC_ACTION.ENABLE_MIC_ONLY+" call"),typeof n!="boolean")return!1;for(var t=0;t<this.streamCenter.previewStreamList.length;t++)if(!this.streamCenter.previewStreamList[t].enableMicrophoneOnly(n,this.streamCenter))return this.logger.error("zsc.emo.0 previewer "+t+" change mic mute state failed"),!1;return this.streamCenter.isMicEnabled=n,!0},o.prototype.replaceTrack=function(n,t){return h(this,void 0,void 0,function(){var e,r;return _(this,function(i){return e=this.stateCenter.getReportSeq(),this.dataReport.newReport(e,a.ZegoRTCLogEvent.kZegoReplaceTrack.event),n instanceof MediaStream?t&&t instanceof MediaStreamTrack?(r=this._replaceTrack(n,t),this.dataReport.uploadReport(e),[2,r]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" mediastream track no found"),this.dataReport.uploadReport(e,void 0,a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),[2,{errorCode:a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" mediastream track no found"}]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" localStream not found"),this.dataReport.uploadReport(e,void 0,a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),[2,{errorCode:a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"}])})})},o.prototype.setPublishStreamConstraints=function(n,t,e){var r=this,i=null;for(var s in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(t)),this.streamCenter.publisherList)this.streamCenter.publisherList[s].localStream==n&&(i=this.streamCenter.publisherList[s]);if(!i)return this.logger.error("zsc.spsc.0 publisher not found"),void(e&&e({errorCode:l.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:l.errorCodeList.PUBLISH_NOT_PUBLISH.message}));this.logger.info("zsc.spsc.0 streamId ",i.streamID);var u=i==null?void 0:i.publisher.previewer;if(!u)return this.logger.error("zsc.spsc.0 preview no found"),void(e&&e({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}));var p=!1,f=!1;(t.width||t.height||t.frameRate||t.videoQuality)&&(t.videoQuality||(u.mediaStreamConfig.videoQuality=4),p=!0),t.ANS===void 0&&t.AGC===void 0&&t.AEC===void 0||(f=!0);var E=u.localStream,y=u.videoTrack,b=u.audioTrack;p&&!y?(this.logger.error("zsc.spsc.0 video track not found"),e&&e({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message})):t.video=!0,f&&!b?(this.logger.error("zsc.spsc.0 audio track not found"),e&&e({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message})):t.audio=!0;var S,k=JSON.parse(JSON.stringify(u.mediaStreamConfig)),O=Object.assign(u.mediaStreamConfig,t);u.previewType=="screen"?(S=this.streamCenter.getScreenConstrains(O)).bitRate!==k.bitRate&&(t.maxBitrate=S.bitRate):S=u.getMediaStreamConstraints(O,!0),this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(S));var g=[];if(p&&g.push(y.applyConstraints(S.video)),f&&(b.stop(),g.push(navigator.mediaDevices.getUserMedia({video:!1,audio:S.audio}))),t.maxBitrate){var v=i.publisher.peerConnection.getSenders().find(function(N){return N.track&&N.track.kind==="video"}),R=v.getParameters();v?(R.encodings||(R.encodings=[{}]),R.encodings[0].maxBitrate=1e3*t.maxBitrate,g.push(v.setParameters(R))):this.logger.error("zsc.spsc.0 video sender no found")}if(g.length>0)Promise.all(g).then(function(N){var w,B;if(r.logger.info("zsc.spsc.0 set constraints success",N[1]),f){var x=(p?N[1]:N[0]).getAudioTracks()[0];x.enabled=i.publisher.mic_status===0;var Z=i.publisher.peerConnection.getSenders().find(function(Y){return Y.track.kind==="audio"});if(Z&&(Z.replaceTrack(x),E)){var V=r.streamCenter.checkPreview(E);V&&(V.replacePreviewTrack(x),V.gainNode=null)}}t.maxBitrate&&i.publisher&&(i.publisher.videoInfo.bitRate=t.maxBitrate),((w=S==null?void 0:S.video)===null||w===void 0?void 0:w.frameRate)&&i.publisher&&(i.publisher.videoInfo.frameRate=(B=S==null?void 0:S.video)===null||B===void 0?void 0:B.frameRate),e&&e({errorCode:0,extendedData:""})}).catch(function(N){r.logger.error("zsc.spsc.0 fail reason ",N.name,JSON.stringify(N)),e&&e({errorCode:l.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:N.name+" "+(N.constraint?"constraint:"+N.constraint:"")})});else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),f){var L=u.getMediaStreamConstraints(k);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(L)),navigator.mediaDevices.getUserMedia({video:!1,audio:L.audio}).then(function(N){var w=N.getAudioTracks()[0],B=(u.audioTrack,i.publisher.peerConnection.getSenders().find(function(Z){return Z.track!==null&&Z.track.kind===b.kind}));if(B){B.replaceTrack(w);var x=r.streamCenter.checkPreview(E);x&&x.replacePreviewTrack(w)}r.logger.info("zsc.spsc.0.1 setbackup suc ")}).catch(function(N){r.logger.error("zsc.spsc.0.1 setbackup fail "+N.name)})}e&&e({errorCode:l.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:"constraints is no changes"})}},o.prototype.useVideoDevice=function(n,t){var e=this;return this.logger.info("zc.uvd.0 call"),new Promise(function(r){var i=e.stateCenter.getReportSeq();if(e.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.event),e.dataReport.addMsgInfo(i,{device:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.device(t)}),!(n instanceof MediaStream))return e.logger.error("zc.uvd.0 localStream not found"),e.dataReport.addMsgInfo(i,a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kLocalStreamError),e.dataReport.uploadReport(i),void r({errorCode:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});if(typeof t!="string")return e.logger.error("zc.uvd.0 deviceID must be string"),e.dataReport.addMsgInfo(i,{error:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,message:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message+" deviceID must be string"}),e.dataReport.uploadReport(i),void r({errorCode:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});var s=function(u){var p,f;e.dataReport.uploadReport(i);var E=e.streamCenter.checkPublish(n);E&&(E.cameraLabel=((f=(p=E.publisher.previewer)===null||p===void 0?void 0:p.videoTrack)===null||f===void 0?void 0:f.label)||E.cameraLabel),r(u)};e.stateCenter.getDevices(function(u){if(!u.cameras.find(function(p){return p.deviceID==t}))return e.logger.error("zc.uvd.0 device is not found"),void r({errorCode:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.code,extendedData:a.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.message});e.switchDevice("video",n,t,s)},function(u){e.logger.warn("zc.uvd.0 getDevices err:",u),e.switchDevice("video",n,t,s)})})},o.prototype.useAudioDevice=function(n,t){var e=this;return this.logger.info("zc.uad.1 call"),new Promise(function(r){var i=e.stateCenter.getReportSeq();e.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.event),e.dataReport.addMsgInfo(i,{device:a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.device(t)});var s=function(p,f){e.logger.error("zc.uad.1 "+f);var E=p;E.message=E.message+(f?" "+f:""),e.dataReport.addMsgInfo(i,E),e.dataReport.uploadReport(i),r({errorCode:E.code,extendedData:E.message})},u=function(p){var f;e.dataReport.uploadReport(i);var E=e.streamCenter.checkPublish(n);E&&(E.microLabel=((f=n.getAudioTracks()[0])===null||f===void 0?void 0:f.label)||E.microLabel),r(p)};n instanceof MediaStream?typeof t=="string"?e.stateCenter.getDevices(function(p){if(!p.microphones.find(function(f){return f.deviceID==t}))return e.logger.error("zc.uad.1 device is not found"),void r({errorCode:a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.code,extendedData:a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.message});e.switchDevice("audio",n,t,u)},function(p){e.logger.warn("zc.uad.1 getDevices err:",p),e.switchDevice("audio",n,t,u)}):s(a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kParamError,"deviceID must be string"):s(a.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kLocalStreamError,"localStream not found")})},o.prototype.publishTarget=function(n){var t=this,e=this.stateCenter.getReportSeq();switch(n.type){case"addpush":this.dataReport.newReport(e,a.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(e,a.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(e,{stream:a.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(n.streamID),target_url:a.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(n.pushUrl)}),new Promise(function(r,i){var s=function(p,f){t.logger.error("zb.pt"+(f||p.message)),t.dataReport.addMsgInfo(e,{error:p.code,message:p.message+(f||"")}),t.dataReport.uploadReport(e),i({errorCode:p.code,extendedData:p.message+(f?" "+f:"")})};if(["addpush","delpush","clearpush"].indexOf(n.type)==-1)return t.logger.error("zb.sh.pt cdn push type error"),void s(l.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(n.streamID&&typeof n.streamID=="string")if(n.pushUrl&&typeof n.pushUrl=="string")if(t.stateCenter.publishStreamList[n.streamID]){var u=t.streamCenter.getRoomByStreamID(n.streamID);u?u.streamHandler._publishTarget(n,function(p){t.dataReport.uploadReport(e),r(p)},s):s(a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else s(a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else s(a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else s(a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")})},o.prototype.handleTrack=function(n,t,e,r,i){var s;return h(this,void 0,void 0,function(){var u,p,f,E,y,b,S,k,O,g,v=this;return _(this,function(R){switch(R.label){case 0:return t instanceof MediaStream?e instanceof MediaStreamTrack&&e.kind!="audio"?(u=this.streamCenter.checkPreview(t))?e.kind==="video"&&((s=u.videoEffect)===null||s===void 0?void 0:s.enabled)?(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" need to disable video beauty effect first"),i&&i({errorCode:l.errorCodeList.VIDEO_EFFECT_IS_RUNNING.code,extendedData:"need to disable video beauty effect before add or remove track"}),[2]):n=="ADD"&&(t.getTracks().length>=2||t.getTracks().find(function(L){return L.kind==e.kind}))?(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" only stream which have one track and kind no exist can add track"),i&&i({errorCode:l.errorCodeList.TRACK_CAN_NOT_ADD.code,extendedData:l.errorCodeList.TRACK_CAN_NOT_ADD.message}),[2]):n!="REMOVE"||t.getTracks().length!=1&&t.getTracks().includes(e)?!(p=this.streamCenter.checkPublish(t))||p.publisher.stateNego===5&&p.publisher.isUpdateSDP!=1?p?(f=p.publisher,E=u,y=p.publisher.peerConnection,f.isUpdateSDP=!0,n!="ADD"?[3,1]:(y.addTrack(e,t),[3,4])):[3,6]:(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" publish state wrong"),i&&i({errorCode:l.errorCodeList.PUBLISHER_STATE_WRONG.code,extendedData:l.errorCodeList.PUBLISHER_STATE_WRONG.message}),[2]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" not supported"),i({errorCode:l.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.code,extendedData:l.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.message}),[2]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" stream no found"),i&&i({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}),[2]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" only can handle video track"),i({errorCode:l.errorCodeList.INPUT_PARAM.code,extendedData:l.errorCodeList.INPUT_PARAM.message}),[2]):(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" stream wrong"),i({errorCode:l.errorCodeList.INPUT_PARAM.code,extendedData:l.errorCodeList.INPUT_PARAM.message}),[2]);case 1:return window.RTCPeerConnection&&window.RTCPeerConnection.prototype.getTransceivers&&window.RTCRtpTransceiver.prototype.stop?[4,y.getSenders().find(function(L){return L.track&&L.track==e})]:(this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" not supported getTransceivers"),i({errorCode:l.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.code,extendedData:l.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.message}),[2]);case 2:return b=R.sent(),[4,y.getTransceivers().find(function(L){return L.sender==b})];case 3:if(S=R.sent(),!(b&&S&&S.stop))return this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" sender no found"),i&&i({errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message}),[2];try{y.removeTrack(b),S.stop()}catch(L){this.logger.error(d.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" "+L),i&&i({errorCode:l.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.code,extendedData:l.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.message+" "+L})}R.label=4;case 4:return k={},O=this.streamCenter.previewStreamList.find(function(L){return L.localStream.getTracks().find(function(N){return N==e})}),k=O&&n=="ADD"?O.videoInfo:{},[4,y.createOffer()];case 5:return g=R.sent(),f.onCreateOfferSuccess(g,!0,k,function(L){return h(v,void 0,void 0,function(){var N;return _(this,function(w){return L!==0?i&&i({errorCode:l.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.code,extendedData:l.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.message}):(N=e.kind=="video"?"videoTrack":"audioTrack",n=="ADD"?(t.addTrack(e),E[N]=e,e.kind=="video"&&e.enabled==1?f.sendStreamStatus(0,f.mic_status,!0):e.enabled==1&&f.sendStreamStatus(f.camera_status,0,!0)):(e.kind=="video"?f.sendStreamStatus(2,f.mic_status,!0):f.sendStreamStatus(f.camera_status,2,!0),t.removeTrack(e),E[N]=null),u.mediaStreamConfig.video=n=="ADD",r({errorCode:0,extendedData:""})),[2]})})}),[3,7];case 6:n=="ADD"?t.addTrack(e):t.removeTrack(e),r({errorCode:0,extendedData:""}),u.mediaStreamConfig.video=n=="ADD",R.label=7;case 7:return[2]}})})},o.prototype.switchDevice=function(n,t,e,r){var i=this,s=this.streamCenter.checkPublish(t);if(s&&s.publisher&&s.publisher.stateNego!==5)return this.logger.error("zsc.sd.0 stream is publishing"),void(r&&r({errorCode:l.errorCodeList.PUBLISHER_STREAM_NO_FOUND.code,extendedData:l.errorCodeList.PUBLISHER_STREAM_NO_FOUND.message}));var u=this.streamCenter.checkPreview(t);if(!u)return this.logger.error("zsc.sd.0 preview no found"),void(r&&r({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message}));if(n==="video"&&u.mediaStreamConfig.video==0)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(r&&r({errorCode:l.errorCodeList.VIDEO_DEVICE_FALSE.code,extendedData:l.errorCodeList.VIDEO_DEVICE_FALSE.message}));if(n==="audio"&&u.mediaStreamConfig.audio==0)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(r&&r({errorCode:l.errorCodeList.AUDIO_DEVICE_FALSE.code,extendedData:l.errorCodeList.AUDIO_DEVICE_FALSE.message}));u.mediaStreamConfig.videoInput!==e&&delete u.mediaStreamConfig.facingMode;var p,f={};n==="video"?(f.videoInput=e,p=u.videoTrack):(f.audioInput=e,p=u.audioTrack);var E=this.stateCenter.browser;this.logger.info("zsc.sd.0 browser "+E),E==="firefox"&&p.stop();var y=m(m({},u.mediaStreamConfig),f),b=u.getMediaStreamConstraints(y),S=function(k,O){O.getTracks().forEach(function(g){if(g.kind===n){var v=n==="video"?"videoTrack":"audioTrack",R=u[v];g.enabled=R.enabled,!s||u.muteImage&&!g.enabled&&n!="audio"?u&&u.muteImage&&!g.enabled&&n=="video"?u[v]=g:u&&u.replacePreviewTrack(g):s.publisher.replacePublishedTrack(g),R&&R.stop()}}),u.restartSoundLevel()};n=="audio"?b.video=!1:b.audio=!1,navigator.mediaDevices.getUserMedia(b).then(function(k){Object.assign(u.mediaStreamConfig,f),S(0,k),i.logger.info("zsc.sd.0 switch "+n+" device success"),r&&r({errorCode:0,extendedData:""})},function(k){var O,g;n=="video"?(O=u.videoTrack)===null||O===void 0||O.stop():(g=u.audioTrack)===null||g===void 0||g.stop(),i.logger.warn("zsc.sd.0 switch "+n+" device failed, stop last device and retry. ",k+""),navigator.mediaDevices.getUserMedia(b).then(function(v){Object.assign(u.mediaStreamConfig,f),S(0,v),i.logger.info("zsc.sd.0 swtich "+n+" device success"),r&&r({errorCode:0,extendedData:""})},function(v){i.logger.warn("zsc.sd.0 swtich "+n+" device failed and recover last device. ",v+"");var R=u.getMediaStreamConstraints(u.mediaStreamConfig),L=l.errorCodeList.VIDEO_DEVICE_FALSE;n==="audio"&&(L=l.errorCodeList.AUDIO_DEVICE_FALSE),navigator.mediaDevices.getUserMedia(R).then(function(N){S(0,N),i.logger.info("zsc.sd.0 recover last "+n+" device success"),r&&r({errorCode:L.code,extendedData:L.message+" "+JSON.stringify(v)})},function(N){i.logger.error("zsc.sd.0 swtich "+n+" device and recover failed, please recreate stream. ",N+""),r&&r({errorCode:L.code,extendedData:L.message+" "+JSON.stringify(N)})})})})},o.prototype._replaceTrack=function(n,t){var e=this.streamCenter.checkPreview(n),r=this.streamCenter.checkPublish(n);return r?r.publisher.replacePublishedTrack(t):e?e.localStream.getTracks().find(function(i){return i.kind===t.kind})?(e.replacePreviewTrack(t),{errorCode:0,extendedData:""}):(this.logger.error("zc.rt.0 track no found"),{errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message}):(this.logger.error("zc.rt.0 preview no found"),{errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message})},o.prototype.enableMicrophone=function(n,t){var e=this.streamCenter.checkPreview(n);return e?e.enableMicrophone(t,this.streamCenter):(this.logger.error("zsc.em.0 no preview"),!1)},o.prototype.enableCamera=function(n,t,e){var r=this.streamCenter.checkPreview(n);return r?r.enableCamera(t,this.streamCenter,e):(this.logger.error("zsc.ec.0 no preview"),!1)},o.prototype.setDummyCaptureImagePath=function(n,t){var e=this;return new Promise(function(r,i){var s=e.streamCenter.checkPreview(t);if(!s)return e.logger.error("zc.sdcp.0 preview no found"),void r(!1);if(typeof n!="string")return e.logger.error("zc.sdcp.0 filePath type error"),void r(!1);var u=new Image;u.src=n,u.onload=function(){s.loadImgTimer&&clearTimeout(s.loadImgTimer),s.loadImgTimer=void 0,e.logger.info("zc.sdcp.0 load file path success"),s.muteImage=u,r(!0)},s.loadImgTimer=setTimeout(function(){e.logger.error("zc.sdcp.0 load img timeout"),r(!1)},5e3)})},o}();T.AdvancedModule=c},4378:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},m.apply(this,arguments)},h=this&&this.__awaiter||function(o,n,t,e){return new(t||(t=Promise))(function(r,i){function s(f){try{p(e.next(f))}catch(E){i(E)}}function u(f){try{p(e.throw(f))}catch(E){i(E)}}function p(f){var E;f.done?r(f.value):(E=f.value,E instanceof t?E:new t(function(y){y(E)})).then(s,u)}p((e=e.apply(o,n||[])).next())})},_=this&&this.__generator||function(o,n){var t,e,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(p){return function(f){return function(E){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(r=2&E[0]?e.return:E[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,E[1])).done)return r;switch(e=0,r&&(E=[2&E[0],r.value]),E[0]){case 0:case 1:r=E;break;case 4:return s.label++,{value:E[1],done:!1};case 5:s.label++,e=E[1],E=[0];continue;case 7:E=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||E[0]!==6&&E[0]!==2)){s=0;continue}if(E[0]===3&&(!r||E[1]>r[0]&&E[1]<r[3])){s.label=E[1];break}if(E[0]===6&&s.label<r[1]){s.label=r[1],r=E;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(E);break}r[2]&&s.ops.pop(),s.trys.pop();continue}E=n.call(o,s)}catch(y){E=[6,y],e=0}finally{t=r=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([p,f])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.signal=T.publisher=T.publishModule=T.playModule=T.preview=T.streamHandler=T.zegoWebRTC=T.ENUM_PUBLISH_STREAM_STATE=T.ENUM_STREAM_CMD_PRI=T.ENUM_STREAM_SUB_CMD=T.PROTO_VERSION=void 0;var d=I(2367),l=I(5098),a=I(8706),c=I(7248);T.PROTO_VERSION="2.15.1",T.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},T.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},T.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},T.zegoWebRTC={mutePublishStreamVideo:function(o,n,t){this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" call");var e=this.stateCenter.getReportSeq();if(this.dataReport.newReport(e,a.ZegoRTCLogEvent.kZegoTaskMutePublishVideo),typeof n!="boolean"||t!==void 0&&typeof t!="boolean")return this.logger.error(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" option error"),!1;var r=this.rtcModules.advancedModule.enableStream(o,{video:!n,retain:t});return this.dataReport.uploadReport(e),this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" end"),r},mutePublishStreamAudio:function(o,n){this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" call");var t=this.stateCenter.getReportSeq();if(this.dataReport.newReport(t,a.ZegoRTCLogEvent.kZegoTaskMutePublishAudio),typeof n!="boolean")return this.logger.error(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" option error"),!1;var e=this.rtcModules.advancedModule.enableStream(o,{audio:!n});return this.dataReport.uploadReport(t),this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" end"),e},mutePlayStreamVideo:function(o,n){this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" call "+o+" "+n);var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,a.ZegoRTCLogEvent.kZegoTaskMutePlayVideo);var e=this.rtcModules.playModule.mutePlayStream(o,"video",n);return this.dataReport.uploadReport(t),this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" end"),e},mutePlayStreamAudio:function(o,n){this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+" call "+o+" "+n);var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,a.ZegoRTCLogEvent.kZegoTaskMutePlayAudio);var e=this.rtcModules.playModule.mutePlayStream(o,"audio",n);return this.dataReport.uploadReport(t),this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+"end"),e},muteMicrophone:function(o){this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_MIC+" call");var n=this.stateCenter.getReportSeq();if(this.dataReport.newReport(n,a.ZegoRTCLogEvent.kZegoTaskMuteMicrophone),typeof o!="boolean")return this.logger.error(d.ZEGO_WEBRTC_ACTION.MUTE_MIC+" option error"),!1;var t=this.rtcModules.advancedModule.enableMicrophoneOnly(!o);return this.dataReport.uploadReport(n),this.logger.info(d.ZEGO_WEBRTC_ACTION.MUTE_MIC+" end"),t},activateSEIInsert:function(o){var n=o.stream,t=o.action,e=o.infoType;return this.rtcModules.publishModule.activateSEIInsert(n,t,e)},getAudioInfo:function(o,n,t){if(!o)return this.logger.error("localStream is empty!"),!1;var e=m({},t);return new c.MediaUtil(this.ac,e).connectToSource(o,function(r){n(r)})},startRecord:function(o){var n=this,t=this.streamCenter.checkPreview(o);if(t){var e=o.clone(),r=e.getAudioTracks();r.length>0&&t.hasEmptyAudioTrack&&r.forEach(function(s){e.removeTrack(s)}),this.recordedBlobs=[];var i={mimeType:"video/webm;codecs=vp9"};MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm;codecs=vp8,opus"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:""}))));try{this.mediaRecorder=new MediaRecorder(e,i)}catch(s){return void this.logger.error("Exception while creating ZegoMediaRecorder:",s)}this.mediaRecorder.onstop=function(s){n.logger.warn("Recorder stopped: "+s)},this.mediaRecorder.ondataavailable=this.handleDataAvailable.bind(this),this.mediaRecorder.start(10)}else this.logger.error("stream is not from zego!")},stopRecord:function(){this.mediaRecorder?this.mediaRecorder.stop():this.logger.warn("please invoke startRecord first")},resumeRecord:function(){this.mediaRecorder?this.mediaRecorder.resume():this.logger.warn("please invoke startRecord first")},pauseRecord:function(){this.mediaRecorder?this.mediaRecorder.pause():this.logger.warn("please invoke startRecord first")},saveRecord:function(o){if(this.mediaRecorder&&this.recordedBlobs){var n=new Blob(this.recordedBlobs,{type:"video/webm"}),t=window.URL.createObjectURL(n),e=document.createElement("a");e.style.display="none",e.href=t,e.download=o+".webm",document.body.appendChild(e),e.click(),setTimeout(function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)},100)}else this.logger.warn("please invoke startRecord first")},handleDataAvailable:function(o){o.data&&o.data.size>0&&this.recordedBlobs.push(o.data)},takeSnapShot:function(o,n){if(o&&o.videoHeight!==0){var t=document.createElement("canvas");t.width=o.videoWidth,t.height=o.videoHeight;var e=t.getContext("2d");e&&e.drawImage(o,0,0,t.width,t.height),n.src=t.toDataURL("image/jpeg")}else this.logger.error("video can not empty")},saveSnapShot:function(o,n){if(o&&o.videoHeight!==0){var t=document.createElement("canvas");t.width=o.videoWidth,t.height=o.videoHeight;var e=t.getContext("2d");e&&e.drawImage(o,0,0,t.width,t.height),t.toBlob(function(r){var i=window.URL.createObjectURL(r),s=document.createElement("a");s.style.display="none",s.href=i,s.download=n+".jpeg",document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(i)},100)})}else this.logger.error("video can not empty")},setStreamExtraInfo:function(o,n){var t=this;return new Promise(function(e,r){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),t.dataReport.addMsgInfo(i,{stream:a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(o),stream_extra_info:a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(n)});var s=function(p,f){t.logger.error("zb.ssei "+f),t.dataReport.addMsgInfo(i,{error:p.code,message:p.message+" "+f}),t.dataReport.uploadReport(i),r({errorCode:p.code,extendedData:p.message+" "+f})};if(typeof o=="string"&&o!="")if(typeof n=="string"&&n!="")if(t.RTM.isDisConnect())s(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(t.stateCenter.publishStreamList[o]){var u=t.streamCenter.getRoomByStreamID(o);u?(t.dataReport.addMsgInfo(i,{room_sid:a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(u.sessionID)}),u.streamHandler.setStreamExtraInfo(o,n,e,s),t.dataReport.uploadReport(i)):s(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else s(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else s(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else s(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")})},addTrack:function(o,n){var t=this;return new Promise(function(e,r){t.logger.info(d.ZEGO_WEBRTC_ACTION.ADD_TRACK+" call"),t.rtcModules.advancedModule.handleTrack("ADD",o,n,e,r)})},removeTrack:function(o,n){var t=this;return new Promise(function(e,r){t.logger.info(d.ZEGO_WEBRTC_ACTION.REMOVE_TRACK+" call"),t.rtcModules.advancedModule.handleTrack("REMOVE",o,n,e,r)})},enableCameraCapturing:function(o,n){return n===void 0&&(n=!0),h(this,void 0,void 0,function(){var t;return _(this,function(e){return(t=this.streamCenter.checkPreview(o))?[2,t.enableCameraCapturing(n)]:(this.logger.error("zsc.ecc no preview"),[2,!1])})})}},T.streamHandler={_publishTarget:function(o,n,t){var e=this;this.logger.info("zb.sh.ptcall");var r=Math.ceil(new Date().getTime()/1e3),i=o.streamID;this.stateCenter.testEnvironment&&(i="zegotest-"+this.stateCenter.appid+"-"+o.streamID);var s={appid:this.stateCenter.appid,biz_type:0,timestamp:r,seq:this.stateCenter.cdnSeq++,version:1*T.PROTO_VERSION,stream_id:i,pushurl:o.pushUrl};if(this.logger.debug("zb.sh.pt send command"),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:1,location:"/liveroomcmd/push",cmd:o.type},s,function(p){e.logger.info("zb.sh.pt receive message");var f=p||{},E=f.code,y=f.message;E&&E!=0?(e.logger.error("zb.sh.pt "+o.type+" error code: "+E+" "+y),t(l.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+o.type+" "+E+" "+y)):(e.logger.info("zb.sh.pt "+o.type+" success"),n&&n({errorCode:0,extendedData:""}))},function(p,f,E,y){var b="";y||(y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,p===200?(e.logger.info("zb.sh.pt error: "+f),y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,f==2001?y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:f==2002&&(y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),b="cmd: "+o.type+", biz_code: "+f):b="request media server fail, error: "+p,e.logger.error("zb.sh.pt "+b)),t&&t(y,b)});else{var u={channel:"media",cmd:o.type,req_body:JSON.stringify(s)};this.sendBizChannelRequest(u,function(p,f,E){if(e.logger.info("zb.sh.pt receive message"),E.length!=0){var y=JSON.parse(E),b=y.code,S=y.message;b&&b!=0?(e.logger.error("zb.sh.pt "+o.type+" error code: "+b+" "+S),t(l.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+o.type+" "+b+" "+S)):(e.logger.info("zb.sh.pt "+o.type+" success"),n&&n({errorCode:0,extendedData:""}))}else t(a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)},function(p,f,E){e.logger.info("zb.sh.pt error: "+p);var y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;p==2001?y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:p==2002&&(y=a.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),e.logger.error("zb.sh.pt "),t(y," cmd: "+o.type+" "+p+"   ")})}},updateStreamExtraInfo:function(o,n,t,e){var r;this.logger.info("zb.sh.usei call"),r=this.stateCenter.type==="PUBLIC"?T.ENUM_STREAM_SUB_CMD.liveUpdate:T.ENUM_STREAM_CMD_PRI.liveUpdate,this.stateCenter.publishStreamList[o]&&this.stateCenter.publishStreamList[o].state>=T.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[o].extra_info=n,this.updateStreamInfo(o,r,n),t({errorCode:0})):this.stateCenter.publishStreamList[o]&&this.stateCenter.publishStreamList[o].state===T.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[o].extra_info=n,t({errorCode:0})):e(a.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(o,n,t,e){this.updateStreamExtraInfo(o,n,t,e)}},T.preview={enableCamera:function(o,n,t){var e,r,i,s,u,p=this;if(!this.localStream||this.localStream.getVideoTracks().length==0)return this.logger.error("zp.ec.2 video track no found"),!1;var f,E=this.videoTrack;if(!o&&this.muteImage){var y=document.createElement("canvas");y.width=this.muteImage.width,y.height=this.muteImage.height;var b=y.getContext("2d"),S=function(){b.drawImage(p.muteImage,0,0),p.muteImageAnID=requestAnimationFrame(S)};S(),f=y.captureStream().getVideoTracks()[0],this.localStream.removeTrack(this.localStream.getVideoTracks()[0]),this.localStream.addTrack(f)}else o&&this.muteImage&&(((e=this==null?void 0:this.videoEffect)===null||e===void 0?void 0:e.enabled)?this.replacePreviewTrack(this.videoEffect.output,!0):this.replacePreviewTrack(this.videoTrack));if(t&&!o||!E)t&&!o&&(((r=this.videoEffect)===null||r===void 0?void 0:r.enabled)?this.logger.warn("zp.ec.2 Unable to keep the preview screen when beauty is turned on"):(this.cloneVideoTrack&&this.cloneVideoTrack.stop(),this.cloneVideoTrack=this.videoTrack.clone(),this.cloneVideoTrack.enabled=!0,this.replacePreviewTrack(this.cloneVideoTrack,!1,{retainTrack:!0})));else if(E.enabled=o,this.stateCenter.browser==="chrome"&&o&&typeof E.getSettings().width!==void 0&&E.getSettings().width>0&&navigator.userAgent){var k=0,O=navigator.userAgent.toLowerCase().match(/chrome\/([\d.]+)/)[1];if(O&&(k=parseInt(O.split(",")[0])),k&&k>=87&&k<92){var g=E.getSettings().width-1,v=E.getSettings().height-1,R=E.getSettings().frameRate;E.applyConstraints({width:g,height:v,frameRate:R}).then(function(){E.applyConstraints({width:p.videoInfo.width,height:p.videoInfo.height,frameRate:R})})}}E==null||(E.enabled=o);var L=(i=n.checkPublish(this.localStream))===null||i===void 0?void 0:i.publisher;if(L){var N=(s=L.peerConnection)===null||s===void 0?void 0:s.getSenders().find(function(x){var Z;return((Z=x.track)===null||Z===void 0?void 0:Z.kind)==="video"});if(!o&&this.muteImage&&f)N==null||N.replaceTrack(f);else if(t&&!o){var w=this.videoTrack.clone();N==null||N.replaceTrack(w),w.stop()}else o&&(((u=this==null?void 0:this.videoEffect)===null||u===void 0?void 0:u.enabled)&&this.videoEffect.output?N==null||N.replaceTrack(this.videoEffect.output):N==null||N.replaceTrack(this.videoTrack),this.muteImageAnID&&cancelAnimationFrame(this.muteImageAnID));var B=this.muteImage&&!o?0:this.videoTrack&&this.videoTrack.readyState==="live"?this.videoTrack.enabled?0:20:2;L.sendStreamStatus(B,L.mic_status)}return this.isVideoEnabled=o,this.logger.info("zp.ec.2 call success"),!0},enableMicrophone:function(o,n){var t;if(!this.localStream)return this.logger.error("zp.em.2 no localStream"),!1;this.localStream.getAudioTracks().forEach(function(s){s.enabled=o}),this.audioTrack&&(this.audioTrack.enabled=o&&n.isMicEnabled);var e=(t=n.checkPublish(this.localStream))===null||t===void 0?void 0:t.publisher;if(e&&e.signal){var r=e.camera_status,i=o&&n.isMicEnabled?0:2;e.sendStreamStatus(r,i)}return this.isAudioEnabled=o,this.logger.debug("zp.em.2 call success"),!0},replacePreviewTrack:function(o,n,t){var e;return n===void 0&&(n=!1),h(this,void 0,void 0,function(){var r,i,s;return _(this,function(u){switch(u.label){case 0:return o&&o.kind&&this.localStream?(r=(t==null?void 0:t.retainTrack)===!0,i=o.kind==="audio"?"audioTrack":"videoTrack",n||!((e=this.videoEffect)===null||e===void 0?void 0:e.enabled)||o.kind!=="video"?[3,3]:r?[3,2]:[4,this.videoEffect.setInput(o)]):[2];case 1:u.sent(),u.label=2;case 2:return[3,4];case 3:(s=this.localStream.getTracks().find(function(p){return p.kind===o.kind}))&&this.localStream.removeTrack(s),this.localStream.addTrack(o),u.label=4;case 4:return n||r||(this[i]=o),[2]}})})},enableCameraCapturing:function(o){var n;return h(this,void 0,void 0,function(){var t,e,r,i,s,u,p,f;return _(this,function(E){switch(E.label){case 0:return this.localStream&&this.videoTrack&&this.previewType==="camera"?(t=(n=this.streamCenter.checkPublish(this.localStream))===null||n===void 0?void 0:n.publisher,o?this.videoTrack.readyState!=="live"?[3,1]:(this.logger.warn("zp.ecc camera is already capturing"),[3,9]):[3,10]):(this.logger.error("zp.ecc not camera stream"),[2,!1]);case 1:e=this.getMediaStreamConstraints(m(m({},this.mediaStreamConfig),{audio:!1})),E.label=2;case 2:return E.trys.push([2,8,,9]),[4,navigator.mediaDevices.getUserMedia(e)];case 3:return r=E.sent(),(i=r.getVideoTracks()[0]).enabled=this.isVideoEnabled,i.enabled===!1&&this.logger.warn("zp.ecc video is not enabled"),!this.muteImage||this.isVideoEnabled?[3,4]:(this.videoTrack=i,i.enabled=!this.isVideoEnabled,[3,7]);case 4:return t?[4,t.replacePublishedTrack(i)]:[3,6];case 5:if((s=E.sent()).errorCode!==0)throw s;return[3,7];case 6:this.replacePreviewTrack(i),E.label=7;case 7:return[3,9];case 8:return u=E.sent(),this.logger.error("zsc.ecc resume camera capturing failed. "+JSON.stringify(u)),[2,!1];case 9:return[3,13];case 10:return p=this.videoTrack.enabled,this.stateCenter.browser==="safari"?[3,12]:(this.videoTrack.enabled=!1,[4,new Promise(function(y){setTimeout(function(){y()},100)})]);case 11:E.sent(),E.label=12;case 12:this.videoTrack.stop(),this.videoTrack.enabled=p,t&&(f=this.muteImage&&!this.isVideoEnabled?0:this.videoTrack&&this.videoTrack.readyState==="live"?this.videoTrack.enabled?0:20:2,t.sendStreamStatus(f,t.mic_status)),E.label=13;case 13:return[2,!0]}})})}},T.playModule={mutePlayStream:function(o,n,t){var e=this;return this.logger.info("zsc.mps.0 call "+n+" "+t),new Promise(function(r,i){if(typeof o!="string"||o=="")return e.logger.error("zsc.mps.0 streamID must be string and not empty"),void i(!1);if(typeof t!="boolean")return e.logger.error("zsc.mps.0 mute must be boolean"),void i(!1);var s=e.streamCenter.playerList[o];if(!s)return e.logger.error("zsc.mps.0 player not found"),void i(!1);if(n==="video"){if(s.playOption&&s.playOption.video===!1||s.player&&s.player.cameraStatus!==0)return e.logger.error("zsc.mps.0 stream no contain video"),void i(!1);s.player.signal.ActivatePlayVideoStream(e.stateCenter.getSeq(),s.player.sessionId,t,function(){e.logger.info("zsc.mps.0 suc");var u=e.stateCenter.getReportSeq();s.player.playMediaStatus.video=!t,e.dataReport.newReport(u,a.ZegoRTCLogEvent.kZegoPlayContentChanged.event),e.dataReport.addMsgInfo(u,{session_id:a.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:a.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(s.player.playMediaStatus.video?1:0),audio_activate:a.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(s.player.playMediaStatus.audio?1:0)}),e.playVideoStatus=e.dataReport.uploadReport(u),r(!0)},function(){e.logger.error("zsc.mps.0 fail"),i(!1)})}else if(n==="audio"){if(s.playOption&&s.playOption.audio===!1||s.player&&s.player.micStatus!==0)return e.logger.error("zsc.mps.0 stream no contain audio"),void i(!1);s.player.signal.ActivatePlayAudioStream(e.stateCenter.getSeq(),s.player.sessionId,t,function(){e.logger.info("zsc.mps.0 suc");var u=e.stateCenter.getReportSeq();s.player.playMediaStatus.audio=!t,e.dataReport.newReport(u,a.ZegoRTCLogEvent.kZegoPlayContentChanged.event),e.dataReport.addMsgInfo(u,{session_id:a.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:a.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(s.player.playMediaStatus.video?1:0),audio_activate:a.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(s.player.playMediaStatus.audio?1:0)}),e.dataReport.uploadReport(u),r(!0)},function(){e.logger.error("zsc.mps.0 fail"),i(!1)})}else i(!1)})},setStreamAudioOutput:function(o,n){var t=this;return!(n==null||n.length==0||!o||(this.logger.debug("zsc.ssao.0 device "+n),o?o.sinkId!=="undefined"?(o.setSinkId(n).then(function(){t.logger.info("zsc.ssao.0 success device: "+n)}).catch(function(e){t.logger.info("zsc.ssao.0 "+e.name)}),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))}},T.publishModule={activateSEIInsert:function(o,n,t){t===void 0&&(t=0);var e=this.streamCenter.checkPreview(o);if(!e)return this.logger.error(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" stream is not created"),!1;if(n!==0&&n!==1)return this.logger.error(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" value of \u201Caction\u201D should be 0 or 1"),!1;e.activatesSEIConfig={action:n,infoType:t};var r=this.streamCenter.checkPublish(o);return r&&(r==null||r.publisher.activateSEIInsert(n,t)),!0}},T.publisher={activateSEIInsert:function(o,n){var t=this;return new Promise(function(e,r){return t.signal?(t.signal&&t.signal.activateSEIInsert(t.stateCenter.getSeq(),t.sessionId,t.peerID,o,n,function(i,s,u){var p=!1;u.result===0?(t.logger.info(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" called success"),p=!0):u.result===1?(t.logger.error(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" "+u.peer_id+" invalid param."),p=!1):u.result===2&&(t.logger.error(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" peer not exist"),p=!1),e(p)},function(i){i===1&&t.logger.error(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" request timeout")}),!1):e(!1)})},replacePublishedTrack:function(o,n){var t;return n===void 0&&(n=!1),h(this,void 0,void 0,function(){var e,r,i,s,u,p,f,E,y;return _(this,function(b){switch(b.label){case 0:return this.localStream,e=this.previewer,r=e==null?void 0:e.videoEffect,i=o.kind,s=e[i+"Track"],u=(t=this.peerConnection)===null||t===void 0?void 0:t.getSenders().find(function(S){return S.track.kind===i}),s?(p=0,f=0,i==="video"?(E=o.readyState,y=o.enabled,n&&(E=s.readyState,y=s.enabled),p=E!=="live"?2:y===!0?0:20,f=this.mic_status):i==="audio"&&(f=o.readyState!=="live"?2:o.enabled===!0?0:20,p=this.camera_status),[4,e.replacePreviewTrack(o,n)]):[3,6];case 1:return b.sent(),u?i!=="audio"&&!n&&(r==null?void 0:r.enabled)?[3,3]:[4,u.replaceTrack(o)]:[3,4];case 2:b.sent(),b.label=3;case 3:return this.sendStreamStatus(p,f),[3,5];case 4:this.logger.info("zc.rt.1 replace remote track will work after stream published"),b.label=5;case 5:return this.logger.info("zc.rt.1 replace remote track success"),[2,{errorCode:0,extendedData:""}];case 6:return this.logger.error("zc.rt.1 publisher track no found"),[2,{errorCode:l.errorCodeList.TRACK_NOT_FOUND.code,extendedData:l.errorCodeList.TRACK_NOT_FOUND.message}]}})})}},T.signal={activateSEIInsert:function(o,n,t,e,r,i,s){this.logger.info(d.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" call "+n);var u={peer_id:t,action:e,info_type:r};this.sendMessageWithCallback("ActivateSEIInsertReq",o,n,u,i,s)}}},5098:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},TRACK_CAN_NOT_ADD:{code:1103063,message:"only stream which have one track and kind no exist can add track"},TRACK_CAN_NOT_REMOVE:{code:1103064,message:"stream which only has one track can not remove "},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},PUBLISHER_STATE_WRONG:{code:1103069,message:"publisher state wrong"},HANDLE_TRACK_NOT_SUPPORTED:{code:1103070,message:"not support remove track"},VIDEO_EFFECT_IS_RUNNING:{code:1103071,message:"video effect processor is running"}}},3824:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0});var m=I(4495),h=I(4378);T.default={type:"Advance",install:function(_,d,l,a,c,o,n,t){for(var e in Object.defineProperty(d.prototype,"initAdvance",{value:function(){this.advancedModule=new m.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),h.zegoWebRTC)Object.defineProperty(_.prototype,e,{value:h.zegoWebRTC[e],writable:!1});for(var e in h.streamHandler)Object.defineProperty(l.prototype,e,{value:h.streamHandler[e],writable:!1});for(var e in h.preview)Object.defineProperty(a.prototype,e,{value:h.preview[e],writable:!1});for(var e in h.playModule)Object.defineProperty(c.prototype,e,{value:h.playModule[e],writable:!1});for(var e in h.publishModule)Object.defineProperty(o.prototype,e,{value:h.publishModule[e],writable:!1});for(var e in h.publisher)Object.defineProperty(n.prototype,e,{value:h.publisher[e],writable:!1});for(var e in h.signal)Object.defineProperty(t.prototype,e,{value:h.signal[e],writable:!1})}}},8706:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRTCLogEvent=void 0;var m=I(5098),h=function(_){return _};T.ZegoRTCLogEvent={kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:m.errorCodeList.INPUT_PARAM,kLocalStreamError:m.errorCodeList.LOCALSTREAM_WRONG}},kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:m.errorCodeList.INPUT_PARAM}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:m.errorCodeList.INPUT_PARAM}},kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:m.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:m.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:m.errorCodeList.LOCALSTREAM_WRONG},device:h},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:m.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:m.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:m.errorCodeList.LOCALSTREAM_WRONG},device:h},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:m.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:m.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:m.errorCodeList.NOT_LOGIN,kNoResponseError:m.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:m.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:m.errorCodeList.INVALID_CHANNEL,kUnknownServerError:m.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:m.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:m.errorCodeList.INPUT_PARAM},stream:h,target_url:h},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:m.errorCodeList.INPUT_PARAM}},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:h,video_activate:h,audio_activate:h},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMuteMicrophone:"/sdk/mute_microphone",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:m.errorCodeList.INPUT_PARAM,kExtraInfoNullError:m.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:m.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:m.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:m.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:h,stream_extra_info:h,room_sid:h}}},7248:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.MediaUtil=void 0;var I=function(){function m(h,_){var d=this,l=_.type,a=_.channels,c=a===void 0?1:a,o=_.bufferSize,n=o===void 0?0:o,t=_.sampleBit,e=t===void 0?16:t,r=_.sampleRate,i=r===void 0?44100:r;this.instant=0,this.slow=0,this.clip=0,this.context=h,this.type=l,this.channels=c,this.bufferSize=n,this.sampleBit=e,this.sampleRate=i,this.script=h.createScriptProcessor(n,c,c),new Date().getTime(),this.script.addEventListener("audioprocess",function(s){var u,p=s.inputBuffer.getChannelData(0),f=0,E=0;for(u=0;u<p.length;++u)f+=p[u]*p[u],Math.abs(p[u])>.99&&(E+=1);if(d.instant=Math.sqrt(f/p.length),d.slow=.95*d.slow+.05*d.instant,d.clip=E/p.length,l==="pcm"||l==="wav"){for(var y=[],b=0;b<d.channels;b++)y.push(s.inputBuffer.getChannelData(b));d.recorderBuffer(y)}}),l!=="pcm"&&l!=="wav"||this.initRecorderBuffer(l)}return m.prototype.connectToSource=function(h,_){try{this.mic=this.context.createMediaStreamSource(h),this.mic.connect(this.script),this.script.connect(this.context.destination),_!==void 0&&_(null)}catch(d){console.error(d),_!==void 0&&_(d)}return this},m.prototype.recorderBuffer=function(h){this.worker.postMessage({command:"record",val:h})},m.prototype.initRecorderBuffer=function(h){var _=this;this.worker=this.inlineWorker(function(){var d,l,a,c,o,n,t=[];function e(E,y,b){for(var S=0;S<b.length;S++,y+=2){var k=Math.max(-1,Math.min(1,b[S]));E.setInt16(y,k<0?32768*k:32767*k,!0)}}function r(E,y,b){for(var S=0;S<b.length;S++,y++){var k=Math.max(-1,Math.min(1,b[S])),O=k<0?128*k:127*k;O+=128,E.setInt8(y,O)}}function i(E,y,b){for(var S=0;S<b.length;S++)E.setUint8(y+S,b.charCodeAt(S))}function s(E,y){for(var b=new Float32Array(y.length/E),S=0,k=0;S<b.length;)b[S]=y[k],k+=E,S++;return b}function u(E,y,b){for(var S=new Float32Array(y*E.length),k=0,O=0;O<b[0].length;O++)S.set(b[0][O],k),k+=b[0][O].length;return S}function p(E,y){for(var b=new Float32Array(E.length+y.length),S=0;S<E.length+y.length;S+=2)b[S]=E[S/2>>0],b[S+1]=y[S/2>>0];return b}function f(E){var y,b;if(d==1)y=u(t[0],o,t),E!=1&&(b=s(E,y));else if(d==2){var S=u(t[0],o,t),k=u(t[1],o,t);E!=1?b=p(s(E,S),s(E,k)):y=p(S,k)}return E!=1?b:y}this.onmessage=function(E){switch(E.data.command){case"init":y=E.data.val,d=y.sampleChannel,l=y.sampleBit,a=y.sampleRate,c=y.oldSampleRate,o=y.bufferSize,n=y.type;break;case"record":(function(b){for(var S=0;S<d;S++)t[S]||(t[S]=[]),t[S].push(b[S]);var k=Math.round(c/a);n==="pcm"?function(O){var g=function(v,R){var L;R==8?L=v.length:R==16&&(L=v.length,L*=2);var N=new ArrayBuffer(L),w=new DataView(N);return R==8?r(w,0,v):l==16&&e(w,0,v),w}(f(O),l);self.postMessage({command:"exportPcmLive",val:g})}(k):n==="wav"&&function(O){var g=function(v,R){var L;R==8?L=v.length:l==16&&(L=v.length,L*=2);var N=new ArrayBuffer(L+44),w=new DataView(N),B=a,x=l,Z=d;return i(w,0,"RIFF"),w.setUint32(4,36+L,!0),i(w,8,"WAVE"),i(w,12,"fmt "),w.setUint32(16,16,!0),w.setUint16(20,1,!0),w.setUint16(22,Z,!0),w.setUint32(24,B,!0),w.setUint32(28,B*Z*(x/8),!0),w.setUint16(32,Z*(x/8),!0),w.setUint16(34,x,!0),i(w,36,"data"),w.setUint32(40,L,!0),l==8?r(w,44,v):l==16&&e(w,44,v),w}(f(O),l);self.postMessage({command:"exportWav",val:g})}(k),t=[]})(E.data.val)}var y}}),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:h}}),this.worker.onmessage=function(d){switch(d.data.command){case"exportPcmLive":_.onReceiveBuffer(d.data.val);break;case"exportWav":_.onReceiveWav(d.data.val)}}},m.prototype.onReceiveBuffer=function(h){},m.prototype.onReceiveWav=function(h){},m.prototype.writeString=function(h,_,d){for(var l=0;l<d.length;l++)h.setUint8(_+l,d.charCodeAt(l))},m.prototype.writeBuffer=function(h,_,d){for(var l=0;l<d.byteLength;l++)h.setUint8(_+l,d[l])},m.prototype.concatenation=function(h){for(var _=0,d=0;d<h.length;++d)_+=h[d].buffer.byteLength;var l=new Uint8Array(_),a=0;for(d=0;d<h.length;++d)l.set(new Uint8Array(h[d].buffer),a),a+=h[d].buffer.byteLength;return l},m.prototype.encodeWave=function(h){var _=this.concatenation(h),d=_.byteLength,l=new ArrayBuffer(d+44),a=new DataView(l),c=this.sampleRate,o=this.sampleBit,n=this.channels;return this.writeString(a,0,"RIFF"),a.setUint32(4,36+d,!0),this.writeString(a,8,"WAVE"),this.writeString(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n,!0),a.setUint32(24,c,!0),a.setUint32(28,c*n*(o/8),!0),a.setUint16(32,n*(o/8),!0),a.setUint16(34,o,!0),this.writeString(a,36,"data"),a.setUint32(40,d,!0),this.writeBuffer(a,44,_),a},m.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},m.prototype.inlineWorker=function(h){if(Worker&&h){var _=h.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],d=URL.createObjectURL(new window.Blob([_],{type:"text/javascript"}));return new Worker(d)}return null},m}();T.MediaUtil=I},2523:function(W,T){"use strict";var I;Object.defineProperty(T,"__esModule",{value:!0}),T.ZEGO_WEBRTC_ACTION=void 0,(I=T.ZEGO_WEBRTC_ACTION||(T.ZEGO_WEBRTC_ACTION={})).PRELOAD_EFFECT="zc.pe.0",I.PLAY_EFFECT="zc.pe.1",I.PAUSE_EFFECT="zc.pe.2",I.RESUME_EFFECT="zc.re",I.STOP_EFFECT="zc.se",I.UNLOAD_EFFECT="zc.ue",I.AUDIO_EFFECT_PROCESS="zc.aep",I.SET_EFFECT_VOLUME="zc.sev",I.START_MIXING_AUDIO="zc.sma.0",I.STOP_MIXING_AUDIO="zc.sma.1",I.MIXING_BUFFER="zc.mb",I.STOP_MIXING_BUFFER="zc.smb",I.SET_MIXING_AUDIO_VOLUME="zc.smav",I.PUBLISHER_PLAY_EFFECT="zc.p.0.pe.0",I.PUBLISHER_PAUSE_EFFECT="zc.p.0.pe.1",I.PUBLISHER_RESUME_EFFECT="zc.p.0.re",I.PUBLISHER_STOP_EFFECT="zc.p.0.se",I.PUBLISHER_START_MIXING_AUDIO="zc.p.0.sma.0",I.PUBLISHER_STOP_MIXING_AUDIO="zc.p.0.sma.1",I.PUBLISHER_MIXING_BUFFER="zc.p.0.mb",I.PUBLISHER_SET_MIXING_AUDIO_VOLUME="zc.p.0.smav"},3013:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.AudioBufferProcessor=void 0;var m=I(4853),h=function(){function _(d,l){this.logger=d,this.ac=l,this.audioBufferList=[],this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.paused=!1,this.isMixAudio=!1,this.isMixingBuffer=!1,this.loop=!1}return _.prototype.playEffect=function(d,l,a,c,o){var n=this;this.isMixAudio!==!0?this.audioBuffer?(this.startOffset=d||0,this.loop=l||!1,this.replace=a||!1,this.effectEndedCallBack=o,this.mixEffect(this.audioBuffer,function(){n.buffSource.loop=!!l,d?n.buffSource.start(0,d/1e3):n.buffSource.start(0),n.startTimes=Date.now(),n.effectEndedListener=n.effectEndedHandler.bind(n),n.buffSource.addEventListener("ended",n.effectEndedListener),c&&c()})):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.warn("amu.pe.1 audio is mixing")},_.prototype.stopMingBuffer=function(){return this.isMixingBuffer=!1,this.stopMixingAudio()},_.prototype.playRealTimeEffect=function(d){var l=this;this.mixEffect(d,function(){l.buffSource&&l.buffSource.start(0),l.buffSource&&l.buffSource.addEventListener("ended",function(){l.audioBufferList.shift(),l.audioBufferList.length>0&&l.isMixAudio&&l.playRealTimeEffect(l.audioBufferList[0])})})},_.prototype.pauseEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be paused"):(this.stopMixingAudio(!0),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration),this.paused=!0)},_.prototype.resumeEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be resume"):(this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset,this.paused=!1)},_.prototype.mixEffect=function(d,l){this.localStream?(this.ac.resume(),this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=d,this.buffSource.connect(this.gainNode),this.gainNode.connect(this.ac.destination),this.replaceTrack()&&l()):this.logger.error("amu.me.0 localStream can not be found")},_.prototype.replaceTrack=function(){if(!this.destination||!this.streamSource)return!1;!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var d=this.destination.stream.getAudioTracks()[0],l=this.peerConnection.getSenders().find(function(a){return a.track.kind===d.kind});return l?(this.micTrack=this.localStream.getAudioTracks()[0],l.replaceTrack(d),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(d),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},_.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack(),this.effectEndedCallBack=null},_.prototype.stopMixingAudio=function(d){return d===void 0&&(d=!1),this.paused?(this.logger.info("amu.sma.1 audioEffect is paused"),!d&&this.effectEndedListener&&(this.effectEndedCallBack&&this.effectEndedCallBack(),this.effectEndedCallBack=null),!0):this.isMixAudio?this.localStream?(this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.gainNode.disconnect(this.ac.destination),this.isMixAudio=!1,this.audioBufferList=[],!d&&this.effectEndedListener&&(this.effectEndedCallBack&&this.effectEndedCallBack(),this.effectEndedCallBack=null),!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},_.prototype.getProcess=function(){var d=Date.now();return this.paused&&(d=this.pauseTimes),(d-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration)},_.prototype.seekTo=function(d){d===void 0&&(d=0),this.startOffset=d,this.paused?this.resumeOffset=d:(this.stopMixingAudio(!0),this.playEffect(d,this.loop,this.replace,void 0,this.effectEndedCallBack))},_.prototype.mixingBuffer=function(d,l){var a=this;this.isMixAudio!==!0||this.audioBufferList.length!=0||this.isMixingBuffer!=0?(this.ac.resume(),this.ac.decodeAudioData(d,function(c){a.audioBufferList.push(c),a.audioBufferList.length==1&&a.playRealTimeEffect(a.audioBufferList[0]),a.isMixingBuffer=!0,l&&l()},function(c){a.logger.error("amu.mb.0 "+c),l&&l({code:m.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.code,message:m.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.message+" "+c})})):this.logger.error("amu.mb.0 audio is mixing")},_}();T.AudioBufferProcessor=h},4194:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.AudioMix=void 0;var I=function(){function m(h,_,d,l){this.logger=h,this.stateCenter=_,this.ac=d,this.mediaEleSources=l,this.replace=!1,this.isMixAudio=!1,this.audioCurrentTimer=null,this.audioResumedTimer=null}return m.prototype.startMixingAudio=function(h,_){if(this.replace=_||!1,this.isMixAudio)return this.logger.error("amu.sma.0 audio is mixing"),!1;if(!this.localStream)return this.logger.error("amu.sma.0 localStream can not be found"),!1;if(h.captureStream=h.captureStream||h.mozCaptureStream||h.webkitCaptureStream,this.ac.resume(),this.gainNode=this.ac.createGain(),this.stateCenter.browser==="safari"){var d=this.mediaEleSources.find(function(o){return o.audio===h});if(d)this.audioNode=d.node;else{var l=this.ac.createMediaElementSource(h);this.audioNode=l,this.mediaEleSources.push({audio:h,node:l})}var a=this.getBrowserInfo(),c=!1;(a==null?void 0:a.sysVer)==="10.15.6"&&(a==null?void 0:a.ver)==="13.1.2"&&(c=!0),c&&(this.audioResumedTimer=setInterval(function(){h.currentTime=h.currentTime+.45},6e4))}else this.audioNode=this.ac.createMediaStreamSource(h.captureStream());return this.audioNode.connect(this.gainNode),this.replaceTrack()},m.prototype.getBrowserInfo=function(){var h,_={},d=navigator.userAgent.toLowerCase();h=(d.match(/x [\d._]+/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."),_.sysVer=h;var l=d.match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/);return l&&(_.browser=l[1].replace(/version/,"'safari"),_.ver=l[2]),_},m.prototype.replaceTrack=function(){if(!this.destination||!this.streamSource)return!1;!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var h=this.destination.stream.getAudioTracks()[0],_=this.peerConnection.getSenders().find(function(d){return d.track.kind===h.kind});return _?(this.micTrack=this.localStream.getAudioTracks()[0],_.replaceTrack(h),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(h),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},m.prototype.stopMixingAudio=function(){return this.isMixAudio?this.localStream?(this.audioNode&&(this.audioNode.disconnect(this.gainNode),this.audioNode=null,this.audioCurrentTimer&&(clearInterval(this.audioCurrentTimer),this.audioCurrentTimer=null),this.audioResumedTimer&&(clearInterval(this.audioResumedTimer),this.audioResumedTimer=null)),this.gainNode.disconnect(this.destination),this.isMixAudio=!1,!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},m.prototype.setMixingAudioVolume=function(h){return this.gainNode?(this.gainNode.gain.value=h,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},m}();T.AudioMix=I},6459:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(a,c,o,n){return new(o||(o=Promise))(function(t,e){function r(u){try{s(n.next(u))}catch(p){e(p)}}function i(u){try{s(n.throw(u))}catch(p){e(p)}}function s(u){var p;u.done?t(u.value):(p=u.value,p instanceof o?p:new o(function(f){f(p)})).then(r,i)}s((n=n.apply(a,c||[])).next())})},h=this&&this.__generator||function(a,c){var o,n,t,e,r={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e;function i(s){return function(u){return function(p){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(t=2&p[0]?n.return:p[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,p[1])).done)return t;switch(n=0,t&&(p=[2&p[0],t.value]),p[0]){case 0:case 1:t=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,n=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(!((t=(t=r.trys).length>0&&t[t.length-1])||p[0]!==6&&p[0]!==2)){r=0;continue}if(p[0]===3&&(!t||p[1]>t[0]&&p[1]<t[3])){r.label=p[1];break}if(p[0]===6&&r.label<t[1]){r.label=t[1],t=p;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(p);break}t[2]&&r.ops.pop(),r.trys.pop();continue}p=c.call(a,r)}catch(f){p=[6,f],n=0}finally{o=t=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.AudioMixModule=void 0;var _=I(2523),d=I(4234),l=function(){function a(c,o,n,t,e){this.logger=c,this.dataReport=o,this.stateCenter=n,this.streamCenter=t,this.ac=e,this.buffer=null,this.blank=null,this.stateCenter.browser=="safari"&&this.blank==null&&this.buffer==null&&(this.ac.resume(),this.buffer=this.ac.createBuffer(1,1,this.ac.sampleRate),this.blank=this.ac.createBufferSource(),this.blank.buffer=this.buffer,this.blank.connect(this.ac.destination),this.blank.start())}return a.prototype.preloadEffect=function(c,o,n){if(c&&typeof c=="string"&&o&&typeof o=="string"){if(this.stateCenter.audioEffectBuffer[c])return this.logger.warn(_.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" audio buffer already exists"),void(n&&n());this.logger.info(_.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" start preload effect"),this._preloadEffect(this.ac,c,o,n)}else this.logger.error(_.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" params error")},a.prototype.getEffectDuration=function(c){if(c&&typeof c!="string")return 0;var o=this.stateCenter.audioEffectBuffer[c];return o?o.duration?Math.floor(1e3*o.duration):0:(this.logger.error(_.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" effect not found"),0)},a.prototype.getEffectProgress=function(c,o){if(!c)return this.logger.error(_.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" streamID format error"),0;o&&typeof o!="string"&&this.logger.error(_.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" effect ");var n=this.streamCenter.getPublisher(c);return n?n.getEffectProgress(o):(this.logger.error(_.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" publisher doesn't exist"),0)},a.prototype.seekAudioEffect=function(c,o,n){if(!c)return this.logger.error(_.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" streamID format error"),!1;(!o||typeof o=="string")&&n>=0||this.logger.error(_.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" params error ");var t=this.streamCenter.getPublisher(c);return t?t.seekAudioEffect(o,n):(this.logger.error(_.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" publisher doesn't exist"),!1)},a.prototype.playEffect=function(c,o,n){return m(this,void 0,void 0,function(){var t,e,r,i=this;return h(this,function(s){switch(s.label){case 0:return typeof c.effectID!="string"||!c.streamID&&!c.stream?(this.logger.error(_.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" params error"),[2]):(t=c.path,e=c.effectID,r=this.stateCenter.audioEffectBuffer[e],t?r?(this.logger.warn(_.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" audio effect already exists"),[3,3]):[3,1]:[3,4]);case 1:return[4,new Promise(function(u,p){i.preloadEffect(e,t,function(f){f?(i.logger.error(_.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" preload audio effect failed"),p(f)):u(void 0)})})];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!r)return this.logger.error(_.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" audio effect doesn't exists"),[2];s.label=5;case 5:return this._playEffect(c,o,n),[2]}})})},a.prototype.pauseEffect=function(c,o){return c?(o&&typeof o!="string"&&this.logger.error(_.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" effect "),this._pauseEffect(c,o)):(this.logger.error(_.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" streamID format error"),!1)},a.prototype.resumeEffect=function(c,o){return c?(o&&typeof o!="string"&&this.logger.error(_.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" effect "),this._resumeEffect(c,o)):(this.logger.error(_.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" streamID format error"),!1)},a.prototype.stopEffect=function(c,o){return c?(o&&typeof o!="string"&&this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" effect "),this._stopEffect(c,o)):(this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" streamID format error"),!1)},a.prototype.unloadEffect=function(c){return c&&typeof c=="string"?(delete this.stateCenter.audioEffectBuffer[c],!0):(this.logger.error(_.ZEGO_WEBRTC_ACTION.UNLOAD_EFFECT+" params error"),!1)},a.prototype.setEffectVolume=function(c,o,n){if(!c)return this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" streamID format error"),!1;n&&typeof n!="string"&&this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" effect ");var t=this.streamCenter.getPublisher(c);return t?t.setEffectVolume(o/100,n):(this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" publisher doesn't exist"),!1)},a.prototype.startMixingAudio=function(c,o){return this.logger.info(_.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" call "+c),c?o?(this.logger.info(_.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" end "+c),Array.isArray(o)&&o.length!==0?this._startMixingAudio(c,o):(this.logger.error(_.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" audio param type error"),!1)):(this.logger.error(_.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" no audio"),!1):(this.logger.error(_.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" stream id type error"),!1)},a.prototype.stopMixingAudio=function(c,o){return c?Array.isArray(o)&&o.length!==0||o===void 0?this._stopMixingAudio(c,o):(this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" audio param type error"),!1):(this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" param streamID format error"),!1)},a.prototype.mixingBuffer=function(c,o,n,t){this.logger.info(_.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" call streamID: "+JSON.stringify(c)+" sourceID:"+o),c?o&&typeof o=="string"?(this._mixingBuffer(c,o,n,t),this.logger.info(_.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" end")):this.logger.error(_.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param source id format error"):this.logger.error(_.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param streamid format error")},a.prototype.stopMixingBuffer=function(c,o){return this.logger.info(_.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" call streamID: "+c+" sourceID:"+o),c?o&&typeof o=="string"?this._stopMixingBuffer(c,o):(this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param source id format error"),!1):(this.logger.error(_.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param streamid format error"),!1)},a.prototype.setMixingAudioVolume=function(c,o,n){return this.logger.info(_.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" call"),c?typeof o!="number"||o<0||o>100?(this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" volume must be a number between 0 and 100"),!1):n&&n instanceof HTMLMediaElement?this._setMixingAudioVolume(c,o,n):(this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" no audio"),!1):(this.logger.error(_.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" stream ID must be string and not empty"),!1)},a.prototype.getSoundLevel=function(c,o,n){this.logger.info("zc.gsl call");var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,d.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.event);try{this.ac.resume();var e=this.ac.createMediaStreamSource(c),r=this.ac.createScriptProcessor(4096,1,1);this.stateCenter.audioStreamList[c.id]={mic:e,script:r},e.connect(r),r.connect(this.ac.destination),r.onaudioprocess=function(i){for(var s=i.inputBuffer.getChannelData(0),u=0,p=0;p<s.length;p++)u<s[p]&&(u=s[p]);o(u)},this.dataReport.uploadReport(t)}catch(i){n(i),this.dataReport.addMsgInfo(t,d.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.error.kGetSoundLevelError),this.dataReport.uploadReport(t)}this.logger.info("zc.gsl call success")},a.prototype.stopSoundLevel=function(c){this.logger.info("zc.ssl call");var o=this.stateCenter.getReportSeq();this.dataReport.newReport(o,d.ZegoRTCLogEvent.kZegoTaskStopSoundLevel);var n=this.stateCenter.audioStreamList[c.id];n.mic.disconnect(),n.script.disconnect(),delete this.stateCenter.audioStreamList[c.id],this.dataReport.uploadReport(o)},a.prototype._preloadEffect=function(c,o,n,t){var e=this,r=new XMLHttpRequest;r.open("GET",n,!0),r.setRequestHeader("Range","none"),r.responseType="arraybuffer",r.onload=function(){if(r.status==200||r.status==304){var i=r.response;c.decodeAudioData(i,function(u){e.logger.info("zc.pe.0 effect preload success"),e.stateCenter.audioEffectBuffer[o]=u,t&&t()},function(u){e.logger.error("zc.pe.0 effect preload fail "+u),t&&t(u)})}else{var s=r.statusText;e.logger.error("zc.pe.0 effect preload fail "+s),t&&t(s)}},r.send()},a.prototype._playEffect=function(c,o,n){var t=this.stateCenter.audioEffectBuffer[c.effectID],e=null;c.streamID&&(e=this.streamCenter.getPublisher(c.streamID)),c.stream&&(e=this.streamCenter.getPublisher(c.stream)),e?t?e.playEffect(c,t,o,n):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")},a.prototype._pauseEffect=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.pauseEffect(o):(this.logger.error("zc.pe.2 publisher doesn't exist"),!1)},a.prototype._resumeEffect=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.resumeEffect(o):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},a.prototype._stopEffect=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.stopEffect(o):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},a.prototype._setMixingAudioVolume=function(c,o,n){var t=this.streamCenter.getPublisher(c);return t?t.setMixingAudioVolume(o/100,n):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},a.prototype._startMixingAudio=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.startMixingAudio(o):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},a.prototype._stopMixingAudio=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.stopMixingAudio(o):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},a.prototype._mixingBuffer=function(c,o,n,t){var e=this.streamCenter.getPublisher(c);e?n instanceof ArrayBuffer?e.mixingBuffer(o,n,t):this.logger.error("zc.mb.0 array buffer not found"):this.logger.error("zc.mb.0 publisher doesn't exist")},a.prototype._stopMixingBuffer=function(c,o){var n=this.streamCenter.getPublisher(c);return n?n.stopMixingBuffer(o):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},a}();T.AudioMixModule=l},6214:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.publisher=void 0;var m=I(2523),h=I(4194),_=I(3013);T.publisher={playEffect:function(d,l,a,c){var o=this;if(this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" call"),this.effectList.find(function(e){return e.effectID==d.effectID&&e.audioBuffer==l}))this.logger.warn(m.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" effect alreadly exist ");else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var n=new _.AudioBufferProcessor(this.logger,this.ac);this.audioSrcNode||(this.audioSrcNode=this.ac.createMediaStreamSource(this.localStream)),this.audioDestNode||(this.audioDestNode=this.ac.createMediaStreamDestination()),n.destination=this.audioDestNode,n.streamSource=this.audioSrcNode,n.localStream=this.localStream,n.peerConnection=this.peerConnection,n.audioBuffer=l;var t={processor:n,effectID:d.effectID,audioBuffer:l};this.effectList.push(t),n.playEffect(d.playTime,d.loop,!1,a,function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];o.effectList.splice(o.effectList.indexOf(t),1),c.apply(void 0,e)}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" play effect "+d.effectID+" success")}},pauseEffect:function(d){var l=this.effectList.find(function(a){return a.effectID==d});if(l)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),l.processor.pauseEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" pause "+d+" success");else{if(d!==void 0)return this.logger.error(m.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" effect not found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(a){return a.processor.pauseEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},resumeEffect:function(d){var l=this.effectList.find(function(a){return a.effectID==d});if(l)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),l.processor.resumeEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" resume"+d+" success");else{if(d!==void 0)return this.logger.error(m.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" no effect found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(a){return a.processor.resumeEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!1},stopEffect:function(d){var l=this.effectList.find(function(a){return a.effectID==d});if(l)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),l.processor.stopMixingAudio(),this.effectList.splice(this.effectList.indexOf(l),1),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" pause "+d+" success");else{if(d!==void 0)return this.logger.error(m.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" effect not found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(a){return a.processor.stopMixingAudio()}),this.effectList=[],this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},setEffectVolume:function(d,l){var a=this.effectList.find(function(c){return c.effectID==l});if(a)a.processor.setMixingAudioVolume(d),this.logger.info("zp.sev.0 "+this.streamId+" set volume "+l+" success");else{if(l!==void 0)return this.logger.error("zp.sev.0 "+this.streamId+" effect not found"),!1;this.effectList.forEach(function(c){return c.processor.setMixingAudioVolume(d)})}return!0},mixingBuffer:function(d,l,a){var c=this;if(this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" call"),this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),this.arrayBufferMap[d])this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[d].mixingBuffer(l,function(){c.streamCenter.soundLevelDelegate&&c.startSoundLevel(),a&&a()});else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var o=new _.AudioBufferProcessor(this.logger,this.ac);this.audioSrcNode||(this.audioSrcNode=this.ac.createMediaStreamSource(this.localStream)),this.audioDestNode||(this.audioDestNode=this.ac.createMediaStreamDestination()),o.destination=this.audioDestNode,o.streamSource=this.audioSrcNode,o.localStream=this.localStream,o.peerConnection=this.peerConnection,this.arrayBufferMap[d]=o,o.mixingBuffer(l,function(){c.streamCenter.soundLevelDelegate&&c.startSoundLevel(),a&&a()})}},getEffectProgress:function(d){var l=this.effectList.find(function(a){return a.effectID==d});return l?l.processor.getProcess():(this.logger.error(m.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" "+this.streamId+" effect not found"),0)},seekAudioEffect:function(d,l){var a=this.effectList.find(function(c){return c.effectID==d});if(!a)return this.logger.error(m.ZEGO_WEBRTC_ACTION.AUDIO_EFFECT_PROCESS+" "+this.streamId+" effect not found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),a.processor.seekTo(l),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()},startMixingAudio:function(d){var l=this;return this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+this.streamId+" call"),this.localStream?(this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),d.forEach(function(a){if(l.audioMixList.find(function(o){return o.media==a}))l.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+l.streamId+" mix audio already exist");else{l.streamCenter.soundLevelDelegate&&l.stopSoundLevel();var c=new h.AudioMix(l.logger,l.stateCenter,l.ac,l.mediaEleSources);l.audioSrcNode||(l.audioSrcNode=l.ac.createMediaStreamSource(l.localStream)),l.audioDestNode||(l.audioDestNode=l.ac.createMediaStreamDestination()),c.destination=l.audioDestNode,c.streamSource=l.audioSrcNode,c.localStream=l.localStream,c.peerConnection=l.peerConnection,l.audioMixList.push({audioMix:c,media:a}),c.startMixingAudio(a),l.streamCenter.soundLevelDelegate&&l.startSoundLevel()}}),!0):(this.logger.error(m.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" localStream not found"),!1)},stopMixingAudio:function(d){var l=this;return this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_MIXING_AUDIO+" "+this.streamId+" call"),d?d.forEach(function(a){for(var c=0;c<l.audioMixList.length;c++)if(l.audioMixList[c].media==a){l.audioMixList[c].audioMix.stopMixingAudio()&&l.audioMixList.splice(c--,1);break}}):(this.audioMixList.forEach(function(a){return a.audioMix.stopMixingAudio()}),this.audioMixList=[]),!0},stopMixingBuffer:function(d){if(d&&this.arrayBufferMap[d])return this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[d].stopMingBuffer(),delete this.arrayBufferMap[d],this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0;if(d===void 0){for(var l in this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap)this.arrayBufferMap[l].stopMingBuffer();return this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0}return this.logger.warn(m.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" arrayBuffer no found"),!1},setMixingAudioVolume:function(d,l){this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call");var a=this.audioMixList.find(function(c){return c.media===l});return a?(a.audioMix.setMixingAudioVolume(d),this.logger.info(m.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call success"),!0):(this.logger.error(m.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" audio is not mixing"),!1)}}},4853:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={GET_SOUND_LEVEL_FAIL:{code:1000019,message:"get sound level error"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:"decode audio data fail"}}},7526:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0});var m=I(6459),h=I(6214);T.default={type:"AudioMix",install:function(_,d){for(var l in Object.defineProperty(_.prototype,"initAudioMix",{value:function(){this.audioMixModule=new m.AudioMixModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.ac)}}),h.publisher)Object.defineProperty(d.prototype,l,{value:h.publisher[l],writable:!1})}}},4234:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRTCLogEvent=void 0;var m=I(4853);T.ZegoRTCLogEvent={kZegoTaskGetSoundLevel:{event:"/sdk/get_sound_level",error:{kGetSoundLevelError:m.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:"/sdk/stop_sound_level"}},4897:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.DataChannel=void 0;var m=I(8835);T.DataChannel={type:"DataChannel",install:function(h){Object.defineProperty(h.prototype,"createRealTimeSequentialDataManager",{value:function(_){this.enableDataChannel(!0);var d=this.stateCenter.getRoomByRoomID(_);return d?d.dataChannelManager?null:(d.dataChannelManager=new m.ZegoRealTimeSequentialDataManager(this,_),d.dataChannelManager):(this.logger.error("zc.crsdm room no exist"),null)},writable:!1}),Object.defineProperty(h.prototype,"destroyRealTimeSequentialDataManager",{value:function(_){var d=this.stateCenter.roomList.find(function(l){return l.dataChannelManager==_});d&&(_.dataChannelManager.reset(),d.dataChannelManager=null)},writable:!1})}}},3504:function(W,T){"use strict";var I=this&&this.__awaiter||function(_,d,l,a){return new(l||(l=Promise))(function(c,o){function n(r){try{e(a.next(r))}catch(i){o(i)}}function t(r){try{e(a.throw(r))}catch(i){o(i)}}function e(r){var i;r.done?c(r.value):(i=r.value,i instanceof l?i:new l(function(s){s(i)})).then(n,t)}e((a=a.apply(_,d||[])).next())})},m=this&&this.__generator||function(_,d){var l,a,c,o,n={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return o={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function t(e){return function(r){return function(i){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,a&&(c=2&i[0]?a.return:i[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,i[1])).done)return c;switch(a=0,c&&(i=[2&i[0],c.value]),i[0]){case 0:case 1:c=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,a=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((c=(c=n.trys).length>0&&c[c.length-1])||i[0]!==6&&i[0]!==2)){n=0;continue}if(i[0]===3&&(!c||i[1]>c[0]&&i[1]<c[3])){n.label=i[1];break}if(i[0]===6&&n.label<c[1]){n.label=c[1],c=i;break}if(c&&n.label<c[2]){n.label=c[2],n.ops.push(i);break}c[2]&&n.ops.pop(),n.trys.pop();continue}i=d.call(_,n)}catch(s){i=[6,s],a=0}finally{l=c=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([e,r])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.DataChannelListener=void 0;var h=function(){function _(d,l){this.zegoWebRTC=d,this.roomID=l,this.pubDataChannelList=[],this.subDataChannelList=[],this.listenerList={receiveRealTimeSequentialData:[]},this.logger=d.logger}return _.prototype.startBroadcasting=function(d,l){return I(this,void 0,void 0,function(){var a,c,o,n;return m(this,function(t){switch(t.label){case 0:return this.logger.info("dc.sb.0 call"),this.pubDataChannelList.includes(d)?(this.logger.error("dc.sb.0 datachannel already exist"),[2,!1]):(a=this.zegoWebRTC.streamCenter.publisherList[d])&&a.publisher.dataChannel?(this.pubDataChannelList.push(d),[2,!0]):a&&!a.publisher.dataChannel?(this.logger.error("dc.sb.0 publish datachannel no exist, try other stream ID"),[2,!1]):this.broadcastStream?[3,2]:(c=document.createElement("canvas"),o=this,[4,this.zegoWebRTC.createStream({custom:{source:c}})]);case 1:o.broadcastStream=t.sent(),t.label=2;case 2:return(n=this.zegoWebRTC.startPublishingStream(d,this.broadcastStream,{roomID:this.roomID},!0))&&this.pubDataChannelList.push(d),this.logger.info("dc.sb.0 end"),[2,n]}})})},_.prototype.stopBroadcasting=function(d){this.logger.info("dc.sb.1 call"),this.pubDataChannelList=this.pubDataChannelList.filter(function(a){return a!==d});var l=this.zegoWebRTC.streamCenter.publisherList[d];return l?(l.room.roomID==this.roomID&&l.isDataChannel&&this.zegoWebRTC.stopPublishingStream(d),this.logger.info("dc.sb.1 end"),!0):(this.logger.error("dc.sb.1 datachannel no found"),!1)},_.prototype.sendRealTimeSequentialData=function(d,l){if(!l instanceof ArrayBuffer)return this.logger.error("dc.srsd data type wrong"),!1;var a=this.zegoWebRTC.streamCenter.publisherList[d];return a&&this.pubDataChannelList.includes(d)?this.sendBCMessage(a.publisher,l):(this.logger.error("dc.srsd datachannel no found"),!1)},_.prototype.sendBCMessage=function(d,l){var a;if(!d.dataChannelState)return!1;for(var c=new Uint8Array(l),o=0,n=l.byteLength,t=d.send_seq,e=0,r=new Date().getTime(),i=0;n>0;){n>1151?i=1141:(i=n,e=1);var s=new Uint8Array(i+10);s[0]=1,s[1]=e,s[2]=d.send_seq>>8&255,s[3]=255&d.send_seq,s[4]=t>>8&255,s[5]=255&t,s[6]=r>>24&255,s[7]=r>>16&255,s[8]=r>>8&255,s[9]=255&r;for(var u=0;u<i;u++)s[u+10]=c[u+o];n-=i,o+=i,d.send_seq++,d.send_seq>=65536&&(d.send_seq=0),(a=d.dataChannel)===null||a===void 0||a.send(s)}return!0},_.prototype.startSubscribing=function(d,l){var a,c;return I(this,void 0,void 0,function(){var o,n;return m(this,function(t){switch(t.label){case 0:return this.logger.info("dc.ss.0 call"),this.subDataChannelList.includes(d)?(this.logger.error("dc.ss.0 datachannel already exist"),[2,!1]):(o=this.zegoWebRTC.streamCenter.playerList[d])?[3,2]:[4,this.zegoWebRTC.startPlayingStream(d,void 0,!0)];case 1:t.sent(),o=this.zegoWebRTC.streamCenter.playerList[d],t.label=2;case 2:return(n=o.player).dataChannel?(!((a=n.onDataChannelList)===null||a===void 0?void 0:a.includes(this.onReceivedDataChannel.bind(this)))&&((c=n.onDataChannelList)===null||c===void 0||c.push(this.onReceivedDataChannel.bind(this))),this.subDataChannelList.push(d),this.logger.info("dc.ss.0 end"),[2,!0]):(this.logger.error("dc.ss.0 datachannel no exist, try other stream ID"),[2,!1])}})})},_.prototype.stopSubscribing=function(d){this.logger.info("dc.ss.1 call"),this.subDataChannelList=this.subDataChannelList.filter(function(a){return a!==d});var l=this.zegoWebRTC.streamCenter.playerList[d];return l?(l.room.roomID==this.roomID&&l.isDataChannel&&this.zegoWebRTC.stopPlayingStream(d),this.logger.info("dc.ss.1 end"),!0):(this.logger.error("dc.ss.1 datachannel no subscribe"),!1)},_.prototype.on=function(d,l){this.bindListener(d,l)},_.prototype.off=function(d,l){this.deleteListener(d,l)},_.prototype.bindListener=function(d,l){return this.listenerList[d]?typeof l!="function"?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(this.listenerList[d].indexOf(l)==-1&&this.listenerList[d].push(l),!0):(this.logger.error("dc.o.0 event "+d+" no found"),!1)},_.prototype.deleteListener=function(d,l){if(!this.listenerList[d])return this.logger.error("dc.o.1 listener no found"),!1;var a=this.listenerList[d];return l?a.splice(a.indexOf(l),1):this.listenerList[d]=[],!0},_.prototype.actionListener=function(d){for(var l=this,a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];this.listenerList[d]&&this.listenerList[d].forEach(function(o){try{setTimeout(function(){o.apply(void 0,a)},0)}catch(n){l.logger.error("dc.al "+d+" "+n)}})},_.prototype.onReceivedDataChannel=function(d,l,a){this.actionListener("receiveRealTimeSequentialData",d,l,a)},_.prototype.reset=function(){var d=this;for(var l in this.logger.info("dc.rs call"),this.pubDataChannelList.forEach(function(a){var c=d.zegoWebRTC.streamCenter.publisherList[a];c&&c.room.roomID==d.roomID&&c.isDataChannel&&d.zegoWebRTC.stopPublishingStream(a)}),this.subDataChannelList.forEach(function(a){var c=d.zegoWebRTC.streamCenter.playerList[a];c&&c.room.roomID==d.roomID&&c.isDataChannel&&d.zegoWebRTC.stopPlayingStream(a)}),this.listenerList)this.listenerList[l]=[];this.broadcastStream&&this.zegoWebRTC.destroyStream(this.broadcastStream),this.broadcastStream=void 0,this.logger.info("dc.rs end")},_}();T.DataChannelListener=h},5906:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.streamHandler=T.zegoWebRTC=void 0;var h=I(817),_=I(6145),d="2.15.1",l=1e4,a={},c="addMsgInfo";function o(n,t){var e,r,i,s,u="",p=h.errorCodeList;return t.errorCode<2e9&&t.errorCode>1e9?(i={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},s="MIXER_INNER_ERROR",(r=t.errorCode-l)>1e9&&i[r-1e9]&&(s=i[r-1e9]),e=p[u=s]):t.errorCode<1e6&&(e=n.decodeServerError(t.errorCode,t.extendedData),u=n.getLiveRoomError(t.errorCode,this.stateCenter.useNetAgent)),{reportErr:e,actualError:p[u]}}T.zegoWebRTC={startMixerTask:function(n){var t=this;return new Promise(function(e,r){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,_.ZegoRTCLogEvent.kZegoTaskMixStart.event),t.stateCenter.logReportCallback("kZegoTaskMixStart"+n.taskID,t.dataReport,i,t.stateCenter.reportList);var s={errorCode:1005027,extendedData:"mix stream input parameters are wrong"};if(n==null?void 0:n.inputList.find(function(f){return(f.streamID===void 0||f.streamID===null)&&(s.extendedData=s.extendedData+". streamID should be of string type",!0)}))return t.dataReport.addMsgInfo(i,s),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+n.taskID,t.stateCenter.reportList),void r(s);n.outputConfig&&n.outputConfig.outputFps&&(n.outputConfig.outputFPS=n.outputConfig.outputFps);var u=function(f){var E=o(t.stateCenter,f),y=E.reportErr,b=E.actualError;y?t.dataReport.addMsgInfo(i,y):t.dataReport.addMsgInfo(i,f),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+n.taskID,t.stateCenter.reportList),b&&(f.errorCode=b==null?void 0:b.code,f.extendedData=(b==null?void 0:b.message)||""),r(f)},p=t.stateCenter.roomList[0];p?p.streamHandler.updateMixStream(n,function(f){t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+n.taskID,t.stateCenter.reportList),e(f)},u):u({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})})},setMixerTaskConfig:function(n){var t=this;return new Promise(function(e,r){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,_.ZegoRTCLogEvent.kZegoTaskMixConfig.event),t.stateCenter.logReportCallback("kZegoTaskMixConfig",t.dataReport,i,t.stateCenter.reportList);var s=t.stateCenter.roomList[0];s?s.streamHandler.setMixerTaskConfig(n).then(function(u){t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),e(u)}).catch(function(u){t.dataReport.addMsgInfo(i,u),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(u)}):r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})})},stopMixerTask:function(n){var t=this;return new Promise(function(e,r){var i=t.stateCenter.getReportSeq();if(t.dataReport.newReport(i,_.ZegoRTCLogEvent.kZegoTaskMixStop.event),!n||typeof n!="string"||n.length>256||!t.stateCenter.checkIllegalCharacters(n))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.dataReport.addMsgInfo(i,{error:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(i),void r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var s=function(p){var f=o(t.stateCenter,p),E=f.reportErr,y=f.actualError;E?t.dataReport.addMsgInfo(i,E):t.dataReport.addMsgInfo(i,p),t.dataReport.uploadReport(i),y&&(p.errorCode=y==null?void 0:y.code,p.extendedData=(y==null?void 0:y.message)||""),r(p)},u=t.stateCenter.roomList[0];u?u.streamHandler.stopMixStream(n,function(p){t.dataReport.uploadReport(i),e(p)},s):s({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})})}},T.streamHandler={setMixerTaskConfig:function(n){var t=this;return new Promise(function(e,r){var i,s={},u={};if(n&&n.videoCodec){var p=n.videoCodec.toLowerCase();if(["vp8","h264"].indexOf(p)==-1)return t.logger.error("zb.sh.ums param videoCode error"),r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;s.videoCodec=p,u.video_codec=p}if(n.backgroundColor){if(!t.stateCenter.checkInteger(n.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;s.backgroundColor=n.backgroundColor,u.background_color=n.backgroundColor}if(n.backgroundImage){if(typeof n.backgroundImage!="string")return t.logger.error("zb.sh.ums param outputBgImage error"),r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!n.backgroundImage.startsWith("preset-id://")||!n.backgroundImage.endsWith(".jpg")&&!n.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),r({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;s.backgroundImage=n.backgroundImage,u.background_image=n.backgroundImage}n.waterMark&&(s.waterMark=n.waterMark,u.water_mark=n.waterMark),n.extraParams&&(s.extraParams||(s.extraParams=[]),(i=s.extraParams).push.apply(i,n.extraParams)),s=a,t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(c,void 0,{config:_.ZegoRTCLogEvent.kZegoTaskMixConfig.config(u)}),e({errorCode:0,extendedData:""})})},stopMixStream:function(n,t,e,r,i){var s=this;this.logger.info("zb.sh.sms call");var u={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:d};if(typeof n=="string"&&(u.task_id=n),r!=null?this.stateCenter.testEnvironment?u.stream_id="zegotest-"+this.stateCenter.appid+"-"+r:u.stream_id=r:i!=null&&(u.mixurl=i),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"stop_mix"},u,function(f){t&&t({errorCode:0,extendedData:""})},function(f,E,y,b){var S="";if(b)return b==h.errorCodeList.TIMEOUT&&(b=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),b.code&&b.code===20010&&(b=JSON.parse(JSON.stringify(h.errorCodeList.MIXER_NO_SERVICES))),void(e&&e(b,S));if(b=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,f===200){if(typeof E=="number")return s.logger.debug("zb.sh.sms error: "+E),E+=1e9,void(e&&e({errorCode:s.stateCenter.getServerError(l+E).code,extendedData:S}));s.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(error));var k=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;e&&e({errorCode:k.code,extendedData:k.message})}else S="request mix server fail, error: "+f,s.logger.error("zb.sh.sms "+S),e&&e(b,S)});else{var p={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(u)};this.sendBizChannelRequest(p,function(){t&&t({errorCode:0,extendedData:""})},function(f){if(typeof f=="number")e&&e({errorCode:s.stateCenter.getServerError(l+f).code,extendedData:""});else{s.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(f));var E;E=f==h.errorCodeList.TIMEOUT?_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:_.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,e&&e({errorCode:E.code,extendedData:E.message})}})}return!0},updateMixStream:function(n,t,e){var r,i,s=this;if(this.logger.info("zb.sh.ums call"),!n.noTaskID&&!n.taskID)return this.logger.error("zb.sh.ums no taskId found"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!n.noTaskID&&typeof n.taskID!="string")return this.logger.error("zb.rh.lg taskId must be string"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!n.noTaskID&&n.taskID.length>256)return this.logger.error("zb.sh.ums taskId is too long"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!n.noTaskID&&!this.stateCenter.checkIllegalCharacters(n.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!n.inputList||n.inputList.length==0)return this.logger.error("zb.sh.ums input list wrong"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;n.inputList.forEach(function(g){g.contentType==="AUDIO"&&(!g.layout&&(g.layout={top:0,left:0,bottom:0,right:0}),g.layout.top=0,g.layout.left=0,g.layout.bottom=1,g.layout.right=1)});for(var u=0;u<n.inputList.length;u++){var p=n.inputList[u],f={errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message};if(typeof p.layout!="object")return this.logger.error("zb.sh.ums input layout must be object"),e(f),!1;if(!(this.stateCenter.checkInteger(p.layout.top,!1)&&this.stateCenter.checkInteger(p.layout.bottom,!1)&&this.stateCenter.checkInteger(p.layout.left,!1)&&this.stateCenter.checkInteger(p.layout.right,!1)))return this.logger.error("zb.sh.ums top\u3001left\u3001bottom\u3001right must be integer number"),e(f),!1;if(p.renderMode!==void 0&&![0,1].includes(p.renderMode))return this.logger.error("zb.sh.ums render_mode is wrong"),e(f),!1}if(!n.outputList||n.outputList.length==0)return this.logger.error("zb.sh.ums no output list found"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(n.outputList.some(function(g){return typeof g=="string"&&!s.stateCenter.isUrl(g)&&!s.stateCenter.checkIllegalCharacters(g)||typeof g=="object"&&g.target&&!s.stateCenter.isUrl(g.target)&&!s.stateCenter.checkIllegalCharacters(g.target)}))return this.logger.error("zb.sh.ums stream output target is incorrect"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!((i=n.inputList.every(function(g){return g.contentType==="AUDIO"}))||n.outputConfig&&typeof n.outputConfig=="object"))return this.logger.error("zb.sh.ums no output config found"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(i&&(n.outputConfig=m(m({},n.outputConfig||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(i||n.outputConfig.outputBitrate&&this.stateCenter.checkInteger(n.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!n.outputConfig.outputFPS||!this.stateCenter.checkInteger(n.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!n.outputConfig.outputWidth||!this.stateCenter.checkInteger(n.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!n.outputConfig.outputHeight||!this.stateCenter.checkInteger(n.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(n.outputConfig.outputAudioCodecID!==void 0&&!this.stateCenter.checkInteger(n.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(n.outputConfig.outputAudioBitrate!==void 0&&!this.stateCenter.checkInteger(n.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(n.outputConfig.outputAudioChannels!==void 0&&!this.stateCenter.checkInteger(n.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var E={},y=0;n.outputConfig.singleStreamPassThrough&&typeof n.outputConfig.singleStreamPassThrough=="boolean"&&(y=n.outputConfig.singleStreamPassThrough?1:0),E={task_id:n.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:d,bypass:y,timestamp:Math.ceil(new Date().getTime()/1e3)};var b=a;b&&(b.videoCodec&&(E.extra_params=[{key:"video_encode",value:b.videoCodec}]),b.backgroundColor&&(E.output_bg_color=b.backgroundColor),b.backgroundImage&&(E.output_bg_image=b.backgroundImage),b.waterMark&&(E.watermark=b.waterMark),b.extraParams&&(!E.extra_params&&(E.extra_params=[]),(r=E.extra_params).push.apply(r,b.extraParams))),E.MixInput=n.inputList.map(function(g,v){var R=g.streamID;return s.stateCenter.testEnvironment&&(R="zegotest-"+s.stateCenter.appid+"-"+g.streamID),{stream_id:R,content_control:g.contentType==="AUDIO"?1:0,rect:{layer:v,top:g.layout.top,left:g.layout.left,bottom:g.layout.bottom,right:g.layout.right},render_mode:g.renderMode}}),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+n.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+n.taskID,this.stateCenter.reportList)(c,void 0,{mix_stream_id:_.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(n.taskID),stream_cnt:_.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(E.MixInput.length),input_stream_list:_.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(E.MixInput)}),E.MixOutput=n.outputList.map(function(g){var v={},R="";if(typeof g=="string")R=g;else{if(typeof g!="object"||!g.target)return s.logger.error("zb.sh.ums output target required"),e({errorCode:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;R=g.target}return R.startsWith("rtmp://")||R.startsWith("https://")&&R.endsWith(".flv")||R.startsWith("https://")&&R.endsWith(".m3u8")?v.mixurl=R:s.stateCenter.testEnvironment?v.stream_id="zegotest-"+s.stateCenter.appid+"-"+R:v.stream_id=R,v.bitrate=1e3*n.outputConfig.outputBitrate,v.fps=n.outputConfig.outputFPS,v.width=n.outputConfig.outputWidth,v.height=n.outputConfig.outputHeight,n.outputConfig.outputAudioCodecID&&(v.audio_enc_id=n.outputConfig.outputAudioCodecID),b.videoCodec==="vp8"?v.audio_enc_id=3:b.videoCodec==="h264"&&(v.audio_enc_id=0),n.outputConfig.outputAudioBitrate&&(v.audio_bitrate=1e3*n.outputConfig.outputAudioBitrate),n.outputConfig.outputAudioChannels&&(v.audio_channel_cnt=n.outputConfig.outputAudioChannels),s.stateCenter.testEnvironment?v.testenv=1:v.testenv=0,v}),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+n.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+n.taskID,this.stateCenter.reportList)(c,void 0,{output_target_list:_.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(E.MixOutput)}),this.logger.debug("zb.sh.ums send command");var S=this.stateCenter.useNetAgent,k="zegotest-"+this.stateCenter.appid+"-";if(S)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"start_mix"},E,function(g){var v=g.play.map(function(L){var N={rtmpURL:"",hlsURL:"",flvURL:""},w=L.stream_alias||"";return s.stateCenter.testEnvironment&&w&&w.startsWith(k)&&(w=w.slice(k.length)),N.streamID=w,L.rtmp_url&&L.rtmp_url.length>0&&(N.rtmpURL=L.rtmp_url),L.hls_url&&L.hls_url.length>0&&(N.hlsURL=L.hls_url),L.hdl_url&&L.hdl_url.length>0&&(N.flvURL=L.hdl_url),N});if(t){var R={mixerOutputList:v};t({errorCode:0,extendedData:JSON.stringify(R)})}},function(g,v,R,L){var N="";if(L)return L==h.errorCodeList.TIMEOUT&&(L=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),L.code&&L.code===20010&&(L=JSON.parse(JSON.stringify(h.errorCodeList.MIXER_NO_SERVICES))),void(e&&e(L,N));if(L=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,g===200){if(typeof v=="number"){if(s.logger.debug("zb.sh.ums error: "+v),(v+=1e9)==1000000150&&R){var w=(R==null?void 0:R.non_exist_streams.map(function(x){return s.stateCenter.testEnvironment&&x.startsWith(k)?x.slice(k.length):x}))||[];w.length>0&&(s.logger.debug("zb.sh.ums not exist streams: "+w),N=w.join(","))}return void(e&&e({errorCode:s.stateCenter.getServerError(l+v).code,extendedData:N}))}s.logger.debug("zb.sh.ums error code "+v);var B=_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;e&&e({errorCode:B.code,extendedData:B.message})}else N="request mix server fail, error: "+g,s.logger.error("zb.sh.ums "+N),e&&e(L,N)});else{var O={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(E)};this.sendBizChannelRequest(O,function(g,v,R){if(s.logger.debug("zb.sh.ums receive message"),R.length!=0){for(var L=JSON.parse(R),N=[],w=0;w<L.play.length;w++){var B={rtmpURL:"",hlsURL:"",flvURL:""},x=L.play[w].stream_alias||"";s.stateCenter.testEnvironment&&x&&x.startsWith(k)&&(x=x.slice(k.length)),B.streamID=x,L.play[w].rtmp_url&&L.play[w].rtmp_url.length>0&&(B.rtmpURL=L.play[w].rtmp_url),L.play[w].hls_url&&L.play[w].hls_url.length>0&&(B.hlsURL=L.play[w].hls_url),L.play[w].hdl_url&&L.play[w].hdl_url.length>0&&(B.flvURL=L.play[w].hdl_url),N.push(B)}if(t){var Z={mixerOutputList:N};t({errorCode:0,extendedData:JSON.stringify(Z)})}}else e&&e({errorCode:s.stateCenter.getServerError(10001).code,extendedData:""})},function(g,v,R){if(typeof g=="number"){s.logger.debug("zb.sh.ums error: "+g);var L=[];if(g==1000000150&&R.length!=0)for(var N=JSON.parse(R),w=0;w<N.non_exist_streams.length;w++){var B=N.non_exist_streams[w];s.stateCenter.testEnvironment&&B.startsWith(k)?L.push(B.slice(k.length)):L.push(B)}e&&e({errorCode:s.stateCenter.getServerError(l+g).code,extendedData:""})}else{s.logger.debug("zb.sh.ums error code "+g.code);var x;x=g==h.errorCodeList.TIMEOUT?_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:_.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,e&&e({errorCode:x.code,extendedData:x.message})}})}return!0}}},817:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}}},577:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0});var m=I(5906);T.default={type:"MixStream",install:function(h,_){for(var d in m.zegoWebRTC)Object.defineProperty(h.prototype,d,{value:m.zegoWebRTC[d],writable:!1});for(var d in m.streamHandler)Object.defineProperty(_.prototype,d,{value:m.streamHandler[d],writable:!1})}}},6145:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRTCLogEvent=void 0;var m=I(817),h=function(_){return _};T.ZegoRTCLogEvent={kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:m.errorCodeList.INPUT_PARAM,kTaskIDNullError:m.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:m.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:m.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:m.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:m.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:m.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:m.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:m.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:m.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:m.errorCodeList.NOT_LOGIN},mix_stream_id:h,stream_cnt:h,input_stream_list:h,output_target_list:h},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:m.errorCodeList.INPUT_PARAM,kTaskIDNullError:m.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:m.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:m.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:m.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:m.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:m.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:m.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:m.errorCodeList.NOT_LOGIN},config:h}}},2760:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(e,r,i,s){return new(i||(i=Promise))(function(u,p){function f(b){try{y(s.next(b))}catch(S){p(S)}}function E(b){try{y(s.throw(b))}catch(S){p(S)}}function y(b){var S;b.done?u(b.value):(S=b.value,S instanceof i?S:new i(function(k){k(S)})).then(f,E)}y((s=s.apply(e,r||[])).next())})},h=this&&this.__generator||function(e,r){var i,s,u,p,f={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return p={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function E(y){return function(b){return function(S){if(i)throw new TypeError("Generator is already executing.");for(;f;)try{if(i=1,s&&(u=2&S[0]?s.return:S[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,S[1])).done)return u;switch(s=0,u&&(S=[2&S[0],u.value]),S[0]){case 0:case 1:u=S;break;case 4:return f.label++,{value:S[1],done:!1};case 5:f.label++,s=S[1],S=[0];continue;case 7:S=f.ops.pop(),f.trys.pop();continue;default:if(!((u=(u=f.trys).length>0&&u[u.length-1])||S[0]!==6&&S[0]!==2)){f=0;continue}if(S[0]===3&&(!u||S[1]>u[0]&&S[1]<u[3])){f.label=S[1];break}if(S[0]===6&&f.label<u[1]){f.label=u[1],u=S;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(S);break}u[2]&&f.ops.pop(),f.trys.pop();continue}S=r.call(e,f)}catch(k){S=[6,k],s=0}finally{i=u=0}if(5&S[0])throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}([y,b])}}},_=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});var d=_(I(2730)),l=_(I(5947)),a=_(I(1646)),c=_(I(1576)),o=I(7803),n=I(1297),t=function(){function e(r){var i=this;this.isSpatial=!1,this.audioSourceList=[],this.speakingUserIdList=[],this._audioCtx=null,this.zegoRTC=r,this.zegoRTC.on("roomStreamUpdate",function(u,p,f){var E=f.map(function(y){return y.streamID});p==="DELETE"?i.speakingUserIdList=i.speakingUserIdList.filter(function(y){var b=!E.includes(y);if(!b){var S=i.audioSourceMap[y];S&&S.isPlaying&&S.stopPlayingAudio()}return b}):p==="ADD"&&(i.speakingUserIdList=i.speakingUserIdList.concat(E),f.forEach(function(y){if(!i.audioSourceMap[y.streamID]){var b=i.getStreamInfo(y.extraInfo),S=b.teamID,k=b.sendMode,O=new d.default({userID:y.streamID,teamID:S,sendMode:k},{audioCtx:i.audioCtx,zegoRTC:i.zegoRTC,isSpatial:i.isSpatial,maxDistance:i.rangeListener.recvRange});i.audioSourceList.push(O),i.playStreamHandler.handlePlayAudioTask()}})),i.playStreamHandler.setAudioSourceList(i.speakingAudioSourceList)}),this.zegoRTC.on("playerStateUpdate",function(u){var p=i.audioSourceMap[u.streamID];p&&(u.state==="NO_PLAY"?p.isPlaying=!1:p.isPlaying=!0)}),this.zegoRTC.on("streamExtraInfoUpdate",function(u,p){p.forEach(function(f){var E=i.audioSourceMap[f.streamID];if(E){var y=i.getStreamInfo(f.extraInfo),b=y.teamID,S=y.sendMode;b!==E.teamID&&(E.teamID=b,i.enableSpatializer(i.isSpatial)),S!==void 0&&(E.sendMode=S),i.playStreamHandler.handlePlayAudioTask()}})}),this.zegoRTC.RTM._on("_roomStateUpdate",function(u,p){p==="CONNECTED"?(i.roomID=u,i.rangeListener.userID=i.zegoRTC.RTM.getUserID()):p==="DISCONNECTED"&&(i.roomID=void 0,i.rangeListener.reset(),i.audioSourceList=[])});var s=window.AudioContext||window.webkitAudioContext;this._audioCtx=this.zegoRTC&&this.zegoRTC.ac||new s,this.rangeListener=l.default.getInstance(this.audioCtx,this.zegoRTC),this.playStreamHandler=a.default.getInstance(this.rangeListener),this.eventManager=c.default.getInstance()}return Object.defineProperty(e.prototype,"audioSourceMap",{get:function(){return this.audioSourceList.reduce(function(r,i){return i.userID&&(r[i.userID]=i),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speakingAudioSourceList",{get:function(){var r=this;return this.audioSourceList.filter(function(i){return!!r.speakingUserIdList.includes(i.userID)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playingAudioSourceList",{get:function(){return this.audioSourceList.filter(function(r){return r.isPlaying})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioCtx",{get:function(){if(!this._audioCtx){var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=new r}return this._audioCtx},enumerable:!1,configurable:!0}),e.getInstance=function(r){return e.instance||(e.instance=new e(r)),e.instance},e.prototype.resumeAudioContext=function(){return m(this,void 0,void 0,function(){var r=this;return h(this,function(i){return[2,new Promise(function(s){r.audioCtx.onstatechange=function(){r.audioCtx.state==="running"&&s(!0)},r.audioCtx.suspend(),r.audioCtx.resume(),setTimeout(function(){s(!1)},3e3)})]})})},e.prototype.getAudioContextState=function(){return this.audioCtx.state},e.prototype.getStreamInfo=function(r){var i=void 0,s=void 0;try{var u=JSON.parse(r);i=u.range_audio_team_id,[n.ZegoRangeAudioMode.World,n.ZegoRangeAudioMode.Team].includes(u.range_audio_mode)&&(s=u.range_audio_mode)}catch(p){}return{teamID:i,sendMode:s}},e.prototype.setAudioReceiveRange=function(r){if(!o.checkNumber(r))throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' requires to be type number.");if((r=Number(r))<0)throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' can not be less than 0.");this.rangeListener.recvRange=r,this.audioSourceList.forEach(function(i){i.setMaxDistance(r)})},e.prototype.updateSelfPosition=function(r,i,s,u){var p=function(f){return"Failed to execute 'updateSelfPosition': Argument '"+f+`' requires an array of type number."`};if(!o.checkCoordinate(r))throw new Error(p("position"));if(!o.checkCoordinate(i))throw new Error(p("axisForward"));if(!o.checkCoordinate(s))throw new Error(p("axisRight"));if(!o.checkCoordinate(u))throw new Error(p("axisUp"));this.rangeListener&&this.rangeListener.updateSelfPosition(r,i,u),this.playStreamHandler.setListener(this.rangeListener)},e.prototype.updateAudioSource=function(r,i){if(r=String(r),!o.checkCoordinate(i))throw new Error("Failed to execute 'updateAudioSource': Arguments 'position' must be an array of type number.");var s=this.audioSourceMap[r];s?s.setPosition(i):(s=new d.default({userID:r,position:i},{audioCtx:this.audioCtx,zegoRTC:this.zegoRTC,isSpatial:this.isSpatial,maxDistance:this.rangeListener.recvRange}),this.enableSpatializer(this.isSpatial),this.audioSourceList.push(s)),this.playStreamHandler.setAudioSourceList(this.speakingAudioSourceList)},e.prototype.enableMicrophone=function(r){if(r===void 0&&(r=!0),!this.rangeListener.userID)throw new Error("Enable mic failed. Please log in room first.");return r?this.rangeListener.startPublishingStream():this.rangeListener.stopPublishingStream()},e.prototype.enableSpeaker=function(r){if(r===void 0&&(r=!0),!this.roomID)throw new Error("Enable speaker failed. Please log in room first.");this.playStreamHandler.isEnable=r,r?(this.playStreamHandler.startPlayingAudioStream(),this.playStreamHandler.handlePlayAudioTask()):this.playStreamHandler.stopPlayingAudioStream()},e.prototype.enableSpatializer=function(r){var i=this;r===void 0&&(r=!0),this.isSpatial=!!r,this.audioSourceList.forEach(function(s){var u=!(![s.teamID,i.rangeListener.teamID].includes(void 0)&&i.rangeListener.teamID===s.teamID)&&r;s.enableSpatializer(u)}),r&&this.rangeListener.updateListenerEffect()},e.prototype.setRangeAudioTeamID=function(r){this.rangeListener.setTeamID(r),this.enableSpatializer(this.isSpatial),this.playStreamHandler.handlePlayAudioTask()},e.prototype.setRangeAudioMode=function(r){this.rangeListener.setSendMode(r),this.rangeListener.setRecvMode(r),this.playStreamHandler.handlePlayAudioTask()},e.prototype.on=function(r,i){return this.eventManager.addEventHandler(r,i)},e.prototype.off=function(r,i){return this.eventManager.removeEventHandler(r,i)},e}();T.default=t},2777:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RangeAudio=void 0;var m=I(3116);T.RangeAudio={type:"RangeAudio",install:function(h){Object.defineProperty(h.prototype,"createRangeAudioInstance",{value:function(){return this.rangeAudio||(this.rangeAudio=m.ZegoExpressRangeAudio.getInstance(this)),this.rangeAudio},writable:!1})}}},2730:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(l,a,c,o){return new(c||(c=Promise))(function(n,t){function e(s){try{i(o.next(s))}catch(u){t(u)}}function r(s){try{i(o.throw(s))}catch(u){t(u)}}function i(s){var u;s.done?n(s.value):(u=s.value,u instanceof c?u:new c(function(p){p(u)})).then(e,r)}i((o=o.apply(l,a||[])).next())})},h=this&&this.__generator||function(l,a){var c,o,n,t,e={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return t={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(t[Symbol.iterator]=function(){return this}),t;function r(i){return function(s){return function(u){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,o&&(n=2&u[0]?o.return:u[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,u[1])).done)return n;switch(o=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,o=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(!((n=(n=e.trys).length>0&&n[n.length-1])||u[0]!==6&&u[0]!==2)){e=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){e.label=u[1];break}if(u[0]===6&&e.label<n[1]){e.label=n[1],n=u;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(u);break}n[2]&&e.ops.pop(),e.trys.pop();continue}u=a.call(l,e)}catch(p){u=[6,p],o=0}finally{c=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(T,"__esModule",{value:!0});var _=I(1297),d=function(){function l(a,c){this.panner=null,this.isSpatial=!1,this.autoPlay=!0,this.position=null,this.stream=null,this.sourceNode=null,this.isPlaying=!1,this.distance=null,this.audioCtx=c.audioCtx,this.zegoRTC=c.zegoRTC,this.isSpatial=c.isSpatial,this.maxDistance=c.maxDistance||1e5,this.userID=a.userID,this.teamID=a.teamID,this.sendMode=a.sendMode!==void 0?a.sendMode:_.ZegoRangeAudioMode.World,a.position&&(this.position=a.position)}return Object.defineProperty(l.prototype,"audioWrapper",{get:function(){var a=document.getElementById("#zg-audio-source-wrapper");return a||((a=document.createElement("div")).setAttribute("id","zg-audio-source-wrapper"),document.body.appendChild(a)),a},enumerable:!1,configurable:!0}),l.prototype.createPanner=function(){var a=this.position||[0,0,0],c=this.maxDistance;return new PannerNode(this.audioCtx,{panningModel:"HRTF",distanceModel:"linear",refDistance:1,maxDistance:c,rolloffFactor:1,coneOuterGain:.4,positionX:a[1],positionY:a[0],positionZ:-a[0]})},l.prototype.startPlayingAudio=function(){return m(this,void 0,void 0,function(){var a,c;return h(this,function(o){switch(o.label){case 0:return(a=document.getElementById("zg-audio-source-"+this.userID))?[3,2]:((a=document.createElement("audio")).setAttribute("autoplay","autoplay"),a.setAttribute("id","zg-audio-source-"+this.userID),a.setAttribute("crossorigin","anonymous"),c=this,[4,this.zegoRTC.startPlayingStream(this.userID)]);case 1:c.stream=o.sent(),this.audioWrapper.appendChild(a),this.stream&&(a.srcObject=this.stream,this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream)),this.panner||(this.panner=this.createPanner()),this.sourceNode&&this.enableSpatializer(this.isSpatial,!0),this.audioCtx.state==="suspended"&&this.audioCtx.resume(),o.label=2;case 2:return a&&a.parentNode&&a.parentNode.removeChild(a),[2]}})})},l.prototype.stopPlayingAudio=function(){this.isPlaying&&this.zegoRTC.stopPlayingStream(this.userID),this.stream=null,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null)},l.prototype.setPosition=function(a){this.position=a,this.panner&&(this.panner.positionX.value=a[1],this.panner.positionY.value=a[2],this.panner.positionZ.value=-a[0])},l.prototype.setMaxDistance=function(a){this.maxDistance=a,this.panner&&(this.panner.maxDistance=this.maxDistance)},l.prototype.getDistanceFromListener=function(a){var c=this.position,o=a.position;if(!o||!c)return null;var n=[c[0]-o[0],c[1]-o[1],c[2]-o[2]];return this.distance=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)),this.distance},l.prototype.enableSpatializer=function(a,c){c===void 0&&(c=!1),(c||this.isSpatial!==a)&&(this.isSpatial=a,this.sourceNode&&(a&&this.panner?(this.sourceNode.disconnect(),this.sourceNode.connect(this.panner).connect(this.audioCtx.destination)):a||(this.sourceNode.disconnect(),this.sourceNode.connect(this.audioCtx.destination))))},l}();T.default=d},1576:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0});var I=function(){function m(){this.handlerListMap={microphoneStateUpdate:[]}}return m.getInstance=function(){return m.instance||(m.instance=new m),m.instance},m.prototype.addEventHandler=function(h,_){if(!this.handlerListMap[h])return!1;if(typeof _!="function")throw new Error("Params callBack is not a Function");return this.handlerListMap[h].indexOf(_)==-1&&this.handlerListMap[h].push(_),!0},m.prototype.removeEventHandler=function(h,_){return!!this.handlerListMap[h]&&(this.handlerListMap[h]=_?this.handlerListMap[h].filter(function(d){return d!==_}):[],!0)},m.prototype.emit=function(h){for(var _=[],d=1;d<arguments.length;d++)_[d-1]=arguments[d];this.handlerListMap[h]&&this.handlerListMap[h].forEach(function(l){try{setTimeout(function(){l.apply(void 0,_)},0)}catch(a){console.error("dispatch "+h+" "+a)}})},m}();T.default=I},1646:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0});var m=I(1297),h=function(){function _(d){this.isEnable=!1,this.interval=3e3,this.timer=null,this.audioSourceList=[],this.hasChanged=!1,this.maxPlayingQuantity=20,this.rangeListener=d}return _.getInstance=function(d){return _.instance||(_.instance=new _(d)),_.instance},_.prototype.setListener=function(d){this.rangeListener=d,this.hasChanged=!0},_.prototype.setAudioSourceList=function(d){this.audioSourceList=d,this.hasChanged=!0},_.prototype.startPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.playAudioTask()},_.prototype.playAudioTask=function(){var d=this;this.hasChanged&&(this.hasChanged=!1,this.handlePlayAudioTask()),this.timer=window.setTimeout(function(){d.playAudioTask()},this.interval)},_.prototype.handlePlayAudioTask=function(){var d=this;if(this.isEnable){var l=this.getTeamAudioSourceGroup(),a=l.teamList,c=l.otherList,o=0;a.forEach(function(t){o<d.maxPlayingQuantity&&(t.isPlaying||t.startPlayingAudio(),o++)});var n=this.rangeListener.recvMode===m.ZegoRangeAudioMode.World;n&&(c.forEach(function(t){t.distance=t.getDistanceFromListener(d.rangeListener)}),c.sort(function(t,e){return t.distance===null?1:e.distance===null||t.distance<e.distance?-1:t.distance>e.distance?1:0})),c.forEach(function(t){n&&o<d.maxPlayingQuantity&&t.sendMode!==m.ZegoRangeAudioMode.Team&&t.distance!==null&&(d.rangeListener.recvRange===null||t.distance<=d.rangeListener.recvRange)?(t.isPlaying||t.startPlayingAudio(),o++):t.stopPlayingAudio()})}else this.stopPlayingAudioStream()},_.prototype.getTeamAudioSourceGroup=function(){var d=this,l=[],a=[];return this.audioSourceList.forEach(function(c){[c.teamID,d.rangeListener.teamID].includes(void 0)||c.teamID!==d.rangeListener.teamID?a.push(c):l.push(c)}),{teamList:l,otherList:a}},_.prototype.stopPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.audioSourceList.forEach(function(d){d.stopPlayingAudio()})},_}();T.default=h},5947:function(W,T,I){"use strict";var m=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(T,"__esModule",{value:!0});var h=I(1297),_=m(I(1576)),d=function(){function l(a,c){var o=this;this.recvMode=h.ZegoRangeAudioMode.World,this.sendMode=h.ZegoRangeAudioMode.World,this.recvRange=null,this.position=null,this.forwardAxis=[1,0,0],this.upAxis=[0,0,1],this.audioStream=null,this.isPublishing=!1,this.zegoRTC=c,this.audioCtx=a,this.audioListener=this.audioCtx.listener,this.eventHandler=_.default.getInstance(),this.zegoRTC.on("publisherStateUpdate",function(n){var t=n.streamID,e=n.state,r=n.errorCode,i=n.extendedData;t===o.userID&&(e==="NO_PUBLISH"?(o.isPublishing=!1,o.stopPublishingStream()):o.isPublishing=!0);var s={NO_PUBLISH:h.ZegoRangeAudioMicrophoneState.Off,PUBLISH_REQUESTING:h.ZegoRangeAudioMicrophoneState.TurningOn,PUBLISHING:h.ZegoRangeAudioMicrophoneState.On};o.eventHandler.emit("microphoneStateUpdate",s[e],r,i)})}return l.getInstance=function(a,c){return l.instance||(l.instance=new l(a,c)),l.instance},l.prototype.updateSelfPosition=function(a,c,o){this.position=a,this.forwardAxis=c,Array.isArray(o)&&(this.upAxis=o),this.updateListenerEffect()},l.prototype.updateListenerEffect=function(){this.position&&(this.audioListener.positionX?(this.audioListener.positionX.value=this.position[1],this.audioListener.positionY.value=this.position[2],this.audioListener.positionZ.value=-this.position[0]):this.audioListener.setPosition(this.position[1],this.position[2],-this.position[0]),this.audioListener.forwardX?(this.audioListener.forwardX.value=this.forwardAxis[1],this.audioListener.forwardY.value=this.forwardAxis[2],this.audioListener.forwardZ.value=-this.forwardAxis[0],this.audioListener.upX.value=this.upAxis[1],this.audioListener.upY.value=this.upAxis[2],this.audioListener.upZ.value=-this.upAxis[0]):this.audioListener.setOrientation(this.forwardAxis[1],this.forwardAxis[2],-this.forwardAxis[0],this.upAxis[1],this.upAxis[2],-this.upAxis[0]))},l.prototype.startPublishingStream=function(){var a=this;this.zegoRTC.createStream({camera:{video:!1,audio:!0,audioBitrate:30}}).then(function(c){if(!a.userID)throw a.zegoRTC.destroyStream(c),Error("Enable mic failed. Please log in room first.");a.audioStream&&a.audioStream!==c&&a.zegoRTC.destroyStream(a.audioStream),a.audioStream=c;var o={range_audio_team_id:a.teamID,range_audio_mode:a.sendMode};a.zegoRTC.startPublishingStream(a.userID,c,{extraInfo:JSON.stringify(o)})}).catch(function(c){throw c})},l.prototype.stopPublishingStream=function(){this.isPublishing&&this.userID&&this.zegoRTC.stopPublishingStream(this.userID),this.isPublishing=!1,this.audioStream&&(this.zegoRTC.destroyStream(this.audioStream),this.audioStream=null)},l.prototype.setRecvMode=function(a){this.recvMode=a},l.prototype.setSendMode=function(a){this.sendMode=a,this.updateSteamExtraInfo()},l.prototype.setTeamID=function(a){this.teamID=a,this.updateSteamExtraInfo()},l.prototype.updateSteamExtraInfo=function(){this.userID&&this.isPublishing&&this.zegoRTC.setStreamExtraInfo(this.userID,JSON.stringify({range_audio_team_id:this.teamID||void 0,range_audio_mode:this.sendMode}))},l.prototype.reset=function(){this.audioStream&&this.stopPublishingStream(),this.userID=void 0},l}();T.default=d},7803:function(W,T){"use strict";function I(m){return!isNaN(Number(m))&&Number.MAX_SAFE_INTEGER>=Number(m)&&Number(m)>=-Number.MAX_SAFE_INTEGER}Object.defineProperty(T,"__esModule",{value:!0}),T.checkCoordinate=T.checkBoolean=T.checkNumber=void 0,T.checkNumber=I,T.checkBoolean=function(m){return!1},T.checkCoordinate=function(m){if(Array.isArray(m)){for(var h=0;h<3;h++)if(!I(m[h]))return!1;return!0}return!1}},3524:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(a,c,o,n){return new(o||(o=Promise))(function(t,e){function r(u){try{s(n.next(u))}catch(p){e(p)}}function i(u){try{s(n.throw(u))}catch(p){e(p)}}function s(u){var p;u.done?t(u.value):(p=u.value,p instanceof o?p:new o(function(f){f(p)})).then(r,i)}s((n=n.apply(a,c||[])).next())})},h=this&&this.__generator||function(a,c){var o,n,t,e,r={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e;function i(s){return function(u){return function(p){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(t=2&p[0]?n.return:p[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,p[1])).done)return t;switch(n=0,t&&(p=[2&p[0],t.value]),p[0]){case 0:case 1:t=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,n=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(!((t=(t=r.trys).length>0&&t[t.length-1])||p[0]!==6&&p[0]!==2)){r=0;continue}if(p[0]===3&&(!t||p[1]>t[0]&&p[1]<t[3])){r.label=p[1];break}if(p[0]===6&&r.label<t[1]){r.label=t[1],t=p;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(p);break}t[2]&&r.ops.pop(),r.trys.pop();continue}p=c.call(a,r)}catch(f){p=[6,f],n=0}finally{o=t=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([s,u])}}},_=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(T,"__esModule",{value:!0}),T.preview=T.zegoWebRTC=void 0;var d=_(I(954)),l=I(3471);T.zegoWebRTC={setBeautyEffect:function(a,c,o){var n=this;return new Promise(function(t,e){if(!(a instanceof MediaStream))return n.logger.error("zc.sbe localStream not found"),void e({errorCode:ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"});c=!!c;var r=function(s){t(s)},i=n.streamCenter.checkPreview(a);if(!i)return n.logger.error("zc.sbe.0 preview no found"),void r({errorCode:l.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:l.errorCodeList.PUBLISH_NO_PREVIEW.message});i.setBeautyEffect(c,o).then(function(){r({errorCode:0,extendedData:""})}).catch(function(s){e({errorCode:s.errorCode||-1,extendedData:s.extendedData||s.toString()})})})}},T.preview={setBeautyEffect:function(a,c){return m(this,void 0,void 0,function(){var o,n,t,e=this;return h(this,function(r){switch(r.label){case 0:if(!this.videoTrack)return this.logger.error("zc.p.0.sbe.0 video track no found"),[2];if(typeof WebGLRenderingContext=="undefined")throw o=l.errorCodeList.VIDEO_EFFECT_NOT_SUPPORT,n=o.code,t=o.message,{errorCode:n,extendedData:t};return d.default?this.videoEffect?this.videoTrack===this.videoEffect.input?[3,2]:[4,this.videoEffect.setInput(this.videoTrack)]:[3,4]:[3,7];case 1:r.sent(),r.label=2;case 2:return[4,this.videoEffect.setBeautyEffectOptions(a,c)];case 3:return r.sent(),[3,6];case 4:return this.videoEffect=new d.default(this.logger,this.videoTrack),this.videoEffect.onOverload=function(i){e.stateCenter.actionListener("beautyEffectOverload",e.localStream,i)},this.videoEffect.onOutputChange=function(i){return m(e,void 0,void 0,function(){var s,u,p;return h(this,function(f){return this.videoTrack&&this.localStream&&(s=this.videoTrack,i&&(s=i),this.localStream.getVideoTracks()[0]!==s&&((u=(p=this.streamCenter.checkPublish(this.localStream))===null||p===void 0?void 0:p.publisher)&&u.previewer?u.replacePublishedTrack(s,!0):this.replacePreviewTrack(s,!!i))),[2]})})},[4,this.videoEffect.setBeautyEffectOptions(a,c)];case 5:r.sent(),r.label=6;case 6:return[3,8];case 7:this.logger.error("zc.p.0.sbe.0 beauty effect module no found"),r.label=8;case 8:return[2]}})})}}},3048:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(o,n,t,e){return new(t||(t=Promise))(function(r,i){function s(f){try{p(e.next(f))}catch(E){i(E)}}function u(f){try{p(e.throw(f))}catch(E){i(E)}}function p(f){var E;f.done?r(f.value):(E=f.value,E instanceof t?E:new t(function(y){y(E)})).then(s,u)}p((e=e.apply(o,n||[])).next())})},h=this&&this.__generator||function(o,n){var t,e,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(p){return function(f){return function(E){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(r=2&E[0]?e.return:E[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,E[1])).done)return r;switch(e=0,r&&(E=[2&E[0],r.value]),E[0]){case 0:case 1:r=E;break;case 4:return s.label++,{value:E[1],done:!1};case 5:s.label++,e=E[1],E=[0];continue;case 7:E=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||E[0]!==6&&E[0]!==2)){s=0;continue}if(E[0]===3&&(!r||E[1]>r[0]&&E[1]<r[3])){s.label=E[1];break}if(E[0]===6&&s.label<r[1]){s.label=r[1],r=E;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(E);break}r[2]&&s.ops.pop(),s.trys.pop();continue}E=n.call(o,s)}catch(y){E=[6,y],e=0}finally{t=r=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([p,f])}}},_=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(T,"__esModule",{value:!0}),T.PUBLISH_SET_BEAUTY_EFFECT=void 0;var d=_(I(8606)),l=_(I(5683)),a=_(I(8302));T.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe.2";var c=function(){function o(n){this.logger=n,this.gl=null,this.effectConfig={sharpenIntensity:.5,whitenIntensity:.5,rosyIntensity:.5,smoothIntensity:.5},this.originResolution={width:0,height:0},this.shaderList=[],this.frameBufferList=[],this.outputTextureList=[],this.inputTexture=null,this.enableBeauty=!1}return o.prototype.setEnableBeauty=function(n){this.enableBeauty=!!n},o.prototype.init=function(n,t,e){return m(this,void 0,void 0,function(){var r,i,s;return h(this,function(u){return typeof WebGLRenderingContext!="undefined"?(this.gl=e.getContext("webgl"),this.gl?(this.initGL(n,t),this.inputTexture?(this.canvasEl=e,(r=new d.default(this.gl,n,t)).setConstUniforms(),(i=new l.default(this.gl,n,t)).setConstUniforms(),(s=new a.default(this.gl,n,t)).setConstUniforms(),this.shaderList=[r,i,s],this.setEffectConfig(this.effectConfig),[2]):[2,this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" input texture not found")]):[2,this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" not get webgl context")]):[2,this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" not support webgl!")]})})},o.prototype.render=function(n){return m(this,void 0,void 0,function(){var t,e,r,i,s=this;return h(this,function(u){switch(u.label){case 0:return(t=this.gl)&&this.canvasEl?this.originResolution.height===n.videoHeight&&this.originResolution.width===n.videoWidth||!(Math.abs(this.originResolution.height-n.videoHeight)>2||Math.abs(this.originResolution.width-n.videoWidth)>2)?[3,3]:n.videoHeight===0||n.videoWidth===0?[2]:(this.canvasEl.width=n.videoWidth,this.canvasEl.height=n.videoHeight,n.setAttribute("width",n.videoWidth.toString()),n.setAttribute("height",n.videoHeight.toString()),!this.gl||this.gl.isContextLost()?[3,1]:(this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" resolution changed, reset resolution"),this.resetResolution(n.videoWidth,n.videoHeight),this.shaderList.forEach(function(p){p.resetResolution(n.videoWidth,n.videoHeight)}),[3,3])):(this.logger.warn(T.PUBLISH_SET_BEAUTY_EFFECT+" video effect manager is not init!"),[2]);case 1:return this.logger.warn(T.PUBLISH_SET_BEAUTY_EFFECT+" resolution changed and gl context lost, restart effect"),this.release(),[4,this.init(n.videoWidth,n.videoHeight,this.canvasEl)];case 2:u.sent(),u.label=3;case 3:return e=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],r=[0,1,2,0,2,3],i=[0,0,1,0,1,1,0,1],t.viewport(0,0,n.width,n.height),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.inputTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),this.shaderList.forEach(function(p,f){var E=p.program;if(E){p.renderPreTextures&&p.renderPreTextures(e,r,i),t.useProgram(E),p.render();var y=t.getUniformLocation(E,"uTexture"),b=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,b),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);var S=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,S),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW);var k=t.getAttribLocation(E,"aPosition");t.enableVertexAttribArray(k),t.vertexAttribPointer(k,3,t.FLOAT,!1,0,0);var O=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,O),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);var g=t.getAttribLocation(E,"aTexCoordinate");t.enableVertexAttribArray(g),t.vertexAttribPointer(g,2,t.FLOAT,!1,0,0);var v=f===s.shaderList.length-1?null:s.outputTextureList[f],R=f===s.shaderList.length-1?null:s.frameBufferList[f];t.bindFramebuffer(t.FRAMEBUFFER,R),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),v&&t.bindTexture(t.TEXTURE_2D,v),t.uniform1i(y,0)}}),[2]}})})},o.prototype.setEffectConfig=function(n){var t=this;isNaN(n.sharpenIntensity)||(this.effectConfig.sharpenIntensity=n.sharpenIntensity),isNaN(n.whitenIntensity)||(this.effectConfig.whitenIntensity=n.whitenIntensity),isNaN(n.rosyIntensity)||(this.effectConfig.rosyIntensity=n.rosyIntensity),isNaN(n.smoothIntensity)||(this.effectConfig.smoothIntensity=n.smoothIntensity),this.shaderList.forEach(function(e){e.setEffectConfig(t.effectConfig)})},o.prototype.release=function(){var n=this;this.shaderList.forEach(function(t){var e;t.program&&((e=n.gl)===null||e===void 0||e.deleteProgram(t.program))}),this.outputTextureList.forEach(function(t){var e;t&&((e=n.gl)===null||e===void 0||e.deleteTexture(t))}),this.frameBufferList.forEach(function(t){var e;t&&((e=n.gl)===null||e===void 0||e.deleteFramebuffer(t))}),this.inputTexture=this.gl=null,this.shaderList=[],this.outputTextureList=[],this.frameBufferList=[]},o.prototype.initGL=function(n,t){var e=this.gl;if(!e)return this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" webgl context not found");this.inputTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.inputTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);for(var r=0;3>r;r++){var i=e.createTexture();if(!i)return this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" create texture failed");e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null);var s=e.createFramebuffer();if(!s)return this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" create frame buffer failed");e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),this.outputTextureList.push(i),this.frameBufferList.push(s)}e.viewport(0,0,n,t),this.originResolution.width=n,this.originResolution.height=t},o.prototype.resetResolution=function(n,t){var e=this.gl;if(!e)return this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" can not find webgl context");this.outputTextureList.forEach(function(r){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null)}),e.viewport(0,0,n,t),this.originResolution.width=n,this.originResolution.height=t},o}();T.default=c},3471:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={VIDEO_EFFECT_NOT_SUPPORT:{code:1103072,message:"not support beauty effect"}}},957:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BeautyEffect=void 0;var m=I(3524);T.BeautyEffect={type:"BeautyEffect",install:function(h,_){for(var d in m.preview)Object.defineProperty(_.prototype,d,{value:m.preview[d],writable:!1});for(var d in m.zegoWebRTC)Object.defineProperty(h.prototype,d,{value:m.zegoWebRTC[d],writable:!1})}}},836:function(W,T){"use strict";var I=this&&this.__awaiter||function(_,d,l,a){return new(l||(l=Promise))(function(c,o){function n(r){try{e(a.next(r))}catch(i){o(i)}}function t(r){try{e(a.throw(r))}catch(i){o(i)}}function e(r){var i;r.done?c(r.value):(i=r.value,i instanceof l?i:new l(function(s){s(i)})).then(n,t)}e((a=a.apply(_,d||[])).next())})},m=this&&this.__generator||function(_,d){var l,a,c,o,n={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return o={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function t(e){return function(r){return function(i){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,a&&(c=2&i[0]?a.return:i[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,i[1])).done)return c;switch(a=0,c&&(i=[2&i[0],c.value]),i[0]){case 0:case 1:c=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,a=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((c=(c=n.trys).length>0&&c[c.length-1])||i[0]!==6&&i[0]!==2)){n=0;continue}if(i[0]===3&&(!c||i[1]>c[0]&&i[1]<c[3])){n.label=i[1];break}if(i[0]===6&&n.label<c[1]){n.label=c[1],c=i;break}if(c&&n.label<c[2]){n.label=c[2],n.ops.push(i);break}c[2]&&n.ops.pop(),n.trys.pop();continue}i=d.call(_,n)}catch(s){i=[6,s],a=0}finally{l=c=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([e,r])}}};Object.defineProperty(T,"__esModule",{value:!0});var h=function(){function _(d){this.logger=d,this.recordedFrameCount=0,this.targetFrameRate=0,this.recordingDuration=0}return _.prototype.startRecordBeautyEffectOutput=function(d){return I(this,void 0,void 0,function(){var l,a,c,o,n=this;return m(this,function(t){switch(t.label){case 0:return l=6,this.recordID?(this.logger.warn("zc.p.0.sbe.3 detector is already recording"),[2,{result:!0}]):(a=new Date().getTime(),this.recordID=a,this.targetFrameRate=d,this.recordedFrameCount=0,this.recordingDuration=l,[4,new Promise(function(e){window.setTimeout(e,1e3*n.recordingDuration)})]);case 1:return t.sent(),this.recordID!==a?(this.recordID=void 0,[2,{result:!0}]):(this.recordID=void 0,c=this.targetFrameRate*this.recordingDuration,o=this.recordedFrameCount/l,this.recordedFrameCount<c/2?(this.logger.warn("zc.p.0.sbe.3 detect effect overload: current fps: "+o),[2,{result:!1,targetFPS:this.targetFrameRate,currentFPS:o}]):(this.logger.info("zc.p.0.sbe.3 detect effect current fps: "+o),[2,{result:!0}]))}})})},_.prototype.stopRecordBeautyEffectOutput=function(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0},_.prototype.addFrame=function(){this.recordID&&(this.recordedFrameCount+=1)},_}();T.default=h},5683:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(c,o){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},m(c,o)},function(c,o){function n(){this.constructor=c}m(c,o),c.prototype=o===null?Object.create(o):(n.prototype=o.prototype,new n)}),_=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(T,"__esModule",{value:!0});var d=_(I(6976)),l=I(1199),a=function(c){function o(n,t,e){var r=c.call(this,n,t,e)||this;return r.width=t,r.height=e,r.type="LightShader",r.uLightIntensity=null,r.uRedIntensity=null,r.whitenIntensity=.5,r.rosyIntensity=.5,r.program=r.makeProgram(l.lightVS,l.lightFS),r}return h(o,c),o.prototype.setEffectConfig=function(n){isNaN(n.whitenIntensity)||(this.whitenIntensity=n.whitenIntensity/100),isNaN(n.rosyIntensity)||(this.rosyIntensity=n.rosyIntensity/100)},o.prototype.render=function(){var n=this.gl;n.uniform1f(this.uLightIntensity,this.whitenIntensity),n.uniform1f(this.uRedIntensity,this.rosyIntensity)},o.prototype.setConstUniforms=function(){var n=this.program;if(n){var t=this.gl;t.useProgram(n),this.uLightIntensity=t.getUniformLocation(n,"intensity"),t.uniform1f(this.uLightIntensity,this.whitenIntensity),this.uRedIntensity=t.getUniformLocation(n,"rosyIntensity"),t.uniform1f(this.uRedIntensity,this.rosyIntensity);var e=t.getUniformLocation(n,"uPMVMatrix");t.uniformMatrix4fv(e,!1,[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}},o}(d.default);T.default=a},6976:function(W,T){"use strict";function I(h){for(var _=h,d="",l=0;l<_.length;l++){var a=_.charCodeAt(l),c=a;a>=65&&a<=90&&(c=(a-65-13+26)%26+65),a>=97&&a<=122&&(c=(a-97-13+26)%26+97),d+=String.fromCharCode(c)}return d}Object.defineProperty(T,"__esModule",{value:!0});var m=function(){function h(_,d,l){this.gl=_,this.width=d,this.height=l,this.type="baseShader",this.program=null,this.program=null}return h.prototype.setEffectConfig=function(_){},h.prototype.setConstUniforms=function(){},h.prototype.resetResolution=function(_,d){this.width=_||this.width,this.height=d||this.height},h.prototype.render=function(){},h.prototype.renderPreTextures=function(_,d,l){},h.prototype.makeProgram=function(_,d){var l=this.gl,a=I(_),c=I(d),o=this.makeShader(a,l.VERTEX_SHADER),n=this.makeShader(c,l.FRAGMENT_SHADER),t=l.createProgram();return l.attachShader(t,o),l.attachShader(t,n),l.linkProgram(t),l.getProgramParameter(t,l.LINK_STATUS),t},h.prototype.makeShader=function(_,d){var l=this.gl,a=l.createShader(d);return l.shaderSource(a,_),l.compileShader(a),l.getShaderParameter(a,l.COMPILE_STATUS),a},h}();T.default=m},8606:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(c,o){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},m(c,o)},function(c,o){function n(){this.constructor=c}m(c,o),c.prototype=o===null?Object.create(o):(n.prototype=o.prototype,new n)}),_=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(T,"__esModule",{value:!0});var d=_(I(6976)),l=I(1199),a=function(c){function o(n,t,e){var r=c.call(this,n,t,e)||this;return r.width=t,r.height=e,r.type="BlurShader",r.blurXProgram=null,r.blurYProgram=null,r.diffProgram=null,r.uIntensity=null,r.smoothIntensity=.5,r.blurTextureList=[],r.blurBufferList=[],r.blurXProgram=r.makeProgram(l.borderBlurVS,l.borderBlurFS),r.setBorderBlurProgram(r.blurXProgram,1/(t||1),0),r.blurYProgram=r.makeProgram(l.borderBlurVS,l.borderBlurFS),r.setBorderBlurProgram(r.blurYProgram,0,1/(e||1)),r.diffProgram=r.makeProgram(l.diffBlurVS,l.diffBlurFS),r.setDiffBlurProgram(r.diffProgram),r.program=r.makeProgram(l.mixBlurVS,l.mixBlurFS),r.initBlurBuffer(),r}return h(o,c),o.prototype.setEffectConfig=function(n){isNaN(n.smoothIntensity)||(this.smoothIntensity=n.smoothIntensity/100)},o.prototype.render=function(){this.gl.uniform1f(this.uIntensity,this.smoothIntensity)},o.prototype.initBlurBuffer=function(){var n=this.gl;this.blurTextureList=[],this.blurTextureList=[];for(var t=0;t<3;t++){var e=n.createTexture();if(!e)return;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null);var r=n.createFramebuffer();if(!r)return;n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.blurTextureList.push(e),this.blurBufferList.push(r)}},o.prototype.renderPreTextures=function(n,t,e){var r=this,i=this.gl,s=[0,1,0],u=[1,1,2];[this.blurXProgram,this.blurYProgram,this.diffProgram].forEach(function(p,f){if(p){i.useProgram(p);var E=i.getUniformLocation(p,"uTexture");i.uniform1i(E,s[f]);var y=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,y),i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.STATIC_DRAW);var b=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,b),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),i.STATIC_DRAW);var S=i.getAttribLocation(p,"aPosition");i.enableVertexAttribArray(S),i.vertexAttribPointer(S,3,i.FLOAT,!1,0,0);var k=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,k),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.STATIC_DRAW);var O=i.getAttribLocation(p,"aTexCoordinate");i.enableVertexAttribArray(O),i.vertexAttribPointer(O,2,i.FLOAT,!1,0,0),i.bindFramebuffer(i.FRAMEBUFFER,r.blurBufferList[f]),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),i.activeTexture(i.TEXTURE0+u[f]),i.bindTexture(i.TEXTURE_2D,r.blurTextureList[f])}})},o.prototype.setConstUniforms=function(){var n=this.width,t=this.height,e=this.program;if(e){var r=this.gl;r.useProgram(e);var i=r.getUniformLocation(e,"widthOffset");r.uniform1f(i,1/n);var s=r.getUniformLocation(e,"heightOffset");r.uniform1f(s,1/t),this.uIntensity=r.getUniformLocation(e,"blurAlpha"),r.uniform1f(this.uIntensity,this.smoothIntensity);var u=r.getUniformLocation(e,"blurTexture");r.uniform1i(u,1);var p=r.getUniformLocation(e,"blurDiffTexture");r.uniform1i(p,2)}},o.prototype.resetResolution=function(n,t){this.width=n||this.width,this.height=t||this.height},o.prototype.setBorderBlurProgram=function(n,t,e){var r=this.gl;r.useProgram(n);var i=r.getUniformLocation(n,"texBlurWidthOffset");r.uniform1f(i,t);var s=r.getUniformLocation(n,"texBlurHeightOffset");r.uniform1f(s,e)},o.prototype.setDiffBlurProgram=function(n){var t=this.gl;t.useProgram(n);var e=t.getUniformLocation(n,"blurTexture");t.uniform1i(e,1)},o}(d.default);T.default=a},1199:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.mixBlurFS=T.mixBlurVS=T.diffBlurFS=T.diffBlurVS=T.borderBlurFS=T.borderBlurVS=T.sharpnessFS=T.sharpnessVS=T.lightFS=T.lightVS=void 0,T.lightVS=`cerpvfvba uvtuc sybng;
nggevohgr irp2 nGrkPbbeqvangr;
nggevohgr irp4 nCbfvgvba;
havsbez zng4 hCZIZngevk;
inelvat irp2 iGrkPbbeq;
ibvq znva() {
    ty_Cbfvgvba = hCZIZngevk * nCbfvgvba;
    iGrkPbbeq = nGrkPbbeqvangr;
}`,T.lightFS=`cerpvfvba uvtuc sybng;
inelvat irp2 iGrkPbbeq;
havsbez fnzcyre2Q hGrkgher;
havsbez sybng vagrafvgl;
havsbez sybng ebflVagrafvgl;
irp3 oevtugarffNaqPbagenfg(irp3 pbybe){
  sybng v = vagrafvgl * 1.0;
  sybng CV = 3.1415926;
  sybng O = 0.12 * v;
  sybng p = 0.1 * v;
  sybng x = gna((45. + 44. * p) / 180.0 * CV);
  pbybe = ((pbybe*255.0 - 127.5 * (1.0 - O)) * x + 127.5 * (1.0 + O)) / 255.0;
  erghea pbybe;
}
ibvq znva() {
  irp4 grkgherPbybe = grkgher2Q(hGrkgher, iGrkPbbeq);
  grkgherPbybe = irp4(oevtugarffNaqPbagenfg(grkgherPbybe.eto), grkgherPbybe.j);
  grkgherPbybe.e = zva(grkgherPbybe.e + 0.06 * ebflVagrafvgl, 1.0);
  ty_SentPbybe = grkgherPbybe;
}`,T.sharpnessVS=`
nggevohgr irp4 nCbfvgvba;
nggevohgr irp4 nGrkPbbeqvangr;
havsbez sybng vzntrJvqguSnpgbe;
havsbez sybng vzntrUrvtugSnpgbe;
havsbez sybng funecarff; 
inelvat irp2 iGrkPbbeq;
inelvat irp2 yrsgGrkgherPbbeqvangr;
inelvat irp2 evtugGrkgherPbbeqvangr;
inelvat irp2 gbcGrkgherPbbeqvangr;
inelvat irp2 obggbzGrkgherPbbeqvangr;
inelvat sybng pragreZhygvcyvre;
inelvat sybng rqtrZhygvcyvre;
ibvq znva() {
  ty_Cbfvgvba = nCbfvgvba;
  irp2 jvqguFgrc = irp2(vzntrJvqguSnpgbe, 0.0);
  irp2 urvtugFgrc = irp2(0.0, vzntrUrvtugSnpgbe);
  iGrkPbbeq = nGrkPbbeqvangr.kl;
  yrsgGrkgherPbbeqvangr = nGrkPbbeqvangr.kl - jvqguFgrc;
  evtugGrkgherPbbeqvangr = nGrkPbbeqvangr.kl + jvqguFgrc;
  gbcGrkgherPbbeqvangr = nGrkPbbeqvangr.kl + urvtugFgrc;
  obggbzGrkgherPbbeqvangr = nGrkPbbeqvangr.kl - urvtugFgrc;
  pragreZhygvcyvre = 1.0 + 4.0 * funecarff;
  rqtrZhygvcyvre = funecarff;
}
`,T.sharpnessFS=`
cerpvfvba uvtuc sybng;
inelvat uvtuc irp2 iGrkPbbeq;
inelvat uvtuc irp2 yrsgGrkgherPbbeqvangr;
inelvat uvtuc irp2 evtugGrkgherPbbeqvangr;
inelvat uvtuc irp2 gbcGrkgherPbbeqvangr;
inelvat uvtuc irp2 obggbzGrkgherPbbeqvangr;
inelvat uvtuc sybng pragreZhygvcyvre;
inelvat uvtuc sybng rqtrZhygvcyvre;
havsbez fnzcyre2Q hGrkgher;
ibvq znva() {
  zrqvhzc irp4 nPbybe = grkgher2Q(hGrkgher, iGrkPbbeq);
  zrqvhzc irp3 grkgherPbybe = nPbybe.eto;
  zrqvhzc irp3 yrsgGrkgherPbybe = grkgher2Q(hGrkgher, yrsgGrkgherPbbeqvangr).eto;
  zrqvhzc irp3 evtugGrkgherPbybe = grkgher2Q(hGrkgher, evtugGrkgherPbbeqvangr).eto;
  zrqvhzc irp3 gbcGrkgherPbybe = grkgher2Q(hGrkgher, gbcGrkgherPbbeqvangr).eto;
  zrqvhzc irp3 obggbzGrkgherPbybe = grkgher2Q(hGrkgher, obggbzGrkgherPbbeqvangr).eto;
  ty_SentPbybe = irp4((grkgherPbybe * pragreZhygvcyvre - (yrsgGrkgherPbybe * rqtrZhygvcyvre + evtugGrkgherPbybe * rqtrZhygvcyvre + gbcGrkgherPbybe * rqtrZhygvcyvre + obggbzGrkgherPbybe * rqtrZhygvcyvre)), nPbybe.n);
}`,T.borderBlurVS=`nggevohgr irp4 nCbfvgvba;
nggevohgr irp4 nGrkPbbeqvangr;
havsbez uvtuc sybng grkOyheJvqguBssfrg;
havsbez uvtuc sybng grkOyheUrvtugBssfrg;
inelvat irp2 i_grkpbbeq0;
inelvat irp4 grkgherFuvsg_1;
inelvat irp4 grkgherFuvsg_2;
inelvat irp4 grkgherFuvsg_3;
inelvat irp4 grkgherFuvsg_4;
ibvq znva()
{
  ty_Cbfvgvba = nCbfvgvba;
  i_grkpbbeq0 = nGrkPbbeqvangr.kl;

  irp2 fvatyrFgrcBssfrg = irp2(grkOyheJvqguBssfrg, grkOyheUrvtugBssfrg)*2.5;

  grkgherFuvsg_1 = irp4(nGrkPbbeqvangr.kl - fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + fvatyrFgrcBssfrg);
  grkgherFuvsg_2 = irp4(nGrkPbbeqvangr.kl - 2.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 2.0 * fvatyrFgrcBssfrg);
  grkgherFuvsg_3 = irp4(nGrkPbbeqvangr.kl - 3.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 3.0 * fvatyrFgrcBssfrg);
  grkgherFuvsg_4 = irp4(nGrkPbbeqvangr.kl - 4.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 4.0 * fvatyrFgrcBssfrg);
}`,T.borderBlurFS=`cerpvfvba zrqvhzc sybng;
havsbez fnzcyre2Q hGrkgher;
inelvat irp2 i_grkpbbeq0;
inelvat uvtuc irp4 grkgherFuvsg_1;
inelvat uvtuc irp4 grkgherFuvsg_2;
inelvat uvtuc irp4 grkgherFuvsg_3;
inelvat uvtuc irp4 grkgherFuvsg_4;
ibvq znva(ibvq) { 
  zrqvhzc irp3 fhz = grkgher2Q(hGrkgher, i_grkpbbeq0).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_1.kl).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_1.mj).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_2.kl).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_2.mj).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_3.kl).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_3.mj).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_4.kl).eto;
  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_4.mj).eto;
  ty_SentPbybe = irp4(fhz * 0.1111, 1.0); 
}`,T.diffBlurVS=`nggevohgr irp4 nCbfvgvba;
nggevohgr irp4 nGrkPbbeqvangr;
havsbez zng4 hCZIZngevk;
inelvat irp2 i_grkpbbeq0;
ibvq znva()
{
  // ty_Cbfvgvba = hCZIZngevk * nCbfvgvba;
  ty_Cbfvgvba = nCbfvgvba;
  i_grkpbbeq0 = nGrkPbbeqvangr.kl;
}`,T.diffBlurFS=`cerpvfvba zrqvhzc sybng;
havsbez fnzcyre2Q hGrkgher;
inelvat irp2 i_grkpbbeq0;
havsbez fnzcyre2Q oyheGrkgher;
ibvq znva(ibvq) {
  irp4 vPbybe = grkgher2Q(oyheGrkgher, i_grkpbbeq0);
  irp4 zrnaPbybe = grkgher2Q(hGrkgher, i_grkpbbeq0);
  irp4 qvssPbybe = vPbybe - zrnaPbybe;
  qvssPbybe.e = zva(qvssPbybe.e * 50.0 * qvssPbybe.e, 1.0);
  qvssPbybe.t = zva(qvssPbybe.t * 50.0 * qvssPbybe.t, 1.0);
  qvssPbybe.o = zva(qvssPbybe.o * 50.0 * qvssPbybe.o, 1.0);
  ty_SentPbybe = irp4(qvssPbybe.eto, 1.0);
}`,T.mixBlurVS=`
nggevohgr irp4 nCbfvgvba;
nggevohgr irp4 nGrkPbbeqvangr;
inelvat irp2 i_grkpbbeq0;
havsbez sybng jvqguBssfrg;
havsbez sybng urvtugBssfrg;
inelvat irp2 grkgherFuvsg_1;
inelvat irp2 grkgherFuvsg_2;
inelvat irp2 grkgherFuvsg_3;
inelvat irp2 grkgherFuvsg_4;
ibvq znva()
{
  ty_Cbfvgvba = nCbfvgvba;
  i_grkpbbeq0 = nGrkPbbeqvangr.kl;
  grkgherFuvsg_1 = irp2(i_grkpbbeq0 + 0.5 * irp2(jvqguBssfrg,urvtugBssfrg));
  grkgherFuvsg_2 = irp2(i_grkpbbeq0 + 0.5 * irp2(-jvqguBssfrg,-urvtugBssfrg));
  grkgherFuvsg_3 = irp2(i_grkpbbeq0 + 0.5 * irp2(-jvqguBssfrg,urvtugBssfrg));
  grkgherFuvsg_4 = irp2(i_grkpbbeq0 + 0.5 * irp2(jvqguBssfrg,-urvtugBssfrg));
}
`,T.mixBlurFS=`
cerpvfvba zrqvhzc sybng;
havsbez fnzcyre2Q hGrkgher;
inelvat irp2 i_grkpbbeq0;
havsbez fnzcyre2Q oyheGrkgher;
havsbez fnzcyre2Q oyheQvssGrkgher;
havsbez ybjc sybng oyheNycun;
ibvq znva(ibvq) {
  ybjc irp4 vPbybe = grkgher2Q(hGrkgher, i_grkpbbeq0);
  ybjc irp4 zrnaPbybe = grkgher2Q(oyheGrkgher, i_grkpbbeq0);
  ybjc irp4 inePbybe = grkgher2Q(oyheQvssGrkgher, i_grkpbbeq0);
  ybjc sybng nycun = oyheNycun * 1.0;
  ybjc sybng gurgn = 0.1;
  zrqvhzc sybng c = pynzc((zva(vPbybe.e, zrnaPbybe.e - 0.1) - 0.2) * 4.0, 0.0, 1.0);
  zrqvhzc sybng zrnaIne = znk(znk(inePbybe.e, inePbybe.t), inePbybe.o);
  zrqvhzc sybng xZva = 0.1;
  ybjc irp3 erfhygPbybe;
  xZva = (1.0 - zrnaIne / (zrnaIne + gurgn)) * c * nycun;
  erfhygPbybe = zvk(vPbybe.eto, zrnaPbybe.eto, xZva);
  erfhygPbybe = zvk(vPbybe.eto, erfhygPbybe, zva(1.0,nycun));
  ty_SentPbybe = irp4(erfhygPbybe,1.0);
}`},8302:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(c,o){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},m(c,o)},function(c,o){function n(){this.constructor=c}m(c,o),c.prototype=o===null?Object.create(o):(n.prototype=o.prototype,new n)}),_=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(T,"__esModule",{value:!0});var d=_(I(6976)),l=I(1199),a=function(c){function o(n,t,e){var r=c.call(this,n,t,e)||this;return r.width=t,r.height=e,r.type="SharpnessShader",r.uIntensity=null,r.sharpenIntensity=.5,r.program=r.makeProgram(l.sharpnessVS,l.sharpnessFS),r}return h(o,c),o.prototype.setEffectConfig=function(n){isNaN(n.sharpenIntensity)||(this.sharpenIntensity=n.sharpenIntensity/100)},o.prototype.render=function(){this.gl.uniform1f(this.uIntensity,.5*this.sharpenIntensity)},o.prototype.resetResolution=function(n,t){this.width=n||this.width,this.height=t||this.height,this.setConstUniforms()},o.prototype.setConstUniforms=function(){var n=this.width,t=this.height,e=this.program;if(e){var r=this.gl;r.useProgram(e);var i=r.getUniformLocation(e,"imageWidthFactor");r.uniform1f(i,1/n);var s=r.getUniformLocation(e,"imageHeightFactor");r.uniform1f(s,1/t),this.uIntensity=r.getUniformLocation(e,"sharpness"),r.uniform1f(this.uIntensity,.5*this.sharpenIntensity)}},o}(d.default);T.default=a},954:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(c,o,n,t){return new(n||(n=Promise))(function(e,r){function i(p){try{u(t.next(p))}catch(f){r(f)}}function s(p){try{u(t.throw(p))}catch(f){r(f)}}function u(p){var f;p.done?e(p.value):(f=p.value,f instanceof n?f:new n(function(E){E(f)})).then(i,s)}u((t=t.apply(c,o||[])).next())})},h=this&&this.__generator||function(c,o){var n,t,e,r,i={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function s(u){return function(p){return function(f){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,t&&(e=2&f[0]?t.return:f[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,f[1])).done)return e;switch(t=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,t=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(!((e=(e=i.trys).length>0&&e[e.length-1])||f[0]!==6&&f[0]!==2)){i=0;continue}if(f[0]===3&&(!e||f[1]>e[0]&&f[1]<e[3])){i.label=f[1];break}if(f[0]===6&&i.label<e[1]){i.label=e[1],e=f;break}if(e&&i.label<e[2]){i.label=e[2],i.ops.push(f);break}e[2]&&i.ops.pop(),i.trys.pop();continue}f=o.call(c,i)}catch(E){f=[6,E],t=0}finally{n=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([u,p])}}},_=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(T,"__esModule",{value:!0}),T.PUBLISH_SET_BEAUTY_EFFECT=void 0;var d=_(I(836)),l=_(I(3048));T.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe.1";var a=function(){function c(o,n){var t=this;this.logger=o,this.kind="video",this._enabled=!1,this.lastRenderTime=0,this.isStarting=!1,this.animationFrameId=0,this.backgroundLoop=null,this.eventHandler={visibilitychange:function(){if(document.hidden){var e=function(){t.enabled&&t.videoEl&&t.manager.render(t.videoEl),t.output&&t.output.requestFrame&&t.output.requestFrame(),t.detector.addFrame(),t.backgroundLoop=window.setTimeout(e,Math.floor(1e3/t.fps))};e()}else t.backgroundLoop&&(clearTimeout(t.backgroundLoop),t.backgroundLoop=null)}},this.setInput(n,!0),this.fps=15,this.detector=new d.default(o),this.backgroundLoop&&clearTimeout(this.backgroundLoop),this.backgroundLoop=null,this.lastRenderTime=0,this.manager=new l.default(o)}return Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(o){this._enabled=o},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"output",{get:function(){return this._output},enumerable:!1,configurable:!0}),c.prototype.setBeautyEffectOptions=function(o,n){return n===void 0&&(n={}),m(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return o&&this.manager.setEffectConfig(n),this.enabled===o?[3,6]:(this.manager.setEnableBeauty(o),this.enabled!==o&&this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" effect enabled "+o+"; options: "+JSON.stringify(n)),this.enabled=o,o?this.input?[4,this.startEffect()]:[3,2]:[3,3]);case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return[4,this.stopEffect()];case 4:t.sent(),t.label=5;case 5:t.label=6;case 6:return[2]}})})},c.prototype.startEffect=function(){return m(this,void 0,void 0,function(){var o,n,t=this;return h(this,function(e){switch(e.label){case 0:return this.isStarting=!0,this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" call start effect"),this.input?this.input&&this.output&&this.input!==this.output?(this.logger.warn(T.PUBLISH_SET_BEAUTY_EFFECT+" video effect is already enabled"),[2]):[4,this.startWebGLProcessor()]:(this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" start effect failed, input track is null"),[2]);case 1:return o=e.sent(),[4,this.updateOutput(o)];case 2:return e.sent(),this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" start effect success"),this.detector.startRecordBeautyEffectOutput(this.fps).then(function(r){if(!r.result&&t.onOverload){var i=r.targetFPS,s=r.currentFPS;t.onOverload({targetFPS:i,currentFPS:s})}}),n=function(){return m(t,void 0,void 0,function(){var r,i,s;return h(this,function(u){switch(u.label){case 0:return this.enabled&&(this.animationFrameId=requestAnimationFrame(n)),r=Date.now(),i=1e3/this.fps,(s=this.lastRenderTime?r-this.lastRenderTime:i)>=i?(this.lastRenderTime=r-(s-i),this.videoEl&&this.videoEl.paused&&this.videoEl.play(),this.enabled&&this.videoEl?this.videoEl.videoWidth>6&&this.videoEl.videoHeight>6?[4,this.manager.render(this.videoEl)]:[3,2]:[3,3]):[3,3];case 1:u.sent(),u.label=2;case 2:this.output&&this.output.requestFrame&&this.output.requestFrame(),this.detector.addFrame(),u.label=3;case 3:return[2]}})})},this.animationFrameId=requestAnimationFrame(n),document.addEventListener("visibilitychange",this.eventHandler.visibilitychange,!1),this.isStarting=!1,[2]}})})},c.prototype.stopEffect=function(){return m(this,void 0,void 0,function(){var o=this;return h(this,function(n){switch(n.label){case 0:return this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" call stop effect"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0),this.detector.stopRecordBeautyEffectOutput(),this.manager.release(),[4,this.updateOutput()];case 1:return n.sent(),this.removeDomTimer===void 0&&(this.removeDomTimer=window.setTimeout(function(){o.enabled===!1&&o.destroy()},18e4)),document.removeEventListener("visibilitychange",this.eventHandler.visibilitychange),[2]}})})},c.prototype.destroy=function(){this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" destroy hidden elements"),this.canvasEl&&this.canvasEl.remove(),this.videoEl&&this.videoEl.remove(),this.videoEl=this.canvasEl=void 0,this.removeDomTimer&&(clearTimeout(this.removeDomTimer),this.removeDomTimer=void 0)},c.prototype.startWebGLProcessor=function(){return m(this,void 0,void 0,function(){var o,n,t,e,r=this;return h(this,function(i){switch(i.label){case 0:return this.input?(this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" start webgl processor"),this.removeDomTimer&&(clearTimeout(this.removeDomTimer),this.removeDomTimer=void 0),this.canvasEl&&this.videoEl?[3,2]:(this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" create elements"),this.canvasEl&&(this.canvasEl.remove(),this.canvasEl=void 0),this.videoEl&&(this.videoEl.remove(),this.videoEl=void 0),this.canvasEl=document.createElement("canvas"),this.videoEl=document.createElement("video"),this.videoEl.setAttribute("autoplay",""),this.videoEl.setAttribute("muted",""),this.videoEl.muted=!0,this.videoEl.setAttribute("playsinline",""),this.videoEl.setAttribute("style","display:none"),this.videoEl.srcObject=new MediaStream([this.input]),o=new Promise(function(s){var u=function(){r.videoEl&&r.videoEl.removeEventListener("playing",u),s(void 0)};r.videoEl&&r.videoEl.addEventListener("playing",u)}),this.videoEl.play(),[4,o])):(this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" input track is null"),[2]);case 1:i.sent(),i.label=2;case 2:return n=this.input.getSettings(),t=n.width||this.videoEl.videoWidth,e=n.height||this.videoEl.videoHeight,n.frameRate&&this.fps!==n.frameRate&&(this.fps=n.frameRate,this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" set target fps: "+this.fps)),this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" beauty video processor: width "+n.width+" height "+n.height),t&&e?(this.canvasEl.width=t,this.canvasEl.height=e,this.videoEl.setAttribute("width",t.toString()),this.videoEl.setAttribute("height",e.toString()),this.manager.init(t,e,this.canvasEl),[2,this.canvasEl.captureStream().getVideoTracks()[0]]):(this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" resolution of track is wrong"),[2])}})})},c.prototype.setInput=function(o,n){return n===void 0&&(n=!1),m(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return o===this.input?[3,6]:o.kind!==this.kind?(this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" kind of track is not video"),[2]):(this.output&&this.input===this.output&&this.logger.error(T.PUBLISH_SET_BEAUTY_EFFECT+" input track is same as effect track"),this.logger.info(T.PUBLISH_SET_BEAUTY_EFFECT+" change input track"),n?this.input?[4,this.removeInput()]:[3,2]:[3,5]);case 1:t.sent(),t.label=2;case 2:return this.input=o,this.enabled&&!this.videoEl?[4,this.startEffect()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[3,6];case 5:this.input=o,this.videoEl&&(this.videoEl.srcObject=new MediaStream([this.input])),t.label=6;case 6:return[2]}})})},c.prototype.removeInput=function(){return m(this,void 0,void 0,function(){return h(this,function(o){switch(o.label){case 0:return this.input=void 0,[4,this.stopEffect()];case 1:return o.sent(),[2]}})})},c.prototype.updateOutput=function(o){return m(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return this.output===o?[3,3]:(this._output=o,this.onOutputChange?[4,this.onOutputChange(this._output)]:[3,2]);case 1:n.sent(),n.label=2;case 2:n.label=3;case 3:return[2]}})})},c.prototype.onOutputChange=function(o){return m(this,void 0,void 0,function(){return h(this,function(n){return[2]})})},c.prototype.onOverload=function(o){},c}();T.default=a},608:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(c,o,n,t){return new(n||(n=Promise))(function(e,r){function i(p){try{u(t.next(p))}catch(f){r(f)}}function s(p){try{u(t.throw(p))}catch(f){r(f)}}function u(p){var f;p.done?e(p.value):(f=p.value,f instanceof n?f:new n(function(E){E(f)})).then(i,s)}u((t=t.apply(c,o||[])).next())})},h=this&&this.__generator||function(c,o){var n,t,e,r,i={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function s(u){return function(p){return function(f){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,t&&(e=2&f[0]?t.return:f[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,f[1])).done)return e;switch(t=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,t=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(!((e=(e=i.trys).length>0&&e[e.length-1])||f[0]!==6&&f[0]!==2)){i=0;continue}if(f[0]===3&&(!e||f[1]>e[0]&&f[1]<e[3])){i.label=f[1];break}if(f[0]===6&&i.label<e[1]){i.label=e[1],e=f;break}if(e&&i.label<e[2]){i.label=e[2],i.ops.push(f);break}e[2]&&i.ops.pop(),i.trys.pop();continue}f=o.call(c,i)}catch(E){f=[6,E],t=0}finally{n=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([u,p])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.ClientUtil=void 0;var _=I(6706),d=I(3529),l=I(4395),a=function(){function c(){}return c.checkIllegalCharacters=function(o){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(o)&&/^[^:/]*$/g.test(o)},c.isUrl=function(o){return!!(o.startsWith("rtmp://")||o.startsWith("https://")&&o.endsWith(".flv")||o.startsWith("https://")&&o.endsWith(".m3u8"))},c.registerCallback=function(o,n,t){var e,r;n.success&&(e=n.success,t[o+"SuccessCallback"]=e),n.error&&(r=n.error,t[o+"ErrorCallback"]=r)},c.actionErrorCallback=function(o,n){return n[o+"ErrorCallback"]},c.actionSuccessCallback=function(o,n){return n[o+"SuccessCallback"]},c.logReportCallback=function(o,n,t,e){c.registerCallback(o,{success:function(r,i){for(var s=[],u=2;u<arguments.length;u++)s[u-2]=arguments[u];c.dataReportEvent(n,t,r,i,s)}},e)},c.actionLogReportCallback=function(o,n,t,e,r){c.actionSuccessCallback(o,n)&&c.actionSuccessCallback(o,n)(t,e)},c.getServerError=function(o,n,t){if(n)return{code:o,message:t||"liveroom error"};var e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",1013:"token03 format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(o===0)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};if(r.code=o,o>1e9){var i=e[o];r.message=i?"liveroom cmd error, code: "+o+", message: "+i:e[1e9]+o}else r.message=e[o]?e[o]+" code:"+o:"unknown error code:"+o;return r},c.unregisterCallback=function(o,n){delete n[o+"SuccessCallback"],delete n[o+"ErrorCallback"]},c.decodeServerError=function(o,n){var t={code:-1,message:"server error"};return o>1e9&&(t.code=o-1e9+52e6),n&&(t.message=n),t},c.getLiveRoomError=function(o,n){var t={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return n?o>2e5&&o<3e5?t[o-2e5]:o<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[o]||t[o]||"ROOM_INNER_ERROR":t[o]||"ROOM_INNER_ERROR":o>1e9?t[o-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[o]||"ROOM_INNER_ERROR"},c.getKickoutError=function(o){var n={};switch(o){case 1:n.code=63000001,n.message="zpush multiple login kickout",n.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:n.code=63000002,n.message="zpush manual kickout",n.name="MANUAL_KICKOUT";break;case 3:n.code=63000003,n.message="kickout reason = "+o;break;case 4:n.code=63000004,n.message="zpush multiple login kickout",n.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:n.code=63000005,n.message="zpush token expired",n.name="TOKEN_EXPIRED";break;default:n.code=o,n.message="kickout reason = "+o}return n},c.dataReportEvent=function(o,n,t,e,r){switch(t){case"eventStart":o.eventStart(n,e);break;case"eventEndWithMsgInfo":o.eventEndWithMsgInfo(n,e,r[0]);break;case"addEventMsg":o.addEventMsg(n,e,r[0],r[1]);break;case"addEvent":o.addEvent(n,e);break;case"eventEnd":o.eventEnd(n,e);break;case"addMsgInfo":o.addMsgInfo(n,r[0])}},c.isKeepTryLogin=function(o){switch(o){case 1002:case 1003:return!0;default:return!1}},c.mergeStreamList=function(o,n,t,e){var r,i=[],s=[],u=[];t||(t=[]);for(var p=0;p<t.length;p++)if(t[p].anchor_id_name!=o&&t[p].id_name!=o&&t[p].user_id!=o){r=!1;for(var f=0;f<n.length;f++)if(t[p].stream_id===n[f].stream_id){t[p].extra_info!==n[f].extra_info&&u.push(t[p]),r=!0;break}r||i.push(t[p])}for(var E=0;E<n.length;E++){r=!1;for(var y=0;y<t.length;y++)if(n[E].stream_id===t[y].stream_id){r=!0;break}r||s.push(n[E])}for(n.splice(0),p=0;p<t.length;p++)n.push(t[p]);e(i,s,u)},c.checkInteger=function(o,n){return n==0?typeof o=="number"&&o%1==0&&o>=0:typeof o=="number"&&o%1==0&&o>0},c.checkValidNumber=function(o,n,t){return n=n||1,t=t||1e4,typeof o=="number"&&o%1==0&&o>=n&&o<=t},c.uuid=function(o,n){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];if(n=n||e.length,o)for(t=0;t<o;t++)r[t]=e[0|Math.random()*n];else{var i=void 0;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",t=0;t<36;t++)r[t]||(i=0|16*Math.random(),r[t]=e[t==19?3&i|8:i])}return r.join("")},c.supportDetection=function(o,n,t,e){return m(this,void 0,void 0,function(){var r,i,s,u,p,f,E,y;return h(this,function(b){switch(b.label){case 0:return r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:o,errInfo:{}},e&&e==="screenSharing"?(n({result:o,errInfo:r.errInfo}),[2]):e&&e!=="customCapture"||(((i=document.createElement("video")).captureStream||i.mozCaptureStream)&&(r.customCapture=!0),e!=="customCapture")?(s=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.location.protocol!=="https:"&&window.location.protocol!=="file:"&&window.location.hostname.indexOf("127.0.0.1")==-1&&window.location.hostname.indexOf("localhost")==-1,e&&e!=="camera"&&e!=="microphone"?[3,9]:s?u?(r.camera=!1,console.error("webrtc requires https or localhost"),[3,9]):[3,1]:[3,9]):(n({result:r.customCapture,errInfo:r.errInfo}),[2]);case 1:if(e&&e!=="camera")return[3,5];b.label=2;case 2:return b.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 3:return(p=b.sent())&&(r.camera=!0)&&p.getTracks().forEach(function(S){return S.stop()}),[3,5];case 4:return f=b.sent(),r.errInfo.camera={name:f.name,message:f.message},console.error("camera devices detect error: ",f.name,f.message),[3,5];case 5:if(e&&e!=="microphone")return[3,9];b.label=6;case 6:return b.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 7:return(E=b.sent())&&(r.microphone=!0)&&E.getTracks().forEach(function(S){return S.stop()}),[3,9];case 8:return y=b.sent(),r.errInfo.microphone={name:y.name,message:y.message},console.error("microphone devices detect error: ",y.name,y.message),[3,9];case 9:return e==="camera"||e==="microphone"?(n({result:r[e],errInfo:r.errInfo}),[2]):(this.supportVideoCodeType(function(S,k){e||(r.videoCodec.H264=S.H264,r.videoCodec.H265=S.H265,r.videoCodec.VP8=S.VP8,r.videoCodec.VP9=S.VP9,r.webRTC=S.webRTC),k&&(typeof k=="string"?r.errInfo.extendedDate=k:r.errInfo.webRTC={name:k.name,message:k.message},console.error("videoCodec detect error: "+k)),n&&n(e?{result:S[e],errInfo:r.errInfo}:r)},t,e),[2])}})})},c.getDevices=function(o,n){navigator.mediaDevices!==void 0&&navigator.mediaDevices.enumerateDevices!==void 0?navigator.mediaDevices.enumerateDevices().then(function(t){for(var e=[],r=[],i=[],s=0;s<t.length;s++){var u=t[s];u.kind==="audioinput"&&e.push({deviceName:u.label,deviceID:u.deviceId}),u.kind==="audiooutput"&&r.push({deviceName:u.label,deviceID:u.deviceId}),u.kind==="videoinput"&&i.push({deviceName:u.label,deviceID:u.deviceId})}o&&o({microphones:e,speakers:r,cameras:i})}).catch(function(t){console.error("enumerate devices wrong "+t),n&&n(d.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)}):n&&n(d.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},c.compareVersion=function(o,n){o=o.split("."),n=n.split(".");for(var t=Math.max(o.length,n.length);o.length<t;)o.push("0");for(;n.length<t;)n.push("0");for(var e=0;e<t;e++){var r=parseInt(o[e]),i=parseInt(n[e]);if(r>i)return 1;if(r<i)return-1}return 0},c.isSupportLive=function(o,n){var t=wx.getSystemInfoSync().SDKVersion,e={code:0,msg:""};this.compareVersion(t,"1.7.0")<0&&(e={code:10001,msg:"\u5F53\u524D\u5FAE\u4FE1\u7248\u672C\u8FC7\u4F4E\uFF0C\u65E0\u6CD5\u4F7F\u7528\u76F8\u5173\u7EC4\u4EF6"},o&&o(e)),wx.getSetting({success:function(r){var i=r.authSetting;i["scope.camera"]&&i["scope.record"]||(e={code:10002,msg:"\u9700\u8981\u6444\u50CF\u5934\u548C\u5F55\u97F3\u529F\u80FD\u7684\u6388\u6743"}),o&&o(e)},fail:function(r){console.error("get setting error",r),n&&n(r)}})},c.supportVideoCodeType=function(o,n,t){return m(this,void 0,void 0,function(){var e,r,i,s,u,p,f,E,y,b;return h(this,function(S){switch(S.label){case 0:return e={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1},t?n!==1||t!=="VP8"&&t!=="H264"?[3,2]:[4,(b=new l.CheckModule).checkSupportByType(t)]:[3,2];case 1:return typeof(r=S.sent())=="boolean"?(e[t]=r,[2,o(e)]):(e[t]=!1,[2,o(e,r)]);case 2:if(t!=="webRTC"&&n!==1)return[3,7];S.label=3;case 3:return S.trys.push([3,5,,6]),[4,new RTCPeerConnection().createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 4:return S.sent(),e.webRTC=!0,[3,6];case 5:return i=S.sent(),o&&o(e,i),[3,6];case 6:if(t==="webRTC")return[2,o(e)];S.label=7;case 7:if(n===1){for(s="",p=[],f=0,E=u=["VP8","H264"];f<E.length;f++)y=E[f],b=new l.CheckModule,p.push(b.checkSupportByType(y));return Promise.all(p).then(function(k){k.forEach(function(O,g){typeof O=="boolean"?e[u[g]]=!0:(e[u[g]]=!1,s=O)}),s?o(e,s):o(e)}),[2]}try{new RTCPeerConnection().createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(k){if(e.webRTC=!0,k&&k.sdp){var O=k.sdp.split(`\r
`);if(e.H264=O.some(function(g){return g.startsWith("a=rtpmap:")&&g.indexOf("H264/")>-1}),t==="H264"||(e.VP8=O.some(function(g){return g.startsWith("a=rtpmap:")&&g.indexOf("VP8/")>-1}),t==="VP8"))return o(e);e.VP9=O.some(function(g){return g.startsWith("a=rtpmap:")&&g.indexOf("VP9/")>-1}),e.H265=O.some(function(g){return g.startsWith("a=rtpmap:")&&g.indexOf("H265/")>-1}),o&&o(e)}})}catch(k){o&&o(e,k)}return[2]}})})},c.getPublisherStateType=function(o){return o==0||o==1?o==0?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},c.getPlayerStateType=function(o){return o==0||o==1?o==0?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},c.getSteamUpdateType=function(o){return o==0?"DELETE":"ADD"},c.checkScreenParams=function(o,n){if(typeof o=="object"&&o.videoQuality!==void 0&&!c.checkInteger(o.videoQuality))return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if(typeof o=="object"&&o.sourceID!==void 0&&typeof o.sourceID!="string")return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," sourceID must be string"),!1;if(typeof o=="object"&&o.videoQuality===4){if(o.bitRate===void 0)return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!c.checkInteger(o.bitRate))return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(o.bitRate>10240)return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(o.frameRate===void 0)return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!c.checkInteger(o.frameRate))return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(o.width===void 0)return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!c.checkInteger(o.width))return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(o.height===void 0)return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!c.checkInteger(o.height))return n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},c.checkCameraParams=function(o,n){return o.width&&c.checkValidNumber(o.width)?o.height&&c.checkValidNumber(o.height)?o.frameRate&&c.checkValidNumber(o.frameRate)?!(!o.bitRate||!c.checkValidNumber(o.bitRate))||(n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(n(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},c.isParamEmpty=function(o){return o!=null&&o!==""},c.isTypeString=function(o){return typeof o=="string"},c.isTooLong=function(o,n){return!(o.length>=n)},c.isReDispatch=function(o){var n=o.message.match(/action:(\d+)/),t=n?Number(n[1]):NaN;return[d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(o)||[6].includes(t)},c.arrAvg=function(o,n,t){return o.push(n),o.length>t&&o.shift(),o.reduce(function(e,r){return e+r})/o.length},c.getNetQuality=function(o,n,t){return t!==void 0?.15*this.calcQualityOfJitter(t)+.85*Math.min(this.calcQualityOfRtt(o),this.calcQualityOfLostRate(n,!1)):Math.min(this.calcQualityOfRtt(o),this.calcQualityOfLostRate(n,!0))},c.calcQualityOfRtt=function(o){return o<600?97-Math.pow(.09*o,1.1):18*Math.exp(.002*(600-o))},c.calcQualityOfJitter=function(o){return o<=50?98-Math.pow(o,1.15):_.QUALITY_CONSTANT.PoorMinQuality},c.calcQualityOfLostRate=function(o,n){if(n){var t=o;return t<=55?99-Math.pow(.8*t,1.18):_.QUALITY_CONSTANT.PoorMinQuality}var e=100*o;return e<=40?96-Math.pow(e,1.22):_.QUALITY_CONSTANT.PoorMinQuality},c.quality2QualityGrade=function(o){return _.QualityGrade.Unknown,o>=_.QUALITY_CONSTANT.ExcellentMinQuality?_.QualityGrade.Excellent:o>=_.QUALITY_CONSTANT.GoodMinQuality?_.QualityGrade.Good:o>=_.QUALITY_CONSTANT.MiddleMinQuality?_.QualityGrade.Middle:o>=_.QUALITY_CONSTANT.PoorMinQuality?_.QualityGrade.Poor:_.QualityGrade.Die},c.checkAudioTrackIsActive=function(o){return!!o.enabled},c.checkVideoTrackIsActive=function(o){return!!o.enabled},c}();T.ClientUtil=a},6502:function(W,T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RetryHandler=void 0;var I=function(){function m(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return m.prototype.init=function(h,_,d,l){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,typeof h=="number"&&h<3600&&(this.RETRY_MAX_TIME=h),typeof _=="number"&&(this.RETRY_START_TIME_INTERVAL=_),typeof d=="number"&&(this.RETRY_CONTINUE_COUNT=d),typeof l=="number"&&(this.RETRY_MAX_TIME_INTERVAL=l)},m.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.startRetryTimer&&clearTimeout(this.startRetryTimer),this.startRetryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},m.prototype.isRetrying=function(){return this.retryTimer!==null||this.startRetryTimer!==null||this.maxTimer!==null},m}();T.RetryHandler=I},4767:function(W,T){"use strict";var I=this&&this.__spreadArrays||function(){for(var h=0,_=0,d=arguments.length;_<d;_++)h+=arguments[_].length;var l=Array(h),a=0;for(_=0;_<d;_++)for(var c=arguments[_],o=0,n=c.length;o<n;o++,a++)l[a]=c[o];return l};Object.defineProperty(T,"__esModule",{value:!0}),T.SdpUtil=void 0;var m=function(){function h(){}return h.zegoSdp=function(_){var d=_.split(`\r
`),l=[],a=[];d.forEach(function(o){var n=o.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);n&&n[1]&&n[2]&&(n[2]==="H264/90000"&&l.push(n[1]),n[2]==="opus/48000/2"&&a.push(n[1]))});var c=[];return d.map(function(o){var n=!0,t=o.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(t&&t[5]&&(I(l,a).some(function(r){return r==t[5]})||(n=!1)),o.indexOf("m=video")>-1){var e=o.split(" ");o=I([e[0],e[1],e[2]],l).join(" ")}else o.indexOf("m=audio")>-1&&(e=o.split(" "),o=I([e[0],e[1],e[2]],a).join(" "));n&&c.push(o)}),c.join(`\r
`)},h.getSDPByVideDecodeType=function(_,d,l){var a={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OTHER:[]}};if(!_.includes("m=video"))return _;var c=/m=video.+/.exec(_)[0];c=c.match(/[\s|\d]+/g)[1].replace(" ",""),a.str=c,a.arr=a.str.split(" "),a.arr.forEach(function(t){var e=new RegExp("a=rtpmap:"+t+".+").exec(_)[0];e.includes("H264")?a.obj.H264.push(t):e.includes("H265")?a.obj.H265.push(t):e.includes("VP8")?a.obj.VP8.push(t):e.includes("VP9")?a.obj.VP9.push(t):a.obj.OTHER.push(t)}),a.obj.OTHER.forEach(function(t){var e=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(_),r=e&&e[1];r&&(a.obj.H264.includes(r)?a.obj.H264.push(t):a.obj.H265.includes(r)?a.obj.H265.push(t):a.obj.VP8.includes(r)?a.obj.VP8.push(t):a.obj.VP9.includes(r)&&a.obj.VP9.push(t))});var o=[];if(d==="VP9"?o=I(a.obj.H265,a.obj.H264,a.obj.VP8):d==="VP8"?o=I(a.obj.H265,a.obj.H264,a.obj.VP9):d==="H264"?o=I(a.obj.H265,a.obj.VP8,a.obj.VP9):d==="H265"&&(o=I(a.obj.VP8,a.obj.H264,a.obj.VP9)),l&&d=="H264"){var n=[];a.obj.H264.forEach(function(t){var e=new RegExp("a=fmtp:"+t+".+\\s\\n","g").exec(_);(e==null?void 0:e.find(function(r){return r.includes("profile-level-id=42e01f")}))||n.push(t)}),n.length==a.obj.H264.length&&(n=[]),o=o.concat(n)}return o.forEach(function(t){var e=a.arr.indexOf(t);a.arr.splice(e,1);var r=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),i=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),s=new RegExp("a=fmtp:"+t+".+\\s\\n","g");_=(_=(_=_.replace(r,"")).replace(i,"")).replace(s,"")}),_=_.replace(c,a.arr.join(" "))},h}();T.SdpUtil=m},5321:function(W,T,I){"use strict";var m=this&&this.__createBinding||(Object.create?function(O,g,v,R){R===void 0&&(R=v),Object.defineProperty(O,R,{enumerable:!0,get:function(){return g[v]}})}:function(O,g,v,R){R===void 0&&(R=v),O[R]=g[v]}),h=this&&this.__setModuleDefault||(Object.create?function(O,g){Object.defineProperty(O,"default",{enumerable:!0,value:g})}:function(O,g){O.default=g}),_=this&&this.__importStar||function(O){if(O&&O.__esModule)return O;var g={};if(O!=null)for(var v in O)v!=="default"&&Object.prototype.hasOwnProperty.call(O,v)&&m(g,O,v);return h(g,O),g},d=this&&this.__awaiter||function(O,g,v,R){return new(v||(v=Promise))(function(L,N){function w(Z){try{x(R.next(Z))}catch(V){N(V)}}function B(Z){try{x(R.throw(Z))}catch(V){N(V)}}function x(Z){var V;Z.done?L(Z.value):(V=Z.value,V instanceof v?V:new v(function(Y){Y(V)})).then(w,B)}x((R=R.apply(O,g||[])).next())})},l=this&&this.__generator||function(O,g){var v,R,L,N,w={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return N={next:B(0),throw:B(1),return:B(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function B(x){return function(Z){return function(V){if(v)throw new TypeError("Generator is already executing.");for(;w;)try{if(v=1,R&&(L=2&V[0]?R.return:V[0]?R.throw||((L=R.return)&&L.call(R),0):R.next)&&!(L=L.call(R,V[1])).done)return L;switch(R=0,L&&(V=[2&V[0],L.value]),V[0]){case 0:case 1:L=V;break;case 4:return w.label++,{value:V[1],done:!1};case 5:w.label++,R=V[1],V=[0];continue;case 7:V=w.ops.pop(),w.trys.pop();continue;default:if(!((L=(L=w.trys).length>0&&L[L.length-1])||V[0]!==6&&V[0]!==2)){w=0;continue}if(V[0]===3&&(!L||V[1]>L[0]&&V[1]<L[3])){w.label=V[1];break}if(V[0]===6&&w.label<L[1]){w.label=L[1],L=V;break}if(L&&w.label<L[2]){w.label=L[2],w.ops.push(V);break}L[2]&&w.ops.pop(),w.trys.pop();continue}V=g.call(O,w)}catch(Y){V=[6,Y],R=0}finally{v=L=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([x,Z])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoWebRTC=void 0;var a=I(6706),c=I(608),o=I(7325),n=I(1089),t=I(3529),e=I(908),r=I(3409),i=I(7560),s=I(1547),u=_(I(5515)),p=I(3770),f=I(4865),E=I(361),y=I(5019),b=I(9595),S=I(9595),k=function(){function O(g,v,R,L){var N=this;L===void 0&&(L=0),this.mediaEleSources=[],this.logger=g,this.dataReport=v,this.ac=new(typeof webkitAudioContext!="undefined"?webkitAudioContext:AudioContext),this.ac.addEventListener("statechange",function(){N.ac.state==="suspended"&&N.ac.resume()}),this.checkAudioContext(),this.stateCenter=new o.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="webrtc",this.stateCenter.type=L===2?"PRIVATE":"PUBLIC",this.RTM=R,this.streamCenter=new r.ZegoStreamCenterWeb(this.logger,this.stateCenter,this.dataReport,this.RTM,this.ac,this.mediaEleSources),this.rtcModules=new e.RTCModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM,this.ac),this.stateCenter.getSeq=a.getSeq,this.stateCenter.getReportSeq=a.getReportSeq,this.stateCenter.networkState=navigator?navigator.onLine?a.ENUM_NETWORK_STATE.online:a.ENUM_NETWORK_STATE.offline:a.ENUM_NETWORK_STATE.online,this.stateCenter.browser=u.browserDetails.browser,this.stateCenter.settingConfig=new S.ZegoSettingConfig,this.RTM.cloudSetting.setEnvVariable("sdk_version",a.PROTO_VERSION),this.RTM.cloudSetting.getSettingCache(b.RTC).then(function(w){N.logger.info(n.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(w));var B=a.getReportSeq();N.dataReport.newReport(B,t.ZegoRTCLogEvent.kZegoTaskCloudSettingCache.event),N.dataReport.addMsgInfo(B,{files:[{name:b.RTC,content:w==null?void 0:w.setting,versions:w==null?void 0:w.versions}]}),N.dataReport.uploadReport(B),N.stateCenter.settingConfig.setSetting(w==null?void 0:w.setting)}).catch(function(w){N.logger.warn(n.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(w))})}return O.prototype.checkAudioContext=function(){var g=this;if(this.ac&&this.ac.state==="suspended"){var v=function(){g.ac.resume(),window.removeEventListener("click",v),window.removeEventListener("touchstart",v)};window.addEventListener("click",v),window.addEventListener("touchstart",v)}},O.prototype.mutePublishStreamVideo=function(g,v,R){return!1},O.prototype.mutePublishStreamAudio=function(g,v){return!1},O.prototype.mutePlayStreamVideo=function(g,v){return new Promise(function(R,L){console.error("should install advanced module"),R(!1)})},O.prototype.mutePlayStreamAudio=function(g,v){return new Promise(function(R,L){console.error("should install advanced module"),R(!1)})},O.prototype.muteMicrophone=function(g){return!1},O.prototype.isMicrophoneMuted=function(){return!this.streamCenter.isMicEnabled},O.prototype.setAudioOutput=function(g,v){return this.logger.info(n.ZEGO_WEBRTC_ACTION.SET_AUDIO_OUTPUT+" call"),typeof v!="string"?(this.logger.error("audiooutput is not string"),!1):this.rtcModules.playModule.setStreamAudioOutput(g,v)},O.prototype.setCustomSignalUrl=function(g){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" call: "+g),g&&g.length!=0){var v=!0;g.forEach(function(R){return R.indexOf("wss://")!=0&&(v=!1)}),v?this.stateCenter.customUrl=g:this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" url is not correct")}else this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" param error")},O.prototype.setGWNode=function(g){typeof g=="string"&&g.length>0&&(this.streamCenter.gwNode=g)},O.prototype.setQualityMonitorCycle=function(g){return typeof g=="number"&&g>=1e3?(this.streamCenter.setQualityMonitorCycle(g),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},O.prototype.startPlayingStream=function(g,v,R){return this.logger.info(n.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.startPlayingStream(g,v,R)},O.prototype.stopPlayingStream=function(g){this.logger.info(n.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.stopPlayingStream(g)},O.prototype.setPlayAccelerate=function(g){this.stateCenter.playAccelerate=g},O.prototype.setTurnOverTcpOnly=function(g){this.logger.info(n.ZEGO_WEBRTC_ACTION.SET_TURN_OVER_TCP_ONLY+" call "+g),typeof g=="boolean"?this.stateCenter.turnOverTcpOnly=g:this.logger.error("zc.p.stoto.0 param must be param")},O.prototype.createStream=function(g){return this.rtcModules.publishModule.createStream(g)},O.prototype.destroyStream=function(g){this.rtcModules.publishModule.destroyStream(g)},O.prototype.startPublishingStream=function(g,v,R,L){return this.logger.info(n.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.startPublishingStream(g,v,R,L)},O.prototype.activateSEIInsert=function(g){return console.error("should install advanced module"),!1},O.prototype.stopPublishingStream=function(g){return this.logger.info(n.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.stopPublishingStream(g)},O.prototype.setVideoConfig=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setVideoConfig(g,v):new Promise(function(R,L){console.error("should install advanced module"),R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.setAudioConfig=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setAudioConfig(g,v):new Promise(function(R,L){console.error("should install advanced module"),R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.replaceTrack=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.replaceTrack(g,v):new Promise(function(R,L){console.error("should install advanced module"),R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.preloadEffect=function(g,v,R){this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.preloadEffect(g,v,R):console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757")},O.prototype.getEffectDuration=function(g){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.getEffectDuration(g):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),0)},O.prototype.getEffectCurrentProgress=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.getEffectProgress(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),0)},O.prototype.seekAudioEffect=function(g,v,R){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.seekAudioEffect(g,v,R):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.playEffect=function(g,v,R){this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.playEffect(g,v,R):console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757")},O.prototype.pauseEffect=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.pauseEffect(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.resumeEffect=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.resumeEffect(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.stopEffect=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.stopEffect(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.unloadEffect=function(g){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.unloadEffect(g):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.setEffectVolume=function(g,v,R){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.setEffectVolume(g,v,R):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.startMixingAudio=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.startMixingAudio(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.stopMixingAudio=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.stopMixingAudio(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.mixingBuffer=function(g,v,R,L){this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.mixingBuffer(g,v,R,L):console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757")},O.prototype.stopMixingBuffer=function(g,v){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.stopMixingBuffer(g,v):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.setMixingAudioVolume=function(g,v,R){return this.rtcModules.audioMixModule!==void 0?this.rtcModules.audioMixModule.setMixingAudioVolume(g,v,R):(console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757"),!1)},O.prototype.checkSystemRequirements=function(g,v){var R=this,L=navigator&&navigator.mediaDevices&&(O.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return this.logger.info(n.ZEGO_WEBRTC_ACTION.CHECK_SUPPORT+" call"+navigator.userAgent),new Promise(function(N){var w=a.getReportSeq();R.dataReport.newReport(w,t.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.event);var B=v||"all",x=function(Z){R.dataReport.addMsgInfo(w,{capability:t.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.capability(Z)}),R.dataReport.uploadReport(w);var V=R.stateCenter.checkList.indexOf(B);R.stateCenter.checkList.splice(V,1),N(Z)};return["webRTC","customCapture","camera","microphone","screenSharing","H264","VP8","all"].includes(B)&&[0,1].includes(g)?R.stateCenter.checkList.includes(B)||R.stateCenter.checkList.includes("all")?x({result:!1,errInfo:{extendedDate:"The last test of the same type has not returned a result "}}):(R.stateCenter.checkList.push(B),void c.ClientUtil.supportDetection(L,x,g,v)):x({result:!1,errInfo:{extendedDate:"param error"}})})},O.prototype.enumDevices=function(g,v){return d(this,void 0,void 0,function(){var R,L,N,w,B,x,Z,V,Y,te,F,K,J,oe,ae=this;return l(this,function(ee){switch(ee.label){case 0:return this.logger.info("zc.ed.0 call"),R=function(){return new Promise(function(se,de){var ge=a.getReportSeq();ae.dataReport.newReport(ge,t.ZegoRTCLogEvent.kZegoTaskEnumDevices.event),ae.rtcModules.publishModule.recordDevices(function(me){var le=[],Te=!0,Re=!0;me.cameras.forEach(function(pe){pe.deviceID===""&&(Te=!1),le.push({device:pe.deviceName,type:0})}),me.microphones.forEach(function(pe){pe.deviceID===""&&(Re=!1),le.push({device:pe.deviceName,type:1})}),me.speakers.forEach(function(pe){return le.push({device:pe.deviceName,type:2})}),ae.dataReport.addMsgInfo(ge,{dev_list:t.ZegoRTCLogEvent.kZegoTaskEnumDevices.dev_list(le)}),ae.dataReport.uploadReport(ge),se({devices:me,enableCamera:Te,enableMic:Re})},function(me){ae.dataReport.addMsgInfo(ge,me),ae.dataReport.uploadReport(ge),de(me)})})},[4,R()];case 1:return L=ee.sent(),N=L.devices,w=L.enableCamera,B=L.enableMic,x=N,g?(this.logger.info("zc.ed.0 check permission"),Z={video:!0,audio:!0},v==="videoinput"?Z.audio=!1:v!=="audioinput"&&v!=="audiooutput"||(Z.video=!1),V=Z.video&&!w,Y=Z.audio&&!B,V||Y?(this.logger.info("zc.ed.0 need to get device permission. needCamera: "+V+", needMic: "+Y),[4,navigator.mediaDevices.getUserMedia(Z).catch(function(){})]):[3,4]):[3,4];case 2:return(te=ee.sent())&&te.getTracks().forEach(function(se){se.stop()}),[4,R()];case 3:F=ee.sent(),K=F.devices,J=F.enableCamera,oe=F.enableMic,Z.video&&!J&&this.logger.warn("zc.ed.0 get video device permission failed."),Z.audio&&!oe&&this.logger.warn("zc.ed.0 get audio device permission failed."),x=K,ee.label=4;case 4:return[2,x]}})})},O.prototype.getCameras=function(){return d(this,void 0,void 0,function(){return l(this,function(g){switch(g.label){case 0:return[4,this.enumDevices(!0,"videoinput")];case 1:return[2,g.sent().cameras]}})})},O.prototype.getMicrophones=function(){return d(this,void 0,void 0,function(){return l(this,function(g){switch(g.label){case 0:return[4,this.enumDevices(!0,"audioinput")];case 1:return[2,g.sent().microphones]}})})},O.prototype.getSpeakers=function(){return d(this,void 0,void 0,function(){return l(this,function(g){switch(g.label){case 0:return[4,this.enumDevices(!0,"audiooutput")];case 1:return[2,g.sent().speakers]}})})},O.prototype.getAudioInfo=function(g,v,R){},O.prototype.getSoundLevel=function(g,v,R){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.getSoundLevel(g,v,R):console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757")},O.prototype.stopSoundLevel=function(g){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopSoundLevel(g):console.error("\u672A\u5F15\u5165\u6DF7\u97F3\u6A21\u5757")},O.handleDataAvailable=function(g){g.data&&g.data.size>0&&O.recordedBlobs.push(g.data)},O.prototype.startRecord=function(g){},O.prototype.stopRecord=function(){},O.prototype.resumeRecord=function(){},O.prototype.pauseRecord=function(){},O.prototype.saveRecord=function(g){},O.prototype.takeSnapShot=function(g,v){},O.prototype.saveSnapShot=function(g,v){},O.prototype.useVideoDevice=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useVideoDevice(g,v):new Promise(function(R,L){R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.useAudioDevice=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useAudioDevice(g,v):(console.error("should use advanced module first"),new Promise(function(R,L){R({errorCode:-1,extendedData:"should install advanced module"})}))},O.prototype.getElectronScreenSources=function(){return this.rtcModules.publishModule.getElectronScreenSources()},O.prototype.setSoundLevelDelegate=function(g,v,R){this.logger.info("zc.ssd.0 call"),typeof g=="boolean"?v&&(!this.stateCenter.checkInteger(v)||v<100||v>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(g,v,R):this.logger.error("zc.ssd.0 param 1 must be boolean")},O.prototype.on=function(g,v){return this.rtcModules.bindListener(g,v)},O.prototype.off=function(g,v){return this.rtcModules.deleteListener(g,v)},O.prototype.getVersion=function(){return a.PROTO_VERSION},O.prototype.setStreamExtraInfo=function(g,v){return new Promise(function(R,L){console.error("should use advanced module first"),L()})},O.prototype.addPublishCdnUrl=function(g,v){return this.logger.info("zg.cm.apu call ",g,v),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"addpush",streamID:g,pushUrl:v}):new Promise(function(R,L){console.error("should install advanced module"),R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.removePublishCdnUrl=function(g,v){return this.logger.info("zg.cm.apu call ",g,v),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"delpush",streamID:g,pushUrl:v}):new Promise(function(R,L){console.error("should install advanced module"),R({errorCode:-1,extendedData:"should install advanced module"})})},O.prototype.startMixerTask=function(g){return new Promise(function(v,R){console.error("\u672A\u5F15\u5165\u6DF7\u6D41\u6A21\u5757"),R()})},O.prototype.setMixerTaskConfig=function(g){return new Promise(function(v,R){console.error("\u672A\u5F15\u5165\u6DF7\u6D41\u6A21\u5757"),R()})},O.prototype.stopMixerTask=function(g){return new Promise(function(v,R){console.error("\u672A\u5F15\u5165\u6DF7\u6D41\u6A21\u5757"),R()})},O.prototype.setCaptureVolume=function(g,v){return this.rtcModules.publishModule.setCaptureVolume(g,v)},O.use=function(g){switch(g.type){case"AudioMix":g.install(e.RTCModules,s.ZegoPublish);break;case"MixStream":g.install(O,i.StreamHandler,e.RTCModules);break;case"Advance":g.install(O,e.RTCModules,i.StreamHandler,p.ZegoPreview,f.PlayModule,E.PublishModule,s.ZegoPublish,y.ZegoSignal);break;case"BeautyEffect":g.install(O,p.ZegoPreview);break;case"RangeAudio":case"DataChannel":g.install(O)}},O.prototype.createRangeAudioInstance=function(){throw new Error("should use range audio module")},O.prototype.createRealTimeSequentialDataManager=function(g){throw new Error("should use datachannel module")},O.prototype.destroyRealTimeSequentialDataManager=function(g){throw new Error("should use datachannel module")},O.prototype.enableDataChannel=function(g){typeof g=="boolean"&&(this.streamCenter.isDataChannelEnabled=g)},O.prototype.addTrack=function(g,v){return new Promise(function(R,L){throw new Error("use advanced module first")})},O.prototype.removeTrack=function(g,v){return new Promise(function(R,L){throw new Error("use advanced module first")})},O.prototype.setBeautyEffect=function(g,v,R){return new Promise(function(L,N){console.error("should install video effect module and advanced module"),L({errorCode:-1,extendedData:"should install video effect module and advanced module"})})},O.prototype.getPublishingStreamQuality=function(g){return this.rtcModules.publishModule.getStreamStats(g)},O.prototype.getPlayingStreamQuality=function(g){return this.rtcModules.playModule.getStreamStats(g)},O.prototype.checkAudioTrackIsActive=function(g){return MediaStreamTrack instanceof g&&g.kind==="video"?c.ClientUtil.checkAudioTrackIsActive(g):(this.logger.error("zc.caia.0 track type error"),!1)},O.prototype.checkVideoTrackIsActive=function(g){return MediaStreamTrack instanceof g&&g.kind==="audio"?c.ClientUtil.checkVideoTrackIsActive(g):(this.logger.error("zc.cvia.0 track type error"),!1)},O.prototype.setDummyCaptureImagePath=function(g,v){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setDummyCaptureImagePath(g,v):new Promise(function(R,L){console.error("should install advanced module"),R(!1)})},O.prototype.setAccess=function(g){this.RTM.setAccess(g),this.stateCenter.useNetAgent=g},O.prototype.setAudioOutputDevice=function(g,v){var R;return d(this,void 0,void 0,function(){var L;return l(this,function(N){switch(N.label){case 0:return(L=(R=g)===null||R===void 0?void 0:R.setSinkId)?(g.setsinkid&&(g.setsinkid.enabled=!0),[4,L.call(g,v)]):[3,2];case 1:return N.sent(),[2,!0];case 2:throw Error("Browser not support set audio output.")}})})},O.prototype.enableCameraCapturing=function(g,v){return v===void 0&&(v=!0),d(this,void 0,void 0,function(){return l(this,function(R){return console.error("should use advanced module first"),[2,!1]})})},O.screenShotReady=!1,O}();T.ZegoWebRTC=k,window.addEventListener("message",function(O){var g=O.data.type,v=O.origin;v!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",v),g==="SS_PING"&&(k.screenShotReady=!0)})},746:function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.AnalogSocket=void 0;var m,h,_=I(4119),d=I(1089);(function(a){a[a.Connected=0]="Connected",a[a.Disconnected=1]="Disconnected",a[a.Broken=2]="Broken"})(m||(m={})),function(a){a[a.AUTO=0]="AUTO",a[a.MANUAL=1]="MANUAL"}(h||(h={}));var l=function(){function a(c,o,n,t){var e=this;this.server=c,this.netAgent=o,this.signalConfig=n,this.logger=t,this.readyState=WebSocket.CLOSED,this.isActive=!1,this.accessServerState=m.Disconnected,this.originAccessServerState=m.Disconnected,this.mediaServerState=m.Disconnected,this.originMediaServerState=m.Disconnected,this.eventHandler={accessDisconnect:function(){e.setAccessServerState(m.Disconnected)},accessConnect:function(){e.setAccessServerState(m.Connected)},accessBroken:function(){e.setAccessServerState(m.Broken)},mediaDisconnect:function(){e.setMediaServerState(m.Disconnected)},mediaConnect:function(r){e.setMediaServerState(m.Connected,r)},mediaBroken:function(){e.setMediaServerState(m.Broken)}},this.wsHandler=o.getPCRequest(c==="unified_rtc"?_.BusinessService.SERVICE_WEBRTC_SIGNAL:_.BusinessService.SERVICE_L3_WEBRTC_SIGNAL,n.path,n.query),this.setAccessServerState(o.isConnect()?m.Connected:m.Disconnected),this.setMediaServerState(this.wsHandler.connectState===0?m.Connected:m.Disconnected)}return a.prototype.updateAccessReadyState=function(){this.isActive&&this.accessServerState===m.Connected&&this.mediaServerState!==m.Connected?this.onreconnnecting&&this.onreconnnecting():this.accessServerState===m.Disconnected&&this.logger.warn(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_UPDATE_ACCESS_READY_STATE+" access timeout")},a.prototype.updateMediaReadyState=function(c){return this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_UPDATE_MEDIA_READY_STATE+" "+c),this.mediaServerState===m.Connected?(this.originMediaServerState===m.Broken&&c===h.AUTO&&this.onreconnnecting&&this.onreconnnecting(),void(this.readyState!==WebSocket.OPEN&&(this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()))):this.mediaServerState===m.Disconnected?(this.wsHandler.off("connected",this.eventHandler.mediaConnect),this.wsHandler.off("disconnected",this.eventHandler.mediaDisconnect),this.wsHandler.off("broken",this.eventHandler.mediaBroken),this.wsHandler.off("downLoadMessage"),this.netAgent.off("connected",this.eventHandler.accessConnect),this.netAgent.off("disconnected",this.eventHandler.accessDisconnect),this.netAgent.off("broken",this.eventHandler.accessBroken),void(this.readyState!==WebSocket.CLOSED&&(this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose()))):void(this.mediaServerState===m.Broken&&(this.readyState=WebSocket.CONNECTING,this.onerror&&this.onerror(new Event("signal connecting"))))},a.prototype.setMediaServerState=function(c,o){this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SET_MEDIA_SERVER_STATE+" "+c+" "+o),this.mediaServerState!==c?(this.originMediaServerState=this.mediaServerState,this.mediaServerState=c,this.updateMediaReadyState(o)):this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SET_MEDIA_SERVER_STATE+" same state")},a.prototype.setAccessServerState=function(c){this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SET_ACCESS_SERVER_STATE+" "+c),this.accessServerState!==c?(this.originAccessServerState=this.accessServerState,this.accessServerState=c,this.updateAccessReadyState()):this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SET_ACCESS_SERVER_STATE+" same state")},a.prototype.open=function(){var c=this;this.isActive=!0,this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_OPEN+" state "+this.mediaServerState),this.mediaServerState===m.Disconnected&&(this.wsHandler.on("connected",this.eventHandler.mediaConnect),this.wsHandler.on("disconnected",this.eventHandler.mediaDisconnect),this.wsHandler.on("broken",this.eventHandler.mediaBroken),this.netAgent.on("connected",this.eventHandler.accessConnect),this.netAgent.on("disconnected",this.eventHandler.accessDisconnect),this.netAgent.on("broken",this.eventHandler.accessBroken),this.wsHandler.on("downLoadMessage",function(o){c.logger.info("zc.as.op download msg "+o),c.onmessage({data:o})}))},a.prototype.close=function(){this.isActive=!1,this.wsHandler.off("connected",this.eventHandler.mediaConnect),this.wsHandler.off("disconnected",this.eventHandler.mediaDisconnect),this.wsHandler.off("broken",this.eventHandler.mediaBroken),this.wsHandler.off("downLoadMessage"),this.netAgent.off("connected",this.eventHandler.accessConnect),this.netAgent.off("disconnected",this.eventHandler.accessDisconnect),this.netAgent.off("broken",this.eventHandler.accessBroken),this.wsHandler.closeRequest()},a.prototype.send=function(c,o){var n=this;c.indexOf("QualityReportReq")==-1&&this.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SEND+" "+c),this.wsHandler.sendRequest({payload:c,ack:o},function(t){n.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SEND+" fail "+t),n.onerror&&n.onerror(t)},function(t){n.logger.info(d.ZEGO_WEBRTC_ACTION.ANALOGSOCKET_SEND+" suc "+t)})},a.prototype.onopen=function(){},a.prototype.onclose=function(c){},a.prototype.onerror=function(c){},a.prototype.onmessage=function(c){},a.prototype.onreconnnecting=function(){},a}();T.AnalogSocket=l},4395:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(l,a,c,o){return new(c||(c=Promise))(function(n,t){function e(s){try{i(o.next(s))}catch(u){t(u)}}function r(s){try{i(o.throw(s))}catch(u){t(u)}}function i(s){var u;s.done?n(s.value):(u=s.value,u instanceof c?u:new c(function(p){p(u)})).then(e,r)}i((o=o.apply(l,a||[])).next())})},h=this&&this.__generator||function(l,a){var c,o,n,t,e={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return t={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(t[Symbol.iterator]=function(){return this}),t;function r(i){return function(s){return function(u){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,o&&(n=2&u[0]?o.return:u[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,u[1])).done)return n;switch(o=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,o=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(!((n=(n=e.trys).length>0&&n[n.length-1])||u[0]!==6&&u[0]!==2)){e=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){e.label=u[1];break}if(u[0]===6&&e.label<n[1]){e.label=n[1],n=u;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(u);break}n[2]&&e.ops.pop(),e.trys.pop();continue}u=a.call(l,e)}catch(p){u=[6,p],o=0}finally{c=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.CheckModule=void 0;var _=I(4767),d=function(){function l(){var a=this;this.iceconnectionstatechangeTimes=0,this.isCheckAll=!1;var c=document.createElement("canvas");c.getContext("2d").fillStyle="rgba(255, 255, 255, 0)";try{this.localStream=c.captureStream()}catch(o){console.error("canvas captureStream error",o)}this.timer=setTimeout(function(){a.resolve("Detection timeout"),a.hangup()},5e3)}return l.prototype.checkSupportByType=function(a){return m(this,void 0,void 0,function(){var c,o,n=this;return h(this,function(t){switch(t.label){case 0:return this.checkType=a,c={},this.localPc=new RTCPeerConnection(c),this.remotePc=new RTCPeerConnection(c),o=new Promise(function(e){return n.resolve=e}),this.localPc.addEventListener("icecandidate",function(e){return n.onIceCandidate(n.localPc,e)}),this.remotePc.addEventListener("icecandidate",function(e){return n.onIceCandidate(n.remotePc,e)}),this.remotePc.addEventListener("iceconnectionstatechange",function(e){n.remotePc.iceConnectionState==="connected"&&(n.iceconnectionstatechangeResult=!0),++n.iceconnectionstatechangeTimes==2&&n.iceCandidate&&(clearTimeout(n.timer),n.remotePc.iceConnectionState==="connected"?n.resolve(!0):n.resolve("The browser does not support "+a+" format"),n.hangup())}),this.localStream.getTracks().forEach(function(e){return n.localPc.addTrack(e,n.localStream)}),[4,this.check(a)];case 1:return t.sent(),[4,o];case 2:return[2,t.sent()]}})})},l.prototype.check=function(a){return m(this,void 0,void 0,function(){var c,o;return h(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.localPc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 1:return(c=n.sent()).sdp=_.SdpUtil.getSDPByVideDecodeType(c.sdp,a),this.onCreateOfferSuccess(c),[3,3];case 2:return o=n.sent(),this.onCreateSessionDescriptionError(o),[3,3];case 3:return[2]}})})},l.prototype.onCreateOfferSuccess=function(a){return m(this,void 0,void 0,function(){var c,o,n,t;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.localPc.setLocalDescription(a)];case 1:return e.sent(),[3,3];case 2:return c=e.sent(),this.onSetSessionDescriptionError(c),[2];case 3:return e.trys.push([3,5,,6]),[4,this.remotePc.setRemoteDescription(a)];case 4:return e.sent(),[3,6];case 5:return o=e.sent(),this.onSetSessionDescriptionError(o),[2];case 6:return e.trys.push([6,9,,10]),[4,this.remotePc.createAnswer()];case 7:return n=e.sent(),[4,this.onCreateAnswerSuccess(n)];case 8:return e.sent(),[3,10];case 9:return t=e.sent(),this.onCreateSessionDescriptionError(t),[2];case 10:return[2]}})})},l.prototype.onCreateAnswerSuccess=function(a){return m(this,void 0,void 0,function(){var c,o;return h(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.remotePc.setLocalDescription(a)];case 1:return n.sent(),[3,3];case 2:return c=n.sent(),this.onSetSessionDescriptionError(c),[2];case 3:return n.trys.push([3,5,,6]),[4,this.localPc.setRemoteDescription(a)];case 4:return n.sent(),[3,6];case 5:return o=n.sent(),this.onSetSessionDescriptionError(o),[2];case 6:return[2]}})})},l.prototype.onIceCandidate=function(a,c){return m(this,void 0,void 0,function(){var o;return h(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getOtherPc(a).addIceCandidate(c.candidate)];case 1:return n.sent(),[3,3];case 2:return o=n.sent(),console.error(this.checkType,this.getPcName(a)+" addIceCandidate error",o),clearTimeout(this.timer),this.hangup(),this.resolve(o),[3,3];case 3:return this.getPcName(a)==="remotePc"&&c.candidate&&(this.iceCandidate=!0),this.iceconnectionstatechangeResult&&this.getPcName(a)==="localPc"&&(clearTimeout(this.timer),this.hangup(),this.resolve(!0)),[2]}})})},l.prototype.getOtherPc=function(a){return a===this.localPc?this.remotePc:this.localPc},l.prototype.getPcName=function(a){return a===this.localPc?"localPc":"remotePc"},l.prototype.onCreateSessionDescriptionError=function(a){console.error("Failed to create session description: "+a.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(a)},l.prototype.onSetSessionDescriptionError=function(a){console.error("Failed to set session description: "+a.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(a)},l.prototype.hangup=function(){this.localPc.close(),this.remotePc.close(),this.iceconnectionstatechangeTimes=0,this.localStream.getTracks().forEach(function(a){return a.stop()})},l}();T.CheckModule=d},8493:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(n,t){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},m(n,t)},function(n,t){function e(){this.constructor=n}m(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(T,"__esModule",{value:!0}),T.RetryDispatchHandler=void 0;var _=I(6502),d=I(6706),l=I(1089),a=I(3529),c=I(2752),o=function(n){function t(e,r,i,s){var u=n.call(this)||this;return u.retryActiveCount=1,u.RETRY_MAX_TIME=90,u.logger=e,u.stateCenter=r,u.rtm=i,u.streamCenter=s,u}return h(t,n),t.prototype.initStream=function(e,r,i){this.streamID=e,this.playOption=r,this.isPublish=i},t.prototype.active=function(e){var r=this;if(this.logger.info(l.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry call "+this.streamID),this.stateCenter.networkState==d.ENUM_NETWORK_STATE.offline)return this.logger.info(l.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info(l.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" has active, ignore"),!1;if(this.isOverTime)return this.logger.warn(l.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry over time, stop retry"),!1;if(!this.rtm.isLogin()){this.stopMaxTime(),this.invalid();var i=this.isPublish?this.streamCenter.publisherList[this.streamID]:this.streamCenter.playerList[this.streamID];i&&(i.isReDispatch=!0)}var s=this.retryActiveCount-1,u=this.playOption&&this.playOption.resourceMode==2?1:0,p={stream_id:this.streamID,ptype:this.isPublish?"push":"pull",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:this.playOption&&this.playOption.cdnUrl||""}],retry:s,center_ability:!0,dispatch_type:u};return this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=setTimeout(function(){r.retryTimer=null,r.retryActiveCount++;var f=r.streamCenter.getRoomByStreamID(r.streamID),E=r.rtm.service.sendMessage("webrtc_url",p,function(y,b){r.handleFetchWebRtcUrlRsp(y)},function(y,b){r.handleFetchWebRtcUrlRsp(y)},void 0,{sessionID:f==null?void 0:f.sessionID,roomID:f==null?void 0:f.roomID,roomSessionID:f==null?void 0:f.roomSessionID});r.isPublish&&E?r.streamCenter.publisherList[r.streamID]&&(r.streamCenter.publisherList[r.streamID].seq=E):E&&r.streamCenter.playerList[r.streamID]&&(r.streamCenter.playerList[r.streamID].seq=E)},typeof e=="number"?e:1e3*this.retryActiveInterval),this.logger.info(l.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.warn(l.ZEGO_WEBRTC_ACTION.RDH_MAX_TIME+" "+e.streamID+" dispatch over max time "+e.RETRY_MAX_TIME+"s stop retry"),e.isOverTime=!0,e.invalid();var r=a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError;r.message=r.message+" try max limit",e.isPublish?e.streamCenter.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,r):e.streamCenter.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.error,e.streamID,r)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r]},t.prototype.handleFetchWebRtcUrlRsp=function(e){if(e.code&&[c.errorCodeList.TIMEOUT.code].includes(e.code))this.active();else{if(e.code&&[c.errorCodeList.SOCKET_CLOSE.code].includes(e.code))return this.stopMaxTime(),this.invalid(),void(this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var r=e,i=r.body.stream_id,s=!1;if(this.isPublish&&(!this.streamCenter.publisherList[i]||r.header.seq!==this.streamCenter.publisherList[this.streamID].seq))return this.logger.warn(l.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(!(this.isPublish||this.streamCenter.playerList[this.streamID]&&r.header.seq===this.streamCenter.playerList[this.streamID].seq))return this.logger.warn(l.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(this.stateCenter.type==="PUBLIC"){if(this.stateCenter.clientIP=r.body.clientip||"",r.body.err_code!==0&&r.body.need_action==2)return this.retryActiveInterval=r.body.action_delay/1e3||Math.floor(3*Math.random())+3,this.retryActiveCount==2&&((p=a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(r.body.err_code?" server error:"+r.body.err_code:""),r.body.ptype==="push"?this.streamCenter.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.retry,i,p):this.streamCenter.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.retry,i,p)),void this.active();if(r.body.err_code!==0&&r.body.need_action!==1&&![3102].includes(r.body.err_code))return this.retryActiveInterval=Math.floor(3*Math.random())+3,this.retryActiveCount==2&&((p=a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(r.body.err_code?" server error:"+r.body.err_code:""),r.body.ptype==="push"?this.streamCenter.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.retry,i,p):this.streamCenter.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.retry,i,p)),void this.active();if(this.stopMaxTime(),this.invalid(),r.body.urls&&Array.isArray(r.body.urls)&&r.body.urls.length>0?s=!0:this.logger.error(l.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),r.body.ptype==="push"&&this.streamCenter.publisherList[i]){if(!s)return void this.streamCenter.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.error,i,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);var u=this.streamCenter.publisherList[i];this.stateCenter.publishStreamList[i]?(u.ttl=r.body.hosts_ttl?new Date().getTime()+1e3*r.body.hosts_ttl:0,u.isCenterNode=typeof r.body.is_center_node=="boolean"&&r.body.is_center_node,u.serverUrls=r.body.urls,this.streamCenter.startPublishingStream(i)):this.logger.error(l.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if(r.body.ptype=="pull"&&this.streamCenter.playerList[i]){var p;if(!s)return(p=a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(r.body.err_code?" server error:"+r.body.err_code:""),r.body.err_code===3102&&(p=a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayUnsupportedResourceMode),void this.streamCenter.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.error,i,p);var f=this.streamCenter.playerList[i];f.ttl=r.body.hosts_ttl?new Date().getTime()+1e3*r.body.hosts_ttl:0,f.isCenterNode=typeof r.body.is_center_node=="boolean"&&r.body.is_center_node,f.serverUrls=r.body.urls,this.streamCenter.startPlayingStream(i,this.stateCenter.useNetAgent,this.streamCenter.playSuccessCallBackList[i])}}}},t}(_.RetryHandler);T.RetryDispatchHandler=o},6014:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(n,t){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},m(n,t)},function(n,t){function e(){this.constructor=n}m(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(T,"__esModule",{value:!0}),T.RetryStreamHandler=void 0;var _=I(6706),d=I(6502),l=I(3529),a=I(1089),c=I(608),o=function(n){function t(e,r,i,s){var u=n.call(this)||this;return u.logger=e,u.stateCenter=r,u.streamCenter=i,u.isPublish=s,u.serverUrls=[],u}return h(t,n),t.prototype.initStream=function(e,r){this.streamID=e,this.serverUrls=r},t.prototype.activePublish=function(e){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),this.stateCenter.networkState==_.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(this.retryActiveCount==1)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var i=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=i>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:i}var s=this.streamCenter.publisherList[this.streamID].publisher,u=this.serverUrls[0],p=["unified_rtc","unified_l3"].includes(u);if(!p){var f=this.serverUrls,E=s.signal?s.signal.server:"";f.forEach(function(y,b){return b<=f.indexOf(E)&&r.serverUrls.push(y)}),f.splice(0,f.indexOf(E)+1),u=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1]}return this.retryTimer=setTimeout(function(){r.logger.info("zc.tsh.a stream "+r.streamID+" : connect to "+(p?"unified signal server":"signal server "+u)),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.streamCenter.connectPublishServer(r.streamID,u)},typeof e=="number"?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.activePull=function(e,r){var i=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),r&&(this.playStreamSuccess=r),this.stateCenter.networkState==_.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(this.retryActiveCount==1)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var s=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=s>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:s}var u=this.streamCenter.playerList[this.streamID].player,p=this.serverUrls,f=u.signal?u.signal.server:"",E=this.serverUrls[0],y=["unified_rtc","unified_l3"].includes(E);return y||(p.forEach(function(b,S){return S<=p.indexOf(f)&&i.serverUrls.push(b)}),p.splice(0,p.indexOf(f)+1),E=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1]),this.retryTimer=setTimeout(function(){i.logger.warn("zc.tsh.a stream "+i.streamID+" : connect to "+(y?"unified signal server":"signal server "+E)),i.retryTimer&&clearTimeout(i.retryTimer),i.retryTimer=null,i.retryActiveCount++,i.streamCenter.connectPlayServer(i.streamID,i.playStreamSuccess,E)},typeof e=="number"?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.logger.warn("zc.tsh.smt "+this.streamID+" call"),this.maxTimer?this.logger.warn("zc.tsh.smt max timer"):this.maxTimer=setTimeout(function(){if(e.logger.warn("zc.tsh.smt "+e.streamID+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish){if(!e.streamCenter.publisherList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");e.publishStateHandle(_.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError,!0)}else{if(!e.streamCenter.playerList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");e.playStateHandle(_.ENUM_PLAY_STATE_UPDATE.error,e.streamID,l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError,!0)}},1e3*this.RETRY_MAX_TIME)},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r]},t.prototype.retryNextSignal=function(e){var r,i;if(this.stateCenter.networkState==_.ENUM_NETWORK_STATE.offline)return!0;if(this.isPublish){var s=this.streamCenter.publisherList[this.streamID];if(s.publisher.state==_.ENUM_PUBLISH_STATE.stop&&[l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError.code,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError.code].includes(e.code))return!0;if(s.isCenterNode&&((r=s.publisher.signal)===null||r===void 0?void 0:r.wsReadyState)==WebSocket.OPEN)return!1;if(!s.isCenterNode&&[l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError.code].includes(e.code)){var u=(p=e.message.match(/reason:(\d+)/))?p[1]:"";return!["26"].includes(u)}return!0}var p,f=this.streamCenter.playerList[this.streamID];return!(f.player.state!=_.ENUM_PLAY_STATE.stop||![l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError.code,l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError.code].includes(e.code))||(!f.isCenterNode||((i=f.player.signal)===null||i===void 0?void 0:i.wsReadyState)!=WebSocket.OPEN)&&(!(!f.isCenterNode&&[l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError.code].includes(e.code))||(u=(p=e.message.match(/reason:(\d+)/))?p[1]:"",!["24","26","28"].includes(u)))},t.prototype.publishStateHandle=function(e,r,i,s){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" call "+r+" "+(i?i.code+"":""));var u=s||this.RETRY_MAX_TIME<3;if(!u&&i&&(c.ClientUtil.isReDispatch(i)||this.serverUrls.length==0))return this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" stop "+u+" "+JSON.stringify(this.serverUrls)),this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPublishStateUpdate(e,r,i);var p=this.streamCenter.publisherList[r],f=p.publisher;if(!u&&i&&i.code!==0){!this.maxTimer&&!u&&this.startMaxTime(),this.stateCenter.publishStreamList[r].state=_.ENUM_PUBLISH_STREAM_STATE.retryPublish;var E=f.localStream,y=f.videoInfo,b=f.mediaStreamConfig,S=f.publishOption;if(f.sessionId!=0&&f.signal&&f.shouldSendCloseSession()&&(f.signal.sendCloseSession(_.getSeq(),f.sessionId,1),f.signal.removeSession(f.sessionId),f.closeSessionSignal=!0),f.resetPublish(),!u&&!this.retryNextSignal(i)){if(p.isCenterNode&&f.gwNodeTTL<new Date().getTime()&&f.gwNodeList.length!==0)f.gwNode="",f.gwNodeList=[],f.gwNodeTTL=0;else if(p.isCenterNode){var k=f.gwNodeList.findIndex(function(g){return g==f.gwNode});f.gwNode=f.gwNodeList[++k%f.gwNodeList.length]}return this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" retry current signal "),this.streamCenter.onPublishStateUpdate(2,r,i),void(this.stateCenter.useNetAgent?f.startPublish(r,E,y,b,S):this.startRetryTimer=setTimeout(function(){f.startPublish(r,E,y,b,S)},3e3))}this.streamCenter.removeStreamFromSignal(!0,r)}if(u)return this.stopMaxTime(),this.invalid(),e===1&&f.resetPublish(),void this.streamCenter.onPublishStateUpdate(e,r,i);if(i&&i.code!==0&&this.activePublish(void 0)){var O=_.getReportSeq();this.streamCenter.dataReport.newReport(O),this.streamCenter.dataReport.addMsgInfo(O,{stream:l.ZegoRTCLogEvent.kZegoTaskRePublish.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(O,l.ZegoRTCLogEvent.kZegoTaskRePublish.event),this.streamCenter.onPublishStateUpdate(2,r,i)}this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" end "+r)},t.prototype.playStateHandle=function(e,r,i,s){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" call "+r+" "+(i?i.code+"":""));var u=s||this.RETRY_MAX_TIME<3;if(!u&&i&&(c.ClientUtil.isReDispatch(i)||this.serverUrls.length==0))return this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" stop "+u+" "+JSON.stringify(this.serverUrls)),this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPlayStateUpdate(e,r,i);if(!u&&i&&i.code!==0){!this.maxTimer&&!u&&this.startMaxTime();var p=this.streamCenter.playerList[r],f=p.player,E=f.playOption;if(f.sessionId!=0&&f.signal&&f.shouldSendCloseSession()&&(f.signal.sendCloseSession(_.getSeq(),f.sessionId,1),f.signal.removeSession(f.sessionId),f.closeSessionSignal=!0),f.resetPlay(),!u&&!this.retryNextSignal(i)){if(p.isCenterNode&&f.gwNodeTTL<new Date().getTime()&&f.gwNodeList.length!==0)f.gwNode="",f.gwNodeList=[],f.gwNodeTTL=0;else if(p.isCenterNode){var y=f.gwNodeList.findIndex(function(S){return S==f.gwNode});f.gwNode=f.gwNodeList[++y%f.gwNodeList.length]}return this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" retry current signal "),this.streamCenter.onPlayStateUpdate(2,r,i),void(this.stateCenter.useNetAgent?f.startPlay(r,f.getRemoteStreamSuc,E):this.startRetryTimer=setTimeout(function(){f.startPlay(r,f.getRemoteStreamSuc,E)},3e3))}this.streamCenter.removeStreamFromSignal(!1,r)}if(u)return this.stopMaxTime(),this.invalid(),void this.streamCenter.onPlayStateUpdate(e,r,i);if(i&&i.code!==0&&this.activePull(void 0)){var b=_.getReportSeq();this.streamCenter.dataReport.newReport(b),this.streamCenter.dataReport.addMsgInfo(b,{stream:l.ZegoRTCLogEvent.kZegoTaskRePlay.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(b,l.ZegoRTCLogEvent.kZegoTaskRePlay.event),this.streamCenter.onPlayStateUpdate(2,r,i)}this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" end "+r)},t}(d.RetryHandler);T.RetryStreamHandler=o},908:function(W,T,I){"use strict";var m=this&&this.__awaiter||function(s,u,p,f){return new(p||(p=Promise))(function(E,y){function b(O){try{k(f.next(O))}catch(g){y(g)}}function S(O){try{k(f.throw(O))}catch(g){y(g)}}function k(O){var g;O.done?E(O.value):(g=O.value,g instanceof p?g:new p(function(v){v(g)})).then(b,S)}k((f=f.apply(s,u||[])).next())})},h=this&&this.__generator||function(s,u){var p,f,E,y,b={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return y={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function S(k){return function(O){return function(g){if(p)throw new TypeError("Generator is already executing.");for(;b;)try{if(p=1,f&&(E=2&g[0]?f.return:g[0]?f.throw||((E=f.return)&&E.call(f),0):f.next)&&!(E=E.call(f,g[1])).done)return E;switch(f=0,E&&(g=[2&g[0],E.value]),g[0]){case 0:case 1:E=g;break;case 4:return b.label++,{value:g[1],done:!1};case 5:b.label++,f=g[1],g=[0];continue;case 7:g=b.ops.pop(),b.trys.pop();continue;default:if(!((E=(E=b.trys).length>0&&E[E.length-1])||g[0]!==6&&g[0]!==2)){b=0;continue}if(g[0]===3&&(!E||g[1]>E[0]&&g[1]<E[3])){b.label=g[1];break}if(g[0]===6&&b.label<E[1]){b.label=E[1],E=g;break}if(E&&b.label<E[2]){b.label=E[2],b.ops.push(g);break}E[2]&&b.ops.pop(),b.trys.pop();continue}g=u.call(s,b)}catch(v){g=[6,v],f=0}finally{p=E=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([k,O])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.RTCModules=void 0;var _=I(6706),d=I(6706),l=I(3529),a=I(608),c=I(7560),o=I(361),n=I(4865),t=I(1089),e=I(2752),r=I(9595),i=function(){function s(u,p,f,E,y,b){this.logger=u,this.dataReport=p,this.stateCenter=f,this.streamCenter=E,this.rtm=y,this.ac=b,this.mediaEleSources=[],this.publishModule=new o.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new n.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.initAdvance(),this.initAudioMix(),this.init()}return s.prototype.init=function(){this.bindWindowListener(),this.bindRTMListener(),this.bindStreamCenterHandler()},s.prototype.initAudioMix=function(){},s.prototype.initAdvance=function(){},s.prototype.bindWindowListener=function(){var u=this,p=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),f=this.stateCenter.browser,E=p?"pagehide":f==="firefox"?"beforeunload":"unload";window.addEventListener(E,function(){for(var y in window.event&&(window.event.cancelBubble=!0),u.streamCenter.publisherList)u.publishModule.stopPublishingStream(y);for(var y in u.streamCenter.playerList)u.playModule.stopPlayingStream(y)}),window.addEventListener("message",function(y){var b=y.data,S=b.type,k=b.streamId,O=b.canRequestAudioTrack;S==="SS_DIALOG_SUCCESS"&&u.screenStreamFrom(k,O,a.ClientUtil.actionSuccessCallback("screenShare",u.stateCenter.callbackList)),S==="SS_DIALOG_CANCEL"&&a.ClientUtil.actionSuccessCallback("screenShare",u.stateCenter.callbackList)(!1,null,S)}),window.addEventListener("offline",function(){if(u.logger.info("zc.off.0 network is broken"),u.stateCenter.networkState=d.ENUM_NETWORK_STATE.offline,u.stateCenter.useNetAgent)u.logger.info("zc.off.0 use netAgent");else{for(var y in u.streamCenter.publisherList)(b=u.streamCenter.publisherList[y].retryStreamHandler).stopMaxTime(),b.invalid();for(var y in u.streamCenter.playerList){var b;(b=u.streamCenter.playerList[y].retryStreamHandler).stopMaxTime(),b.invalid()}}}),window.addEventListener("online",function(y){for(var b in u.logger.info("zc.on.0 network is online"),u.stateCenter.networkState=d.ENUM_NETWORK_STATE.online,u.streamCenter.publisherList){var S=u.streamCenter.publisherList[b].publisher,k=u.streamCenter.publisherList[b].retryStreamHandler;S.state==d.ENUM_PUBLISH_STATE.stop||S.stateNego!==d.ENUM_PUBLISH_STATE_NEGO.iceConnected?!k.isOverTime&&k.publishStateHandle(d.ENUM_PUBLISH_STATE_UPDATE.error,b,l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNetworkBrokenError):S.state==d.ENUM_PUBLISH_STATE.publishing&&k.stopMaxTime()}for(var b in u.streamCenter.playerList){var O=u.streamCenter.playerList[b].player;k=u.streamCenter.playerList[b].retryStreamHandler,O.state==d.ENUM_PLAY_STATE.stop||O.stateNego!==d.ENUM_PLAY_STATE_NEGO.iceConnected?!k.isOverTime&&k.playStateHandle(d.ENUM_PLAY_STATE_UPDATE.error,b,l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNetworkBrokenError):O.state==d.ENUM_PLAY_STATE.playing&&k.stopMaxTime()}}),window.addEventListener("visibilitychange",function(y){if(Object.keys(u.streamCenter.publisherList).length>0||Object.keys(u.streamCenter.playerList).length>0){var b=d.getReportSeq();u.dataReport.newReport(b,l.ZegoRTCLogEvent.kZegoVisibilityChange.event),u.dataReport.uploadReport(b)}})},s.prototype.bindRTMListener=function(){var u,p,f=this;this.rtm._on("_settingCanFetch",function(E){return m(f,void 0,void 0,function(){var y=this;return h(this,function(b){return this.rtm.cloudSetting.fetchSetting(r.RTC).then(function(S){y.logger.info("zc.scf stream config "+JSON.stringify(S)),y.rtm._on("_cloudSettingNotify",function(k,O){var g=d.getReportSeq();y.dataReport.newReport(g,l.ZegoRTCLogEvent.kZegoTaskCloudSettingRefresh.event);var v=y.rtm.cloudSetting.getEnvVariables();y.dataReport.addMsgInfo(g,{params:v,files:[{name:k,content:O.setting,versions:O.versions}]}),y.dataReport.uploadReport(g),r.RTC})}),[2]})})}),this.rtm._on("_appConfigRsp",function(){f.stateCenter.appConfig=f.rtm.getAppConfig(),f.publishModule.startWaitPublish(),f.playModule.startWaitPlay()}),this.rtm._on("_roomLogin",function(E,y){f.stateCenter.appid=f.rtm.getAppID(),f.stateCenter.idName=f.rtm.getUserID(),f.stateCenter.testEnvironment=f.rtm.isTestEnvironment(),f.stateCenter.isMultiRoom=f.rtm.getMultiRoom(),f.stateCenter.useNetAgent=f.rtm.getUseNetAgent(),f.streamCenter.setSessionInfo(f.stateCenter.appid,f.stateCenter.idName,f.stateCenter.testEnvironment);var b=f.stateCenter.getRoomByRoomID(E);if(!b){var S=new c.StreamHandler(f.logger,f.stateCenter,f.rtm,f.streamCenter,E);f.bindStreamHandler(S),b={roomID:E,streamHandler:S,sessionID:"",roomSessionID:"",token:y,isResetRoom:!1,streamList:[],streamInfoList:[]},f.stateCenter.roomList.push(b)}}),this.rtm._on("roomLoginResponse",function(E){f.logger.info("zc.rlr call "+JSON.stringify(E));var y=E.header.room_id||E.body.room_id;f.stateCenter.appConfig=f.rtm.getAppConfig();var b=f.rtm.getToken(y),S=f.rtm.getSessionId(y),k=f.rtm.getRoomSessionID(y),O=f.stateCenter.getRoomByRoomID(y);if(!O){var g=new c.StreamHandler(f.logger,f.stateCenter,f.rtm,f.streamCenter,y);f.bindStreamHandler(g),O={roomID:y,streamHandler:g,sessionID:S,roomSessionID:k,token:b,isResetRoom:!1,streamList:[],streamInfoList:[]},f.stateCenter.roomList.push(O)}if(O.sessionID=S,O.roomSessionID=k,E.body.stream_fetch_flag===1)return f.logger.info("zc.rlr stream fetch "+y),O.streamHandler.room=O,void O.streamHandler.fetchStreamList();O.streamHandler.handleStreamStart(E,O),f.logger.info("zc.rlr end "+y)}),this.rtm._on("HBResponse",function(E){var y,b=(y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id,S=f.stateCenter.getRoomByRoomID(b);f.stateCenter.type==="PUBLIC"&&(S==null||S.streamHandler.patchStreamList(E))}),this.rtm._on("_roomStateUpdate",function(E,y,b,S){if(y=="DISCONNECTED"){f.logger.info("zc.rsu "+E+" disconnected "+(b?b+" ":"")+(S||""));var k=f.stateCenter.getRoomByRoomID(E);if(k){var O=f.stateCenter.roomList.findIndex(function(g){return g.roomID==E});k.isResetRoom=!0,k.streamHandler.reset(),f.streamCenter.reset(E,b),f.stateCenter.roomList.splice(O,1)}}else f.logger.info("zc.rsu "+E+" state: "+y)}),this.rtm._on("_tokenRenewed",function(E,y){f.logger.info("zc.tr roomID:"+y+" "+E);var b=f.stateCenter.getRoomByRoomID(y);b&&(b.token=E)}),this.rtm._on("_tokenExpired",function(E){var y,b;(((b=(y=E==null?void 0:E.body)===null||y===void 0?void 0:y.stop_stream)===null||b===void 0?void 0:b.stream_id_list)||[]).forEach(function(S){f.publishModule.stopPublishingStream(S,e.errorCodeList.TOKEN_EXPIRED)})}),this.rtm.service.on("stream",function(E){var y,b=((y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id)||"",S=f.stateCenter.getRoomByRoomID(b);S?S.streamHandler.handleStreamUpdateRsp(E):f.logger.error(t.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")}),this.rtm.liveRoomHandler.handlePushStreamMsg=function(E){var y=_.streamMap[E.header.sub_cmd];E.body.stream_cmd=y,f.handlePushStreamMsg(E)},(u=this.rtm.service)===null||u===void 0||u.on("push_stream_update",function(E){f.handlePushStreamMsg(E)}),(p=this.rtm.service)===null||p===void 0||p.on("zegochat_js.push_room_stream_update_req",function(E){var y,b=((y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id)||"",S=f.stateCenter.getRoomByRoomID(b);S?S.streamHandler.handlePriPushStreamUpdateMsg(E):f.logger.error(t.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")})},s.prototype.handlePushStreamMsg=function(u){var p,f=((p=u==null?void 0:u.header)===null||p===void 0?void 0:p.room_id)||"",E=this.stateCenter.getRoomByRoomID(f);E?E.streamHandler.handlePushStreamUpdateMsg(u):this.logger.error(t.ZEGO_WEBRTC_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")},s.prototype.bindStreamCenterHandler=function(){var u=this;this.streamCenter.onPlayStateUpdate=function(p,f,E){var y=u.stateCenter.reportSeqList.startPlay[f],b=u.streamCenter.playerList[f];if(p==1&&b&&a.ClientUtil.isReDispatch(E)){var S=b.player,k=b.retryDispatchHandler,O=b.playOption;return S.sessionId!=0&&S.signal&&S.shouldSendCloseSession()&&(S.signal.sendCloseSession(u.stateCenter.getSeq(),S.sessionId,1),S.signal.removeSession(S.sessionId),S.closeSessionSignal=!0),S.resetPlay(),k.stopMaxTime(),k.invalid(),k.initStream(f,O,!1),void(u.rtm.isLogin()?(k.startMaxTime(),k.active(0)):u.streamCenter.playerList[f].isReDispatch=!0)}b&&b.player&&(p==0||p==1)&&y&&(u.dataReport.eventEndWithMsgInfo(y,"PlayState",{type:p}),p==1&&E&&u.dataReport.addMsgInfo(y,E),u.dataReport.addMsgInfo(y,{session_id:b.player.sessionId}),u.dataReport.uploadReport(y),delete u.stateCenter.reportSeqList.startPlay[f]),p===1&&u.streamCenter.playErrorCallBackList[f]?(u.streamCenter.playErrorCallBackList[f]({errorCode:E&&E.code,extendedData:E&&E.message}),delete u.streamCenter.playErrorCallBackList[f],u.logger.info("zc.opsu.1 stop play called by sdk"),u.playModule.stopPlayingStream(f,E)):u.stateCenter.actionListener("playerStateUpdate",{state:a.ClientUtil.getPlayerStateType(p),streamID:f,errorCode:E&&E.code,extendedData:E&&E.message})},this.streamCenter.onPublishStateUpdate=function(p,f,E){u.onPublishStateUpdateHandle(p,f,E)},this.streamCenter.onPublishQualityUpdate=function(p,f){u.stateCenter.actionListener("publishQualityUpdate",p,f)},this.streamCenter.onPlayQualityUpdate=function(p,f){u.stateCenter.actionListener("playQualityUpdate",p,f)},this.streamCenter.onRemoteCameraStatusUpdate=function(p,f,E){var y=d.getReportSeq();u.dataReport.newReport(y,l.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.event),u.dataReport.addMsgInfo(y,{stream:l.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.stream(p),status:l.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.status(f)}),u.dataReport.uploadReport(y),u.stateCenter.actionListener("remoteCameraStatusUpdate",p,f),u.stateCenter.actionListener("_remoteCameraStatusUpdate",p,E)},this.streamCenter.onRemoteMicStatusUpdate=function(p,f,E){var y=d.getReportSeq();u.dataReport.newReport(y,l.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.event),u.dataReport.addMsgInfo(y,{stream:l.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.stream(p),status:l.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.status(f)}),u.dataReport.uploadReport(y),u.stateCenter.actionListener("remoteMicStatusUpdate",p,f),u.stateCenter.actionListener("_remoteMicStatusUpdate",p,E)},this.streamCenter.onSoundLevelUpdate=function(p){u.stateCenter.actionListener("soundLevelUpdate",p)},this.streamCenter.onMicSoundLevelUpdate=function(p){u.stateCenter.actionListener("capturedSoundLevelUpdate",p)}},s.prototype.bindStreamHandler=function(u){var p=this;u.onStreamUpdated=function(f,E,y){var b;b=p.stateCenter.type==="PRIVATE"?y.map(function(v){return{streamID:v.stream_id,user:{userID:v.user_id,userName:v.user_name},extraInfo:v.extra_info,title:v.title,streamVer:v.stream_ver}}):y.map(function(v){return{streamID:v.streamID,user:v.user,extraInfo:v.extraInfo,urlsFLV:v.urlFlv,urlsRTMP:v.urlRtmp,urlsHLS:v.urlHls,urlsHttpsFLV:v.urlHttpsFlv,urlsHttpsHLS:v.urlHttpsHls}});var S={};if(E===0){var k=y.map(function(v){return{stream_id:v.streamID,code:d.STREAM_DELETE_REASON[v.closeType]&&d.STREAM_DELETE_REASON[v.closeType].code||0,description:d.STREAM_DELETE_REASON[v.closeType]&&d.STREAM_DELETE_REASON[v.closeType].description||"unknown"}});S.stream_delete_reason=k}var O=d.getReportSeq();if(p.dataReport.newReport(O,l.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),p.dataReport.addMsgInfo(O,{stream_update_type:l.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(E===1?"added":"deleted"),update_stream:l.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(b)}),p.dataReport.uploadReport(O),p.stateCenter.actionListener("roomStreamUpdate",f,a.ClientUtil.getSteamUpdateType(E),b,Object.keys(S).length>0?JSON.stringify(S):""),p.stateCenter.actionListener("_streamUpdated",E,y),E===1){var g=[];b.forEach(function(v){v.extraInfo&&g.push({streamID:v.streamID,user:v.user,extraInfo:v.extraInfo})}),g.length>0&&p.stateCenter.actionListener("streamExtraInfoUpdate",f,g)}},u.onPublishStateUpdate=function(f,E,y){p.logger.info("zb.opsu ",E);var b=p.stateCenter.reportSeqList.startPublish[E],S=p.streamCenter.publisherList[E];S&&S.publisher&&(f==0||f==1)&&b&&(p.dataReport.eventEndWithMsgInfo(b,"PublishState",{type:f}),f==1&&p.dataReport.addMsgInfo(b,y),p.dataReport.addMsgInfo(b,{session_id:S.publisher.sessionId}),p.dataReport.uploadReport(b),delete p.stateCenter.reportSeqList.startPublish[E]),p.stateCenter.actionListener("publisherStateUpdate",{state:a.ClientUtil.getPublisherStateType(f),streamID:E,errorCode:y.code,extendedData:y.message})},u.onStreamExtraInfoUpdated=function(f,E){var y;y=p.stateCenter.type==="PUBLIC"?E.map(function(S){return{streamID:S.streamID,user:S.user,extraInfo:S.extraInfo}}):E.map(function(S){return{streamID:S.stream_id,user:{userID:S.user_id,userName:S.user_name},extraInfo:S.extra_info,title:S.title,streamVer:S.stream_ver}});var b=d.getReportSeq();p.dataReport.newReport(b,l.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),p.dataReport.addMsgInfo(b,{update_stream:l.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(y)}),p.dataReport.uploadReport(b),p.stateCenter.actionListener("streamExtraInfoUpdate",f,y)}},s.prototype.screenStreamFrom=function(u,p,f){var E={};E.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u}},E.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u,maxWidth:window.screen.width,maxHeight:window.screen.height}},!p&&(E.audio=!1),navigator.mediaDevices.getUserMedia(E).then(function(y){f(!0,y)}).catch(function(y){f(!1,null,y)})},s.prototype.onPublishStateUpdateHandle=function(u,p,f){var E=this;this.logger.info("zc.opsuh.0 call");var y=this.streamCenter.publisherList[p],b=y.room;if(b)if(u==0){if(this.stateCenter.publishStreamList[p])if([d.ENUM_PUBLISH_STREAM_STATE.tryPublish,d.ENUM_PUBLISH_STREAM_STATE.retryPublish].includes(this.stateCenter.publishStreamList[p].state)&&!b.streamList.find(function(v){return v.stream_id==p})){this.stateCenter.publishStreamList[p].state=d.ENUM_PUBLISH_STREAM_STATE.update_info;var S;S=this.stateCenter.type==="PUBLIC"?d.ENUM_STREAM_SUB_CMD.liveBegin:d.ENUM_STREAM_CMD_PRI.liveBegin,b.streamHandler.updateStreamInfo(p,S,this.stateCenter.publishStreamList[p].extra_info,function(v){E.stateCenter.type==="PRIVATE"&&E.stateCenter.publishStreamList[p]&&E.stateCenter.publishStreamList[p].state==d.ENUM_PUBLISH_STREAM_STATE.update_info&&(E.stateCenter.publishStreamList[p].state=d.ENUM_PUBLISH_STREAM_STATE.stop,b.streamHandler.onPublishStateUpdate(1,p,v),E.publishModule.stopPublishingStream(p))})}else this.stateCenter.publishStreamList[p].state=d.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(u,p,f)}else{if(u==1&&y&&a.ClientUtil.isReDispatch(f)){var k=y.publisher,O=y.retryDispatchHandler,g=y.publishOption;return k.sessionId!=0&&k.signal&&k.shouldSendCloseSession()&&(k.signal.sendCloseSession(this.stateCenter.getSeq(),k.sessionId,1),k.signal.removeSession(k.sessionId),k.closeSessionSignal=!0),k.resetPublish(),O.stopMaxTime(),O.invalid(),O.initStream(p,g,!0),void(this.rtm.isLogin()?(O.startMaxTime(),O.active(0)):this.streamCenter.publisherList[p].isReDispatch=!0)}b.streamHandler.onPublishStateUpdate(u,p,f),u==1&&(this.logger.info("zc.opsuh.0 stop publish called by sdk"),this.publishModule.stopPublishingStream(p,f))}else this.logger.error("zc.opsuh.0 room not exist")},s.prototype.WebrtcOnPublishStateUpdateHandle=function(u,p,f){if(this.stateCenter.publishStreamList[p].state==d.ENUM_PUBLISH_STREAM_STATE.publishing){var E=this.streamCenter.getRoomByStreamID(p);E&&E.streamHandler.onPublishStateUpdate(u,p,f)}},s.prototype.bindListener=function(u,p){return this.stateCenter.listenerList[u]?typeof p!="function"?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(this.stateCenter.listenerList[u].indexOf(p)==-1&&this.stateCenter.listenerList[u].push(p),!0):(this.logger.error("zc.o.0 event "+u+" no found"),!1)},s.prototype.deleteListener=function(u,p){if(!this.stateCenter.listenerList[u])return this.logger.error("zc.o.1 listener no found"),!1;var f=this.stateCenter.listenerList[u];return p?f.splice(f.indexOf(p),1):this.stateCenter.listenerList[u]=[],!0},s}();T.RTCModules=i},4865:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(c){for(var o,n=1,t=arguments.length;n<t;n++)for(var e in o=arguments[n])Object.prototype.hasOwnProperty.call(o,e)&&(c[e]=o[e]);return c},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.PlayModule=void 0;var h=I(1089),_=I(6706),d=I(3529),l=I(608),a=function(){function c(o,n,t,e,r){this.logger=o,this.dataReport=n,this.stateCenter=t,this.streamCenter=e,this.rtm=r}return c.prototype.startPlayingStream=function(o,n,t){var e=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call ",o),new Promise(function(r,i){return e._handlePlayStream(o,n,r,i,t)})},c.prototype._handlePlayStream=function(o,n,t,e,r){var i=this,s=_.getReportSeq();this.stateCenter.reportSeqList.startPlay[o]=s,this.dataReport.newReport(s,d.ZegoRTCLogEvent.kZegoTaskPlayStart.event);var u,p=function(S,k){i.logger.error(h.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" "+(k||S.message)),i.dataReport.uploadReport(s,void 0,S,k),delete i.stateCenter.reportSeqList.startPlay[o],e&&e(m(m({},S),{errorCode:S.code,extendedData:S.message+(k?" "+k:"")}))};if(o===void 0||typeof o!="string"||o==="")return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"stream id type error"),!1;if(o.length>_.MAX_STREAM_ID_LENGTH)return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDToLongError,"stream id length limit "+_.MAX_STREAM_ID_LENGTH),!1;if(!l.ClientUtil.checkIllegalCharacters(o))return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError),!1;if(n!==void 0&&typeof n!="object")return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"playOption must be object"),!1;if(this.stateCenter.customUrl&&this.stateCenter.customUrl.length!=0)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),u=this.stateCenter.customUrl;else{var f=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);f&&f instanceof Array&&f.length>0&&(u=f,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(f)))}if(u)return this.streamCenter.setPlayStateStart(o,n,r)?(this.streamCenter.onPlayStateUpdate(_.ENUM_PLAY_STATE_UPDATE.retry,o,{code:0,message:""}),this.streamCenter.playerList[o].serverUrls=u,this.streamCenter.startPlayingStream(o,!1,function(S){t&&t(S)})):(p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1);if(this.dataReport.addMsgInfo(s,{stream:d.ZegoRTCLogEvent.kZegoTaskPlayStart.stream(o),playOption:d.ZegoRTCLogEvent.kZegoTaskPlayStart.playOption(n),use_na:this.stateCenter.useNetAgent?1:0}),this.stateCenter.useNetAgent&&this.stateCenter.playAccelerate&&this.stateCenter.roomList.length>0)this.logger.info(h.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" play accelerate");else if(this.rtm.isDisConnect())return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;this.stateCenter.pullLimited||(o=NaN+o),n&&n.videoCodec&&(n.videoCodec=n.videoCodec.toUpperCase());var E=this.stateCenter.settingConfig.getSetting("resource_mode",!0);if(E&&(this.logger.info(h.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM," setting resource_mode "+E),!n&&(n={}),n.resourceMode=E),!this.streamCenter.setPlayStateStart(o,n,r))return p(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1;this.streamCenter.onPlayStateUpdate(_.ENUM_PLAY_STATE_UPDATE.retry,o,{code:0,message:""}),this.streamCenter.playSuccessCallBackList[o]=function(S){t&&t(S)},e&&(this.streamCenter.playErrorCallBackList[o]=e);var y=this.stateCenter.useNetAgent;if(y)return this.stateCenter.appConfig?(this.streamCenter.playerList[o].serverUrls=(n==null?void 0:n.resourceMode)===2?["unified_l3"]:["unified_rtc"],this.streamCenter.startPlayingStream(o,y,this.streamCenter.playSuccessCallBackList[o]),!0):(this.streamCenter.waitPlayList.push(o),!0);var b=this.streamCenter.playerList[o].retryDispatchHandler;return b.stopMaxTime(),b.invalid(),b.initStream(o,n,!1),b.startMaxTime(),b.active(0)},c.prototype.stopPlayingStream=function(o,n){var t,e;this.logger.info(h.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call",o);var r=_.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[o]=r,this.dataReport.newReport(r,d.ZegoRTCLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(r,{stream:d.ZegoRTCLogEvent.kZegoTaskPlayStop.stream(o)}),typeof o!="string"||o==="")return this.logger.error(h.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" streamid must be string and not empty"),this.dataReport.uploadReport(r,void 0,d.ZegoRTCLogEvent.kZegoTaskPlayStop.error.kParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[o];var i=this.streamCenter.playerList[o],s=i&&i.player&&i.player.state!==_.ENUM_PLAY_STATE.stop||((t=i==null?void 0:i.retryStreamHandler)===null||t===void 0?void 0:t.isRetrying());for(var u in this.streamCenter.stopPlayingStream(o),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[u]===o){delete this.stateCenter.streamUrlMap[u];break}this.dataReport.addMsgInfo(r,{session_id:(e=i==null?void 0:i.player)===null||e===void 0?void 0:e.sessionId}),this.dataReport.uploadReport(r),s&&this.streamCenter.onPlayStateUpdate(_.ENUM_PLAY_STATE_UPDATE.error,o,n||{code:0,message:""}),this.logger.debug(h.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call success")},c.prototype.mutePlayStream=function(o,n,t){return new Promise(function(e,r){e(!1)})},c.prototype.setStreamAudioOutput=function(o,n){return!1},c.prototype.startWaitPlay=function(){var o=this;this.streamCenter.waitPlayList.forEach(function(n){o.streamCenter.startPlayingStream(n,o.stateCenter.useNetAgent,o.streamCenter.playSuccessCallBackList[n])}),this.streamCenter.waitPlayList=[]},c.prototype.getStreamStats=function(o){var n,t,e;return this.logger.info(h.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call"),typeof o=="string"&&(e=(n=this.streamCenter.playerList[o])===null||n===void 0?void 0:n.player),e&&((t=e==null?void 0:e.qualityHandler)===null||t===void 0?void 0:t.currentQuality)?e.qualityHandler.currentQuality||null:(this.logger.error("zsc.sp.0 stream is not playing"),null)},c}();T.PlayModule=a},5634:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(c){for(var o,n=1,t=arguments.length;n<t;n++)for(var e in o=arguments[n])Object.prototype.hasOwnProperty.call(o,e)&&(c[e]=o[e]);return c},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.PlayStreamQuality=void 0;var h=I(6706),_=I(1089),d=I(3529),l=I(608),a=function(){function c(o,n,t,e){this.player=n,this.logger=t,this.dataReport=e,this.playQualityList=[],this.maxQualityListCount=10,this.qualityTimer=null,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.currentQuality={video:{videoBitrate:0,videoFPS:0,videoTransferFPS:0,frameHeight:0,frameWidth:0,muteState:"1",videoQuality:-1,googCodecName:"",videoPacketsLost:0,videoPacketsLostRate:0,videoFramesDecoded:0,videoFramesDropped:0},audio:{audioBitrate:0,audioCodec:"opus",muteState:"1",audioQuality:-1,audioFPS:0,audioJitter:0,audioLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,audioSamplingRate:0,audioSendLevel:0,googCodecName:""}},this.decodeStartTime=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=h.ENUM_PROBE_STATE.probed,this.probeTimer=null,this.probeTimeoutInterval=3e4,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.cumulativeQuality={},this.audioBreakThreshold=200,this.videoBreakThreshold=500,this.videoBreak={breakStartTime:void 0,cumulativeBreakDuration:0,cumulativeDecodeDuration:0,decodeStartTime:void 0,decodeEndTime:void 0,totalDuration:0,noBreakNoDecodeDuration:0,resumeRecv:!0},this.audioBreak={breakStartTime:void 0,cumulativeBreakDuration:0,cumulativeDecodeDuration:0,decodeStartTime:void 0,decodeEndTime:void 0,totalDuration:0,noBreakNoDecodeDuration:0,resumeRecv:!0},this.lastSampleTime=0,this.videoBreakReport={breakDuration:0,breakCancelDuration:0,decodeTime:0},this.audioBreakReport={breakDuration:0,breakCancelDuration:0,decodeTime:0},this.totalQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0,audioBytesReceived:0},this.currentSecondQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0},this.onBreakEnd=function(r,i,s,u){if(u===void 0&&(u="video"),i.breakStartTime){var p=r-i.breakStartTime;p>=s&&(i.cumulativeBreakDuration+=p),i.breakStartTime=void 0}},this.p2pNetStats={p2pLostRate:0,p2pRTT:0},this.sampleTimes=0,this.qualitySampleInterval=1e3,this.qualityTimeInterval=o,this.currentQuality.video.muteState=this.player.videoMuteState,this.currentQuality.audio.muteState=this.player.audioMuteState}return Object.defineProperty(c.prototype,"streamId",{get:function(){return this.player.streamId},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"sessionId",{get:function(){return this.player.sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"peerID",{get:function(){return this.player.peerID},enumerable:!1,configurable:!0}),c.prototype.getPlayStats=function(o,n){var t=this;if(o!=null){var e=this.sampleTimes%parseInt((this.qualityTimeInterval/this.qualitySampleInterval).toString())==0;this.sampleTimes,parseInt((this.qualityTimeInterval/this.qualitySampleInterval).toString()),e&&this.getP2PNetStats();for(var r,i=document.querySelectorAll("video, audio"),s=0;s<i.length;s++)i[s].srcObject===this.player.playStream&&(r=i[s]);var u={sampleTimeWindow:this.qualityTimeInterval,audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.player.audioMuteState,videoMuteState:this.player.videoMuteState,muted:r?r.muted:void 0,paused:r?r.paused:void 0,volume:r?r.volume:void 0,sinkId:r?r.sinkId:void 0},p=this.lastPlayStats.time,f=0,E=0,y=0,b=0,S=0,k=0,O=0,g=null,v=null;o.forEach(function($){["ssrc","inbound-rtp"].includes($.type)&&($.mediaType=="video"||$.id.indexOf("VideoStream")>=0)&&(g=$),($.type=="inbound-rtp"||$.type=="ssrc"&&$.bytesReceived!=null)&&($.mediaType=="audio"||$.id.indexOf("AudioStream")>=0)&&(v=$)});var R=function($,Se,Oe,_e,fe,re,G,q,z){if(q===void 0&&(q=G),z===void 0&&(z="video"),fe>1e3&&(fe=1e3),_e.breakStartTime)if(Oe)if(Se===0)$-_e.breakStartTime>=22e3&&t.onBreakEnd($,_e,fe,z),re.breakDuration+=1e3;else if(G>=fe)if(G<500)if(G+q<1e3){var X=$-(1e3-q);t.onBreakEnd(X,_e,fe,z),_e.breakStartTime=$-G,re.breakDuration+=q+G,re.decodeTime+=1e3-(q+G)}else t.onBreakEnd($-1e3+q,_e,fe,z),_e.breakStartTime=$-1e3+q,re.breakDuration+=1e3;else G>=500&&(t.onBreakEnd($-G,_e,fe,z),_e.breakStartTime=$-G,re.breakDuration+=1e3);else q<=fe?(t.onBreakEnd($-1e3+q,_e,fe,z),_e.breakStartTime=void 0,re.breakDuration+=q,re.decodeTime+=1e3-q):re.breakDuration+=1e3;else{_e.resumeRecv=!1;var M=$-1e3,C=M-_e.breakStartTime;C<=0&&(t.logger.error(_.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" breakCancelDuration less than 0.  ("+_e.breakStartTime+", "+M+")"),C=0),_e.breakStartTime=void 0,_e.noBreakNoDecodeDuration+=C,re.breakCancelDuration+=C}else Oe?Se===0?_e.resumeRecv?(_e.breakStartTime=$-1e3,re.breakDuration+=1e3):_e.noBreakNoDecodeDuration+=1e3:q>fe?_e.resumeRecv?(_e.breakStartTime=$-q,re.breakDuration+=q,re.decodeTime+=1e3-q):_e.noBreakNoDecodeDuration+=1e3:re.decodeTime+=1e3:_e.decodeStartTime&&(Se===0?(_e.resumeRecv=!1,_e.noBreakNoDecodeDuration+=1e3):re.decodeTime+=1e3);Oe&&Se&&(_e.resumeRecv=!0)},L=new Date().getTime(),N=function($,Se){return $>Se?$-Se:0};if(this.lastSampleTime||(this.lastSampleTime=L-1e3),g){var w=g.totalInterFrameDelay,B=g.framesDecoded,x=g.totalSquaredInterFrameDelay,Z=N(B,this.totalQuality.framesDecode);this.totalQuality.framesDecode=B;var V=N(w,this.totalQuality.totalInterFrameDelay);this.totalQuality.totalInterFrameDelay=w;var Y=N(x,this.totalQuality.totalSquaredInterFrameDelay);this.totalQuality.totalSquaredInterFrameDelay=x;var te=(Y-Math.pow(V,2)/(Z||1))/(Z||1);te=te>0?te:-te;var F=parseInt((1e3/(Z+1)).toString()),K=1e3*Math.sqrt(te),J=V/(Z||1)*1e3||F,oe=(J=parseInt((J>1e3?1e3:J).toString()))+K;oe=parseInt((oe>1e3?1e3:oe).toString()),Z>0&&this.player.cameraStatus===0&&!this.videoBreak.decodeStartTime&&(this.videoBreak.decodeStartTime=L-1e3),this.videoBreak.decodeStartTime&&R(L,Z,this.player.cameraStatus===0&&this.player.playMediaStatus.video,this.videoBreak,this.videoBreakThreshold,this.videoBreakReport,J,oe)}if(v){var ae=v,ee=ae.totalSamplesReceived,se=ae.concealedSamples,de=ae.bytesReceived,ge=N(ee,this.totalQuality.totalSamplesReceived);this.totalQuality.totalSamplesReceived=ee;var me=N(se,this.totalQuality.concealedSamples);this.totalQuality.concealedSamples=se;var le=N(de,this.totalQuality.audioBytesReceived);this.totalQuality.audioBytesReceived=de;var Te=parseInt((me/(ge||1)*1e3).toString());le>0&&this.player.micStatus===0&&!this.audioBreak.decodeStartTime&&(this.audioBreak.decodeStartTime=L-1e3),this.audioBreak.decodeStartTime&&R(L,le,this.player.micStatus===0&&this.player.playMediaStatus.audio,this.audioBreak,this.audioBreakThreshold,this.audioBreakReport,Te,Te,"audio")}if(n&&n.result().forEach(function($){e&&($.type=="ssrc"&&($.names().indexOf("googBandwidthLimitedResolution")>=0&&(u.googBandwidthLimitedResolution=$.stat("googBandwidthLimitedResolution")),$.names().indexOf("codecImplementationName")>=0&&(u.codecImplementationName=$.stat("codecImplementationName")),$.stat("mediaType")=="video"&&($.names().indexOf("googCodecName")>=0&&(u.videoCodecName=$.stat("googCodecName")),$.names().indexOf("googCurrentDelayMs")>=0&&(O=$.stat("googCurrentDelayMs"))),$.stat("mediaType")=="audio"&&($.names().indexOf("googCodecName")>=0&&(u.audioCodecName=$.stat("googCodecName")),$.names().indexOf("googCurrentDelayMs")>=0&&(k=$.stat("googCurrentDelayMs"))),$.names().indexOf("googCpuLimitedResolution")>=0&&(u.googCpuLimitedResolution=$.stat("googCpuLimitedResolution"))),$.type=="VideoBwe"&&$.names().indexOf("googAvailableSendBandwidth")>=0&&(u.googAvailableSendBandwidth=$.stat("googAvailableSendBandwidth")))}),e){o.forEach(function($){if(($.type=="inbound-rtp"||$.type=="ssrc"&&$.bytesReceived!=null)&&($.mediaType=="audio"||$.id.indexOf("AudioStream")>=0)){p!=0&&(u.audioBitrate=8*($.bytesReceived-t.lastPlayStats.audioBytesReceived)/($.timestamp-p),(Oe=$.packetsLost-t.lastPlayStats.audioPacketsLost)>0&&(E=Oe/(Oe+$.packetsReceived-t.lastPlayStats.audioPacketsReceived))),u.audioBitrate<0&&(u.audioBitrate=0),u.audioJitter=$.jitter,$.packetsLost>0&&(u.audioPacketsLost=$.packetsLost),u.audioFractionLost=$.fractionLost;var Se=$.packetsLost-t.lastPlayStats.audioPacketsLost;u.audioFPS=($.packetsReceived-t.lastPlayStats.audioPacketsReceived)/($.timestamp-p)*1e3,u.audioPacketsLostRate=Se>0?Se/($.packetsReceived-t.lastPlayStats.audioPacketsReceived+Se):0,t.lastPlayStats.audioBytesReceived=$.bytesReceived,$.packetsLost>0&&(t.lastPlayStats.audioPacketsLost=$.packetsLost),t.lastPlayStats.audioPacketsReceived=$.packetsReceived,t.lastPlayStats.audioTime=$.timestamp,t.lastPlayStats.time=$.timestamp,t.lastPlayStats.audioBitrate=u.audioBitrate,b=$.jitter}else if(($.type=="inbound-rtp"||$.type=="ssrc"&&$.bytesReceived!=null)&&($.mediaType=="video"||$.id.indexOf("VideoStream")>=0)){var Oe;p!=0?(u.videoBitrate=8*($.bytesReceived-t.lastPlayStats.videoBytesReceived)/($.timestamp-p),u.videoFPS=1e3*($.framesDecoded-t.lastPlayStats.framesDecoded)/($.timestamp-p),(Oe=$.packetsLost-t.lastPlayStats.videoPacketsLost)>0&&(y=Oe/(Oe+$.packetsReceived-t.lastPlayStats.videoPacketsReceived))):typeof $.framesPerSecond=="number"&&(u.videoFPS=$.framesPerSecond),u.videoBitrate<0&&(u.videoBitrate=0),u.videoFPS<0&&(u.videoFPS=0),u.nackCount=$.nackCount,u.pliCount=$.pliCount,u.videoFractionLost=$.fractionLost,u.videoFramesDecoded=$.framesDecoded,$.packetsLost>0&&(u.videoPacketsLost=$.packetsLost),Se=$.packetsLost-t.lastPlayStats.videoPacketsLost,u.videoPacketsLostRate=Se>0?Se/($.packetsReceived-t.lastPlayStats.videoPacketsReceived+Se):0,t.lastPlayStats.videoBytesReceived=$.bytesReceived,t.lastPlayStats.framesDecoded=$.framesDecoded,$.packetsLost>0&&(t.lastPlayStats.videoPacketsLost=$.packetsLost),t.lastPlayStats.videoPacketsReceived=$.packetsReceived,t.lastPlayStats.videoTime=$.timestamp,t.lastPlayStats.time=$.timestamp,S=$.jitter}else if($.type=="track"&&($.kind=="video"||$.id.indexOf("video")>=0)||$.frameWidth){if(u.frameHeight=$.frameHeight,u.frameWidth=$.frameWidth,p===0||t.lastPlayStats.frameHeight===$.frameHeight&&t.lastPlayStats.frameWidth===$.frameWidth)p===0&&(t.lastPlayStats.frameHeight=$.frameHeight,t.lastPlayStats.frameWidth=$.frameWidth);else{var _e=h.getReportSeq();t.dataReport.newReport(_e,d.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.event),t.dataReport.addMsgInfo(_e,{session_id:d.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.session_id(t.sessionId),w:d.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.w($.frameWidth),h:d.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.h($.frameHeight)}),!t.player.isProbe&&t.dataReport.uploadReport(_e),t.lastPlayStats.frameHeight=$.frameHeight,t.lastPlayStats.frameWidth=$.frameWidth}p!=0&&(u.videoTransferFPS=1e3*($.framesReceived-t.lastPlayStats.framesReceived)/($.timestamp-p),u.videoFramesDropped=$.framesDropped-t.lastPlayStats.framesDropped),u.videoTransferFPS<0&&(u.videoTransferFPS=0),u.videoFramesDropped<0&&(u.videoFramesDropped=0),t.lastPlayStats.framesReceived=$.framesReceived,t.lastPlayStats.framesDropped=$.framesDropped}else $.type=="track"&&($.kind=="audio"||$.id.indexOf("audio")>=0)?(u.audioLevel=$.audioLevel||0,u.audioSendLevel=$.totalAudioEnergy,u.audioSamplingRate=$.totalSamplesDuration):$.type=="candidate-pair"&&($.totalRoundTripTime!=null&&(u.totalRoundTripTime=$.totalRoundTripTime),$.currentRoundTripTime!=null&&(u.currentRoundTripTime=$.currentRoundTripTime,f=1e3*u.currentRoundTripTime))}),this.lastPlayStats.googCurrentDelayMs=Number(k)||Number(O)||0,y=isNaN(y)||y<0?0:y,S=isNaN(S)||S<0?0:S,E=isNaN(E)||E<0?0:E,b=isNaN(b)||b<0?0:b;var Re=l.ClientUtil.getNetQuality(f,y,S),pe=l.ClientUtil.getNetQuality(f,E,b);u.audioQuality=p>0?l.ClientUtil.quality2QualityGrade(Re):0,u.videoQuality=p>0?l.ClientUtil.quality2QualityGrade(pe):0;var ke=Math.min(Re,pe);this.netQuality=ke,u.peerToPeerDelay=isNaN(this.p2pNetStats.p2pRTT)?0:parseInt((this.p2pNetStats.p2pRTT/2+this.lastPlayStats.googCurrentDelayMs).toString()),u.peerToPeerPacketLostRate=this.p2pNetStats.p2pLostRate,p>0&&ke<=h.QUALITY_CONSTANT.MiddleMinQuality&&L>this.probeTime+this.probeInterval&&(this.logger.info(_.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+ke+" start net probe"),this.probeState=h.ENUM_PROBE_STATE.tryProbe,this.player.streamCenter.startNetProbe(!1,this.player,this.player.gwNodeList),this.probeTime=L),this.uploadPlayQuality(u,L),this.updateCurrentQualityStats(u),p!=0&&this.player.onPlayQualityUpdate(this.streamId,this.currentQuality)}}},c.prototype.updateCurrentQualityStats=function(o){var n=o.videoBitrate,t=o.videoFPS,e=o.videoTransferFPS,r=o.frameHeight,i=o.frameWidth,s=o.videoMuteState,u=o.videoQuality,p=o.videoFramesDecoded,f=o.videoFramesDropped,E=o.videoPacketsLost,y=o.videoPacketsLostRate,b=o.audioBitrate,S=o.audioCodec,k=o.audioMuteState,O=o.audioQuality,g=o.audioFPS,v=o.audioJitter,R=o.audioLevel,L=o.audioPacketsLost,N=o.audioPacketsLostRate,w=o.audioSamplingRate,B=o.audioSendLevel,x=o.nackCount,Z=o.pliCount,V=o.totalRoundTripTime,Y=o.currentRoundTripTime,te=o.peerToPeerDelay,F=o.peerToPeerPacketLostRate,K=o.sampleTimeWindow,J={video:m(m({},this.currentQuality.video),{videoBitrate:n,videoFPS:t,videoTransferFPS:e,frameHeight:r,frameWidth:i,videoQuality:u,videoFramesDecoded:p,videoFramesDropped:f,videoPacketsLost:E,videoPacketsLostRate:y,muteState:s}),audio:m(m({},this.currentQuality.audio),{audioBitrate:b,audioCodec:S,audioQuality:O,audioFPS:g,audioJitter:v,audioLevel:R,audioPacketsLost:L,audioPacketsLostRate:N,audioSamplingRate:w,audioSendLevel:B,muteState:k}),nackCount:x,pliCount:Z,totalRoundTripTime:V,currentRoundTripTime:Y,peerToPeerDelay:te,peerToPeerPacketLostRate:(F||0)/255,sampleTimeWindow:K};if(o.muted!==void 0){var oe=o.muted,ae=o.paused,ee=o.volume,se=o.sinkId;J.muted=oe,J.paused=ae,J.volume=ee,J.sinkId=se}if(o.videoCodecName!==void 0){var de=o.videoCodecName,ge=o.audioCodecName,me=o.codecImplementationName,le=o.googAvailableSendBandwidth;J.video.googCodecName=de,J.audio.googCodecName=ge,J.codecImplementationName=me,J.googAvailableSendBandwidth=le}this.currentQuality=J},c.prototype.uploadPlayQuality=function(o,n){if(this.qualityUpload&&this.player.signal.isServerConnected){var t=n;(this.qualityUploadLastTime==0||t-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(o.stream_type="play",o.stream_id=this.streamId,o.timeStamp=parseInt((t/1e3).toString()),o.video_break_duration=this.videoBreakReport.breakDuration,o.video_break_cancel_duration=this.videoBreakReport.breakCancelDuration,o.video_decode_time=this.videoBreakReport.decodeTime,this.videoBreakReport.breakCancelDuration=0,this.videoBreakReport.breakDuration=0,this.videoBreakReport.decodeTime=0,o.audio_break_duration=this.audioBreakReport.breakDuration,o.audio_break_cancel_duration=this.audioBreakReport.breakCancelDuration,o.audio_decode_time=this.audioBreakReport.decodeTime,this.audioBreakReport.breakCancelDuration=0,this.audioBreakReport.breakDuration=0,this.audioBreakReport.decodeTime=0,o.real_sampling_interval=t-this.lastSampleTime,this.lastSampleTime=t,this.logger.info(_.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+this.streamId+" upload"+JSON.stringify(o)),this.player.streamCenter.updateQuality(1,o),this.qualityUploadLastTime=t)}},c.prototype.getP2PNetStats=function(){var o=this;this.player.signal.getP2PNetStats(h.getSeq(),this.sessionId,this.peerID,function(n,t,e){var r=e.p2p_lost_rate,i=e.p2p_rtt;o.p2pNetStats.p2pLostRate=r||0,o.p2pNetStats.p2pRTT=i||0},function(n){})},c.prototype.setPlayQualityTimer=function(){var o=this;this.qualityTimer==null&&(this.logger.info(_.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" startTimer"),this.clearPlayQualityTimer(),this.getP2PNetStats(),this.qualityTimer=setInterval(function(){o.sampleTimes++;var n=o.player.peerConnection;if(n){var t=[n.getStats(null)];o.player.stateCenter.browser=="chrome"&&t.push(new Promise(function(e,r){n.getStats(function(i){return e(i)},function(i){return r(i)})})),Promise.all(t).then(function(e){o.getPlayStats(e[0],e[1])}).catch(function(e){o.logger.error(_.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+o.streamId+" getStats error "+e.toString())})}},1e3),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},c.prototype.clearPlayQualityTimer=function(){if(this.qualityTimer!=null){clearInterval(this.qualityTimer),this.qualityTimer=null;var o=new Date().getTime();this.lastSampleTime=0,this.sampleTimes=0,this.totalQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0,audioBytesReceived:0};var n=function(r,i,s,u,p){if(p===void 0&&(p="video"),s=s>1e3?1e3:s,i.breakDuration=0,i.breakCancelDuration=0,i.decodeTime=0,r.decodeStartTime){var f=o,E=f-r.decodeStartTime;if(r.decodeStartTime=void 0,r.totalDuration+=E,r.breakStartTime){var y=f-r.breakStartTime;r.breakStartTime=void 0,u?y>s&&(r.cumulativeBreakDuration+=y):r.noBreakNoDecodeDuration+=y}var b=r.cumulativeBreakDuration,S=r.totalDuration-r.cumulativeBreakDuration-r.noBreakNoDecodeDuration;return r.cumulativeDecodeDuration=S,{cumulativeBreakDuration:b,cumulativeDecodeDuration:S}}return{cumulativeBreakDuration:0,cumulativeDecodeDuration:0}},t=this.player.cameraStatus===0&&this.player.playMediaStatus.video;n(this.videoBreak,this.videoBreakReport,this.videoBreakThreshold,t);var e=this.player.micStatus===0&&this.player.playMediaStatus.audio;n(this.audioBreak,this.audioBreakReport,this.audioBreakThreshold,e,"audio")}this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},c.prototype.startProbeTimeout=function(){var o=this;this.probeTimer=setTimeout(function(){o.logger.error(_.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" probe timeout"),o.player.playStateUpdateError(d.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kProbeTimeOutError)},this.probeTimeoutInterval)},c.prototype.stopProbeTimeout=function(){this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null)},c}();T.PlayStreamQuality=a},3849:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoPlayWeb=void 0;var h=I(6706),_=I(4767),d=I(608),l=I(3529),a=I(1089),c=I(5634),o=function(){function n(t,e,r,i,s,u,p){this.state=h.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.broadcasterStatus=h.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.reportSeq=NaN,this.streamReportSeq=h.getSeq(),this.videoSizeCallback=!1,this.remoteStream=null,this.playStream=null,this.playOption={},this.playMediaStatus={video:!0,audio:!0},this.closeSessionSignal=!1,this.stateNego=h.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.cameraStatus=0,this.micStatus=0,this.hasSentStreamStatus=!1,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.beginTime=0,this.firstFrameTime=0,this.resourceMode=0,this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.isPeer=!1,this.peerFailCount=0,this.isProbe=!1,this.peerID=0,this.isRecvClientInfo=!1,this.answerSdpTime=0,this.audioMuteState="0",this.videoMuteState="0",this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.onDataChannelList=[],this.iceDisconnectedMaxTime=15e3,this.logger=t,this.signal=e,this.dataReport=r,this.streamCenter=s,this.ac=u,this.stateCenter=p,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()}),this.qualityHandler=new c.PlayStreamQuality(i,this,this.logger,this.dataReport),this.resourceMode=this.stateCenter.settingConfig.getSetting("resource_mode")}return Object.defineProperty(n.prototype,"probeState",{get:function(){return this.qualityHandler.probeState},set:function(t){this.qualityHandler.probeState=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"netQuality",{get:function(){return this.qualityHandler.netQuality},set:function(t){this.qualityHandler.netQuality=t},enumerable:!1,configurable:!0}),n.prototype.startPlay=function(t,e,r){var i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" called ",t),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),t){this.streamId=t,this.getRemoteStreamSuc=e,this.playOption=r||{},this.playMediaStatus={video:this.playOption.video===void 0||!!this.playOption.video,audio:this.playOption.audio===void 0||!!this.playOption.audio},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec);var s=this.stateCenter.settingConfig.getSetting("play_video_codec",!0);s&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting play_video_codec "+s),this.playOption.videoCodec=s),this.dataReport.addMsgInfo(this.reportSeq,{audio_activate:l.ZegoRTCLogEvent.kZegoTaskPlayStart.audio_activate(this.playOption.audio==1?1:this.playOption.audio==0?0:1),video_activate:l.ZegoRTCLogEvent.kZegoTaskPlayStart.video_activate(this.playOption.video==1?1:this.playOption.video==0?0:1)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){i.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" waiting timeout"),i.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError)},this.negoInterval),this.isProbe&&this.qualityHandler.startProbeTimeout()}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" streamId is null")},n.prototype.onCreatePlaySessionSuccess=function(t){var e=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" success");var r=[];if(t.turn_server){var i=t.turn_server,s=this.stateCenter.turnOverTcpOnly,u=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);u&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" setting udp_or_tcp "+u),s=u==="tcp"),s&&(i=i.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" turn over tcp "+i),r.push(i)}t.stun_server&&r.push(t.stun_server);var p={iceTransportPolicy:"relay",iceServers:[{urls:r,username:t.turn_username,credential:t.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" username: "+t.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" credential: "+t.turn_auth_key),this.createOffer(p),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(f,E,y){e.onRecvMediaDesc(f,E,y)}),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(f,E,y){e.onRecvCandidateInfo(f,E,y)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(f,E,y){e.onRecvCloseSession(f,E,y)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(f,E,y){e.onRecvResetSession(f,E,y)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(f,E,y){e.gotStreamStatus=!0,e.streamStatus=y,e.playStream&&e.onRecvStreamStatus(y)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(f,E,y){e.onRecvPlayEvent(f,E,y)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(f,E,y){e.onRecvClientInfo(f,E,y)}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" call success")},n.prototype.createOffer=function(t){var e=this;this.peerConnection=new RTCPeerConnection(t),this.peerConnection.onicecandidate=function(i){e.onIceCandidate(i)},this.peerConnection.onsignalingstatechange=function(i){e.onConnectionStateChange(i)},this.peerConnection.oniceconnectionstatechange=function(i){e.onIceConnectionStateChange(i)},this.peerConnection.ontrack=function(i){e.onGotRemoteStream(i.streams[0])},this.streamCenter.isDataChannelEnabled&&(this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=function(i){e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+e.streamId+" data channel open")},this.dataChannel.onmessage=function(i){if(e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+e.streamId+" data channel onmessage"),i.data instanceof Blob){var s=new FileReader,u={};s.readAsArrayBuffer(i.data),s.onload=function(){u.data=s.result,e.onReceivedDataChannel(u)}}else e.onReceivedDataChannel(i)});var r={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&this.playOption.video===!1&&(r.offerToReceiveVideo=0),this.playOption&&this.playOption.audio===!1&&(r.offerToReceiveAudio=0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(r)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(r).then(function(i){e.dataReport.eventEnd(e.reportSeq,"CreateOffer"),e.dataReport.eventEnd(e.streamReportSeq,"CreateOffer"),e.onCreateOfferSuccess(i)},function(i){e.dataReport.eventEndWithMsg(e.reportSeq,"CreateOffer",{error:i.toString()}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"CreateOffer",{error:i.toString()}),e.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+e.streamId+" create offer error "+i.toString()),e.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCreateOfferError,!0)})},n.prototype.createSession=function(t){var e=this;this.sessionSeq=h.getSeq();var r=this.streamId;this.streamCenter.testEnvironment==1&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var i=this.stateCenter.settingConfig.getSetting("gw_nodes");if(i&&i instanceof Array&&i.length>0&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting "+JSON.stringify(i)),this.gwNodeList=i,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer){this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp");var s=this.stateCenter.settingConfig.getSetting("l3_play_buffer_ms"),u=new Date().getTime();this.signal.createSessionWithSdp({seq:this.sessionSeq,type:this.isProbe?2:1,mode:0,streamId:r,strAuthParam:this.playOption&&this.playOption.streamParams||"",sdp:t.sdp,serverHost:this.gwNode,playBufLevel:this.resourceMode==2?s:void 0},function(p,f,E){var y=new Date().getTime();e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" create session time "+(y-u)),e.handleCreateSessionWithSdpResp(p,f,E)},function(p,f){e.dataReport.eventEndWithMsg(e.reportSeq,"CreateSession",{error:p}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"CreateSession",{error:p}),e.playStateUpdateError(p==h.SEND_MSG_TIMEOUT?l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)})}else this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,r,this.playOption&&this.playOption.streamParams,this.gwNode,function(p,f,E){e.handleCreateSessionResp(p,f,E)},function(p,f){e.dataReport.eventEndWithMsg(e.reportSeq,"CreateSession",{error:p}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"CreateSession",{error:p}),e.playStateUpdateError(p==h.SEND_MSG_TIMEOUT?l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)});this.state=h.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" called success"),this.stateNego=h.ENUM_PLAY_STATE_NEGO.start},n.prototype.handleCreateSessionResp=function(t,e,r){var i=r.turn_server,s=i.split("?")[0]&&i.split("?")[0].slice(5),u=this.streamCenter.server.split("?"),p=u[1]&&u[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+p+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+s+"/"+p+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==t?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?new Date().getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,r.result!==0?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" create error"),this.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.dataReport.addMsgInfo(this.reportSeq,{session_id:l.ZegoRTCLogEvent.kZegoTaskPlayStart.session_id(this.sessionId)}),this.onCreatePlaySessionSuccess(r))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" seq is not match.")},n.prototype.handleCreateSessionWithSdpResp=function(t,e,r){var i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" sessionId:"+e),this.sessionSeq==t){this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?new Date().getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:e});var s=0,u=new Date().getTime();if(this.dataReport.dataStatistics[this.reportSeq]&&(s=u-this.dataReport.dataStatistics[this.reportSeq].event_time,this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" "+this.streamId+" create sdp time "+s)),this.answerSdpTime=u,this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:e,sessionTime:s}),r.result!==0){if(this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session failed "+r.result),this.stateCenter.useNetAgent&&(r==null?void 0:r.result)===1004)return void this.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamNotFound,!0);this.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)}else this.sessionId=e,this.sessionToken=r.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session success ",this.streamId),this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(p,f,E){i.onRecvCloseSession(p,f,E)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(p,f,E){i.onRecvResetSession(p,f,E)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(p,f,E){i.gotStreamStatus=!0,i.streamStatus=E,i.playStream&&i.onRecvStreamStatus(E)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(p,f,E){i.onRecvPlayEvent(p,f,E)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(p,f,E){i.onRecvClientInfo(p,f,E)}),this.signal.registerPushCallback("NetQualityProbeRsp",this.sessionId,function(p,f,E){i.onRecvPlayEvent(p,f,E)}),this.signal.registerPushCallback("NetQualityInfoPush",this.sessionId,function(p,f,E){i.onRecvNetQualityInfo(p,f,E)}),this.onGetRemoteOfferSuccess(r.sdp)}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" seq is not match.")},n.prototype.onCreateOfferSuccess=function(t){var e=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+t.sdp.substr(0,t.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+t.sdp.substr(t.sdp.length/2)),t.sdp=t.sdp.replace(/sendrecv/g,"recvonly"),t.sdp=t.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec=");var r=t.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)?t.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)[0]:null;if(r){var i=r.replace(/recvonly/,"sendrecv");t.sdp=t.sdp.replace(r,i)}var s=t.sdp.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102).*)/);if(s!==null){var u=s[3];t.sdp=t.sdp.replace(u,u+";sps-pps-idr-in-keyframe=1")}this.playOption.videoCodec&&(t.sdp=_.SdpUtil.getSDPByVideDecodeType(t.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(t).then(function(){e.dataReport.eventEnd(e.reportSeq,"SetLocalDescription"),e.dataReport.eventEnd(e.streamReportSeq,"SetLocalDescription"),e.onSetLocalDescriptionSuccess(t)},function(p){e.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+e.streamId+" set error "+p.toString()),e.dataReport.eventEnd(e.reportSeq,"SetLocalDescription",{error:p.toString()}),e.dataReport.eventEnd(e.streamReportSeq,"SetLocalDescription",{error:p.toString()}),e.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetLocalDescError,!0)})},n.prototype.onSetLocalDescriptionSuccess=function(t){var e=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(t);else{var r={sdp:t.sdp};this.resourceMode==2&&(r.min_play_buf_level_ms=500),this.answerSeq=h.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,function(i,s,u){e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" sendMediaDesc resp"),e.answerSeq==i&&e.sessionId==s?(e.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" send success stateNego:waiterAnswer"),e.stateNego=h.ENUM_PLAY_STATE_NEGO.waiterAnswer,e.dataReport.eventEnd(e.reportSeq,"SendMediaDesc"),e.dataReport.eventEnd(e.streamReportSeq,"SendMediaDesc"),e.state=h.ENUM_PLAY_STATE.waitingServerAnswer):e.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" seq or sessionId is not equal "+e.answerSeq+" "+i,0+e.sessionId+" "+s)},function(i,s){e.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" failed to send "+i),e.dataReport.eventEndWithMsg(e.reportSeq,"SendMediaDesc",{error:i}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"SendMediaDesc",{error:i}),e.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaDescError)}),this.state=h.ENUM_PLAY_STATE.waitingOfferRsp}},n.prototype.onRecvMediaDesc=function(t,e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received ",r),this.stateNego=h.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.state===h.ENUM_PLAY_STATE.waitingServerAnswer?(this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(t,this.sessionId,0),this.onGetRemoteOfferSuccess(r.sdp)):this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},n.prototype.onGetRemoteOfferSuccess=function(t){var e,r=this,i={type:"answer",sdp:t,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription");var s=this.stateCenter.turnOverTcpOnly,u=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);u&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" setting udp_or_tcp "+u),s=u==="tcp"),s&&((e=i.sdp.match(/candidate.*/g))===null||e===void 0||e.forEach(function(p){var f=p.replace(/udp/,"tcp");i.sdp=i.sdp.replace(p,f)})),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" remoteSdp ",i.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(i)).then(function(){r.dataReport.eventEnd(r.reportSeq,"SetRemoteDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetRemoteDescription"),r.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set success")},function(p){r.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set remote error "+p.toString()),r.dataReport.eventEndWithMsg(r.reportSeq,"SetRemoteDescription",{error:p.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetRemoteDescription",{error:p.toString()}),r.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetRemoteDescError,!0)}),this.state=h.ENUM_PLAY_STATE.waitingServerICE,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" call success")},n.prototype.onRecvCandidateInfo=function(t,e,r){var i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "),this.state==h.ENUM_PLAY_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(t,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var s=0;s<r.infos.length;s++){var u={sdpMid:r.infos[s].sdpMid,sdpMLineIndex:r.infos[s].sdpMLineIndex,candidate:r.infos[s].candidate};this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" candidate "+u.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(u)).then(function(){i.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")},function(p){i.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+p.toString()),i.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError,!0)})}this.state=h.ENUM_PLAY_STATE.connecting,this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" call success")}else this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},n.prototype.onRecvPlayEvent=function(t,e,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" received"),this.playEvent===!0&&r.event==0){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" retry: "+this.streamId);var i=this.streamId,s=this.playOption;this.signal.sendCloseSession(h.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(i,this.getRemoteStreamSuc,s)}else this.playEvent=!0},n.prototype.onRecvClientInfo=function(t,e,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id,this.isProbe&&this.stateNego==h.ENUM_PLAY_STATE_NEGO.iceConnected&&this.signal.sendNetProbe(h.getSeq(),this.sessionId,this.peerID,function(){},function(){}),this.isRecvClientInfo=!0},n.prototype.onRecvNetQualityInfo=function(t,e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" call"),this.qualityHandler.stopProbeTimeout();var i=0,s=r.lossrate,u=r.rtt;this.peerID===r.peer_id&&typeof s!=null&&typeof u!=null||(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" local peerID:"+this.peerID+" remote peerID:"+r.peer_id+" lossrate:"+s+" rtt:"+u),i=1),this.signal.sendNetQualityInfoPushAck(h.getSeq(),this.sessionId,this.peerID,i),i==0&&typeof s=="number"&&typeof u=="number"?this.onCalNetQualityResult(0,d.ClientUtil.getNetQuality(u,s)):this.onCalNetQualityResult(1)},n.prototype.onIceCandidate=function(t){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" called"),t.candidate!=null)if(this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate "+t.candidate.candidate),this.state<h.ENUM_PLAY_STATE.connecting||this.state==h.ENUM_PLAY_STATE.stop)this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" cached"),this.candidateInfo.push({candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex});else{this.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" send");var e={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};this.sendCandidateInfo([e])}},n.prototype.onConnectionStateChange=function(t){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+t.target.signalingState)},n.prototype.onIceConnectionStateChange=function(t){var e=this;if(this.state!=h.ENUM_PLAY_STATE.stop&&this.peerConnection!=null)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),this.peerConnection.iceConnectionState==="connected"){if(this.stateNego=h.ENUM_PLAY_STATE_NEGO.iceConnected,this.isProbe&&this.isPeer&&this.isRecvClientInfo)return this.signal.sendNetProbe(h.getSeq(),this.sessionId,this.peerID,function(){},function(){}),void(this.negoTimer!=null&&(clearTimeout(this.negoTimer),this.negoTimer=null));if(this.negoTimer!=null&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.iceDisconnectedTimer!=null&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.answerSdpTime){var r=new Date().getTime()-this.answerSdpTime;this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" ice time "+r)}for(var i in this.isProbe||this.state==h.ENUM_PLAY_STATE.playing||(this.onPlayStateUpdate(h.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.getRemoteStreamSuc&&this.getRemoteStreamSuc(this.playStream)),this.state=h.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[i].publisher.state==h.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==h.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(h.getSeq(),this.sessionId,1),this.broadcasterStatus=h.ENUM_BROADCASTER_STATUS.start;break}if(!this.isProbe&&this.qualityHandler.setPlayQualityTimer(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.isPeer&&(this.peerFailCount=0),this.firstFrameTime==0){this.firstFrameTime=new Date().getTime()-this.beginTime;var s=h.getReportSeq();this.dataReport.newReport(s,l.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.event),this.dataReport.addMsgInfo(s,{session_id:l.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.session_id(this.sessionId),fft_consumed:l.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.fft_consumed(this.firstFrameTime)}),!this.isProbe&&this.dataReport.uploadReport(s)}}else this.peerConnection.iceConnectionState==="closed"?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=h.ENUM_PLAY_STATE_NEGO.iceClosed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):this.peerConnection.iceConnectionState==="failed"?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=h.ENUM_PLAY_STATE_NEGO.iceFailed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):this.peerConnection.iceConnectionState==="disconnected"&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=h.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected"),this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout(function(){e.checkPlayConnectionFailedState("disconnected")},this.iceDisconnectedMaxTime)))},n.prototype.checkPlayConnectionFailedState=function(t){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+"  state "+this.state+" connectionState "+t),this.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaConnectionError)},n.prototype.resetPlay=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_RESET_PLAY+" "+this.streamId+" call"),this.state=h.ENUM_PLAY_STATE.stop,this.playEvent=!1,this.isRecvClientInfo=!1,this.peerConnection!=null&&(this.peerConnection.close(),this.peerConnection=null),this.negoTimer!=null&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.iceDisconnectedTimer!=null&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.qualityHandler.stopProbeTimeout(),this.qualityHandler.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId),this.signal.unregisterPushCallback("NetQualityProbeRsp",this.sessionId),this.signal.unregisterPushCallback("NetQualityInfoPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},n.prototype.onRecvResetSession=function(t,e,r){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),e==this.sessionId){this.signal.sendCloseSessionAck(t,this.sessionId,0);var i=JSON.parse(JSON.stringify(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(i)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},n.prototype.onRecvCloseSession=function(t,e,r){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLOSE_SESSION+" "+this.streamId+" "+JSON.stringify(r)),this.signal.sendCloseSessionAck(t,this.sessionId,0);var i=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},s=i.action?i.action:null,u=1*r.reason,p=JSON.parse(JSON.stringify(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));p.message+=" reason:"+u+" "+(s?" action:"+s:""),this.negoTimer&&clearTimeout(this.negoTimer);var f=![4,8,10,11,12,14,24,26,27,28].includes(u)&&![2,5,6].includes(s);this.playStateUpdateError(p,f)},n.prototype.onRecvStreamStatus=function(t){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" status camera_status: "+t.camera_status+" mic_status: "+t.mic_status),(!this.hasSentStreamStatus||this.cameraStatus!==t.camera_status)&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(t.camera_status),t.camera_status),(!this.hasSentStreamStatus||this.micStatus!==t.mic_status)&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(t.mic_status),t.mic_status),this.hasSentStreamStatus=!0,this.cameraStatus=t.camera_status,this.micStatus=t.mic_status,this.videoMuteState=t.camera_status===0?"0":"1",this.audioMuteState=t.mic_status===0?"0":"1",typeof this.playOption.video=="boolean")this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" has set video option, ignore stream status");else{var e=this.playStream;if(t.camera_status!==0&&t.camera_status!==20?e.getVideoTracks().forEach(function(u){u.enabled=!1,u.stop(),e.removeTrack(u)}):e.getVideoTracks().length===0&&e.addTrack(this.remoteStream.clone().getVideoTracks()[0]),this.stateCenter.browser==="safari")for(var r=document.querySelectorAll("video, audio"),i=0;i<r.length;i++){var s=r[i];s.srcObject===this.playStream&&s.paused===!0&&(s.srcObject=this.playStream)}}this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call success")},n.prototype.onGotRemoteStream=function(t){var e=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" called "+t),t?(this.playStream?(this.playStream.getTracks().forEach(function(r){return e.playStream.removeTrack(r)}),t.clone().getTracks().forEach(function(r){return e.playStream.addTrack(r)})):this.playStream=t.clone(),this.audioMuteState=this.playStream.getAudioTracks().length>0?"0":"1",this.videoMuteState=this.playStream.getVideoTracks().length>0?"0":"1",this.remoteStream=t,this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&!this.isProbe&&this.startSoundLevel()):this.logger.warn(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" remote stream is empty")},n.prototype.sendCandidateInfo=function(t){var e=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(t=t.filter(function(r){return!(r.candidate.indexOf("tcp")>0)&&(!!r.candidate||void 0)}))||t.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==h.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=h.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(h.getSeq(),this.sessionId,t,function(r,i,s){e.logger.debug(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+e.streamId+" send success"),e.dataReport.eventEnd(e.reportSeq,"SendIceCandidate"),e.dataReport.eventEnd(e.streamReportSeq,"SendIceCandidate")},function(r,i){e.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+e.streamId+" failed to send: "+r.toString()),e.dataReport.eventEndWithMsg(e.reportSeq,"SendIceCandidate",{error:r}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"SendIceCandidate",{error:r}),e.playStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError)}))},n.prototype.shouldSendCloseSession=function(){return this.state!=h.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=h.ENUM_PLAY_STATE.waitingSessionRsp},n.prototype.playStateUpdateError=function(t,e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" call ",this.streamId,JSON.stringify(t)),this.isProbe?this.onCalNetQualityResult(1):this.streamId&&this.onPlayStateUpdate(h.ENUM_PLAY_STATE_UPDATE.error,this.streamId,t,e),this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" "+this.streamId+" ended")},n.prototype.getCameraMicStatus=function(t){return t==0?"OPEN":"MUTE"},n.prototype.onPlayStateUpdate=function(t,e,r,i){},n.prototype.onPlayQualityUpdate=function(t,e){},n.prototype.onRemoteCameraStatusUpdate=function(t,e,r){},n.prototype.onRemoteMicStatusUpdate=function(t,e,r){},n.prototype.stopPlay=function(){var t;for(var e in this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_PLAY+" "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==h.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==h.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(h.getSeq(),this.sessionId,0),this.broadcasterStatus=h.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(h.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.resetPlay();var r=this.qualityHandler,i=r.videoBreak,s=r.audioBreak,u=this.resourceMode===2?"l3":"rtc",p=((t={})[u+"_a_break_time"]=s.cumulativeBreakDuration,t[u+"_a_decode_time"]=s.cumulativeDecodeDuration,t[u+"_v_break_time"]=i.cumulativeBreakDuration,t[u+"_v_decode_time"]=i.cumulativeDecodeDuration,t);this.dataReport.addMsgInfo(this.streamReportSeq,m({itemtype:"RTCPlayStream",use_na:this.stateCenter.useNetAgent?1:0,cdn_a_break_time:0,cdn_a_decode_time:0,cdn_v_break_time:0,cdn_v_decode_time:0,l3_a_break_time:0,l3_a_decode_time:0,l3_v_break_time:0,l3_v_decode_time:0,rtc_a_break_time:0,rtc_a_decode_time:0,rtc_v_break_time:0,rtc_v_decode_time:0},p)),!this.isProbe&&this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream")},n.prototype.onDisconnect=function(t){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_ON_DISCONNECT+" "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(t||l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!t)},n.prototype.startSoundLevel=function(){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" call streamID: "+this.streamId),!this.isProbe)if(this.remoteStream&&this.remoteStream.getAudioTracks().length!=0){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),i=0,s=0;s<r.length;s++)i<r[s]&&(i=r[s]);t.soundLevel=100*i},this.ac.resume()}catch(e){this.logger.error(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" get sound level failed "+e)}}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" "+this.streamId+" remote stream no found")},n.prototype.stopSoundLevel=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},n.prototype.onCalNetQualityResult=function(t,e){},n.prototype.onReceivedDataChannel=function(t){var e,r,i=this,s=new Uint8Array(t.data,0,10),u=t.data.byteLength-10,p=new Uint8Array(t.data,10,u);if(s[0]==1){var f=s[1],E=s[2]<<8|s[3],y=s[4]<<8|s[5],b=new Date().getTime();if(this.first_pkt&&(this.next_sn[0]=E==y?E:y,this.first_pkt=!1),this.pkt_list.push({sn:E,sn0:y,recv_ts:b,flags:f,payload_len:u,payloadArray:p}),this.pkt_list.sort(this.compareShort),E==this.next_sn[0]){var S=this.pkt_list.filter(function(L){return L.sn0==y});if(S.sort(this.compareShort),S.find(function(L){return 1&L.flags})!=null&&S.length==this.compareShort(E,y)+1){for(var k=0,O=new ArrayBuffer(65536),g=0;g<S.length;g++)new Uint8Array(O).set(S[g].payloadArray,k),k+=S[g].payload_len;(e=this.onDataChannelList)===null||e===void 0||e.forEach(function(L){L(O,k,i.streamId)}),this.pkt_list=[],this.first_pkt=!0}this.next_sn[0]++}else for(var v=function(){var L=R.pkt_list.filter(function(Z){return Z.sn0==i.pkt_list[0].sn0});if(L.sort(R.compareShort),L.find(function(Z){return 1&Z.flags})!=null&&L.length==R.compareShort(L[L.length-1].sn,L[0].sn0)+1){for(var N=0,w=new ArrayBuffer(65536),B=0;B<L.length;B++)new Uint8Array(w).set(L[B].payloadArray,N),N+=L[B].payload_len;R.next_sn[0]=L[0].sn0+L.length,(r=R.onDataChannelList)===null||r===void 0||r.forEach(function(Z){Z(w,N,i.streamId)}),R.pkt_list=[],R.first_pkt=!0}else if(b-L[0].ts<4e3){var x=L[0].sn0;for(B=0;B<L.length&&x==L[B].sn;B++)x++;return R.next_sn[0]=x,"break"}for(B=0;B<L.length;B++)R.pkt_list.shift()},R=this;this.pkt_list.length>0&&v()!=="break";);}},n.prototype.compareShort=function(t,e){var r=new Uint16Array(1);r[0]=t-e;var i=new Int16Array(1);return i[0]=r[0],i[0]},n}();T.ZegoPlayWeb=o},361:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.PublishModule=void 0;var h=I(1089),_=I(6706),d=I(3529),l=I(608),a=I(2752),c=I(3770),o=I(5321),n=function(){function t(e,r,i,s,u){this.logger=e,this.dataReport=r,this.stateCenter=i,this.streamCenter=s,this.rtm=u,this.recordDevices()}return t.prototype.createStream=function(e){var r=this;return this.logger.info(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&typeof e.screen=="object"&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise(function(i,s){var u="camera",p=_.getReportSeq();r.dataReport.newReport(p,d.ZegoRTCLogEvent.kZegoTaskCreateStream.event);var f=function(g){var v=r.streamCenter.checkPreview(g),R=g;if(v&&navigator.userAgent){var L=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);L&&L[1]&&L[1].includes("15_1")&&(R=r.getStreamThroughCanvas(g),v.localStream=R)}if(R.getAudioTracks().length==0){var N=r.streamCenter.ac.createMediaStreamDestination(),w=N?N.stream:null,B=w?w.getAudioTracks()[0]:null;B&&(B.enabled=!1,R.addTrack(B),v&&(v.hasEmptyAudioTrack=!0))}r.dataReport.uploadReport(p),!r.stateCenter.deviceInfos&&r.recordDevices(),i(R),r.streamCenter.activeSoundLevel()},E=function(g,v){v===void 0&&(v=""),r.dataReport.addMsgInfo(p,{error:g.code,message:g.message+v}),r.dataReport.uploadReport(p),s({code:g.code,msg:g.message+v})};if(window.location.protocol!=="https:"&&window.location.protocol!=="file:"&&window.location.hostname.indexOf("127.0.0.1")==-1&&window.location.hostname.indexOf("localhost")==-1)return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" https or localhost required "),void E({code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.message+" https or localhost required"});if(e&&e.screen){if(u="screen",!l.ClientUtil.checkScreenParams(e.screen,E))return;var y=r.stateCenter.browser,b=r.streamCenter.getScreenConstrains(e.screen);r.dataReport.addMsgInfo(p,{stream_type:d.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("screen"),screen:d.ZegoRTCLogEvent.kZegoTaskCreateStream.screen(b)});var S=function(g){r.streamCenter.createScreenPreviewer(g,b)&&f(g),g.getVideoTracks()[0].onended=function(){var v=_.getReportSeq();r.dataReport.newReport(v),r.dataReport.uploadReport(v,d.ZegoRTCLogEvent.kZegoTaskScreenSharingEnded),g&&r.stopPreview(g),r.stateCenter.actionListener("screenSharingEnded",g)}};y=="firefox"||typeof e.screen=="object"&&e.screen.type=="firefox"?r.startScreenShotFirFox("screen",b,function(g,v,R){g?v&&S(v):R&&E(R)}):y=="chrome"&&o.ZegoWebRTC.screenShotReady||typeof e.screen=="object"&&e.screen.type=="shot"?r.startScreenShotChrome(function(g,v,R){g?(r.logger.info(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" using extension"),v&&S(v)):(R&&r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" extension "+R),R==="SS_DIALOG_CANCEL"||typeof e.screen=="object"&&e.screen.type=="shot"?R&&E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):r.startScreenSharing(b,function(L,N,w){L?N&&S(N):(r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" "+w),w&&E(w))}))}):y=="Electron"||typeof e.screen=="object"&&e.screen.type=="Electron"?r.startScreenShotElectron(b,function(g,v,R){g?v&&S(v):R&&E(R)}):r.startScreenSharing(b,function(g,v,R){g?v&&S(v):R&&E(R)})}else{if(e&&typeof e.camera=="object"&&e.camera.videoQuality!==void 0&&!l.ClientUtil.checkInteger(e.camera.videoQuality))return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" videoQuality must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!l.ClientUtil.checkInteger(e.camera.audioBitrate))return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot less 6 kbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot greater than 510 kbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps");r.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if(typeof e.camera.bitRate!="number")return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.camera.bitRate>10240)return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&e.camera.channelCount!==void 0&&!l.ClientUtil.checkInteger(e.camera.channelCount))return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" channelCount must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must be integer number");if(e&&e.camera&&e.camera.videoQuality===4&&!l.ClientUtil.checkCameraParams(e.camera,E))return;if(e&&e.custom&&e.custom.bitRate){if(!l.ClientUtil.checkInteger(e.custom.bitRate))return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.custom.bitRate>10240)return r.logger.error(h.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.custom&&e.custom.audioBitrate){if(!l.ClientUtil.checkInteger(e.custom.audioBitrate))return r.logger.error("ze.cs.0 audioBitrate must be integer number"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.custom.audioBitrate<6)return r.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.custom.audioBitrate>510)return r.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps")}if(e&&e.custom&&e.custom.channelCount!==void 0&&e.custom.channelCount!==1&&e.custom.channelCount!==2)return r.logger.error("ze.cs.0 channelCount must number 1 or 2"),void E(d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must number 1 or 2");var k={};if(e&&e.camera)u="camera",k=e.camera,r.dataReport.addMsgInfo(p,{stream_type:d.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("camera"),camera:d.ZegoRTCLogEvent.kZegoTaskCreateStream.camera(e.camera)}),typeof k.video!="boolean"&&(k.video=!0),typeof k.audio!="boolean"&&(k.audio=!0);else if(e&&e.custom){u="custom",k=e.custom;var O=e.custom.source instanceof MediaStream?"MediaStream":"HTMLElement";r.dataReport.addMsgInfo(p,{stream_type:d.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("custom"),custom:d.ZegoRTCLogEvent.kZegoTaskCreateStream.custom(m(m({},e.custom),{source:O}))})}r.startPreview(k,u,f,E)}})},t.prototype.destroyStream=function(e){this.logger.info(h.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call");var r=_.getReportSeq();if(this.dataReport.newReport(r),!(e instanceof MediaStream))return this.logger.error(h.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(r,d.ZegoRTCLogEvent.kZegoTaskDestroyStream.error.kLocalStreamError),void this.dataReport.uploadReport(r,d.ZegoRTCLogEvent.kZegoTaskDestroyStream.event);e instanceof MediaStream&&e.getTracks().length==0&&this.logger.info(h.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" tracks is null"),this.stopPreview(e),this.dataReport.uploadReport(r,d.ZegoRTCLogEvent.kZegoTaskDestroyStream.event)},t.prototype.startPublishingStream=function(e,r,i,s){this.logger.info(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call ",e);var u,p=!0,f="",E=_.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=E,this.dataReport.newReport(E,d.ZegoRTCLogEvent.kZegoTaskPublishStart.event),p&&e===void 0&&(f="stream id required",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!p||e&&typeof e=="string"||(f="stream id type wrong",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),p&&e.length>_.MAX_STREAM_ID_LENGTH&&(f="stream id length limit",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),p&&!l.ClientUtil.checkIllegalCharacters(e)&&(f="stream ID contains illegal characters",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),p&&(!r||r instanceof MediaStream&&r.getTracks().length==0)&&(f="localStream wrong",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError);var y=this.streamCenter.checkPreview(r);if(p&&!y&&(f="stream is not from zego",this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoPreviewError),(y==null?void 0:y.isVideoEffectStarting)&&(f=(u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishEffectIsStarting).message,this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),p=!1),p&&i!==void 0&&typeof i!="object"&&(p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,f="publishOption must be object"),p&&i!==void 0&&i.streamParams!==void 0&&typeof i.streamParams!="string"&&(this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption streamParams must be string"),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,f=" publishOption streamParams must be string"),p&&i!==void 0&&i.extraInfo!==void 0&&typeof i.extraInfo!="string"&&(this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption extraInfo must be string"),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,f=" publishOption extraInfo must be string"),p&&i!==void 0&&i.videoCodec!==void 0&&typeof i.videoCodec!="string"&&(this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption videoCodec must be string"),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,f=" publishOption videoCodec must be string"),!p||!this.stateCenter.isMultiRoom||i&&typeof i.roomID=="string"&&i.roomID!=""||(p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,f=" roomID is need if set multi room"),i&&i.videoCodec&&(i.videoCodec=i.videoCodec.toUpperCase()),p&&this.rtm.isDisConnect()&&(this.logger.error("zc.p.sps.1 not login"),p=!1,u=d.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError),!p)throw this.logger.error(h.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+f),this.dataReport.uploadReport(E,void 0,u,f),delete this.stateCenter.reportSeqList.startPublish[e],{errorCode:u==null?void 0:u.code,extendedData:f};i||(i={}),this.dataReport.addMsgInfo(E,{stream:d.ZegoRTCLogEvent.kZegoTaskPublishStart.stream(e),publishOption:d.ZegoRTCLogEvent.kZegoTaskPublishStart.publishOption(i),use_na:this.stateCenter.useNetAgent?1:0}),i.audioBitRate=this.stateCenter.audioBitRate;var b,S=i.roomID?i.roomID:this.stateCenter.roomList[0]?this.stateCenter.roomList[0].roomID:"",k=this.stateCenter.getRoomByRoomID(S);if(!k)return this.logger.error("zc.p.sps.1 room no found"),!1;if(this.dataReport.addMsgInfo(E,{publish_room_id:S,isMulti:this.stateCenter.isMultiRoom}),this.stateCenter.customUrl&&this.stateCenter.customUrl.length!=0)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),b=this.stateCenter.customUrl;else{var O=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);O&&O instanceof Array&&O.length>0&&(b=O,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(O)))}if(b)return this.stateCenter.publishStreamList[e]={state:_.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:i.extraInfo?i.extraInfo:null},this.streamCenter.setPublishStateStart(k,e,r,i,s)?(k.streamHandler.onPublishStateUpdate(_.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.publisherList[e].serverUrls=b,this.streamCenter.startPublishingStream(e)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(!this.streamCenter.setPublishStateStart(k,e,r,i,s))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.stateCenter.publishStreamList[e]={state:_.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:i.extraInfo?i.extraInfo:null},this.logger.info("zc.p.sps.1 start publish"),k.streamHandler.onPublishStateUpdate(_.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""});var g=this.stateCenter.useNetAgent,v=this.streamCenter.publisherList[e];if(g)return this.stateCenter.appConfig?(this.streamCenter.publisherList[e].serverUrls=["unified_rtc"],this.streamCenter.startPublishingStream(e,g),!0):(this.streamCenter.waitPublishList.push(e),!0);var R=v.retryDispatchHandler;return R.stopMaxTime(),R.invalid(),R.initStream(e,i,!0),R.startMaxTime(),R.active(0)},t.prototype.activateSEIInsert=function(e,r,i){return i===void 0&&(i=0),!1},t.prototype.stopPublishingStream=function(e,r){var i,s;this.logger.info(h.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call ",e+(r?r.toString():""));var u=_.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=u,this.dataReport.newReport(u,d.ZegoRTCLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(u,{streamID:d.ZegoRTCLogEvent.kZegoTaskPublishStop.stream(e)}),typeof e!="string"||e=="")return this.logger.error(h.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" streamID must be string and not empty"),this.dataReport.uploadReport(u,void 0,d.ZegoRTCLogEvent.kZegoTaskPublishStop.error.kParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var p=this.streamCenter.publisherList[e],f=this.streamCenter.getRoomByStreamID(e),E=p&&p.publisher&&p.publisher.state!==_.ENUM_PUBLISH_STATE.stop||((i=p==null?void 0:p.retryStreamHandler)===null||i===void 0?void 0:i.isRetrying());if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=_.ENUM_PUBLISH_STREAM_STATE.update_info&&f){if(!r||r.code!==1102018){var y;y=this.stateCenter.type==="PUBLIC"?_.ENUM_STREAM_SUB_CMD.liveEnd:_.ENUM_STREAM_CMD_PRI.liveEnd,f.streamHandler.updateStreamInfo(e,y)}for(var b=0;b<f.streamList.length;b++)if(f.streamList[b].stream_id==e){f.streamList.splice(b--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.addMsgInfo(u,{session_id:(s=p==null?void 0:p.publisher)===null||s===void 0?void 0:s.sessionId}),this.dataReport.uploadReport(u),f&&E&&f.streamHandler.onPublishStateUpdate(_.ENUM_PUBLISH_STATE_UPDATE.error,e,r||{code:0,message:""}),!0},t.prototype.setCaptureVolume=function(e,r){var i=this;return new Promise(function(s){var u;i.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call");var p=function(L){i.logger.error(h.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" "+L),s({errorCode:d.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.code,extendedData:JSON.stringify({fail_reason:d.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.message+" "+L})})},f=i.streamCenter.ac,E=i.streamCenter.checkPreview(e);if(e instanceof MediaStream&&E)if(e.getAudioTracks().length!=0)if(typeof r!="number"||r<0||r>100)p(" volume must be number between 0 to 100");else{if(E.gainNode)E.gainNode.gain.value=r/100;else{var y=f.createMediaStreamSource(e),b=f.createGain(),S=f.createMediaStreamDestination();y.connect(b),b.connect(S);var k=S.stream.getAudioTracks()[0];for(var O in i.streamCenter.publisherList){var g=i.streamCenter.publisherList[O];if(g.localStream==e){var v=(u=g.publisher.peerConnection)===null||u===void 0?void 0:u.getSenders().find(function(L){return L.track&&L.track.kind==="audio"});v&&(v.replaceTrack(k),g.localStream.removeTrack(g.publisher.localStream.getAudioTracks()[0]),g.localStream.addTrack(k));break}}var R=e.getAudioTracks()[0];R&&(k.enabled=R.enabled,e.removeTrack(R)),e.addTrack(k),E.gainNode=b,E.gainNode.gain.value=r/100}f.resume(),s({errorCode:0,extendedData:""}),i.logger.info(h.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call success")}else p(" stream audioTrack no found");else p(" stream must be created by zego")})},t.prototype.getElectronScreenSources=function(){var e=this;return new Promise(function(r,i){var s=window.require("electron");s||(e.logger.error("zc.gess.0 Electron is not exist"),i({message:"Electron is not exist"})),s.desktopCapturer.getSources({types:["window","screen"]}).then(function(u){var p=u.map(function(f){return{id:f.id,name:f.name,thumbnail:f.thumbnail}});r(p)}).catch(function(u){e.logger.error("zc.gess.0 "+u),i(u)})})},t.prototype.startScreenShotChrome=function(e){if(o.ZegoWebRTC.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),l.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var r='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(r),e(!1,null,{code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+r})}},t.prototype.startScreenSharing=function(e,r){var i=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:e.video}).then(function(s){r(!0,s)}).catch(function(s){i.logger.error("zc.b.sss "+s),s.message&&s.message.toLowerCase()=="permission denied"?r(!1,null,d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):r(!1,null,{code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+s})}):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),r(!1,null,d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError))},t.prototype.startScreenShotFirFox=function(e,r,i){var s=this,u={video:m(m({},r.video),{mediaSource:e}),audio:r.audio};navigator.mediaDevices.getUserMedia(u).then(function(p){i(!0,p)}).catch(function(p){s.logger.error("ze.ssf.1 "+p),i(!1,null,{code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+p})})},t.prototype.startScreenShotElectron=function(e,r){var i=this;if(!window.require("electron"))return this.logger.error("ze.sse.1 Electron is not exist"),void r(!1,null,{code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" Electron is not exist"});var s={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.sourceID,maxWidth:window.screen.width,maxHeight:window.screen.height}},audio:!1};navigator.mediaDevices.getUserMedia(s).then(function(u){r(!0,u)}).catch(function(u){i.logger.error("ze.sse.1 "+u),r(!1,null,{code:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:d.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+u})})},t.prototype.startPreview=function(e,r,i,s){var u=this,p=null;return p=new c.ZegoPreview(this.logger,this.streamCenter.ac,this.stateCenter,this.streamCenter,r),this.streamCenter.previewStreamList.push(p),p.startPreview(e,function(f){var E;u.streamCenter.soundLevelDelegate&&(p==null||p.startSoundLevel()),r==="camera"&&(((E=e)===null||E===void 0?void 0:E.audio)===!1&&p&&(p.hasMicTrack=!1),(p==null?void 0:p.micTrack)&&(p.micTrack.enabled=u.streamCenter.isMicEnabled)),(e==null?void 0:e.videoOptimizationMode)&&u.streamCenter.setVideoTrackContentHint(f,e==null?void 0:e.videoOptimizationMode),u.logger.debug("zsc.sp.0 call success"),!u.stateCenter.deviceInfos&&u.recordDevices(),i&&i(f)},function(f){u.streamCenter.previewStreamList=u.streamCenter.previewStreamList.filter(function(E){return E!==p}),s&&s(f)}),!0},t.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var r in this.streamCenter.publisherList)this.streamCenter.publisherList[r].localStream===e&&(this.streamCenter.publisherList[r].localStream=null);var i=this.streamCenter.checkPreview(e);return i?(i.previewSuc&&(i.stopPreview(),this.streamCenter.removePreview(i)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},t.prototype.recordDevices=function(e,r){var i,s=this;this.logger.info("zsc.rd.0 call"),l.ClientUtil.getDevices(function(u){s.stateCenter.deviceInfos={microphones:u.microphones,speakers:u.speakers,cameras:u.cameras},e&&e(u)},function(u){s.logger.warn("zsc.rd.0 getDevices err:",u),r&&r(u)}),((i=navigator.mediaDevices)===null||i===void 0?void 0:i.ondevicechange)!==void 0&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(u){s.logger.info("zsc.rd.0 devicechange"),s.stateCenter.deviceChangeTimer&&(clearTimeout(s.stateCenter.deviceChangeTimer),s.stateCenter.deviceChangeTimer=null),s.stateCenter.deviceChangeTimer=setTimeout(function(){l.ClientUtil.getDevices(function(p){for(var f=[],E=function(v){var R=s.stateCenter.deviceInfos.cameras[v];p.cameras.find(function(L){return L.deviceID===R.deviceID})||f.push(R)},y=0;y<s.stateCenter.deviceInfos.cameras.length;y++)E(y);s.stateCenter.deviceStateOut=!1;var b=!1;f.length>0&&(b=!0),f.forEach(function(v){for(var R in s.streamCenter.publisherList){var L=s.streamCenter.publisherList[R],N=L.publisher;L.localStream&&L.cameraLabel!==""&&L.cameraLabel===v.deviceName&&(b=!1,N.sendStreamStatus(-6,N.mic_status),s.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,v.deviceName,"camera"),s.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,v.deviceName)),L.localStream&&L.localStream.getAudioTracks().length===0&&(b=!1)}var w=_.getReportSeq();s.dataReport.newReport(w,d.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),s.dataReport.addMsgInfo(w,{interrupt:0}),s.dataReport.uploadReport(w),s.stateCenter.actionListener("videoDeviceStateChanged","DELETE",v)}),b&&(s.stateCenter.deviceStateOut=!0),s.stateCenter.deviceInfos.microphones.filter(function(v){return!p.microphones.find(function(R){return R.deviceID===v.deviceID})}).forEach(function(v){for(var R in s.streamCenter.publisherList){var L=s.streamCenter.publisherList[R],N=L.publisher;L.localStream&&L.microLabel!==""&&(L.microLabel===v.deviceName||L.microLabel.includes(v.deviceName))&&(N.sendStreamStatus(N.camera_status,-6),s.stateCenter.actionListener("_deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,s.streamCenter.publisherList[R].microLabel,"micro"),s.stateCenter.actionListener("deviceError",a.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,s.streamCenter.publisherList[R].microLabel))}var w=_.getReportSeq();s.dataReport.newReport(w,d.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),s.dataReport.addMsgInfo(w,{interrupt:0}),s.dataReport.uploadReport(w),s.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",v)});var S=s.stateCenter.deviceInfos.speakers.filter(function(v){return!p.speakers.find(function(R){return R.deviceID===v.deviceID})}),k=p.cameras.filter(function(v){return!s.stateCenter.deviceInfos.cameras.find(function(R){return R.deviceID===v.deviceID})}),O=p.microphones.filter(function(v){return!s.stateCenter.deviceInfos.microphones.find(function(R){return R.deviceID===v.deviceID})}),g=p.speakers.filter(function(v){return!s.stateCenter.deviceInfos.speakers.find(function(R){return R.deviceID===v.deviceID})});S.forEach(function(v){var R=_.getReportSeq();s.dataReport.newReport(R,d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),s.dataReport.addMsgInfo(R,{reason:d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("delete"),device:d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(v)}),s.dataReport.uploadReport(R),s.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",v)}),k.forEach(function(v){var R=_.getReportSeq();s.dataReport.newReport(R,d.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),s.dataReport.addMsgInfo(R,{interrupt:1}),s.dataReport.uploadReport(R),s.stateCenter.actionListener("videoDeviceStateChanged","ADD",v)}),O.forEach(function(v){var R=_.getReportSeq();s.dataReport.newReport(R,d.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),s.dataReport.addMsgInfo(R,{interrupt:1}),s.dataReport.uploadReport(R),s.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",v)}),g.forEach(function(v){var R=_.getReportSeq();s.dataReport.newReport(R,d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),s.dataReport.addMsgInfo(R,{reason:d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("add"),device:d.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(v)}),s.dataReport.uploadReport(R),s.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",v)}),s.stateCenter.deviceInfos={microphones:p.microphones,speakers:p.speakers,cameras:p.cameras}},function(p){s.logger.warn("zsc.rd.0 getDevices err:",p)})},500)})},t.prototype.getStreamThroughCanvas=function(e){if(e.getVideoTracks().length==0)return e;var r=document.createElement("video"),i=document.createElement("canvas"),s=i.getContext("2d");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),document.body.append(r),document.body.append(i),r.srcObject=e;var u=function(){s==null||s.drawImage(r,0,0,i.width,i.height),window.requestAnimationFrame(u),r.srcObject=e};r.oncanplay=function(){i.width=r.videoWidth,i.height=r.videoHeight,r.play(),u()};var p=i.captureStream(15),f=p.getVideoTracks()[0],E=f.stop;if(f.stop=function(){E.call(f),u(),r.remove(),i.width=0,i.remove()},e instanceof MediaStream&&e.getAudioTracks().length){var y=e.getAudioTracks()[0];p.addTrack(y)}return p},t.prototype.startWaitPublish=function(){var e=this;this.streamCenter.waitPublishList.forEach(function(r){e.streamCenter.startPublishingStream(r,e.stateCenter.useNetAgent)}),this.streamCenter.waitPublishList=[]},t.prototype.getStreamStats=function(e){var r,i,s;return this.logger.info(h.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call"),e instanceof MediaStream&&e.getTracks().length>0?s=(r=this.streamCenter.checkPublish(e))===null||r===void 0?void 0:r.publisher:typeof e=="string"&&(s=(i=this.streamCenter.publisherList[e])===null||i===void 0?void 0:i.publisher),s?(s==null?void 0:s.currentQuality)||null:(this.logger.error("zsc.sp.0 stream is not publishing"),null)},t}();T.PublishModule=n},3770:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},m.apply(this,arguments)},h=this&&this.__awaiter||function(o,n,t,e){return new(t||(t=Promise))(function(r,i){function s(f){try{p(e.next(f))}catch(E){i(E)}}function u(f){try{p(e.throw(f))}catch(E){i(E)}}function p(f){var E;f.done?r(f.value):(E=f.value,E instanceof t?E:new t(function(y){y(E)})).then(s,u)}p((e=e.apply(o,n||[])).next())})},_=this&&this.__generator||function(o,n){var t,e,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(p){return function(f){return function(E){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(r=2&E[0]?e.return:E[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,E[1])).done)return r;switch(e=0,r&&(E=[2&E[0],r.value]),E[0]){case 0:case 1:r=E;break;case 4:return s.label++,{value:E[1],done:!1};case 5:s.label++,e=E[1],E=[0];continue;case 7:E=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||E[0]!==6&&E[0]!==2)){s=0;continue}if(E[0]===3&&(!r||E[1]>r[0]&&E[1]<r[3])){s.label=E[1];break}if(E[0]===6&&s.label<r[1]){s.label=r[1],r=E;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(E);break}r[2]&&s.ops.pop(),s.trys.pop();continue}E=n.call(o,s)}catch(y){E=[6,y],e=0}finally{t=r=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([p,f])}}};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoPreview=void 0;var d=I(6706),l=I(3529),a=I(1089),c=function(){function o(n,t,e,r,i){var s=this;this.logger=n,this.ac=t,this.stateCenter=e,this.streamCenter=r,this.previewType=i,this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.soundLevel=0,this.hasEmptyAudioTrack=!1,this.script=null,this.mic=null,this._audioTrack=null,this._videoTrack=null,this.cloneVideoTrack=null,this.originVideoTrack=null,this.activateSEIConfig=null,this.isAudioEnabled=!0,this.isVideoEnabled=!0,this.gainNode=null,this.cameraMaxResolution={},this.muteImage=null,this.hasMicTrack=!0,this.enableMicrophoneOnly=function(u,p){var f;if(!s.localStream)return s.logger.error("zp.em.2 no localStream"),!1;var E=(f=p.checkPublish(s.localStream))===null||f===void 0?void 0:f.publisher;if(E){var y=E.camera_status,b=s.isAudioEnabled&&u?0:20;E.sendStreamStatus(y,b)}return s.micTrack?(s.micTrack.enabled=s.isAudioEnabled&&u,s.logger.debug("zp.emo.2 call success"),!0):(s.logger.info("zp.emo.2 no micTrack"),!0)}}return Object.defineProperty(o.prototype,"audioTrack",{get:function(){var n;return this._audioTrack||((n=this.localStream)===null||n===void 0?void 0:n.getAudioTracks()[0])||null},set:function(n){this._audioTrack=n},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"videoTrack",{get:function(){var n;return this._videoTrack||((n=this.localStream)===null||n===void 0?void 0:n.getVideoTracks()[0])||null},set:function(n){this._videoTrack=n},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"micTrack",{get:function(){return this.hasMicTrack&&this.previewType==="camera"&&this.audioTrack||null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isVideoEffectStarting",{get:function(){return!!this.videoEffect&&this.videoEffect.isStarting},enumerable:!1,configurable:!0}),o.prototype.getMediaStreamConstraints=function(n,t){var e={audio:null,video:null};if(e.audio=!0,e.video={width:640,height:480,frameRate:15,bitRate:this.stateCenter.settingConfig.getSetting("camera_video_bitrate")},n.audio?n.audioInput===void 0&&n.ANS===void 0&&n.AGC===void 0&&n.AEC===void 0&&n.channelCount===void 0?(e.audio={},e.audio.noiseSuppression=this.stateCenter.settingConfig.getSetting("ANS"),e.audio.autoGainControl=this.stateCenter.settingConfig.getSetting("AGC"),e.audio.echoCancellation=this.stateCenter.settingConfig.getSetting("AEC"),e.audio.channelCount=1):(e.audio={},n.audioInput!==void 0&&n.audioInput!==null&&(e.audio.deviceId={exact:n.audioInput}),n.ANS!==void 0&&(e.audio.noiseSuppression=n.ANS),n.AGC!==void 0&&(e.audio.autoGainControl=n.AGC),n.AEC!==void 0&&(e.audio.echoCancellation=n.AEC),n.channelCount!==void 0&&(e.audio.channelCount=n.channelCount)):n.audio===!1&&(e.audio=!1),n.video){var r=640,i=480,s=15,u=this.stateCenter.settingConfig.getSetting("camera_video_bitrate");if(n.videoQuality===1?(r=d.ENUM_RESOLUTION_TYPE.LOW.width,i=d.ENUM_RESOLUTION_TYPE.LOW.height,s=d.ENUM_RESOLUTION_TYPE.LOW.frameRate,u=d.ENUM_RESOLUTION_TYPE.LOW.bitRate):n.videoQuality===2?(r=d.ENUM_RESOLUTION_TYPE.MEDIUM.width,i=d.ENUM_RESOLUTION_TYPE.MEDIUM.height,s=d.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,u=d.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):n.videoQuality===3?(r=d.ENUM_RESOLUTION_TYPE.HIGH.width,i=d.ENUM_RESOLUTION_TYPE.HIGH.height,s=d.ENUM_RESOLUTION_TYPE.HIGH.frameRate,u=d.ENUM_RESOLUTION_TYPE.HIGH.bitRate):n.videoQuality===4?(r=n.width,i=n.height,s=n.frameRate,u=n.bitRate||this.stateCenter.settingConfig.getSetting("camera_video_bitrate")):this.logger.info("zp.gmsc.2 use default"),t&&(n.width&&(r=n.width),n.height&&(i=n.height),n.frameRate&&(s=n.frameRate),n.bitRate&&(u=n.bitRate)),n.horizontal===!1){var p=i;i=r,r=p}n.isSwitch===!0&&(p=i,i=r,r=p),e.video={width:r,height:i,frameRate:s,bitRate:u},n.facingMode!=null?e.video.facingMode=n.facingMode:n.videoInput!=null&&n.videoInput!=null&&n.videoInput!=""&&(e.video.deviceId={exact:n.videoInput}),this.logger.info("zp.gmsc.2 width: "+r+" height: "+i+" rate: "+s)}else n.video===!1&&(n.audioBitrate&&(e.video={}),e.video=!1);return e},o.prototype.startPreview=function(n,t,e){return h(this,void 0,void 0,function(){var r,i,s,u,p,f,E,y=this;return _(this,function(b){return this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=n,navigator.mediaDevices===void 0||navigator.mediaDevices.getUserMedia==null?(e&&e(l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):n.source instanceof MediaStream?(r=n.source.getVideoTracks(),i=r.length>0?r[0].getSettings():{width:0,height:0,frameRate:0},this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=n.source,this.initMediaTrack(n.source),this.videoInfo={width:i.width,height:i.height,frameRate:i.frameRate,bitRate:n.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),startBitrate:n.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode"),channelCount:n.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*n.audioBitrate||48e3},t&&t(this.localStream),[2]):n.source instanceof HTMLMediaElement?((s=this.captureStream(n.source,n))?(this.videoInfo.bitRate=n.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),this.previewSuc=!0,this.initMediaTrack(s),t&&t(s)):e&&e(l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):((u=this.getMediaStreamConstraints(n)).audio&&(p=this.stateCenter.settingConfig.getSetting("AEC",!0),f=this.stateCenter.settingConfig.getSetting("AGC",!0),E=this.stateCenter.settingConfig.getSetting("ANS",!0),typeof p=="boolean"&&(this.logger.info("zp.sv.2 setting AEC "+p),u.audio.echoCancellation=p),typeof f=="boolean"&&(this.logger.info("zp.sv.2 setting AGC "+f),u.audio.autoGainControl=f),typeof E=="boolean"&&(this.logger.info("zp.sv.2 setting ANS "+E),u.audio.noiseSuppression=E)),this.videoInfo=m({},u.video),this.videoInfo?(this.videoInfo.audioBitrate=1e3*n.audioBitrate||48e3,this.videoInfo.startBitrate=n.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")):n.audioBitrate&&(this.videoInfo={audioBitrate:1e3*n.audioBitrate||48e3}),this.mediaStreamConfig.video=!!u.video,this.mediaStreamConfig.audio=!!u.audio,this.logger.info("zp.sv.2 ",JSON.stringify(u)),n.unlimitedCaptureResolution&&u.video.width&&(u.video.width={ideal:4096},u.video.height={ideal:2160},this.logger.info("zp.sv.2 ","capture max resolution of camera")),navigator.mediaDevices.getUserMedia(u).then(function(S){y.logger.info("zp.sv.2 success"),y.localStream=S,y.previewSuc=!0,y.initMediaTrack(S),y.videoInfo&&(y.videoInfo.channelCount=n.channelCount||(y.audioTrack&&y.audioTrack.getSettings?y.audioTrack.getSettings().channelCount:1)),t&&t(S)},function(S){if(y.logger.info("zp.sv.2 failed ",S.name," ",S.message),e){var k=l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kGetUserMediaError;k.message=k.message+" "+S.name+" "+S.message,S.name==="NotAllowedError"||S.name==="SecurityError"?(k=m({},l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoAllowedError)).message=S.name+": "+k.message:S.name==="NotReadableError"?(k=m({},l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoReadableError)).message=S.name+": "+k.message:S.name==="OverconstrainedError"&&((k=m({},l.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceOverConstrainedError)).message=S.name+": "+k.message+(S.constraint?". such as "+S.constraint:"")),e(k)}}),[2])})})},o.prototype.captureStream=function(n,t){if(!n)return this.logger.info("zp.cs.2 no local video"),null;var e;if(n.captureStream)e=n.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!n.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;e=n.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return e.getTracks().length==0?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=e,this.videoInfo={width:n.videoWidth,height:n.videoHeight,frameRate:0,bitRate:t.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),channelCount:t.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*t.audioBitrate||48e3,startBitrate:t.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")},this.logger.debug("zp.cs.2 called success"),this.localStream)},o.prototype.stopPreview=function(){var n,t,e,r;this.logger.info("zp.sv.2.1 called"),this.localStream&&(this.videoEffect&&(this.videoEffect.setBeautyEffectOptions(!1),this.videoEffect.destroy()),(n=this.cloneVideoTrack)===null||n===void 0||n.stop(),this.muteImageAnID&&cancelAnimationFrame(this.muteImageAnID),(t=this.originVideoTrack)===null||t===void 0||t.stop(),(e=this.videoTrack)===null||e===void 0||e.stop(),(r=this.audioTrack)===null||r===void 0||r.stop(),this.localStream.getTracks().reverse().forEach(function(i){return i.stop()}),this.localStream=null,this.videoInfo={})},o.prototype.enableMicrophone=function(n,t){return!1},o.prototype.enableCamera=function(n,t,e){return!1},o.prototype.enableCameraCapturing=function(n){return h(this,void 0,void 0,function(){return _(this,function(t){return[2,!1]})})},o.prototype.startSoundLevel=function(){var n=this;if(this.localStream&&this.localStream.getAudioTracks().length!=0){this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect();try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var e=t.inputBuffer.getChannelData(0),r=0,i=0;i<e.length;i++)r<e[i]&&(r=e[i]);n.soundLevel=100*r},this.ac.resume()}catch(t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" get sound level failed "+t)}}},o.prototype.stopSoundLevel=function(){this.soundLevel=0,this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},o.prototype.restartSoundLevel=function(){this.streamCenter.soundLevelDelegate?(this.stopSoundLevel(),this.startSoundLevel()):this.stopSoundLevel()},o.prototype.setBeautyEffect=function(n,t){return h(this,void 0,void 0,function(){return _(this,function(e){return[2]})})},o.prototype.replacePreviewTrack=function(n,t){t===void 0&&(t=!1)},o.prototype.initMediaTrack=function(n){n.getVideoTracks().length>0&&(this.videoTrack=n.getVideoTracks()[0],this.originVideoTrack=this.videoTrack),n.getAudioTracks().length>0&&(this.audioTrack=n.getAudioTracks()[0])},o}();T.ZegoPreview=c},1547:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoPublish=void 0;var h=I(6706),_=I(4767),d=I(608),l=I(3529),a=I(1089),c=function(){function o(n,t,e,r,i,s,u,p,f){this.state=h.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.sessionToken="",this.candidateInfo=[],this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.currentQuality={video:{videoBitrate:0,videoFPS:0,videoTransferFPS:0,frameHeight:0,frameWidth:0,muteState:"1",videoQuality:-1,videoPacketsLost:0,videoPacketsLostRate:0,googCodecName:""},audio:{audioBitrate:0,audioCodec:"opus",muteState:"1",audioQuality:-1,audioFPS:0,audioPacketsLost:0,audioPacketsLostRate:0,googCodecName:""}},this.reportSeq=NaN,this.streamReportSeq=h.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0,channelCount:1,audioBitrate:48e3},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.peerConnection=null,this.qualityCount=0,this.closeSessionSignal=!1,this.channelCount=1,this.localSdpOrder=[],this.remoteSdpOrder=[],this.videoCodec="H264",this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.cameraState="on",this.microState="on",this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[],this.isPeer=!1,this.peerFailCount=0,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=h.ENUM_PROBE_STATE.probed,this.iceDisconnectedMaxTime=15e3,this.isUpdateSDP=!1,this.toBeReplacedTracks={},this.send_seq=0,this.dataChannelState=0,this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.answerSdpTime=0,this.audioSrcNode=void 0,this.audioStreamDestNode=void 0,this.camera_status=2,this.mic_status=2,this.streamId=n,this.logger=t,this.dataReport=e,this.qualityTimeInterval=r,this.ac=s,this.mediaEleSources=u,this.streamCenter=i,this.stateCenter=p,this.dataReport.newReport(this.streamReportSeq),this.videoCodec=this.stateCenter.settingConfig.getSetting("publish_video_codec"),this.localStream=f}return Object.defineProperty(o.prototype,"previewer",{get:function(){return this.streamCenter.checkPreview(this.localStream)},enumerable:!1,configurable:!0}),o.prototype.publishStateUpdateError=function(n,t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  call ",this.streamId,JSON.stringify(n)),this.streamId&&this.onPublishStateUpdate(h.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,n,t),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  ended")},o.prototype.resetPublish=function(){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_RESET_PUBLISH+"   "+this.streamId+" call"),this.state=h.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,this.peerConnection==null&&this.peerConnection==null||(this.peerConnection.close(),this.peerConnection=null),this.negoTimer!=null&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.iceDisconnectedTimer!=null&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.resetEncBitrate(),this.isUpdateSDP=!1},o.prototype.clearPublishQualityTimer=function(){this.qualityTimer!=null&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},o.prototype.shouldSendCloseSession=function(){return this.state!=h.ENUM_PUBLISH_STATE.stop&&this.state!=h.ENUM_PUBLISH_STATE.waitingSessionRsp},o.prototype.startPublish=function(n,t,e,r,i){var s,u,p,f=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+n+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),n){var E;this.localStream=t,this.mediaStreamConfig=r,this.channelCount=r.channelCount,this.publishOption=i||{},this.currentQuality.video.muteState=((u=(s=this.previewer)===null||s===void 0?void 0:s.videoTrack)===null||u===void 0?void 0:u.enabled)?"0":"1",this.currentQuality.audio.muteState=this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&r&&(r.externalCapture||r.externalMediaStream)&&(this.localStream.onaddtrack=function(){var k,O,g,v;f.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+f.streamId+" Track added");var R=[];((k=f.previewer)===null||k===void 0?void 0:k.videoTrack)&&R.push((O=f.previewer)===null||O===void 0?void 0:O.videoTrack);var L=f.localStream.getAudioTracks();if(R.length>1){var N=(g=f.peerConnection)===null||g===void 0?void 0:g.getSenders().find(function(w){var B;return((B=w.track)===null||B===void 0?void 0:B.kind)===R[1].kind});N==null||N.replaceTrack(R[1]),f.localStream.removeTrack(R[0])}else L.length>1&&(N=(v=f.peerConnection)===null||v===void 0?void 0:v.getSenders().find(function(w){var B;return((B=w.track)===null||B===void 0?void 0:B.kind)===L[1].kind}),N==null||N.replaceTrack(L[1]),f.localStream.removeTrack(L[0]))}),e&&(this.videoInfo=e),i&&i.videoCodec&&(this.videoCodec=i.videoCodec);var y=(p=this.previewer)===null||p===void 0?void 0:p.previewType;switch(y){case"camera":E=this.stateCenter.settingConfig.getSetting("camera_video_bitrate",!0);break;case"screen":E=this.stateCenter.settingConfig.getSetting("screen_video_bitrate",!0);break;case"custom":E=this.stateCenter.settingConfig.getSetting("custom_video_bitrate",!0)}E&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+y+" "+E),this.videoInfo.bitRate=E);var b=this.stateCenter.settingConfig.getSetting("bitrate_mode",!0);b&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting bitrate_mode "+b),this.videoInfo.startBitrate=b);var S=this.stateCenter.settingConfig.getSetting("publish_video_codec",!0);S&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting publish_video_codec "+S),this.videoCodec=S),this.dataReport.addMsgInfo(this.reportSeq,{video_en_codec_id:l.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_codec_id(this.videoCodec=="VP8"?2:0),audio_c_channel_count:l.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_c_channel_count(this.channelCount==2?2:1),audio_en_bps:l.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_en_bps(this.videoInfo.audioBitrate),aec_level:l.ZegoRTCLogEvent.kZegoTaskPublishStart.aec_level(r.AEC==1?2:r.AEC==0?0:2),ans_level:l.ZegoRTCLogEvent.kZegoTaskPublishStart.ans_level(r.ANS==1?2:r.ANS==0?0:2),agc:l.ZegoRTCLogEvent.kZegoTaskPublishStart.agc(r.AGC==1?2:r.AGC==0?0:2),traffic_control_min_video_bitrate:l.ZegoRTCLogEvent.kZegoTaskPublishStart.traffic_control_min_video_bitrate(this.videoInfo.bitRate)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){f.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" waiting timeout"),f.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError)},this.negoInterval)}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+n+" streamId is null")},o.prototype.activateSEIInsert=function(n,t){return new Promise(function(e,r){e(!1)})},o.prototype.createSession=function(n){var t=this;this.sessionSeq=h.getSeq();var e=this.streamId;this.streamCenter.testEnvironment==1&&(e="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var r=this.stateCenter.settingConfig.getSetting("gw_nodes");if(r&&r instanceof Array&&r.length>0&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+JSON.stringify(r)),this.gwNodeList=r,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer){this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp");var i=new Date().getTime();this.signal.createSessionWithSdp({seq:this.sessionSeq,type:0,mode:0,streamId:e,videoInfo:this.videoInfo,strAuthParam:this.publishOption&&this.publishOption.streamParams||"",sdp:n.sdp,serverHost:this.gwNode},function(s,u,p){var f=new Date().getTime();t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session time "+(f-i)),t.handleCreateSessionWithSdpResp(s,u,p)},function(s,u){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:s}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:s}),t.publishStateUpdateError(s==h.SEND_MSG_TIMEOUT?l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)})}else this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,e,this.publishOption&&this.publishOption.streamParams,this.gwNode,function(s,u,p){t.handleCreateSessionResp(s,u,p)},function(s,u){t.reportSeq,t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:s}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:s}),t.publishStateUpdateError(s==h.SEND_MSG_TIMEOUT?l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)});this.state=h.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" called success"),this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.start},o.prototype.handleCreateSessionResp=function(n,t,e){var r=e.turn_server,i=r.split("?")[0]&&r.split("?")[0].slice(5),s=this.streamCenter.server.split("?"),u=s[1]&&s[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:e.session_id,url:"webrtc://"+i+"/"+u+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:e.session_id,url:"webrtc://"+i+"/"+u+"/"+this.streamId}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" sessionId:"+e.session_id),this.sessionSeq==n?(this.gwNodeList=e.gw_nodes&&e.gw_nodes.length>0?e.gw_nodes:this.gwNodeList,this.gwNode=e.gw_nodes&&e.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=e.gw_nodes_ttl?new Date().getTime()+1e3*e.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=e.clientip?e.clientip:this.stateCenter.clientIP,e.result!==0?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session failed "+e.result),this.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)):(this.sessionId=e.session_id,this.sessionToken=e.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session success "+this.sessionId),this.dataReport.addMsgInfo(this.reportSeq,{session_id:l.ZegoRTCLogEvent.kZegoTaskPublishStart.session_id(this.sessionId)}),this.onCreatePublishSessionSuccess(e))):this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" seq is not match.")},o.prototype.handleCreateSessionWithSdpResp=function(n,t,e){var r=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" sessionId:"+t),this.sessionSeq==n){this.gwNodeList=e.gw_nodes&&e.gw_nodes.length>0?e.gw_nodes:this.gwNodeList,this.gwNode=e.gw_nodes&&e.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=e.gw_nodes_ttl?new Date().getTime()+1e3*e.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=e.clientip?e.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t});var i=0,s=new Date().getTime();this.dataReport.dataStatistics[this.reportSeq]&&(i=s-this.dataReport.dataStatistics[this.reportSeq].event_time,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create sdp time "+i)),this.answerSdpTime=s,this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t,sessionTime:i}),e.result!==0?(this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session failed "+e.result),this.publishStateUpdateError({code:l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.code,message:l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.message+" result:"+e.result})):(this.sessionId=t,this.sessionToken=e.session_token,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" get remote session success "+this.streamId),this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(u,p,f){r.onRecvCloseSession(u,p,f)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(u,p,f){r.onRecvResetSession(u,p,f)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(u,p,f){r.onRecvPublishEvent(u,p,f)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(u,p,f){r.onRecvClientInfo(u,p,f)}),this.signal.registerPushCallback("MediaDescUpdatePush",this.sessionId,function(u,p,f){r.onRecvUpdateMediaDescription(u,p,f)}),this.onGetRemoteOfferSuccess(e.sdp))}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" seq is not match.")},o.prototype.onCreatePublishSessionSuccess=function(n){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" called");var e=[];if(n.turn_server){var r=n.turn_server,i=this.stateCenter.turnOverTcpOnly,s=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);s&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" setting udp_or_tcp "+s),i=s==="tcp"),i&&(r=r.replace("udp","tcp")),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" over tcp "+r),e.push(r)}n.stun_server&&e.push(n.stun_server);var u={iceTransportPolicy:"relay",iceServers:[{urls:e,username:n.turn_username,credential:n.turn_auth_key}]};this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" username: "+n.turn_username),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" credential: "+n.turn_auth_key),this.createOffer(u),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(p,f,E){t.onRecvCandidateInfo(p,f,E)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(p,f,E){t.onRecvCloseSession(p,f,E)}),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(p,f,E){t.onRecvMediaDescription(p,f,E)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(p,f,E){t.onRecvResetSession(p,f,E)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(p,f,E){t.onRecvPublishEvent(p,f,E)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(p,f,E){t.onRecvClientInfo(p,f,E)}),this.signal.registerPushCallback("MediaDescUpdatePush",this.sessionId,function(p,f,E){t.onRecvUpdateMediaDescription(p,f,E)}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" call success")},o.prototype.createOffer=function(n){var t,e,r=this;this.peerConnection=new RTCPeerConnection(n),this.effectList&&this.effectList.forEach(function(p){p.processor&&(p.processor.peerConnection=r.peerConnection)}),this.audioMixList&&this.audioMixList.forEach(function(p){p.audioMix&&(p.audioMix.peerConnection=r.peerConnection)}),this.peerConnection.onicecandidate=function(p){r.onIceCandidate(p)},this.peerConnection.onsignalingstatechange=function(p){r.onConnectionStateChange(p)},this.peerConnection.oniceconnectionstatechange=function(p){r.onIceConnectionStateChange(p)},this.streamCenter.isDataChannelEnabled&&(this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=function(p){r.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+r.streamId+" data channel open"),r.dataChannelState=1},this.dataChannel.onclose=function(p){r.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+r.streamId+" data channel close ")});var i=[],s=[];this.localStream&&(this.localStream.getTracks().forEach(function(p){var f;(f=r.peerConnection)===null||f===void 0||f.addTrack(p,r.localStream)}),((t=this.previewer)===null||t===void 0?void 0:t.videoTrack)&&(i=[(e=this.previewer)===null||e===void 0?void 0:e.videoTrack]),s=this.localStream.getAudioTracks(),i.length>0&&this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" video device: "+i[0].label),s.length>0&&this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" audio device: "+s[0].label));var u={offerToReceiveAudio:s.length>0?1:0,offerToReceiveVideo:i.length>0?1:0};this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(u)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(u).then(function(p){r.dataReport.eventEnd(r.reportSeq,"CreateOffer"),r.dataReport.eventEnd(r.streamReportSeq,"CreateOffer"),r.onCreateOfferSuccess(p)},function(p){r.dataReport.eventEndWithMsg(r.reportSeq,"CreateOffer",{error:p.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"CreateOffer",{error:p.toString()}),r.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+r.streamId+" create offer error "+p.toString()),r.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCreateOfferError,!0)})},o.prototype.onCreateOfferSuccess=function(n,t,e,r){var i,s=this;t&&(this.isUpdateSDP=!0,r&&(this.updateSDPCallBack=r)),this.videoInfo.bitRate>0&&(n.sdp=this.updateBandwidthRestriction(n.sdp,this.videoInfo.bitRate)),n.sdp=n.sdp.replace(/sendrecv/g,"sendonly");var u=n.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)?n.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)[0]:null;if(u){var p=u.replace(/sendonly/,"sendrecv");n.sdp=n.sdp.replace(u,p)}n.sdp=n.sdp.replace(/useinbandfec=\d+/,(this.videoInfo.audioBitrate?"maxaveragebitrate="+this.videoInfo.audioBitrate:"")+(this.videoInfo.channelCount===2?";stereo=1":"")),this.localSdpOrder=n.sdp.match(/m=(.\w*)\s/g)||[],this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" local sdp revert "+this.localSdpOrder.join("")),n.sdp=_.SdpUtil.getSDPByVideDecodeType(n.sdp,this.videoCodec,!0),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+n.sdp.substr(0,n.sdp.length/2)),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+n.sdp.substr(n.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),(i=this.peerConnection)===null||i===void 0||i.setLocalDescription(n).then(function(){s.dataReport.eventEnd(s.reportSeq,"SetLocalDescription"),s.dataReport.eventEnd(s.streamReportSeq,"SetLocalDescription"),s.onSetLocalDescriptionSuccess(n,e)},function(f){s.dataReport.eventEndWithMsg(s.reportSeq,"SetLocalDescription",{error:f.toString()}),s.dataReport.eventEndWithMsg(s.streamReportSeq,"SetLocalDescription",{error:f.toString()}),s.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+s.streamId+" error "+f.toString()),s.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetLocalDescError,!0)})},o.prototype.updateBandwidthRestriction=function(n,t){var e="AS";return this.stateCenter.browser==="firefox"&&(t=1e3*(t>>>0),e="TIAS"),n.indexOf("b="+e+":")===-1?n.replace(/(m=video.*\r\nc=IN.*\r\n)/g,"$1b="+e+":"+t+`\r
`):(n=n.replace(new RegExp("b="+e+`:.*\r
`,"g"),"b="+e+":"+t+`\r
`)).replace("b="+e+":"+t+`\r
`,"")},o.prototype.onSetLocalDescriptionSuccess=function(n,t){var e=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),!this.isUpdateSDP&&(this.state=h.ENUM_PUBLISH_STATE.waitingOfferRsp),t&&(this.videoInfo=m(m({},this.videoInfo),t));var r={sdp:n.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};if(this.offerSeq=h.getSeq(),this.isUpdateSDP){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" update sdp");var i=m(m({},r),{seq:this.sessionSeq,peerID:this.peerID,type:0});return this.dataReport.eventStart(this.reportSeq,"SendMediaDescUpdate"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDescUpdate"),void this.signal.sendMediaDescUpdateReq(this.offerSeq,this.sessionId,i,function(s,u,p){},function(s,u){e.dataReport.eventEndWithMsg(e.reportSeq,"SendMediaDescUpdate",{error:s}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"SendMediaDescUpdate",{error:s}),e.updateSDPCallBack&&e.updateSDPCallBack(-1),e.publishStateUpdateError(s==h.SEND_MSG_TIMEOUT?l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kUpdateMediaDescriptionTimeOut:l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kUpdateMediaDescriptionError)})}this.isPeer?this.createSession(n):(this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,function(s,u,p){e.offerSeq==s&&e.sessionId==u?(e.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" send success"),e.dataReport.eventEndWithMsg(e.reportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:r.width,height:r.height,frameRate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv}}),e.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" send success stateNego:waiterAnswer"),e.stateNego=h.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,e.state=h.ENUM_PUBLISH_STATE.waitingServerAnswer):e.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+e.streamId+" seq or sessionId is not equal")},function(s,u){e.dataReport.eventEndWithMsg(e.reportSeq,"SendMediaDesc",{error:s}),e.dataReport.eventEndWithMsg(e.streamReportSeq,"SendMediaDesc",{error:s}),e.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)}),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" call success"))},o.prototype.onRecvUpdateMediaDescription=function(n,t,e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC+" "+this.streamId+" received"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvUpdateMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvUpdateMediaDesc"),this.signal.sendUpdateMediaDescAck(n,this.sessionId,0,this.peerID),e.type==1?this.onGetRemoteOfferSuccess(e.sdp):this.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)},o.prototype.onRecvMediaDescription=function(n,t,e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received"),this.state==h.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(n,this.sessionId,0),e.type==1?this.onGetRemoteOfferSuccess(e.sdp):this.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)):this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},o.prototype.onGetRemoteOfferSuccess=function(n){var t,e,r,i,s,u,p=this;this.videoInfo.audioBitrate&&this.videoInfo.audioBitrate!==48e3&&(n=n.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.videoInfo.audioBitrate)),this.remoteSdpOrder=n.match(/m=(.\w*)\s/g)||[],this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+NaN+this.remoteSdpOrder.join(""));var f=this.stateCenter.turnOverTcpOnly,E=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);if(E&&(this.logger.info("zp.oro.0 setting udp_or_tcp "+E),f=E==="tcp"),f&&((t=n.match(/candidate.*/g))===null||t===void 0||t.forEach(function(Y){var te=Y.replace(/udp/,"tcp");n=n.replace(Y,te)})),this.logger.info("zp.oro.0 "+this.streamId+" sdp revert "+this.localSdpOrder.join("")+" "+this.remoteSdpOrder.join("")),this.localSdpOrder.join()!==this.remoteSdpOrder.join()&&this.localSdpOrder.length==this.remoteSdpOrder.length){var y=new RegExp("[\\s\\S]*"+this.remoteSdpOrder[0]).exec(n)[0].replace(this.remoteSdpOrder[0],""),b=[],S="";this.localSdpOrder.forEach(function(Y){var te=p.remoteSdpOrder.findIndex(function(J){return J==Y}),F=new RegExp(Y+"[\\s\\S]*"+(p.remoteSdpOrder[te+1]||"")).exec(n)[0].replace(p.remoteSdpOrder[te+1],""),K=/a=mid:(\w)/.exec(F)[1];b.push(K),S+=F||""}),n=y.replace(/a=group:BUNDLE.*/,"a=group:BUNDLE "+b.join(" "))+S,this.localSdpOrder=[],this.remoteSdpOrder=[]}var k=n.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(\d+).*)/);if(this.stateCenter.browser=="chrome"){var O=0;if(this.videoInfo.bitRate&&this.videoInfo.startBitrate==="target"&&(O=this.videoInfo.bitRate),k!==null&&O){var g=k[3];n=g.indexOf("apt=")!==-1?n.replace(g,"a=fmtp:96 x-google-start-bitrate="+O+`
`+g):n.replace(g,g+";x-google-start-bitrate="+O)}}if(this.videoInfo.bitRate>0){var v=/b=AS.*(\r\n|\n)/.test(n);n=v?n.replace(/AS:(\d+)/,"AS:"+this.videoInfo.bitRate):n.replace(/m=video.*(\r\n|\n)c=.*(\r\n|\n)/,"$&b=AS:"+this.videoInfo.bitRate+`
`);var R=(e=this.peerConnection)===null||e===void 0?void 0:e.getSenders().find(function(Y){return Y.track&&Y.track.kind==="video"});if(R&&R.getParameters&&R.setParameters){var L=R.getParameters();L.encodings&&L.encodings.length!=0||(L.encodings=[{}]),L.encodings[0].maxBitrate=1e3*this.videoInfo.bitRate;var N=this.lastPublishStats.frameWidth,w=((i=(r=this.previewer)===null||r===void 0?void 0:r.cameraMaxResolution)===null||i===void 0?void 0:i.maxWidth)||0,B=(s=this.previewer)===null||s===void 0?void 0:s.videoInfo.width,x=N?Math.min(w,N):w;if(w&&B){var Z=Math.max(x/B,1);L.encodings[0].scaleResolutionDownBy=Z}R.setParameters(L)}}this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" remoteSdp:",n);var V={type:"answer",sdp:n,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),(u=this.peerConnection)===null||u===void 0||u.setRemoteDescription(new RTCSessionDescription(V)).then(function(){p.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+p.streamId+" set success"),p.dataReport.eventEnd(p.reportSeq,"SetRemoteDescription"),p.dataReport.eventEnd(p.streamReportSeq,"SetRemoteDescription"),p.stateNego==h.ENUM_PUBLISH_STATE_NEGO.iceConnected&&p.updateSDPCallBack&&(p.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+p.streamId+" update sdp success"),p.updateSDPCallBack(0),p.updateSDPCallBack=void 0,p.isUpdateSDP=!1)},function(Y){p.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+p.streamId+" failed: "+Y.toString()),p.dataReport.eventEndWithMsg(p.reportSeq,"SetRemoteDescription",{error:Y.toString()}),p.dataReport.eventEndWithMsg(p.streamReportSeq,"SetRemoteDescription",{error:Y.toString()}),p.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetRemoteDescError,!0)}),this.state=h.ENUM_PUBLISH_STATE.waitingServerICE,this.logger.debug(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" call success")},o.prototype.onIceConnectionStateChange=function(n){var t=this;if(this.state!=h.ENUM_PUBLISH_STATE.stop&&this.peerConnection!=null)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),this.peerConnection.iceConnectionState==="connected"){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.answerSdpTime){var e=new Date().getTime()-this.answerSdpTime;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" ice time "+e)}this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.iceDisconnectedTimer!=null&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout(function(){var r;t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats state "+t.state),t.state!==h.ENUM_PUBLISH_STATE.publishing&&((r=t.peerConnection)===null||r===void 0||r.getStats().then(function(i){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats suc"),i.size>0&&t.publishSuccess()}))},1e3))}else this.peerConnection.iceConnectionState==="closed"?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.iceClosed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):this.peerConnection.iceConnectionState==="failed"?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.iceFailed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):this.peerConnection.iceConnectionState==="disconnected"&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.logger.warn(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected "),this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout(function(){t.checkPublishConnectionFailedState("disconnected")},this.iceDisconnectedMaxTime)))},o.prototype.onIceCandidate=function(n){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+n.candidate),n.candidate)if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+n.candidate.candidate),this.state<h.ENUM_PUBLISH_STATE.connecting||this.state==h.ENUM_PUBLISH_STATE.stop)this.candidateInfo.push({candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex});else{var t={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},o.prototype.sendCandidateInfo=function(n){var t=this;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(n=n.filter(function(e){return e.candidate.indexOf("relay")>0}))||n.length<1?this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==h.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=h.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(h.getSeq(),this.sessionId,n,function(e,r,i){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")},function(e,r){t.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError)}))},o.prototype.onConnectionStateChange=function(n){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+n.target.signalingState)},o.prototype.onRecvCandidateInfo=function(n,t,e){var r,i=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "+JSON.stringify(e.infos)),this.state==h.ENUM_PUBLISH_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(n,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var s=0;s<e.infos.length;s++){var u={sdpMid:e.infos[s].sdpMid,sdpMLineIndex:e.infos[s].sdpMLineIndex,candidate:e.infos[s].candidate};this.logger.debug(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+""+this.streamId+" candidate "+u.candidate),(r=this.peerConnection)===null||r===void 0||r.addIceCandidate(new RTCIceCandidate(u)).then(function(){i.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")},function(p){i.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+p.toString()),i.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError,!0)})}this.state=h.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},o.prototype.onRecvCloseSession=function(n,t,e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLOSE_SESSION+""+this.streamId+" "+JSON.stringify(e)),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(n,this.sessionId,0);var r=e.err_info?JSON.parse(e.err_info.toLowerCase()):{},i=r.action?r.action:null,s=1*e.reason,u=JSON.parse(JSON.stringify(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError));u.message+=" reason:"+s+" "+(i?" action:"+i:""),r.err===1011&&(u=l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaServerForbidError),r.err===1014&&(u=l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishTokenExpiredError),this.negoTimer&&clearTimeout(this.negoTimer);var p=![4,8,10,11,12,14,26,27].includes(s)&&![2,5,6].includes(i);this.publishStateUpdateError(u,p)},o.prototype.onRecvResetSession=function(n,t,e){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(n,this.sessionId,0);var r=l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError;this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(r)}else this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},o.prototype.onRecvPublishEvent=function(n,t,e){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_PUBLISH_EVENT+" "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===h.ENUM_PUBLISH_STATE_NEGO.iceConnected&&e.event==0&&this.publishSuccess()},o.prototype.onRecvClientInfo=function(n,t,e){this.stateCenter.clientIP!==e.clientip&&this.logger.warn(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+e.clientip),this.stateCenter.clientIP=e.clientip,this.peerID=e.peer_id;var r=this.previewer;if(r&&r.activateSEIConfig!==null){var i=r==null?void 0:r.activateSEIConfig,s=i.action,u=i.infoType;this.activateSEIInsert(s,u)}},o.prototype.checkPublishConnectionFailedState=function(n){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" streamID "+this.streamId," state "+this.state+" connectionState "+n),this.publishStateUpdateError(l.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaConnectionError)},o.prototype.setPublishQualityTimer=function(){var n=this;this.qualityTimer==null&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval(function(){n.peerConnectionGetStats()},this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:new Date().getTime(),audioTime:new Date().getTime(),time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0,videoRetransmittedPacketsSent:0},this.qualitySeq=h.getSeq(),this.qualityCount=0)},o.prototype.peerConnectionGetStats=function(n){var t=this;if(this.peerConnection){var e=[this.peerConnection.getStats(null)];this.stateCenter.browser=="chrome"&&e.push(new Promise(function(r,i){var s;(s=t.peerConnection)===null||s===void 0||s.getStats(function(u){return r(u)},function(u){return i(u)})})),Promise.all(e).then(function(r){var i=t.getPublishStats(r[0],r[1]);n&&n(i,r[0],r[1])}).catch(function(r){t.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+t.streamId+" getStats error "+r.toString())})}},o.prototype.getPublishStats=function(n,t){var e,r=this;if(n){for(var i,s=document.querySelectorAll("video, audio"),u=0;u<s.length;u++)s[u].srcObject===this.localStream&&(i=s[u]);var p=this.streamCenter.checkPreview(this.localStream),f={audioCodec:"opus",audioTargetBitrate:this.videoInfo.audioBitrate/1e3||0,audioBitrate:0,videoTargetBitrate:this.videoInfo.bitRate||0,videoTargetFPS:this.videoInfo.frameRate||0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:((e=p==null?void 0:p.videoTrack)===null||e===void 0?void 0:e.enabled)?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},E=this.lastPublishStats.time,y=0,b=0,S=0,k=0,O=0,g=0;n.forEach(function(N){if((N.type=="outbound-rtp"||N.type=="ssrc"&&N.bytesSent!=null)&&N.mediaType=="audio")E!=0&&(f.audioBitrate=8*(N.bytesSent-r.lastPublishStats.audioBytesSent)/(N.timestamp-E),N.retransmittedPacketsSent=N.retransmittedPacketsSent||0,N.packetsSent=N.packetsSent||0,f.audioFPS=(N.packetsSent-(N.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)-r.lastPublishStats.audioPacketsSent)/(N.timestamp-E)*1e3||0,S=(N.retransmittedPacketsSent-r.lastPublishStats.audioRetransmittedPacketsSent)/(N.packetsSent-r.lastPublishStats.audioPacketsSent)),f.audioBitrate<0&&(f.audioBitrate=0),r.lastPublishStats.audioBytesSent=N.bytesSent,r.lastPublishStats.time=N.timestamp,r.lastPublishStats.audioPacketsSentTimeStamp=N.packetsSent-r.lastPublishStats.audioPacketsSent,r.lastPublishStats.audioPacketsSent=N.packetsSent,r.lastPublishStats.audioRetransmittedPacketsSent=N.retransmittedPacketsSent;else if((N.type=="outbound-rtp"||N.type=="ssrc"&&N.bytesSent!=null)&&N.mediaType=="video")E!=0&&(f.videoBitrate=8*(N.bytesSent-r.lastPublishStats.videoBytesSent)/(N.timestamp-E),f.videoFPS=1e3*(N.framesEncoded-r.lastPublishStats.framesEncoded)/(N.timestamp-E),k=(N.retransmittedPacketsSent-r.lastPublishStats.videoRetransmittedPacketsSent)/(N.packetsSent-r.lastPublishStats.videoPacketsSent)),f.videoBitrate<0&&(f.videoBitrate=0),f.videoFPS<0&&(f.videoFPS=0),f.nackCount=N.nackCount,f.pliCount=N.pliCount,r.lastPublishStats.videoBytesSent=N.bytesSent,r.lastPublishStats.framesEncoded=N.framesEncoded,r.lastPublishStats.time=N.timestamp,r.lastPublishStats.videoPacketsSentTimeStamp=N.packetsSent-r.lastPublishStats.videoPacketsSent,r.lastPublishStats.videoPacketsSent=N.packetsSent,r.lastPublishStats.videoRetransmittedPacketsSent=N.retransmittedPacketsSent;else if(N.type=="remote-inbound-rtp"&&N.kind=="video"){N.packetsLost>0&&(f.videoPacketsLost=N.packetsLost);var w=N.packetsLost-r.lastPublishStats.videoPacketsLost;f.videoPacketsLostRate=w>0?w/r.lastPublishStats.videoPacketsSentTimeStamp:0,N.packetsLost>0&&(r.lastPublishStats.videoPacketsLost=N.packetsLost),r.lastPublishStats.videoTime=N.timestamp,b=1e3*N.roundTripTime,g=N.jitter}else if(N.type=="remote-inbound-rtp"&&N.kind=="audio"){N.packetsLost>0&&(f.audioPacketsLost=N.packetsLost);var B=N.packetsLost-r.lastPublishStats.audioPacketsLost;f.audioPacketsLostRate=B>0?B/r.lastPublishStats.audioPacketsSentTimeStamp:0,N.packetsLost>0&&(r.lastPublishStats.audioPacketsLost=N.packetsLost),r.lastPublishStats.audioTime=N.timestamp,y=1e3*N.roundTripTime,O=N.jitter}else if(N.type=="media-source"&&(N.kind=="audio"||N.id.toLowerCase().indexOf("audio")>=0))f.audioLevel=N.audioLevel||0,f.sendLevel=N.totalAudioEnergy,f.audioInputLevel=32767*N.totalAudioEnergy,f.samplingRate=N.totalSamplesDuration;else if(N.type=="track"&&(N.kind=="video"||N.id.indexOf("video")>=0||N.frameWidth)){if(f.frameHeight=N.frameHeight,f.frameWidth=N.frameWidth,E===0||r.lastPublishStats.frameHeight===N.frameHeight&&r.lastPublishStats.frameWidth===N.frameWidth)E===0&&(r.lastPublishStats.frameHeight=N.frameHeight,r.lastPublishStats.frameWidth=N.frameWidth);else{var x=h.getReportSeq();r.dataReport.newReport(x,l.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.event),r.dataReport.addMsgInfo(x,{session_id:l.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.session_id(r.sessionId),w:l.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.w(N.frameWidth),h:l.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.h(N.frameHeight)}),r.dataReport.uploadReport(x),r.lastPublishStats.frameHeight=N.frameHeight,r.lastPublishStats.frameWidth=N.frameWidth}E!=0&&(f.videoTransferFPS=1e3*(N.framesSent-r.lastPublishStats.framesSent)/(N.timestamp-E)),f.videoTransferFPS<0&&(f.videoTransferFPS=0),r.lastPublishStats.framesSent=N.framesSent}else N.type=="candidate-pair"&&(N.totalRoundTripTime!=null&&(f.totalRoundTripTime=N.totalRoundTripTime),N.currentRoundTripTime!=null&&(f.currentRoundTripTime=N.currentRoundTripTime))}),t&&t.result().forEach(function(N){N.type=="ssrc"&&N.names().indexOf("googBandwidthLimitedResolution")>=0&&(f.googBandwidthLimitedResolution=N.stat("googBandwidthLimitedResolution")),N.type=="ssrc"&&N.stat("mediaType")=="video"&&N.names().indexOf("googCodecName")>=0&&(f.videoCodecName=N.stat("googCodecName")),N.type=="ssrc"&&N.stat("mediaType")=="audio"&&N.names().indexOf("googCodecName")>=0&&(f.audioCodecName=N.stat("googCodecName")),N.type=="ssrc"&&N.names().indexOf("googCpuLimitedResolution")>=0&&(f.googCpuLimitedResolution=N.stat("googCpuLimitedResolution")),N.type=="ssrc"&&N.names().indexOf("googFrameWidthInput")>=0&&(f.googFrameWidthInput=N.stat("googFrameWidthInput")),N.type=="ssrc"&&N.names().indexOf("googFrameHeightInput")>=0&&(f.googFrameHeightInput=N.stat("googFrameHeightInput")),N.type=="ssrc"&&N.names().indexOf("googFrameRateInput")>=0&&(f.googFrameRateInput=N.stat("googFrameRateInput")),N.type=="ssrc"&&N.names().indexOf("codecImplementationName")>=0&&(f.codecImplementationName=N.stat("codecImplementationName")),N.type=="VideoBwe"&&N.names().indexOf("googAvailableSendBandwidth")>=0&&(f.googAvailableSendBandwidth=N.stat("googAvailableSendBandwidth")),N.type=="VideoBwe"&&N.names().indexOf("googActualEncBitrate")>=0&&(f.googActualEncBitrate=N.stat("googActualEncBitrate")),N.type=="VideoBwe"&&N.names().indexOf("googTargetEncBitrate")>=0&&(f.googTargetEncBitrate=N.stat("googTargetEncBitrate")),N.type=="VideoBwe"&&N.names().indexOf("googRetransmitBitrate")>=0&&(f.googRetransmitBitrate=N.stat("googRetransmitBitrate"))}),this.stateCenter.browser==="chrome"&&this.handleEncBitrate(Number.parseInt(f.googTargetEncBitrate),Number.parseInt(f.googActualEncBitrate),Number.parseInt(f.googRetransmitBitrate)),b=isNaN(b)||b<0?0:b,k=isNaN(k)||k<0?0:k,g=isNaN(g)||g<0?0:g,y=isNaN(y)||y<0?0:y,S=isNaN(S)||S<0?0:S,O=isNaN(O)||O<0?0:O;var v=d.ClientUtil.getNetQuality(b,k,g),R=d.ClientUtil.getNetQuality(y,S,O);f.videoQuality=E>0?d.ClientUtil.quality2QualityGrade(v):0,f.audioQuality=E>0?d.ClientUtil.quality2QualityGrade(R):0;var L=Math.min(v,R);this.netQuality=L,E>0&&L<=h.QUALITY_CONSTANT.MiddleMinQuality&&new Date().getTime()>this.probeTime+this.probeInterval&&(this.logger.info(a.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+L+" start net probe"),this.probeState=h.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!0,this,this.gwNodeList),this.probeTime=new Date().getTime()),this.updateCurrentQualityStats(f),E!==0&&(this.uploadPublishQuality(f),this.onPublishQualityUpdate(this.streamId,this.currentQuality,n,t))}},o.prototype.updateCurrentQualityStats=function(n){var t=n.videoBitrate,e=n.videoFPS,r=n.videoTransferFPS,i=n.frameHeight,s=n.frameWidth,u=n.videoMuteState,p=n.videoQuality,f=n.audioBitrate,E=n.audioCodec,y=n.audioMuteState,b=n.audioQuality,S=n.audioFPS,k={video:m(m({},this.currentQuality.video),{videoBitrate:t,videoFPS:e,videoTransferFPS:r,frameHeight:i,frameWidth:s,muteState:u,videoQuality:p}),audio:m(m({},this.currentQuality.audio),{audioBitrate:f,audioCodec:E,muteState:y,audioQuality:b,audioFPS:S}),nackCount:n.nackCount,pliCount:n.pliCount,totalRoundTripTime:n.totalRoundTripTime,currentRoundTripTime:n.currentRoundTripTime};if(n.videoPacketsLost!==void 0){var O=n.videoPacketsLost,g=n.videoPacketsLostRate;k.video.videoPacketsLost=O,k.video.videoPacketsLostRate=g}if(n.audioPacketsLost!==void 0){var v=n.audioPacketsLost,R=n.audioPacketsLostRate;k.audio.audioPacketsLost=v,k.audio.audioPacketsLostRate=R}if(n.muted!==void 0&&(k.muted=n.muted,k.paused=n.paused,k.volume=n.volume,k.sinkId=n.sinkId),n.googBandwidthLimitedResolution!==void 0){var L=n.googBandwidthLimitedResolution,N=n.videoCodecName,w=n.audioCodecName,B=n.googFrameWidthInput,x=n.googFrameHeightInput,Z=n.googCpuLimitedResolution,V=n.googFrameRateInput,Y=n.codecImplementationName,te=n.googAvailableSendBandwidth,F=n.googActualEncBitrate,K=n.googTargetEncBitrate;k.googBandwidthLimitedResolution=L,k.video.googCodecName=N,k.audio.googCodecName=w,k.googCpuLimitedResolution=Z,k.googFrameWidthInput=B,k.googFrameHeightInput=x,k.googFrameRateInput=V,k.codecImplementationName=Y,k.googAvailableSendBandwidth=te,k.googActualEncBitrate=F,k.googTargetEncBitrate=K}this.currentQuality=k},o.prototype.uploadPublishQuality=function(n){if(this.qualityUpload&&this.signal.isServerConnected){var t=new Date().getTime();(this.qualityUploadLastTime==0||t-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(n.stream_type="publish",n.stream_id=this.streamId,n.timeStamp=Math.round(t/1e3),n.sampleTimeWindow=this.qualityTimeInterval,this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+this.streamId+" upload"+JSON.stringify(n)),this.streamCenter.updateQuality(0,n),this.qualityUploadLastTime=t)}},o.prototype.stopPublish=function(){if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_PUBLISH+"  .1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var n in this.streamCenter.playerList){var t=this.streamCenter.playerList[n].player;t.state==h.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==h.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(h.getSeq(),t.sessionId,0),t.broadcasterStatus=h.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(h.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream",use_na:this.stateCenter.useNetAgent?1:0}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},o.prototype.onPublishStateUpdate=function(n,t,e,r){},o.prototype.onPublishQualityUpdate=function(n,t,e,r){},o.prototype.onDisconnect=function(n){this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" call"),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(n||l.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!n)},o.prototype.playEffect=function(n,t,e,r){},o.prototype.pauseEffect=function(n){},o.prototype.resumeEffect=function(n){},o.prototype.stopEffect=function(n){},o.prototype.setEffectVolume=function(n,t){},o.prototype.getEffectProgress=function(n){},o.prototype.seekAudioEffect=function(n,t){},o.prototype.startMixingAudio=function(n){},o.prototype.stopMixingAudio=function(n){},o.prototype.mixingBuffer=function(n,t,e){},o.prototype.stopMixingBuffer=function(n){},o.prototype.setMixingAudioVolume=function(n,t){},o.prototype.publishSuccess=function(){var n,t;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call"),this.isUpdateSDP&&this.updateSDPCallBack)return this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" "+this.streamId+" update sdp success"),this.updateSDPCallBack(0),this.updateSDPCallBack=void 0,void(this.isUpdateSDP=!1);for(var e in this.state!=h.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(h.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.isPeer&&(this.peerFailCount=0),this.state=h.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var r=this.streamCenter.playerList[e].player;r.state==h.ENUM_PLAY_STATE.playing&&r.broadcasterStatus==h.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(h.getSeq(),r.sessionId,1),r.broadcasterStatus=h.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var i=2,s=2,u=(n=this.previewer)===null||n===void 0?void 0:n.videoTrack,p=this.localStream.getAudioTracks().length!==0&&this.localStream.getAudioTracks()[0];(u&&u.readyState==="live"&&u.enabled===!0||((t=this.previewer)===null||t===void 0?void 0:t.muteImage))&&(i=0),p&&p.readyState==="live"&&p.enabled===!0&&(s=0),this.sendStreamStatus(i,s,!0),this.streamCenter.soundLevelDelegate&&this.previewer&&this.previewer.startSoundLevel(),this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call success")},o.prototype.startSoundLevel=function(){var n;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" call streamID: "+this.streamId),this.localStream&&this.localStream.getAudioTracks().length!=0)try{(n=this.previewer)===null||n===void 0||n.startSoundLevel()}catch(t){this.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" get sound level failed "+t)}else this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" local stream no found")},o.prototype.stopSoundLevel=function(){var n;this.logger.info(a.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),(n=this.previewer)===null||n===void 0||n.stopSoundLevel()},o.prototype.rebackMic=function(){var n,t=this;if(this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&this.audioMixList.length==0&&Object.keys(this.arrayBufferMap).length==0&&this.effectList.length==0){var e=(n=this.peerConnection)===null||n===void 0?void 0:n.getSenders().find(function(r){var i,s;return((i=r.track)===null||i===void 0?void 0:i.kind)===((s=t.micTrack)===null||s===void 0?void 0:s.kind)});e&&(e.replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))}},o.prototype.handleEncBitrate=function(n,t,e){var r,i=this,s=1e3*this.videoInfo.bitRate,u=0;if(t>0){this.needIncMax||this.gotMax||(this.probeCount++,t>=.75*n?(this.probeCount>=10&&this.initFitCnt>=.6*this.probeCount&&(this.gotMax=!0,this.targetRate=s),this.initFitCnt++):this.probeCount>=10&&this.initFitCnt/this.probeCount<.3&&(this.needIncMax=!0));var p=d.ClientUtil.arrAvg(this.totalBitrateArray,t,10);if(this.needIncMax)if(p>=1.05*s){if(this.targetRate>s){var f=void 0;p>n?(f=p-n,this.targetRate-=f):(f=p-s,this.targetRate-=f),this.targetRate=Math.max(this.targetRate,s),this.targetRate=Math.min(this.targetRate,2*s),u=this.targetRate}}else p<.8*s&&(this.targetRate===0&&(this.targetRate=n),this.targetRate>=s?this.targetRate=this.targetRate+.08*s:this.targetRate=1.05*this.targetRate,this.targetRate=Math.min(this.targetRate,2*s),u=this.targetRate)}if(e>0&&e<s){var E=d.ClientUtil.arrAvg(this.totalRetransRateArray,e,5);this.needIncMax?E+t>1.05*s&&(f=E+t-s,this.targetRate-=f,this.targetRate=Math.max(this.targetRate,s-E),u=this.targetRate):u=this.targetRate-E}else this.targetRate<s&&(this.targetRate=s,u=this.targetRate);if(u>0){u=d.ClientUtil.arrAvg(this.totalTargetRateArray,u,5);var y=(r=this.peerConnection)===null||r===void 0?void 0:r.getSenders().find(function(S){return S.track&&S.track.kind==="video"});if(!y)return;var b=y.getParameters();b.encodings||(b.encodings=[{}]),b.encodings[0].maxBitrate=u,y.setParameters(b).catch(function(S){i.logger.error(a.ZEGO_WEBRTC_ACTION.PUBLISHER_HANDLE_ENC_BITRATE+" "+S)})}},o.prototype.resetEncBitrate=function(){this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[]},o.prototype.replacePublishedTrack=function(n,t){return t===void 0&&(t=!1),{errorCode:-1,extendedData:"should install advanced module first"}},o.prototype.sendStreamStatus=function(n,t,e,r){var i=this;e===void 0&&(e=!1),r===void 0&&(r=0),(e||this.camera_status!==n||this.mic_status!==t)&&this.signal&&(this.camera_status=n,this.mic_status=t,r++,this.signal.sendStreamStatus(h.getSeq(),this.sessionId,n,t,this.streamId,function(){i.camera_status===n&&i.mic_status===t&&r<=1&&i.sendStreamStatus(n,t,!0,r)}))},o}();T.ZegoPublish=c},5019:function(W,T,I){"use strict";var m=this&&this.__assign||function(){return m=Object.assign||function(c){for(var o,n=1,t=arguments.length;n<t;n++)for(var e in o=arguments[n])Object.prototype.hasOwnProperty.call(o,e)&&(c[e]=o[e]);return c},m.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoSignal=void 0;var h=I(6706),_=I(1089),d=I(2752),l=I(746),a=function(){function c(o,n,t,e){e===void 0&&(e=!1),this.netAgent=t,this.useNetAgent=e,this.sendDataMap={},this.sendDataList=new h.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq","CreateSessionReq","CreateSessionWithSdpReq","ActivateSEIInsertReq","StreamStatusNotify","MediaDescUpdateReq"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=h.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this._websocket=null,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=o,this.stateCenter=n,this.stateCenter.streamConnectTime&&(this.tryConnectInterval=this.stateCenter.streamConnectTime)}return Object.defineProperty(c.prototype,"wsReadyState",{get:function(){var o;return(o=this.websocket)===null||o===void 0?void 0:o.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"websocket",{get:function(){return this._websocket},set:function(o){o===null&&this.useNetAgent||(this._websocket=o)},enumerable:!1,configurable:!0}),c.prototype.getBrowserAndVersion=function(){var o,n=navigator.userAgent,t=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(t[1])?{name:"IE",version:(o=/\brv[ :]+([\d\.]+)/g.exec(n)||[])[1]||""}:t[1]==="Chrome"&&(o=n.match(/\bOPR|Edge\/([\d\.]+)/))!=null?{name:"Opera",version:o[1]}:(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],(o=n.match(/version\/([\d+\.]+)/i))!=null&&t.splice(1,1,o[1]),{name:t[0],version:t[1]})},c.prototype.setSessionInfo=function(o,n){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_SET_SESSION_INFO+" call"),this.appid=o+"",this.userid=n},c.prototype.onDisconnect=function(o,n){},c.prototype.onUpdateHeartBeatInterval=function(o){},c.prototype.resetConnectTimer=function(){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CONNECT_TIMER+" call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},c.prototype.handleWsMessage=function(o){var n=JSON.parse(o.data);this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= ",n.header.cmd),this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= "+JSON.stringify(n)),n.header.appid==this.appid&&n.header.user_id===this.userid?this.handleServerPush(n):this.logger.warn(_.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" check header failed")},c.prototype.bindWebSocketEvents=function(){var o=this;this.tryHeartbeatCount=0,this.tryConnectInterval=this.stateCenter.streamConnectTime?this.stateCenter.streamConnectTime:3e3,this.websocket&&(this.websocket.onclose=function(n){if(o.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" close msg = "+JSON.stringify((n==null?void 0:n.code)?n==null?void 0:n.code:n)),o.state!=h.ENUM_CONNECT_STATE.disconnect){if(o.useNetAgent)return void o.disconnectCallback(d.errorCodeList.PUBLISHER_RETRY_TIMEOUT);o.resetConnectTimer(),o.startConnectTimer(function(t){t===1008&&o.disconnectCallback(d.errorCodeList.TOKEN_EXPIRED)}),o.resetCheckMessage()}},this.websocket.onerror=function(n){o.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" msg = "+JSON.stringify(n))})},c.prototype.resetCheckMessage=function(){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CHECK_MESSAGE+" call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var o=this.sendDataList.getFirst();o!=null;)this.sendDataList.remove(o),o._data.error&&o._data.error(h.SEND_MSG_RESET,o._data.seq),o=this.sendDataList.getFirst();this.sendDataMap={}},c.prototype.handleServerPush=function(o){switch(o.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",o);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",o),o.body.result===0&&this.addSession(o.header.session_id,o.body.session_token);break;case"CreateSessionWithSdpRsp":this.handleRespondData("CreateSessionWithSdpReq",o),o.body.result===0&&this.addSession(o.header.session_id,o.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",o);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",o);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",o),this.removeSession(o.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",o);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(o);break;case"CloseSessionPush":this.handlePushData(o),this.removeSession(o.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",o);break;case"SessionResetPush":this.handlePushResetSessionData(o);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":case"ClientInfoPush":this.handlePushData(o);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",o);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",o);break;case"NetQualityProbeRsp":this.handleRespondData("NetQualityProbeReq",o);break;case"NetQualityInfoPush":this.handlePushData(o);break;case"ActivateSEIInsertRsp":this.handleRespondData("ActivateSEIInsertReq",o);break;case"StreamStatusNotifyAck":this.handleRespondData("StreamStatusNotify",o);break;case"Peer2PeerNetStatsGetRsp":this.handleRespondData("Peer2PeerNetStatsGetReq",o);break;case"MediaDescUpdateRsp":this.handleRespondData("MediaDescUpdateReq",o);case"MediaDescUpdatePush":this.handlePushData(o)}},c.prototype.disconnectCallback=function(o,n){this.connectCallback&&(this.connectCallback(n||-1,this.server,void 0),this.connectCallback=null);var t=this.server;this.disconnectServer(),this.onDisconnect(t,o)},c.prototype.updateToken=function(){var o=this;this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_UPDATE_TOKEN+" call");var n={token:this.token,tokenType:this.tokenType,roomid:this.roomID,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:h.PROTO_VERSION,osinfo:navigator.appVersion};if(Object.keys(this.sessionInfos).length!=0){var t=[];for(var e in this.sessionInfos){var r=parseInt(e);t.push({session_id:r,session_token:this.sessionInfos[r].token})}n.sessions=t}this.sendMessageWithCallback("LoginReq",this.stateCenter.getSeq(),0,n,function(i,s,u){if(u.result==0){o.token=u.token,o.tokenType=u.tokenType;var p={report:u.report,report_interval:u.report_interval_ms};u.negoInterval&&(o.negoInterval=u.negoInterval),u.negoTryCount&&(o.negoTryCount=u.negoTryCount),u.negoTryMaxCount&&(o.negoTryMaxCount=u.negoTryMaxCount),o.connectCallback!=null&&(o.connectCallback(0,o.server,p),o.connectCallback=null),o.checkMessageTimeout()}else{var f={error:u.strError};o.connectCallback!=null&&(o.connectCallback(u.result,o.server,f),o.connectCallback=null)}},function(){o.connectCallback!=null&&(o.connectCallback(-1,o.server,void 0),o.connectCallback=null)})},c.prototype.sendMessageWithCallback=function(o,n,t,e,r,i){var s;if(r===void 0&&(r=null),i===void 0&&(i=null),this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" call "+o+" "+((s=this.websocket)===null||s===void 0?void 0:s.readyState)),!this.websocket||o!=="LoginReq"&&this.websocket.readyState!==WebSocket.OPEN)return this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" connect not establish"),void(i&&i(h.SEND_MSG_TIMEOUT,n));var u={header:this.getHeader(o,n,t),body:e},p={seq:n,deleted:!1,cmd:o,time:new Date().getTime(),success:r,error:i},f=this.sendDataList.push(p);this.sendDataMap[p.seq]=f;var E=JSON.stringify(u);this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" "+E),this.websocket.send(E),this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" success")},c.prototype.getHeader=function(o,n,t){return{version:"1.0.1",cmd:o,appid:this.appid+"",seq:n,user_id:this.userid,session_id:t}},c.prototype.connectServer=function(o,n,t,e){var r,i=this;if(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+t),this.roomID=o,this.token=n,this.server=t,this.state=h.ENUM_CONNECT_STATE.connecting,this.connectCallback=e,this.isServerConnected)this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket is connected"),this.resetConnectTimer(),this.state=h.ENUM_CONNECT_STATE.connected;else try{if(this.useNetAgent){if(!this.stateCenter.appConfig)return void this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" no app config ");var s=this.stateCenter.appConfig.media_config.publish_config.resource_info.find(function(E){return E.resource_type===h.SignalResourceType.RTC});if(!s)return void(e&&e(d.errorCodeList.GET_CONFIG_FAIL));var u=(r=s==null?void 0:s.service_info)===null||r===void 0?void 0:r.find(function(E){return E.protocol===h.ProtocolType.WEBRTC});if(!u)return void(e&&e(d.errorCodeList.GET_CONFIG_FAIL));var p=u.url_template.split("{IP}")[1].split("?"),f={path:p[0],query:p[1]};this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" signal "+JSON.stringify(f)),this.websocket instanceof WebSocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),!this.websocket&&(this.websocket=new l.AnalogSocket(this.server,this.netAgent,f,this.logger)),this.websocket.open()}else this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" need new websocket"),this.websocket&&(this.logger.warn(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close()),this.websocket=new WebSocket(this.server);this.websocket.onclose=function(E){i.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket close call  "+JSON.stringify(E)),i.useNetAgent&&i.state!=h.ENUM_CONNECT_STATE.disconnect&&(i.resetConnectTimer(),i.startConnectTimer(function(y){y===1008&&i.disconnectCallback(d.errorCodeList.TOKEN_EXPIRED)}))},this.websocket.onerror=function(E){i.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket onerror call  "+JSON.stringify(E)),i.stateCenter.useNetAgent&&(E==null?void 0:E.code)&&i.disconnectCallback(void 0,E==null?void 0:E.code)},this.useNetAgent&&this.websocket instanceof l.AnalogSocket?(this.websocket.onopen=function(){i.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),i.bindWebSocketEvents(),i.state=h.ENUM_CONNECT_STATE.connected,i.websocket&&(i.websocket.onmessage=i.handleWsMessage.bind(i))},this.websocket.onreconnnecting=function(){i.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket reconnecting"),i.updateToken()},this.websocket.onmessage=this.handleWsMessage.bind(this),this.updateToken()):this.websocket.onopen=function(){i.resetConnectTimer(),i.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),i.websocket&&(i.websocket.onmessage=i.handleWsMessage.bind(i)),i.bindWebSocketEvents(),i.updateToken(),i.state=h.ENUM_CONNECT_STATE.connected}}catch(E){this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket error "+E)}this.useNetAgent||(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+this.tryConnectInterval),this.tryConnectTimer=setTimeout(function(){i.startConnectTimer(e)},this.tryConnectInterval))},c.prototype.startConnectTimer=function(o){if(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" call"),this.tryConnectCount>=h.MAX_TRY_CONNECT_COUNT)return this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&this.websocket.readyState===WebSocket.OPEN?(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" websocket is connected"),this.resetConnectTimer()):(this.tryConnectCount+=1,this.connectServer(this.roomID,this.token,this.server,o))},c.prototype.disconnectServer=function(){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_DISCONNECT_SERVER+" call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=h.ENUM_CONNECT_STATE.disconnect},Object.defineProperty(c.prototype,"isServerConnected",{get:function(){var o;return((o=this.websocket)===null||o===void 0?void 0:o.readyState)===WebSocket.OPEN},enumerable:!1,configurable:!0}),c.prototype.createSession=function(o,n,t,e,r,i,s,u){r===void 0&&(r=""),i===void 0&&(i=""),this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+e);var p="";h.PROTO_VERSION.split(".").forEach(function(E,y){return E.length==1&&y==1?p+="0"+E:p+=E});var f={type:n,stream_id:e,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:t,strAuthParam:r,sdk_version:1*p,turn_server_host:typeof i=="string"?i:""};this.sendMessageWithCallback("CreateSessionReq",o,0,f,s,u)},c.prototype.createSessionWithSdp=function(o,n,t){var e=o.seq,r=o.type,i=o.streamId,s=o.strAuthParam,u=o.sdp,p=o.serverHost,f=o.playBufLevel;this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+i);var E="";h.PROTO_VERSION.split(".").forEach(function(b,S){return b.length==1&&S==1?E+="0"+b:E+=b});var y={type:r,app_id:this.appid,stream_id:i,sdp:u,user_id:this.userid,platform:this.platform,browser:this.browser.name,sdk_vers:parseInt(E),clientIp:"",media_server_host:typeof p=="string"?p:"",strAuthParam:s};f&&(y.min_play_buf_level_ms=f),this.sendMessageWithCallback("CreateSessionWithSdpReq",e,0,y,n,t)},c.prototype.sendMediaDescUpdateReq=function(o,n,t,e,r){var i={peer_id:t.peerID,type:t.type,sdp:t.sdp,width:t.width,height:t.height,framerate:t.frameRate,video_min_kpbs:t.video_min_kpbs,video_max_kpbs:t.video_max_kpbs,audio_kpbs:t.audio_kpbs,keyframe_intv:t.keyframe_intv};this.sendMessageWithCallback("MediaDescUpdateReq",o,n,i,e,r)},c.prototype.removeSession=function(o){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_REMOVE_SESSION+" call"+o),this.sessionInfos[o]&&delete this.sessionInfos[o]},c.prototype.sendCloseSession=function(o,n,t,e,r){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_REMOVE_SESSION+" call: "+n);var i={reason:t};this.removeSession(n),this.sendMessageWithCallback("CloseSessionReq",o,n,i,e,r)},c.prototype.sendMessage=function(o,n,t,e){if(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" call "+o),this.websocket&&this.websocket.readyState===WebSocket.OPEN){var r={header:this.getHeader(o,n,t),body:e},i=JSON.stringify(r);this.websocket.send(i),this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" success")}else this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" connect not establish")},c.prototype.handleRespondData=function(o,n){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" call");var t=this.sendDataMap[n.header.seq];if(t!=null){delete this.sendDataMap[n.header.seq],this.sendDataList.remove(t);var e=t._data;e.cmd!==o?this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" command is not match"):e.success&&e.success(n.header.seq,n.header.session_id,n.body)}else{if(n.header.cmd=="CloseSessionRsp")return;this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" cannot find data "+o)}},c.prototype.addSession=function(o,n){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_ADD_SESSION+" call"+o),this.sessionInfos[o]={token:n}},c.prototype.handlePushData=function(o){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" call "+o.header.cmd+" session "+o.header.session_id);var n=this.pushCallback[o.header.cmd+o.header.session_id];n?n.callback&&n.callback(o.header.seq,o.header.session_id,o.body):this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" no callbackData "+o.header.cmd+" session: "+o.header.session_id)},c.prototype.handlePushResetSessionData=function(o){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" call ");var n=[];if(o.body.cResetType==0)n=Object.keys(this.sessionInfos);else if(o.body.cResetType==1)for(var t=0;t<o.body.session_ids.length;t++)n.push(o.body.session_ids[t]);if(this.sendResetSessionAck(o.header.seq,0,0),n.length!=0)for(var e=0;e<n.length;e++){var r=this.pushCallback[o.header.cmd+n[e]];r==null?this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no callbackData "+n[e]):r.callback&&r.callback(o.header.seq,n[e],o.body)}else this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no session to callback")},c.prototype.sendMediaDesc=function(o,n,t,e,r,i){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC+" call: "+n);var s={type:t,sdp:e.sdp};e.width!=null&&(s.width=e.width),e.height!=null&&(s.height=e.height),e.frameRate!=null&&(s.framerate=e.frameRate),e.video_min_kpbs!=null&&(s.video_min_kpbs=e.video_min_kpbs),e.video_max_kpbs!=null&&(s.video_max_kpbs=e.video_max_kpbs),e.audio_kpbs!=null&&(s.audio_kpbs=e.audio_kpbs),e.keyframe_intv!=null&&(s.keyframe_intv=e.keyframe_intv),e.min_play_buf_level_ms!=null&&(s.min_play_buf_level_ms=e.min_play_buf_level_ms),this.sendMessageWithCallback("MediaDescReq",o,n,s,r,i)},c.prototype.sendCandidateInfo=function(o,n,t,e,r){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO+" call: "+n);for(var i=[],s=0;s<t.length;s++){var u={candidate:t[s].candidate,sdpMid:t[s].sdpMid,sdpMLineIndex:t[s].sdpMLineIndex};i.push(u)}var p={infos:i};this.sendMessageWithCallback("CandidateInfoReq",o,n,p,e,r)},c.prototype.sendMediaDescAck=function(o,n,t){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+n);var e={result:t};this.sendMessage("MediaDescAck",o,n,e)},c.prototype.sendUpdateMediaDescAck=function(o,n,t,e){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+n);var r={peer_id:e,result:t};this.sendMessage("MediaDescUpdateAck",o,n,r)},c.prototype.sendCandidateInfoAck=function(o,n,t){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO_ACK+" call: "+n);var e={result:t};this.sendMessage("CandidateInfoAck",o,n,e)},c.prototype.sendCloseSessionAck=function(o,n,t){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CLOSE_SESSION_ACK+" call: "+n);var e={result:t};this.sendMessage("CloseSessionAck",o,n,e)},c.prototype.sendResetSessionAck=function(o,n,t){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_RESET_SESSION_ACK+" call: "+n);var e={result:t};this.sendMessage("SessionResetAck",o,n,e)},c.prototype.registerPushCallback=function(o,n,t){t&&typeof t=="function"&&(this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_REGISTER_PUSH_CALLBACK+" set callback "+n),this.pushCallback[o+n]={callback:t})},c.prototype.unregisterPushCallback=function(o,n){delete this.pushCallback[o+n]},c.prototype.checkMessageTimeout=function(){for(var o=this,n=this.sendDataList.getFirst(),t=new Date().getTime(),e=0,r=0,i=0;n!=null&&!(n._data.time+this.sendDataTimeout>t);)if(delete this.sendDataMap[n._data.seq],this.sendDataList.remove(n),++r,this.checkMessageList.indexOf(n._data.cmd)!=-1){if(n._data.error==null||this.sendDataDropTimeout>0&&n._data.time+this.sendDataDropTimeout<t?++i:(this.logger.warn(_.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" error cmd = "+n._data.cmd),n._data.error&&n._data.error(h.SEND_MSG_TIMEOUT,n._data.seq)),++e>=this.sendDataCheckOnceCount)break;n=this.sendDataList.getFirst()}else n=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout(function(){o.checkMessageTimeout()},this.sendDataCheckInterval),r==0&&i==0||this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" call success, state: timeout="+r+" drop="+i)},c.prototype.sendHeartbeat=function(){var o=this;if(this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+"call tryHeartbeatCount:"+this.tryHeartbeatCount),Object.keys(this.sessionInfos).length!=0)if(this.state===h.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>h.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" heartbeat try limit"),void this.disconnectCallback();var n=[];for(var t in this.sessionInfos)n.push(parseInt(t));var e={session_ids:n},r=new Date().getTime();this.sendMessageWithCallback("ClientHBReq",this.stateCenter.getSeq(),0,e,function(i,s,u){o.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" hb time "+(new Date().getTime()-r)),o.heartbeatInterval!=u.hb_interval&&(o.heartbeatInterval=u.hb_interval,o.onUpdateHeartBeatInterval(u.hb_interval)),o.tryHeartbeatCount=0},function(i,s){})}else this.logger.warn(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" state error");else this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" no need to heartbeat")},c.prototype.QualityReport=function(o,n,t,e,r){this.logger.debug(_.ZEGO_WEBRTC_ACTION.SIGNAL_QUALITY_REPORT+" call");var i={streams:[m(m({},t),{aid:n})]};this.sendMessageWithCallback("QualityReportReq",o,n,i,e,r)},c.prototype.sendStreamStatus=function(o,n,t,e,r,i){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" call "+n);var s={mic_status:e,camera_status:t};this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" stream "+(r||"")+" status "+JSON.stringify(s)),this.sendMessageWithCallback("StreamStatusNotify",o,n,s,function(){},function(u){u===h.SEND_MSG_TIMEOUT&&i&&i()})},c.prototype.ActivatePlayVideoStream=function(o,n,t,e,r){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" call");var i={active:t?0:1,layer:0};this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" activate video "+JSON.stringify(i)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",o,n,i,e,r)},c.prototype.ActivatePlayAudioStream=function(o,n,t,e,r){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" call");var i={active:t?0:1,layer:0};this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" activate audio "+JSON.stringify(i)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",o,n,i,e,r)},c.prototype.sendBroadcasterStatus=function(o,n,t){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_BROADCAST_STATUS+" call "+n);var e={status:t};this.sendMessage("BroadcasterStatusNotify",o,n,e)},c.prototype.sendNetProbe=function(o,n,t,e,r){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+n);var i={peer_id:t,action:1};this.sendMessageWithCallback("NetQualityProbeReq",o,n,i,e,r)},c.prototype.sendNetQualityInfoPushAck=function(o,n,t,e){this.logger.info(_.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+n);var r={peer_id:t,result:e};this.sendMessage("NetQualityInfoAck",o,n,r)},c.prototype.activateSEIInsert=function(o,n,t,e,r,i,s){},c.prototype.getP2PNetStats=function(o,n,t,e,r){var i={peer_id:t};this.sendMessageWithCallback("Peer2PeerNetStatsGetReq",o,n,i,e,r)},c}();T.ZegoSignal=a},3409:function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(f,E){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,b){y.__proto__=b}||function(y,b){for(var S in b)Object.prototype.hasOwnProperty.call(b,S)&&(y[S]=b[S])},m(f,E)},function(f,E){function y(){this.constructor=f}m(f,E),f.prototype=E===null?Object.create(E):(y.prototype=E.prototype,new y)}),_=this&&this.__assign||function(){return _=Object.assign||function(f){for(var E,y=1,b=arguments.length;y<b;y++)for(var S in E=arguments[y])Object.prototype.hasOwnProperty.call(E,S)&&(f[S]=E[S]);return f},_.apply(this,arguments)};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoStreamCenterWeb=void 0;var d=I(6706),l=I(3770),a=I(1547),c=I(5740),o=I(6706),n=I(5019),t=I(3849),e=I(6014),r=I(8493),i=I(2752),s=I(3529),u=I(2990),p=function(f){function E(y,b,S,k,O,g){var v=f.call(this)||this;return v.logger=y,v.stateCenter=b,v.dataReport=S,v.rtm=k,v.ac=O,v.mediaEleSources=g,v.testEnvironment=!1,v.heartbeatTimer=null,v.heartbeatInterval=1e4,v.qualityTimerInterval=3e3,v.previewStreamList=[],v.signalList={},v.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},v.chargeInfosTimer=null,v.chargeInfosInterval=6e4,v.chargeInfoSeq=0,v.soundLevelDelegate=!1,v.soundLevelInterval=1e3,v.enableInBackground=!1,v.isPeer=!0,v.probeList={},v.isMicEnabled=!0,v.isDataChannelEnabled=!1,v.publishQualityInfos=[],v.playQualityInfos=[],v.qualityUploadTimestamp=0,v.qualityHeadTimestamp=0,v.gwNode="",v.playerList={},v.publisherList={},v.playSuccessCallBackList={},v.playErrorCallBackList={},v.waitPublishList=[],v.waitPlayList=[],v.tryCountConnectInterval=3e3,v.checkMessageTimeout=function(){for(var R in v.signalList)v.signalList[R].signal&&v.signalList[R].signal.checkMessageTimeout()},v.getAllInUseUrl=function(){var R=[];for(var L in v.signalList)R.push(L);return R},v.onDisconnectHandle=function(R,L){if(v.logger.info("zsc.od.0 call"),v.signalList[R]){for(var N=v.signalList[R],w=0;w<N.publishConnectedList.length;w++){var B=v.publisherList[N.publishConnectedList[w]];B&&B.publisher&&B.publisher.onDisconnect(L)}for(w=0;w<N.playConnectedList.length;w++){var x=v.playerList[N.playConnectedList[w]];x&&x.player&&x.player.onDisconnect(L)}delete v.signalList[R],v.stopSignalHeartbeat(),v.stopChargeInfosUpload(),v.stopSoundLevel()}},v.eventHandler={visibilitychange:function(){var R=!document.hidden;!v.enableInBackground&&v.soundLevelDelegate&&(R?(v.enableSoundLevelProcessor(!0),v.activeSoundLevel()):(v.soundLevelTimer&&clearTimeout(v.soundLevelTimer),v.soundLevelTimer=null,v.enableSoundLevelProcessor(!1)))}},v.stateCenter.type=="PRIVATE"&&(v.isPeer=!1),document.addEventListener("visibilitychange",v.eventHandler.visibilitychange),v}return h(E,f),Object.defineProperty(E.prototype,"cameraPreviewStream",{get:function(){return this.previewStreamList.find(function(y){return y.previewType==="camera"})},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"microphonePreviewStream",{get:function(){return this.previewStreamList.find(function(y){return y.previewType==="camera"&&y.micTrack})},enumerable:!1,configurable:!0}),E.prototype.onSignalDisconnected=function(y){},E.prototype.setQualityMonitorCycle=function(y){var b=this;return this.logger.debug("zsc.qmc.0 timeInterval "+y),Object.keys(this.publisherList).length==0?this.qualityTimerInterval=y:Object.keys(this.publisherList).forEach(function(S){b.publisherList[S].publisher.qualityTimeInterval=y,b.publisherList[S].publisher.setPublishQualityTimer()}),!0},E.prototype.setSessionInfo=function(y,b,S){this.logger.debug("zsc.ssi.0 called"),this.appid=y,this.userid=b,this.testEnvironment=S},E.prototype.onPlayStateUpdate=function(y,b,S){},E.prototype.onPlayQualityUpdate=function(y,b){},E.prototype.onPublishStateUpdate=function(y,b,S){},E.prototype.onPublishQualityUpdate=function(y,b){},E.prototype.onUpdateHeartBeatIntervalHandle=function(y){y!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+y),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=y,this.startSignalHeartbeat())},E.prototype.setPublishStateStart=function(y,b,S,k,O){var g,v,R=this;if(this.logger.info("zsc.pss.0 call "+b),this.stateCenter.networkState==d.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.0 network offline"),!1;var L=this.publisherList[b],N=this.stateCenter.reportSeqList.startPublish[b];if(this.dataReport.eventStart(N,"setPublishState"),L)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(N,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(N,void 0,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[b],!1;var w=new a.ZegoPublish(b,this.logger,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter,S);w.state=o.ENUM_PUBLISH_STATE.start,w.isPeer=this.isPeer,w.reportSeq=this.stateCenter.reportSeqList.startPublish[b];var B=w.previewer,x=(g=B==null?void 0:B.videoTrack)===null||g===void 0?void 0:g.label,Z=S.getAudioTracks()[0]&&S.getAudioTracks()[0].label,V=(v=B==null?void 0:B.videoTrack)===null||v===void 0?void 0:v.getSettings().deviceId,Y=S.getAudioTracks()[0]&&S.getAudioTracks()[0].getSettings().deviceId,te=new e.RetryStreamHandler(this.logger,this.stateCenter,this,!0);return this.publisherList[b]={seq:0,room:y,localStream:S,publisher:w,serverUrls:[],ttl:0,isCenterNode:!0,streamID:b,publishOption:k,cameraLabel:x||"",microLabel:Z||"",cameraDeviceId:V||"",microDeviceId:Y||"",deviceStateCount:0,retryStreamHandler:te,retryDispatchHandler:new r.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:O},w.onPublishStateUpdate=function(F,K,J,oe){var ae=R.publisherList[K];ae?te.publishStateHandle(F,ae.streamID,J,oe):R.logger.error("zsc.psuh.0 cannot find publish "+b)},w.onPublishQualityUpdate=function(F,K){var J=R.publisherList[F];J?(R.stateCenter.deviceStateOut&&K.audio.audioBitrate===0?(J.deviceStateCount++,J.deviceStateCount>=2&&(J.deviceStateCount=0,R.stateCenter.deviceStateOut=!1,R.logger.warn("zsc.pss.0 publish audio error by device"))):J.deviceStateCount=0,R.onPublishQualityUpdate(J.streamID,K)):R.logger.error("zsc.psuh.0 cannot find publish "+b)},this.dataReport.eventStart(w.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(w.streamReportSeq,"GetSignalUrl"),!0},E.prototype.startPublishingStream=function(y,b){b===void 0&&(b=!1),this.logger.info("zsc.sps.0 call");var S=this.publisherList[y];if(!S)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var k=S.publisher;if(!b){if(this.dataReport.eventEndWithMsg(k.reportSeq,"GetSignalUrl",{urls:S.serverUrls,is_center:S.isCenterNode}),this.dataReport.eventEndWithMsg(k.streamReportSeq,"GetSignalUrl",{urls:S.serverUrls,is_center:S.isCenterNode}),!S.serverUrls||S.serverUrls.length===0)return S.retryStreamHandler.publishStateHandle(o.ENUM_PUBLISH_STATE_UPDATE.error,y,i.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!0;var O=S.serverUrls.indexOf(this.server);O!==-1&&(S.serverUrls.splice(O,1),S.serverUrls.unshift(this.server))}var g=S.retryStreamHandler;return g.invalid(),g.init(this.stateCenter.streamRetryTime),g.initStream(y,S.serverUrls),g.startMaxTime(),g.activePublish(0)},E.prototype.updateWaitingList=function(y,b,S,k,O){var g={streamID:S,success:k,error:O};b?y.publishWaitingList.push(g):y.playWaitingList.push(g)},E.prototype.publishStream=function(y){var b=this.publisherList[y].publisher;if(b){var S=null,k=null,O=this.publisherList[y].publishOption,g=this.checkPreview(this.publisherList[y].localStream);if(g){S=g.localStream,k=g.videoInfo;var v=this.stateCenter.reportSeqList.startPublish[y];this.dataReport.addMsgInfo(v,{cap_w:s.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_w(g.videoInfo.width),cap_h:s.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_h(g.videoInfo.height),w:s.ZegoRTCLogEvent.kZegoTaskPublishStart.w(g.videoInfo.width),h:s.ZegoRTCLogEvent.kZegoTaskPublishStart.h(g.videoInfo.height),video_en_fps:s.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_fps(g.videoInfo.frameRate),video_en_bps:s.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_bps(g.videoInfo.bitRate)}),S?(this.logger.info("zsc.ps.0 call success"),b.gwNodeTTL<new Date().getTime()&&!this.gwNode?(b.gwNode="",b.gwNodeList=[],b.gwNodeTTL=0):this.gwNode&&(b.gwNode=this.gwNode),b.startPublish(y,S,k,g.mediaStreamConfig,O)):this.logger.error("zsc.ps.0 no localStream found")}else this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},E.prototype.connectPublishServer=function(y,b){var S=this,k=this.publisherList[y];return k?(this.dataReport.eventStart(k.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(k.publisher.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(y,!0,b,function(O,g,v){var R=S.publisherList[O];if(R){var L=R.publisher;if(L){S.dataReport.eventEndWithMsg(L.reportSeq,"ConnectServer",{result:0,server:v}),S.dataReport.eventEndWithMsg(L.streamReportSeq,"ConnectServer",{result:0,server:v});var N=g.tokenInfo;S.logger.info("zsc.cps.0 update token success"),N&&N.report&&(L.qualityUpload=N.report,L.qualityUploadInterval=N.report_interval),L.signal=g.signal,S.server=v,S.publishStream(O),S.getTokenSuccess()}else S.logger.info("zsc.cps.1 check publisher don't exist")}else S.logger.info("zsc.cps.0 after connect publisher don't exist")},function(O,g){S.logger.error("zsc.cps.0 "+O+" connect fail "+g);var v=S.publisherList[O];if(v){var R=v.publisher;if(R){var L;S.dataReport.eventEndWithMsg(R.reportSeq,"ConnectServer",{result:g}),S.dataReport.uploadReport(R.reportSeq),delete S.stateCenter.reportSeqList.startPublish[O];var N=!1;g&&g.code===i.errorCodeList.GET_CONFIG_FAIL.code?(L=_({},i.errorCodeList.GET_CONFIG_FAIL),N=!0):((L=_({},i.errorCodeList.CONNECT_FAILED)).message=L.message+" "+g,g===1008&&(L=i.errorCodeList.TOKEN_EXPIRED,N=!0),g===20010&&(N=!0,L=JSON.parse(JSON.stringify(i.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL)))),v.retryStreamHandler.publishStateHandle(o.ENUM_PUBLISH_STATE_UPDATE.error,O,L,N)}else S.logger.info("zsc.cps.1 check publisher don't exist")}else S.logger.info("zsc.cps.0 after connect publisher don't exist")}),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},E.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},E.prototype.stopPublishingStream=function(y){var b=this.publisherList[y];if(b){var S=b.retryStreamHandler;for(var k in S&&(S.stopMaxTime(),S.invalid()),this.signalList)this.signalList[k].publishWaitingList=this.signalList[k].publishWaitingList.filter(function(O){return O.streamID!==y});delete this.publisherList[y],b.publisher&&(b.publisher.stopPublish(),delete b.publisher),this.removeStreamFromSignal(!0,y),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},E.prototype.connectWithReuseSignalServer=function(y,b,S,k,O){var g=this;this.logger.info("zsc.crss.0 begin "+S);var v=null;if(this.signalList[S])(v=this.signalList[S]).state==o.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+S+" streamId: "+y),b?v.publishConnectedList.push(y):v.playConnectedList.push(y),k(y,v,S)):v.state==o.ENUM_SIGNAL_STATE.connecting&&(this.logger.info("zsc.crss.0 signal is connecting "+S+" streamId: "+y),this.updateWaitingList(v,b,y,k,O));else{this.logger.info("zsc.crss.0 new signal "+S+", streamId: "+y);var R=["unified_rtc","unified_l3"].includes(S),L=new n.ZegoSignal(this.logger,this.stateCenter,this.rtm.netAgent,R);L.setSessionInfo(this.appid,this.userid),R||(L.onUpdateHeartBeatInterval=this.onUpdateHeartBeatIntervalHandle.bind(this)),L.onDisconnect=this.onDisconnectHandle;var N=this.publisherList[y]||this.playerList[y]||null,w=N==null?void 0:N.retryStreamHandler;if(this.stateCenter.streamConnectTime)L.tryConnectInterval=this.stateCenter.streamConnectTime;else if(w&&w.retryActiveCount){var B=w.retryActiveCount*(w.retryActiveCount-1)/2+2;B=B>o.MAX_RETRY_CONNECT_INTERVAL?o.MAX_RETRY_CONNECT_INTERVAL:B,L.tryConnectInterval=1e3*B}this.signalList[S]={signal:L,state:o.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[S],b,y,k,O);var x=N==null?void 0:N.room.token,Z=N==null?void 0:N.room.roomID;this.logger.info("zsc.crss.0 "+x),L.connectServer(Z||this.stateCenter.roomList[0].roomID,x||this.stateCenter.roomList[0].token,S,function(V,Y,te){v=g.signalList[S],V!=0?(g.logger.info("zsc.crss.0 connect failed "+Y),v.publishWaitingList.forEach(function(F){F.error&&F.error(F.streamID,V)}),v.playWaitingList.forEach(function(F){F.error&&F.error(F.streamID,V)}),delete g.signalList[S]):(g.logger.debug("zsc.crss.0 connected success "+Y),v.state=o.ENUM_SIGNAL_STATE.connected,v.tokenInfo=te,v.publishWaitingList.forEach(function(F){F.success&&F.success(F.streamID,v,Y),v&&v.publishConnectedList.push(F.streamID)}),v.playWaitingList.forEach(function(F){F.success&&F.success(F.streamID,v,Y),v&&v.playConnectedList.push(F.streamID)}),v.publishWaitingList=[],v.playWaitingList=[],R||g.heartbeatTimer!=null||g.startSignalHeartbeat(),g.chargeInfosTimer==null&&g.startChargeInfosUpload(),g.activeSoundLevel())})}},E.prototype.setPlayStateStart=function(y,b,S){var k=this;if(this.logger.info("zsc.pss.1 call "+y),this.stateCenter.networkState==d.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.1 network offline"),!1;var O=this.playerList[y],g=this.stateCenter.reportSeqList.startPlay[y];if(this.dataReport.eventStart(g,"setPlayState"),O)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(g,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(g,void 0,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[y],!1;var v=this.getPlayRoom(y)||this.stateCenter.roomList[0];if(!v)return this.logger.error("zsc.pss.1 not login room"),this.dataReport.eventEndWithMsgInfo(g,"setPlayState",{message:"not login room"}),this.dataReport.uploadReport(g,void 0,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;var R=new t.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);b&&[0,2,3].includes(b.resourceMode)&&(R.resourceMode=b.resourceMode),this.dataReport.addMsgInfo(g,{resourceMode:R.resourceMode,play_room_id:v==null?void 0:v.roomID,isMulti:this.stateCenter.isMultiRoom}),R.state=o.ENUM_PLAY_STATE.start,R.isPeer=this.isPeer,R.reportSeq=this.stateCenter.reportSeqList.startPlay[y],R.beginTime=new Date().getTime();var L=new e.RetryStreamHandler(this.logger,this.stateCenter,this,!1);return this.playerList[y]={seq:0,room:v,player:R,signal:null,serverUrls:[],ttl:0,isCenterNode:!0,streamID:y,playOption:b,retryStreamHandler:L,retryDispatchHandler:new r.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:S},R.onPlayStateUpdate=function(N,w,B,x){var Z=k.playerList[w];Z?L.playStateHandle(N,Z.streamID,B,x):k.logger.error("zsc.pss.1 cannot find play "+w)},R.onPlayQualityUpdate=function(N,w){var B=k.playerList[N];B?k.onPlayQualityUpdate(B.streamID,w):k.logger.error("zsc.pss.1 cannot find play "+N)},R.onRemoteCameraStatusUpdate=function(N,w,B){var x=k.playerList[N];x?k.onRemoteCameraStatusUpdate(x.streamID,w,B):k.logger.error("zsc.pss.1 cannot find play "+N)},R.onRemoteMicStatusUpdate=function(N,w,B){var x=k.playerList[N];x?k.onRemoteMicStatusUpdate(x.streamID,w,B):k.logger.error("zsc.pss.1 cannot find play "+N)},this.dataReport.eventStart(R.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(R.streamReportSeq,"GetSignalUrl"),!0},E.prototype.onRemoteMicStatusUpdate=function(y,b,S){},E.prototype.onRemoteCameraStatusUpdate=function(y,b,S){},E.prototype.startPlayingStream=function(y,b,S){b===void 0&&(b=!1),this.logger.info("zsc.sps.1 start play called");var k=this.playerList[y];if(!k)return this.logger.error("zsc.sps.1 player don't exist"),!1;var O=k.player;if(!b){if(this.dataReport.eventEndWithMsg(O.reportSeq,"GetSignalUrl",{urls:k.serverUrls}),this.dataReport.eventEndWithMsg(O.streamReportSeq,"GetSignalUrl",{urls:k.serverUrls}),k.serverUrls.length==0)return k.retryStreamHandler.playStateHandle(o.ENUM_PLAY_STATE_UPDATE.error,y,i.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;var g=k.serverUrls.indexOf(this.server);g!==-1&&(k.serverUrls.splice(g,1),k.serverUrls.unshift(this.server))}var v=k.retryStreamHandler;return v.invalid(),v.init(this.stateCenter.streamRetryTime),v.initStream(y,k.serverUrls),v.startMaxTime(),v.activePull(0,S)},E.prototype.connectPlayServer=function(y,b,S){var k=this,O=this.playerList[y];return O?(this.dataReport.eventStart(O.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(O.player.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(y,!1,S,function(g,v,R){var L=k.playerList[g];if(L){var N=L.player;if(N){k.dataReport.eventEndWithMsg(N.reportSeq,"ConnectServer",{result:0,server:R}),k.dataReport.eventEndWithMsg(N.streamReportSeq,"ConnectServer",{result:0,server:R});var w=v.tokenInfo;k.logger.info("zsc.cps.1 update token success"),w&&w.report&&(N.qualityHandler.qualityUpload=w.report,N.qualityHandler.qualityUploadInterval=w.report_interval),N.signal=v.signal,k.server=R,k.playStream(g,b),k.getTokenSuccess()}else k.logger.error("zsc.cps.1 checkplayer don't exist")}else k.logger.error("zsc.cps.1 after connect player don't exist")},function(g,v){var R=k.playerList[g];if(R){k.dataReport.eventEndWithMsg(R.player.reportSeq,"ConnectServer",{result:v}),!R.player.isProbe&&k.dataReport.uploadReport(R.player.reportSeq),delete k.stateCenter.reportSeqList.startPlay[y];var L=_({},i.errorCodeList.CONNECT_FAILED);L.message=L.message+" "+v,v===1008&&(L=i.errorCodeList.TOKEN_EXPIRED);var N=v==1008;v===20010&&(N=!0,L=S==="unified_l3"?i.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL:i.errorCodeList.PLAYER_SESSION_REQUEST_FAIL),R.retryStreamHandler.playStateHandle(o.ENUM_PLAY_STATE_UPDATE.error,g,L,N)}else k.logger.error("zsc.cps.1 after connect player don't exist")}),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},E.prototype.playStream=function(y,b){var S=this.playerList[y].player;S?(this.logger.info("zsc.ps.1 call success"),S.gwNodeTTL<new Date().getTime()&&!this.gwNode?(S.gwNode="",S.gwNodeList=[],S.gwNodeTTL=0):this.gwNode&&(S.gwNode=this.gwNode),S.startPlay(y,b,this.playerList[y].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},E.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var y=0;for(var b in this.signalList)y+=1;this.heartbeatTimer&&y==0&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},E.prototype.removeStreamFromSignal=function(y,b){var S=[];for(var k in this.signalList){var O=this.signalList[k];if(y){for(var g=0;g<O.publishConnectedList.length;g++)if(O.publishConnectedList[g]===b){this.logger.debug("zsc.rsfs.0 found from publish"),O.publishConnectedList.splice(g,1);break}for(g=0;g<O.publishWaitingList.length;g++)if(O.publishWaitingList[g].streamID===b){this.logger.debug("zsc.rsfs.0 found from publish"),O.publishWaitingList.splice(g,1);break}}else{for(var v=0;v<O.playConnectedList.length;v++)if(O.playConnectedList[v]===b){this.logger.debug("zsc.rsfs.0 found from play"),O.playConnectedList.splice(v,1);break}for(v=0;v<O.playWaitingList.length;v++)if(O.playWaitingList[v].streamID===b){this.logger.debug("zsc.rsfs.0 found from play"),O.playWaitingList.splice(v,1);break}}O.publishConnectedList.length==0&&O.playConnectedList.length==0&&O.publishWaitingList.length==0&&O.playWaitingList.length==0&&(O.signal.disconnectServer(),S.push(k))}for(var R=0;R<S.length;R++)delete this.signalList[S[R]],this.server==S[R]&&(this.server="")},E.prototype.stopPlayingStream=function(y){var b=this.playerList[y];if(b){var S=b.retryStreamHandler;for(var k in S&&(S.stopMaxTime(),S.invalid()),this.signalList)this.signalList[k].playWaitingList=this.signalList[k].playWaitingList.filter(function(O){return O.streamID!==y});delete this.playerList[y],b.player&&(b.player.stopPlay(),delete b.player),this.removeStreamFromSignal(!1,y),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[y],delete this.playErrorCallBackList[y],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},E.prototype.reset=function(y,b){var S,k;for(var O in this.publisherList)this.publisherList[O].room.roomID!=y&&y||((k=(S=this.publisherList[O].room)===null||S===void 0?void 0:S.streamHandler)===null||k===void 0||k.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,O,b==1002031?s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError:{code:0,message:""}),this.stopPublishingStream(O));var g=function(L){var N=v.playerList[L].room;if(N.roomID!=y||!N.streamList.find(function(B){return B.stream_id==L})&&v.stateCenter.roomList.length!=1){if(N.roomID==y&&v.stateCenter.roomList.length>1){var w=v.stateCenter.roomList.find(function(B){return B.roomID!==y});w?v.playerList[L].room=w:(v.stopPlayingStream(L),v.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,L,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError))}}else v.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,L,b==1002031?s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError:{code:0,message:""}),v.stopPlayingStream(L)},v=this;for(var R in this.playerList)g(R);Object.keys(this.publisherList).length==0&&Object.keys(this.playerList).length==0&&(this.probeList={}),this.waitPublishList=[],this.waitPlayList=[],this.publishQualityInfos=[],this.playQualityInfos=[],this.qualityHeadTimestamp=0,this.qualityUploadTimestamp=0,this.qualityWebsocket&&(this.qualityWebsocket.close(),this.qualityWebsocket=void 0)},E.prototype.startSignalHeartbeat=function(){var y=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout(function(){y.checkSignalHeartbeat()},this.heartbeatInterval)},E.prototype.startChargeInfosUpload=function(){var y=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout(function(){y.checkChargeInfos()},this.chargeInfosInterval)},E.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var y={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var b in this.chargeInfos.timestamp_begin=new Date().getTime(),this.publisherList){this.publisherList[b].publisher.state===o.ENUM_PUBLISH_STATE.publishing&&(y.is_publishing=1);break}y.play_max_audio_bitrate=0;var S=function(g){var v=k.playerList[g].player.playStream,R=v&&v.getVideoTracks().length!==0?v.getVideoTracks()[0].getSettings():void 0,L={video_width:R&&R.width?R.width:0,video_height:R&&R.height?R.height:0,count:1};if(!y.play_stream_resolution_infos.find(function(w){return w.video_width==L.video_width&&w.video_height==L.video_height&&(w.count++,!0)})&&y.play_stream_resolution_infos.push(L),L.video_width==0&&L.video_height==0){var N=1e3*k.playerList[g].player.qualityHandler.lastPlayStats.audioBitrate;N>y.play_max_audio_bitrate&&(y.play_max_audio_bitrate=N)}},k=this;for(var O in this.playerList)S(O);this.chargeInfos.timestamp_end!==0?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=new Date().getTime(),this.chargeInfos.infos=[y],y.play_stream_resolution_infos.length!==0&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},E.prototype.checkSignalHeartbeat=function(){for(var y in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[y].signal&&this.signalList[y].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},E.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var y=0;for(var b in this.signalList)y+=1;this.chargeInfosTimer&&y==0&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},E.prototype.getPublisher=function(y){var b=null;if(typeof y=="string"&&this.publisherList[y]&&this.publisherList[y].publisher)b=this.publisherList[y].publisher;else if(y instanceof MediaStream){var S=this.checkPublish(y);S&&(b=S==null?void 0:S.publisher)}return b},E.prototype.checkPreview=function(y){for(var b=0;b<this.previewStreamList.length;b++)if(this.previewStreamList[b].localStream===y)return this.previewStreamList[b];return null},E.prototype.checkPublish=function(y){for(var b in this.publisherList)if(this.publisherList[b].localStream==y)return this.publisherList[b];return null},E.prototype.removePreview=function(y){for(var b=0;b<this.previewStreamList.length;b++)if(this.previewStreamList[b]===y){this.previewStreamList.splice(b,1);break}},E.prototype.onPlayerStreamUrlUpdate=function(y,b,S){},E.prototype.getScreenConstrains=function(y){var b={};if(typeof y=="boolean"&&y)b={audio:!1,video:{frameRate:o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate},bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};else if(typeof y=="object"){switch(y.videoQuality){case 1:b={video:{frameRate:o.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate},bitRate:o.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 3:b={video:{frameRate:o.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate},bitRate:o.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:b={video:{frameRate:y.frameRate,width:y.width,height:y.height},bitRate:y.bitRate};break;case 2:b={video:{frameRate:o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate},bitRate:o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};break;default:b={video:{frameRate:o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate},bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||o.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate}}b.audio=typeof y.audio=="boolean"&&y.audio}return b},E.prototype.createScreenPreviewer=function(y,b){var S=new l.ZegoPreview(this.logger,this.ac,this.stateCenter,this,"screen"),k=y.getVideoTracks()[0].getSettings();return this.previewStreamList.push(S),S.mediaStreamConfig=b,y.getAudioTracks().length>0&&(S.audioTrack=y.getAudioTracks()[0]),S.localStream=y,S.videoInfo={width:k.width,height:k.height,frameRate:k.frameRate||15,bitRate:(b==null?void 0:b.bitRate)||1e3,startBitrate:(b==null?void 0:b.startBitrate)||this.stateCenter.settingConfig.getSetting("bitrate_mode")},S.previewSuc=!0,S.previewType="screen",(b==null?void 0:b.videoOptimizationMode)&&this.setVideoTrackContentHint(y,b==null?void 0:b.videoOptimizationMode),S},E.prototype.setSoundLevelDelegate=function(y,b,S){S===void 0&&(S=!0),this.logger.info("zsc.ssd.0 call"),b&&(this.soundLevelInterval=b),this.soundLevelDelegate=y,this.enableInBackground=S,this.enableSoundLevelProcessor(y),y?(this.logger.info("zsc.ssd.0 start getting sound"),this.activeSoundLevel()):(this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},E.prototype.enableSoundLevelProcessor=function(y){for(var b in this.previewStreamList){var S=this.previewStreamList[b];y?S.startSoundLevel():S.stopSoundLevel()}for(var b in this.playerList){var k=this.playerList[b].player;y?k.startSoundLevel():k.stopSoundLevel()}},Object.defineProperty(E.prototype,"hasRemoteStream",{get:function(){return Object.keys(this.signalList).length>0},enumerable:!1,configurable:!0}),E.prototype.activeSoundLevel=function(){!this.soundLevelTimer&&this.soundLevelDelegate&&this.startSoundLevel()},E.prototype.startSoundLevel=function(){var y=this;this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelDelegate&&(this.hasRemoteStream&&this.checkSoundLevel(),this.checkMicSoundLevel(),this.soundLevelTimer=setTimeout(function(){y.startSoundLevel()},this.soundLevelInterval))},E.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var y=[];for(var b in this.publisherList){var S=0,k=this.publisherList[b].publisher,O=k.previewer;O&&(S=O.soundLevel),y.push({streamID:this.getBackStreamId(k.streamId),soundLevel:S,type:"push"})}for(var b in this.playerList){var g=this.playerList[b].player;g.streamId&&!g.isProbe&&y.push({streamID:this.getBackStreamId(g.streamId),soundLevel:g.soundLevel,type:"pull"})}this.soundLevelDelegate&&y.length>0&&this.onSoundLevelUpdate(y)},E.prototype.checkMicSoundLevel=function(){if(this.microphonePreviewStream&&this.soundLevelDelegate){var y=this.microphonePreviewStream.soundLevel;this.onMicSoundLevelUpdate(y)}},E.prototype.getBackStreamId=function(y){return this.testEnvironment&&y?y.replace("zegotest-"+this.appid+"-",""):y},E.prototype.onSoundLevelUpdate=function(y){},E.prototype.onMicSoundLevelUpdate=function(y){},E.prototype.stopSoundLevel=function(){var y=this.previewStreamList.length;this.soundLevelTimer&&!this.hasRemoteStream&&y===0&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null)},E.prototype.startNetProbe=function(y,b,S){var k=this,O=d.getReportSeq();if(this.dataReport.newReport(O,s.ZegoRTCLogEvent.kZegoNetProbe.event),this.isPeer){var g=!0;S.length==0&&(g=!1,S=y?this.publisherList[b.streamId].serverUrls:this.playerList[b.streamId].serverUrls),S.forEach(function(v){if(!(k.probeList[v]&&k.probeList[v].timeStamp+9e5<new Date().getTime()||b.probeState==o.ENUM_PROBE_STATE.probed)){var R="zegoprobe-"+new Date().getTime();k.setPlayStateStart(R);var L=k.playerList[R]?k.playerList[R].player:null;L&&(L.isProbe=!0,g?(L.gwNode=v,L.signal=b.signal,L.startPlay(R,function(){})):k.connectPlayServer(R,function(){},v),L.onCalNetQualityResult=function(N,w){k.logger.info("zc.ocnqr.0 "+L.gwNode+" "+N+" "+w),k.probeList[v]={result:N,netQuality:w,timeStamp:new Date().getTime()},b.gwNode==v||b.signal.server==v?b.netQuality=w:k.handleCalNetQualityResult(y,N,w,b,v),k.stopPlayingStream(R)})}}),this.dataReport.addMsgInfo(O,{netQuality:b.netQuality,nodeList:S}),this.dataReport.uploadReport(O)}else this.dataReport.uploadReport(O,void 0,{code:-1,message:"not support peer"})},E.prototype.handleCalNetQualityResult=function(y,b,S,k,O){if(this.logger.info("zc.hcqr.0 "+k.netQuality+" probe "+S+" "+O),b===0){var g=d.getReportSeq();this.dataReport.newReport(g,s.ZegoRTCLogEvent.kZegoNetProbeResult.event);var v=!1;if(S>Math.max(75,k.netQuality+20)&&k.probeState==o.ENUM_PROBE_STATE.tryProbe)if(v=!0,y){var R=k,L=R.streamId,N=R.localStream,w=R.videoInfo,B=R.mediaStreamConfig,x=R.publishOption;R.sessionId!=0&&R.signal&&R.shouldSendCloseSession()&&(R.signal.sendCloseSession(this.stateCenter.getSeq(),R.sessionId,1),R.signal.removeSession(R.sessionId),R.closeSessionSignal=!0),R.resetPublish(),this.publisherList[L].isCenterNode?(R.gwNode=O,R.startPublish(L,N,w,B,x)):this.connectPublishServer(L,O)}else{var Z=k,V=(L=Z.streamId,Z.getRemoteStreamSuc),Y=Z.playOption;Z.sessionId!=0&&Z.signal&&Z.shouldSendCloseSession()&&(Z.signal.sendCloseSession(this.stateCenter.getSeq(),Z.sessionId,1),Z.signal.removeSession(Z.sessionId),Z.closeSessionSignal=!0),Z.resetPlay(),this.playerList[L].isCenterNode?(Z.gwNode=O,Z.startPlay(L,V,Y)):this.connectPlayServer(L,V,O)}else v=!1,this.logger.warn("zc.hcqr.0 "+k.netQuality+" probe "+S+" "+O);this.dataReport.addMsgInfo(g,{isSwitch:v,isPublish:y,streamID:k.streamId,result:b,node:O,netQuality:k.netQuality,probeNetQuality:S}),this.dataReport.uploadReport(g),k.probeState=o.ENUM_PROBE_STATE.probed}},E.prototype.getRoomByStreamID=function(y){return this.publisherList[y]?this.publisherList[y].room:this.playerList[y]?this.playerList[y].room:void 0},E.prototype.setVideoTrackContentHint=function(y,b){if(typeof b=="string"){var S=b.toLowerCase();if(["default","motion","detail","text"].includes(S)){var k=y.getVideoTracks()[0];k?"contentHint"in k?(this.logger.info("zc.svtch "+S),k.contentHint=S=="default"?"":S):this.logger.warn("zc.svtch mediaStreamTrack contentHint attribute not supported"):this.logger.warn("zc.svtch video track no found")}else this.logger.warn("zc.svtch videoOptimizationMode wrong")}else this.logger.warn("zc.svtch videoOptimizationMode type wrong")},E.prototype.getPlayRoom=function(y){return this.stateCenter.roomList.find(function(b){return!!b.streamList.find(function(S){return S.stream_id==y})})},E.prototype.getQualityHead=function(y,b){var S=new Uint8Array(12);S[0]=0,S[1]=12,S[2]=y.length>>8,S[3]=y.length-(S[2]<<8),S[4]=b.length>>24,S[5]=b.length-(S[4]<<24)>>16,S[6]=b.length-(S[4]<<24)-(S[5]<<16)>>8,S[7]=b.length-(S[4]<<24)-(S[5]<<16)-(S[6]<<8);var k=Math.ceil(new Date().getTime()/1e3);return S[8]=k>>24,S[9]=k-(S[8]<<24)>>16,S[10]=k-(S[8]<<24)-(S[9]<<16)>>8,S[11]=k-(S[8]<<24)-(S[9]<<16)-(S[10]<<8),S},E.prototype.streamQualityUpload=function(){var y,b=this;if(Object.keys(this.publisherList).length>0||Object.keys(this.playerList).length>0){var S={version:1,timestamp:this.qualityHeadTimestamp,event:0,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,biz_type:1},k={publish_quality_infos:this.publishQualityInfos,play_quality_infos:this.playQualityInfos},O=u.logreport.SpeedLogHead.create(S),g=u.logreport.QualityEvent.create(k),v=u.logreport.SpeedLogHead.encode(O).finish(),R=u.logreport.QualityEvent.encode(g).finish(),L=this.getQualityHead(v,R),N=new Uint8Array(12+v.length+R.length);N.set(L),N.set(v,12),N.set(R,12+v.length);var w=(y=this.logger.url)===null||y===void 0?void 0:y.split("/")[2];if(!w)return;if(this.qualityWebsocket&&this.qualityWebsocket.readyState!=2&&this.qualityWebsocket.readyState!=3)this.qualityWebsocket.readyState==1&&this.qualityWebsocket.send(N);else{var B=this.stateCenter.appid,x=this.stateCenter.idName,Z=this.stateCenter.roomList[0].token;this.qualityWebsocket=new WebSocket("wss://"+w+"/ws/report/stream?appid="+B+"&product=rtc&token="+encodeURIComponent(Z)+"&id_name="+x),this.qualityWebsocket.onopen=function(){var V;(V=b.qualityWebsocket)===null||V===void 0||V.send(N)}}}},E.prototype.updateQuality=function(y,b){var S=this,k=new Date().getTime();this.qualityUploadTimestamp!==0&&k-this.qualityUploadTimestamp>6e4||this.publishQualityInfos.join("").length+this.playQualityInfos.join().length>8e3?(this.publishQualityInfos.forEach(function(O){return O.timestamp_offset_end=Math.round(k/1e3)-S.qualityHeadTimestamp}),this.playQualityInfos.forEach(function(O){return O.timestamp_offset_end=Math.round(k/1e3)-S.qualityHeadTimestamp}),this.streamQualityUpload(),this.publishQualityInfos=[],this.playQualityInfos=[],this.qualityHeadTimestamp=Math.round(new Date().getTime()/1e3),this.qualityUploadTimestamp=k):this.qualityHeadTimestamp==0&&(this.qualityHeadTimestamp=Math.round(new Date().getTime()/1e3),this.qualityUploadTimestamp=k),y==0?this.handlePublishQualityData(b):this.handlePlayQualityData(b)},E.prototype.handlePublishQualityData=function(y){var b=this.publishQualityInfos.find(function(k){return k.stream_id==y.stream_id&&k.video_width==y.frameWidth&&k.video_height==y.frameHeight});if(!b){var S=this.getRoomByStreamID(y.stream_id);b={timestamp_offset_begin:Math.abs(Number(y.timeStamp-this.qualityHeadTimestamp)),timestamp_offset_end:0,stream_id:y.stream_id,session_id:S?Number(S.sessionID):0,video_width:y.frameWidth,video_height:y.frameHeight,infos:[],room_id:S?S.roomID:"",evnvironment:1,room_session_id:S?Number(S.roomSessionID):0,resource_type:2},this.publishQualityInfos.push(b)}b.infos.push({audio_bitrate:Math.round(y.audioBitrate)||0,video_bitrate:Math.round(y.videoBitrate)||0,video_capture_fps:Math.round(10*y.videoFPS)||0,video_network_fps:Math.round(10*y.videoTransferFPS)||0,uplink_plr:y.audioPacketsLostRate,rtt:Math.round(y.currentRoundTripTime),audio_network_fps:Math.round(10*y.audioFPS),captured_sound_level:Math.round(y.audioLevel),sample_time_window:Math.round(y.sampleTimeWindow/10)})},E.prototype.handlePlayQualityData=function(y){var b,S=this.playQualityInfos.find(function(g){return g.stream_id==y.stream_id&&g.video_width==y.frameWidth&&g.video_height==y.frameHeight});if(!S){var k=this.getRoomByStreamID(y.stream_id),O=(b=this.playerList[y.stream_id])===null||b===void 0?void 0:b.player;S={timestamp_offset_begin:Math.abs(Number(y.timeStamp-this.qualityHeadTimestamp)),timestamp_offset_end:0,stream_id:y.stream_id,session_id:k?Number(k.sessionID):0,video_width:y.frameWidth,video_height:y.frameHeight,infos:[],room_id:k?k.roomID:"",room_session_id:k?Number(k.roomSessionID):0,resource_type:O==null?void 0:O.resourceMode},this.playQualityInfos.push(S)}S.infos.push({audio_bitrate:Math.round(y.audioBitrate)||0,video_bitrate:Math.round(y.videoBitrate)||0,video_network_fps:Math.round(10*y.videoFPS)||0,downlink_plr:Math.round(y.audioPacketsLostRate)||0,audio_network_fps:Math.round(10*y.audioFPS)||0,audio_break_duration:Math.round(y.audio_break_duration/10),video_break_duration:Math.round(y.video_break_duration/10),rtt:y.currentRoundTripTime,rendered_sound_level:Math.round(y.audioLevel),audio_break_cancel_duration:Math.round(y.audio_break_cancel_duration/10),video_break_cancel_duration:Math.round(y.video_break_cancel_duration/10),audio_decode_time:Math.round(y.audio_decode_time/10),video_decode_time:Math.round(y.video_decode_time/10),real_sampling_interval:Math.round(y.real_sampling_interval/10),video_frames_decoded:Math.round(y.videoFramesDecoded)||0,video_frames_dropped:Math.round(y.videoFramesDropped)||0,sample_time_window:Math.round(y.sampleTimeWindow/10),peer_to_peer_plr:y.peerToPeerPacketLostRate,peer_to_peer_delay:y.peerToPeerDelay})},E}(c.ZegoStreamCenter);T.ZegoStreamCenterWeb=p},2990:function(W,T,I){"use strict";var m,h=I(2100),_=h.Reader,d=h.Writer,l=h.util,a=h.roots.default||(h.roots.default={});a.logreport=((m={}).SpeedLogHead=function(){function c(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}var o,n;return c.prototype.version=0,c.prototype.signature=l.newBuffer([]),c.prototype.timestamp=0,c.prototype.event=0,c.prototype.app_id=0,c.prototype.user_id="",c.prototype.biz_type=0,c.prototype.device_id="",c.create=function(t){return new c(t)},c.encode=function(t,e){return e||(e=d.create()),t.version!=null&&Object.hasOwnProperty.call(t,"version")&&e.uint32(8).uint32(t.version),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&e.uint32(18).bytes(t.signature),t.timestamp!=null&&Object.hasOwnProperty.call(t,"timestamp")&&e.uint32(24).uint32(t.timestamp),t.event!=null&&Object.hasOwnProperty.call(t,"event")&&e.uint32(32).uint32(t.event),t.app_id!=null&&Object.hasOwnProperty.call(t,"app_id")&&e.uint32(40).uint32(t.app_id),t.user_id!=null&&Object.hasOwnProperty.call(t,"user_id")&&e.uint32(50).string(t.user_id),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(56).uint32(t.biz_type),t.device_id!=null&&Object.hasOwnProperty.call(t,"device_id")&&e.uint32(66).string(t.device_id),e},c.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},c.decode=function(t,e){t instanceof _||(t=_.create(t));for(var r=e===void 0?t.len:t.pos+e,i=new a.logreport.SpeedLogHead;t.pos<r;){var s=t.uint32();switch(s>>>3){case 1:i.version=t.uint32();break;case 2:i.signature=t.bytes();break;case 3:i.timestamp=t.uint32();break;case 4:i.event=t.uint32();break;case 5:i.app_id=t.uint32();break;case 6:i.user_id=t.string();break;case 7:i.biz_type=t.uint32();break;case 8:i.device_id=t.string();break;default:t.skipType(7&s)}}return i},c.decodeDelimited=function(t){return t instanceof _||(t=new _(t)),this.decode(t,t.uint32())},c.verify=function(t){return typeof t!="object"||t===null?"object expected":t.version!=null&&t.hasOwnProperty("version")&&!l.isInteger(t.version)?"version: integer expected":t.signature!=null&&t.hasOwnProperty("signature")&&!(t.signature&&typeof t.signature.length=="number"||l.isString(t.signature))?"signature: buffer expected":t.timestamp!=null&&t.hasOwnProperty("timestamp")&&!l.isInteger(t.timestamp)?"timestamp: integer expected":t.event!=null&&t.hasOwnProperty("event")&&!l.isInteger(t.event)?"event: integer expected":t.app_id!=null&&t.hasOwnProperty("app_id")&&!l.isInteger(t.app_id)?"app_id: integer expected":t.user_id!=null&&t.hasOwnProperty("user_id")&&!l.isString(t.user_id)?"user_id: string expected":t.biz_type!=null&&t.hasOwnProperty("biz_type")&&!l.isInteger(t.biz_type)?"biz_type: integer expected":t.device_id!=null&&t.hasOwnProperty("device_id")&&!l.isString(t.device_id)?"device_id: string expected":null},c.fromObject=function(t){if(t instanceof a.logreport.SpeedLogHead)return t;var e=new a.logreport.SpeedLogHead;return t.version!=null&&(e.version=t.version>>>0),t.signature!=null&&(typeof t.signature=="string"?l.base64.decode(t.signature,e.signature=l.newBuffer(l.base64.length(t.signature)),0):t.signature.length&&(e.signature=t.signature)),t.timestamp!=null&&(e.timestamp=t.timestamp>>>0),t.event!=null&&(e.event=t.event>>>0),t.app_id!=null&&(e.app_id=t.app_id>>>0),t.user_id!=null&&(e.user_id=String(t.user_id)),t.biz_type!=null&&(e.biz_type=t.biz_type>>>0),t.device_id!=null&&(e.device_id=String(t.device_id)),e},c.toObject=function(t,e){e||(e={});var r={};return e.defaults&&(r.version=0,e.bytes===String?r.signature="":(r.signature=[],e.bytes!==Array&&(r.signature=l.newBuffer(r.signature))),r.timestamp=0,r.event=0,r.app_id=0,r.user_id="",r.biz_type=0,r.device_id=""),t.version!=null&&t.hasOwnProperty("version")&&(r.version=t.version),t.signature!=null&&t.hasOwnProperty("signature")&&(r.signature=e.bytes===String?l.base64.encode(t.signature,0,t.signature.length):e.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),t.timestamp!=null&&t.hasOwnProperty("timestamp")&&(r.timestamp=t.timestamp),t.event!=null&&t.hasOwnProperty("event")&&(r.event=t.event),t.app_id!=null&&t.hasOwnProperty("app_id")&&(r.app_id=t.app_id),t.user_id!=null&&t.hasOwnProperty("user_id")&&(r.user_id=t.user_id),t.biz_type!=null&&t.hasOwnProperty("biz_type")&&(r.biz_type=t.biz_type),t.device_id!=null&&t.hasOwnProperty("device_id")&&(r.device_id=t.device_id),r},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c.ProtoVersion=(o={},(n=Object.create(o))[o[0]="PROTO_VERSION"]=0,n[o[1]="PROTO_VERSION1"]=1,n[o[2]="PROTO_VERSION2"]=2,n[o[3]="PROTO_VERSION3"]=3,n[o[4]="PROTO_VERSION4"]=4,n[o[5]="PROTO_VERSION5"]=5,n[o[6]="PROTO_VERSION6"]=6,n),c.Event=function(){var t={},e=Object.create(t);return e[t[0]="QUALITY_EVENT"]=0,e[t[100]="NO_BILLING_EVENT"]=100,e[t[300]="DETECT_QUALITY_EVENT"]=300,e}(),c.BizType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN"]=0,e[t[1]="LIVE"]=1,e[t[2]="RTV"]=2,e}(),c}(),m.SpeedLogRsp=function(){function c(o){if(o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.code=0,c.prototype.message="",c.create=function(o){return new c(o)},c.encode=function(o,n){return n||(n=d.create()),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&n.uint32(8).uint32(o.code),o.message!=null&&Object.hasOwnProperty.call(o,"message")&&n.uint32(18).string(o.message),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.SpeedLogRsp;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.code=o.uint32();break;case 2:e.message=o.string();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){return typeof o!="object"||o===null?"object expected":o.code!=null&&o.hasOwnProperty("code")&&!l.isInteger(o.code)?"code: integer expected":o.message!=null&&o.hasOwnProperty("message")&&!l.isString(o.message)?"message: string expected":null},c.fromObject=function(o){if(o instanceof a.logreport.SpeedLogRsp)return o;var n=new a.logreport.SpeedLogRsp;return o.code!=null&&(n.code=o.code>>>0),o.message!=null&&(n.message=String(o.message)),n},c.toObject=function(o,n){n||(n={});var t={};return n.defaults&&(t.code=0,t.message=""),o.code!=null&&o.hasOwnProperty("code")&&(t.code=o.code),o.message!=null&&o.hasOwnProperty("message")&&(t.message=o.message),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.QualityEvent=function(){function c(t){if(this.publish_quality_infos=[],this.play_quality_infos=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}var o,n;return c.prototype.hardware_infos=null,c.prototype.publish_quality_infos=l.emptyArray,c.prototype.play_quality_infos=l.emptyArray,c.prototype.network_type=0,c.prototype.charge_infos=null,c.prototype.client_type=0,c.create=function(t){return new c(t)},c.encode=function(t,e){if(e||(e=d.create()),t.hardware_infos!=null&&Object.hasOwnProperty.call(t,"hardware_infos")&&a.logreport.HardwareInfos.encode(t.hardware_infos,e.uint32(10).fork()).ldelim(),t.publish_quality_infos!=null&&t.publish_quality_infos.length)for(var r=0;r<t.publish_quality_infos.length;++r)a.logreport.PublishQualityInfos.encode(t.publish_quality_infos[r],e.uint32(18).fork()).ldelim();if(t.play_quality_infos!=null&&t.play_quality_infos.length)for(r=0;r<t.play_quality_infos.length;++r)a.logreport.PlayQualityInfos.encode(t.play_quality_infos[r],e.uint32(26).fork()).ldelim();return t.network_type!=null&&Object.hasOwnProperty.call(t,"network_type")&&e.uint32(32).uint32(t.network_type),t.charge_infos!=null&&Object.hasOwnProperty.call(t,"charge_infos")&&a.logreport.ChargeInfos.encode(t.charge_infos,e.uint32(42).fork()).ldelim(),t.client_type!=null&&Object.hasOwnProperty.call(t,"client_type")&&e.uint32(800).uint32(t.client_type),e},c.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},c.decode=function(t,e){t instanceof _||(t=_.create(t));for(var r=e===void 0?t.len:t.pos+e,i=new a.logreport.QualityEvent;t.pos<r;){var s=t.uint32();switch(s>>>3){case 1:i.hardware_infos=a.logreport.HardwareInfos.decode(t,t.uint32());break;case 2:i.publish_quality_infos&&i.publish_quality_infos.length||(i.publish_quality_infos=[]),i.publish_quality_infos.push(a.logreport.PublishQualityInfos.decode(t,t.uint32()));break;case 3:i.play_quality_infos&&i.play_quality_infos.length||(i.play_quality_infos=[]),i.play_quality_infos.push(a.logreport.PlayQualityInfos.decode(t,t.uint32()));break;case 4:i.network_type=t.uint32();break;case 5:i.charge_infos=a.logreport.ChargeInfos.decode(t,t.uint32());break;case 100:i.client_type=t.uint32();break;default:t.skipType(7&s)}}return i},c.decodeDelimited=function(t){return t instanceof _||(t=new _(t)),this.decode(t,t.uint32())},c.verify=function(t){if(typeof t!="object"||t===null)return"object expected";if(t.hardware_infos!=null&&t.hasOwnProperty("hardware_infos")&&(r=a.logreport.HardwareInfos.verify(t.hardware_infos)))return"hardware_infos."+r;if(t.publish_quality_infos!=null&&t.hasOwnProperty("publish_quality_infos")){if(!Array.isArray(t.publish_quality_infos))return"publish_quality_infos: array expected";for(var e=0;e<t.publish_quality_infos.length;++e)if(r=a.logreport.PublishQualityInfos.verify(t.publish_quality_infos[e]))return"publish_quality_infos."+r}if(t.play_quality_infos!=null&&t.hasOwnProperty("play_quality_infos")){if(!Array.isArray(t.play_quality_infos))return"play_quality_infos: array expected";for(e=0;e<t.play_quality_infos.length;++e){var r;if(r=a.logreport.PlayQualityInfos.verify(t.play_quality_infos[e]))return"play_quality_infos."+r}}return t.network_type!=null&&t.hasOwnProperty("network_type")&&!l.isInteger(t.network_type)?"network_type: integer expected":t.charge_infos!=null&&t.hasOwnProperty("charge_infos")&&(r=a.logreport.ChargeInfos.verify(t.charge_infos))?"charge_infos."+r:t.client_type!=null&&t.hasOwnProperty("client_type")&&!l.isInteger(t.client_type)?"client_type: integer expected":null},c.fromObject=function(t){if(t instanceof a.logreport.QualityEvent)return t;var e=new a.logreport.QualityEvent;if(t.hardware_infos!=null){if(typeof t.hardware_infos!="object")throw TypeError(".logreport.QualityEvent.hardware_infos: object expected");e.hardware_infos=a.logreport.HardwareInfos.fromObject(t.hardware_infos)}if(t.publish_quality_infos){if(!Array.isArray(t.publish_quality_infos))throw TypeError(".logreport.QualityEvent.publish_quality_infos: array expected");e.publish_quality_infos=[];for(var r=0;r<t.publish_quality_infos.length;++r){if(typeof t.publish_quality_infos[r]!="object")throw TypeError(".logreport.QualityEvent.publish_quality_infos: object expected");e.publish_quality_infos[r]=a.logreport.PublishQualityInfos.fromObject(t.publish_quality_infos[r])}}if(t.play_quality_infos){if(!Array.isArray(t.play_quality_infos))throw TypeError(".logreport.QualityEvent.play_quality_infos: array expected");for(e.play_quality_infos=[],r=0;r<t.play_quality_infos.length;++r){if(typeof t.play_quality_infos[r]!="object")throw TypeError(".logreport.QualityEvent.play_quality_infos: object expected");e.play_quality_infos[r]=a.logreport.PlayQualityInfos.fromObject(t.play_quality_infos[r])}}if(t.network_type!=null&&(e.network_type=t.network_type>>>0),t.charge_infos!=null){if(typeof t.charge_infos!="object")throw TypeError(".logreport.QualityEvent.charge_infos: object expected");e.charge_infos=a.logreport.ChargeInfos.fromObject(t.charge_infos)}return t.client_type!=null&&(e.client_type=t.client_type>>>0),e},c.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.publish_quality_infos=[],r.play_quality_infos=[]),e.defaults&&(r.hardware_infos=null,r.network_type=0,r.charge_infos=null,r.client_type=0),t.hardware_infos!=null&&t.hasOwnProperty("hardware_infos")&&(r.hardware_infos=a.logreport.HardwareInfos.toObject(t.hardware_infos,e)),t.publish_quality_infos&&t.publish_quality_infos.length){r.publish_quality_infos=[];for(var i=0;i<t.publish_quality_infos.length;++i)r.publish_quality_infos[i]=a.logreport.PublishQualityInfos.toObject(t.publish_quality_infos[i],e)}if(t.play_quality_infos&&t.play_quality_infos.length)for(r.play_quality_infos=[],i=0;i<t.play_quality_infos.length;++i)r.play_quality_infos[i]=a.logreport.PlayQualityInfos.toObject(t.play_quality_infos[i],e);return t.network_type!=null&&t.hasOwnProperty("network_type")&&(r.network_type=t.network_type),t.charge_infos!=null&&t.hasOwnProperty("charge_infos")&&(r.charge_infos=a.logreport.ChargeInfos.toObject(t.charge_infos,e)),t.client_type!=null&&t.hasOwnProperty("client_type")&&(r.client_type=t.client_type),r},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c.ResourceType=(o={},(n=Object.create(o))[o[0]="UNKNOWN"]=0,n[o[1]="CDN"]=1,n[o[2]="RTC"]=2,n[o[3]="L3"]=3,n),c}(),m.HardwareInfos=function(){function c(o){if(this.infos=[],o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.timestamp_offset_begin=0,c.prototype.timestamp_offset_end=0,c.prototype.infos=l.emptyArray,c.prototype.sys_mem_total=0,c.create=function(o){return new c(o)},c.encode=function(o,n){if(n||(n=d.create()),o.timestamp_offset_begin!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_begin")&&n.uint32(8).uint32(o.timestamp_offset_begin),o.timestamp_offset_end!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_end")&&n.uint32(16).uint32(o.timestamp_offset_end),o.infos!=null&&o.infos.length)for(var t=0;t<o.infos.length;++t)a.logreport.HardwareInfo.encode(o.infos[t],n.uint32(26).fork()).ldelim();return o.sys_mem_total!=null&&Object.hasOwnProperty.call(o,"sys_mem_total")&&n.uint32(32).uint32(o.sys_mem_total),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.HardwareInfos;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.timestamp_offset_begin=o.uint32();break;case 2:e.timestamp_offset_end=o.uint32();break;case 3:e.infos&&e.infos.length||(e.infos=[]),e.infos.push(a.logreport.HardwareInfo.decode(o,o.uint32()));break;case 4:e.sys_mem_total=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&!l.isInteger(o.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&!l.isInteger(o.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(o.infos!=null&&o.hasOwnProperty("infos")){if(!Array.isArray(o.infos))return"infos: array expected";for(var n=0;n<o.infos.length;++n){var t=a.logreport.HardwareInfo.verify(o.infos[n]);if(t)return"infos."+t}}return o.sys_mem_total!=null&&o.hasOwnProperty("sys_mem_total")&&!l.isInteger(o.sys_mem_total)?"sys_mem_total: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.HardwareInfos)return o;var n=new a.logreport.HardwareInfos;if(o.timestamp_offset_begin!=null&&(n.timestamp_offset_begin=o.timestamp_offset_begin>>>0),o.timestamp_offset_end!=null&&(n.timestamp_offset_end=o.timestamp_offset_end>>>0),o.infos){if(!Array.isArray(o.infos))throw TypeError(".logreport.HardwareInfos.infos: array expected");n.infos=[];for(var t=0;t<o.infos.length;++t){if(typeof o.infos[t]!="object")throw TypeError(".logreport.HardwareInfos.infos: object expected");n.infos[t]=a.logreport.HardwareInfo.fromObject(o.infos[t])}}return o.sys_mem_total!=null&&(n.sys_mem_total=o.sys_mem_total>>>0),n},c.toObject=function(o,n){n||(n={});var t={};if((n.arrays||n.defaults)&&(t.infos=[]),n.defaults&&(t.timestamp_offset_begin=0,t.timestamp_offset_end=0,t.sys_mem_total=0),o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&(t.timestamp_offset_begin=o.timestamp_offset_begin),o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&(t.timestamp_offset_end=o.timestamp_offset_end),o.infos&&o.infos.length){t.infos=[];for(var e=0;e<o.infos.length;++e)t.infos[e]=a.logreport.HardwareInfo.toObject(o.infos[e],n)}return o.sys_mem_total!=null&&o.hasOwnProperty("sys_mem_total")&&(t.sys_mem_total=o.sys_mem_total),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.PublishQualityInfos=function(){function c(o){if(this.infos=[],o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.timestamp_offset_begin=0,c.prototype.timestamp_offset_end=0,c.prototype.stream_id="",c.prototype.session_id=0,c.prototype.video_width=0,c.prototype.video_height=0,c.prototype.ipv4=0,c.prototype.ipv6="",c.prototype.resource_type=0,c.prototype.infos=l.emptyArray,c.prototype.room_id="",c.prototype.evnvironment=0,c.prototype.ap="",c.prototype.session="",c.prototype.room_session_id=l.Long?l.Long.fromBits(0,0,!0):0,c.prototype.protocol_type=0,c.create=function(o){return new c(o)},c.encode=function(o,n){if(n||(n=d.create()),o.timestamp_offset_begin!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_begin")&&n.uint32(8).uint32(o.timestamp_offset_begin),o.timestamp_offset_end!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_end")&&n.uint32(16).uint32(o.timestamp_offset_end),o.stream_id!=null&&Object.hasOwnProperty.call(o,"stream_id")&&n.uint32(26).string(o.stream_id),o.session_id!=null&&Object.hasOwnProperty.call(o,"session_id")&&n.uint32(32).uint32(o.session_id),o.video_width!=null&&Object.hasOwnProperty.call(o,"video_width")&&n.uint32(40).uint32(o.video_width),o.video_height!=null&&Object.hasOwnProperty.call(o,"video_height")&&n.uint32(48).uint32(o.video_height),o.ipv4!=null&&Object.hasOwnProperty.call(o,"ipv4")&&n.uint32(56).uint32(o.ipv4),o.ipv6!=null&&Object.hasOwnProperty.call(o,"ipv6")&&n.uint32(66).string(o.ipv6),o.resource_type!=null&&Object.hasOwnProperty.call(o,"resource_type")&&n.uint32(72).uint32(o.resource_type),o.infos!=null&&o.infos.length)for(var t=0;t<o.infos.length;++t)a.logreport.PublishQualityInfo.encode(o.infos[t],n.uint32(82).fork()).ldelim();return o.room_id!=null&&Object.hasOwnProperty.call(o,"room_id")&&n.uint32(90).string(o.room_id),o.evnvironment!=null&&Object.hasOwnProperty.call(o,"evnvironment")&&n.uint32(104).uint32(o.evnvironment),o.ap!=null&&Object.hasOwnProperty.call(o,"ap")&&n.uint32(114).string(o.ap),o.session!=null&&Object.hasOwnProperty.call(o,"session")&&n.uint32(122).string(o.session),o.room_session_id!=null&&Object.hasOwnProperty.call(o,"room_session_id")&&n.uint32(128).uint64(o.room_session_id),o.protocol_type!=null&&Object.hasOwnProperty.call(o,"protocol_type")&&n.uint32(136).uint32(o.protocol_type),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.PublishQualityInfos;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.timestamp_offset_begin=o.uint32();break;case 2:e.timestamp_offset_end=o.uint32();break;case 3:e.stream_id=o.string();break;case 4:e.session_id=o.uint32();break;case 5:e.video_width=o.uint32();break;case 6:e.video_height=o.uint32();break;case 7:e.ipv4=o.uint32();break;case 8:e.ipv6=o.string();break;case 9:e.resource_type=o.uint32();break;case 10:e.infos&&e.infos.length||(e.infos=[]),e.infos.push(a.logreport.PublishQualityInfo.decode(o,o.uint32()));break;case 11:e.room_id=o.string();break;case 13:e.evnvironment=o.uint32();break;case 14:e.ap=o.string();break;case 15:e.session=o.string();break;case 16:e.room_session_id=o.uint64();break;case 17:e.protocol_type=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&!l.isInteger(o.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&!l.isInteger(o.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(o.stream_id!=null&&o.hasOwnProperty("stream_id")&&!l.isString(o.stream_id))return"stream_id: string expected";if(o.session_id!=null&&o.hasOwnProperty("session_id")&&!l.isInteger(o.session_id))return"session_id: integer expected";if(o.video_width!=null&&o.hasOwnProperty("video_width")&&!l.isInteger(o.video_width))return"video_width: integer expected";if(o.video_height!=null&&o.hasOwnProperty("video_height")&&!l.isInteger(o.video_height))return"video_height: integer expected";if(o.ipv4!=null&&o.hasOwnProperty("ipv4")&&!l.isInteger(o.ipv4))return"ipv4: integer expected";if(o.ipv6!=null&&o.hasOwnProperty("ipv6")&&!l.isString(o.ipv6))return"ipv6: string expected";if(o.resource_type!=null&&o.hasOwnProperty("resource_type")&&!l.isInteger(o.resource_type))return"resource_type: integer expected";if(o.infos!=null&&o.hasOwnProperty("infos")){if(!Array.isArray(o.infos))return"infos: array expected";for(var n=0;n<o.infos.length;++n){var t=a.logreport.PublishQualityInfo.verify(o.infos[n]);if(t)return"infos."+t}}return o.room_id!=null&&o.hasOwnProperty("room_id")&&!l.isString(o.room_id)?"room_id: string expected":o.evnvironment!=null&&o.hasOwnProperty("evnvironment")&&!l.isInteger(o.evnvironment)?"evnvironment: integer expected":o.ap!=null&&o.hasOwnProperty("ap")&&!l.isString(o.ap)?"ap: string expected":o.session!=null&&o.hasOwnProperty("session")&&!l.isString(o.session)?"session: string expected":o.room_session_id!=null&&o.hasOwnProperty("room_session_id")&&!(l.isInteger(o.room_session_id)||o.room_session_id&&l.isInteger(o.room_session_id.low)&&l.isInteger(o.room_session_id.high))?"room_session_id: integer|Long expected":o.protocol_type!=null&&o.hasOwnProperty("protocol_type")&&!l.isInteger(o.protocol_type)?"protocol_type: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.PublishQualityInfos)return o;var n=new a.logreport.PublishQualityInfos;if(o.timestamp_offset_begin!=null&&(n.timestamp_offset_begin=o.timestamp_offset_begin>>>0),o.timestamp_offset_end!=null&&(n.timestamp_offset_end=o.timestamp_offset_end>>>0),o.stream_id!=null&&(n.stream_id=String(o.stream_id)),o.session_id!=null&&(n.session_id=o.session_id>>>0),o.video_width!=null&&(n.video_width=o.video_width>>>0),o.video_height!=null&&(n.video_height=o.video_height>>>0),o.ipv4!=null&&(n.ipv4=o.ipv4>>>0),o.ipv6!=null&&(n.ipv6=String(o.ipv6)),o.resource_type!=null&&(n.resource_type=o.resource_type>>>0),o.infos){if(!Array.isArray(o.infos))throw TypeError(".logreport.PublishQualityInfos.infos: array expected");n.infos=[];for(var t=0;t<o.infos.length;++t){if(typeof o.infos[t]!="object")throw TypeError(".logreport.PublishQualityInfos.infos: object expected");n.infos[t]=a.logreport.PublishQualityInfo.fromObject(o.infos[t])}}return o.room_id!=null&&(n.room_id=String(o.room_id)),o.evnvironment!=null&&(n.evnvironment=o.evnvironment>>>0),o.ap!=null&&(n.ap=String(o.ap)),o.session!=null&&(n.session=String(o.session)),o.room_session_id!=null&&(l.Long?(n.room_session_id=l.Long.fromValue(o.room_session_id)).unsigned=!0:typeof o.room_session_id=="string"?n.room_session_id=parseInt(o.room_session_id,10):typeof o.room_session_id=="number"?n.room_session_id=o.room_session_id:typeof o.room_session_id=="object"&&(n.room_session_id=new l.LongBits(o.room_session_id.low>>>0,o.room_session_id.high>>>0).toNumber(!0))),o.protocol_type!=null&&(n.protocol_type=o.protocol_type>>>0),n},c.toObject=function(o,n){n||(n={});var t={};if((n.arrays||n.defaults)&&(t.infos=[]),n.defaults){if(t.timestamp_offset_begin=0,t.timestamp_offset_end=0,t.stream_id="",t.session_id=0,t.video_width=0,t.video_height=0,t.ipv4=0,t.ipv6="",t.resource_type=0,t.room_id="",t.evnvironment=0,t.ap="",t.session="",l.Long){var e=new l.Long(0,0,!0);t.room_session_id=n.longs===String?e.toString():n.longs===Number?e.toNumber():e}else t.room_session_id=n.longs===String?"0":0;t.protocol_type=0}if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&(t.timestamp_offset_begin=o.timestamp_offset_begin),o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&(t.timestamp_offset_end=o.timestamp_offset_end),o.stream_id!=null&&o.hasOwnProperty("stream_id")&&(t.stream_id=o.stream_id),o.session_id!=null&&o.hasOwnProperty("session_id")&&(t.session_id=o.session_id),o.video_width!=null&&o.hasOwnProperty("video_width")&&(t.video_width=o.video_width),o.video_height!=null&&o.hasOwnProperty("video_height")&&(t.video_height=o.video_height),o.ipv4!=null&&o.hasOwnProperty("ipv4")&&(t.ipv4=o.ipv4),o.ipv6!=null&&o.hasOwnProperty("ipv6")&&(t.ipv6=o.ipv6),o.resource_type!=null&&o.hasOwnProperty("resource_type")&&(t.resource_type=o.resource_type),o.infos&&o.infos.length){t.infos=[];for(var r=0;r<o.infos.length;++r)t.infos[r]=a.logreport.PublishQualityInfo.toObject(o.infos[r],n)}return o.room_id!=null&&o.hasOwnProperty("room_id")&&(t.room_id=o.room_id),o.evnvironment!=null&&o.hasOwnProperty("evnvironment")&&(t.evnvironment=o.evnvironment),o.ap!=null&&o.hasOwnProperty("ap")&&(t.ap=o.ap),o.session!=null&&o.hasOwnProperty("session")&&(t.session=o.session),o.room_session_id!=null&&o.hasOwnProperty("room_session_id")&&(typeof o.room_session_id=="number"?t.room_session_id=n.longs===String?String(o.room_session_id):o.room_session_id:t.room_session_id=n.longs===String?l.Long.prototype.toString.call(o.room_session_id):n.longs===Number?new l.LongBits(o.room_session_id.low>>>0,o.room_session_id.high>>>0).toNumber(!0):o.room_session_id),o.protocol_type!=null&&o.hasOwnProperty("protocol_type")&&(t.protocol_type=o.protocol_type),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.PlayQualityInfos=function(){function c(o){if(this.infos=[],o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.timestamp_offset_begin=0,c.prototype.timestamp_offset_end=0,c.prototype.stream_id="",c.prototype.session_id=0,c.prototype.video_width=0,c.prototype.video_height=0,c.prototype.ipv4=0,c.prototype.ipv6="",c.prototype.resource_type=0,c.prototype.infos=l.emptyArray,c.prototype.room_id="",c.prototype.session="",c.prototype.room_session_id=l.Long?l.Long.fromBits(0,0,!0):0,c.prototype.protocol_type=0,c.create=function(o){return new c(o)},c.encode=function(o,n){if(n||(n=d.create()),o.timestamp_offset_begin!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_begin")&&n.uint32(8).uint32(o.timestamp_offset_begin),o.timestamp_offset_end!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_end")&&n.uint32(16).uint32(o.timestamp_offset_end),o.stream_id!=null&&Object.hasOwnProperty.call(o,"stream_id")&&n.uint32(26).string(o.stream_id),o.session_id!=null&&Object.hasOwnProperty.call(o,"session_id")&&n.uint32(32).uint32(o.session_id),o.video_width!=null&&Object.hasOwnProperty.call(o,"video_width")&&n.uint32(40).uint32(o.video_width),o.video_height!=null&&Object.hasOwnProperty.call(o,"video_height")&&n.uint32(48).uint32(o.video_height),o.ipv4!=null&&Object.hasOwnProperty.call(o,"ipv4")&&n.uint32(56).uint32(o.ipv4),o.ipv6!=null&&Object.hasOwnProperty.call(o,"ipv6")&&n.uint32(66).string(o.ipv6),o.resource_type!=null&&Object.hasOwnProperty.call(o,"resource_type")&&n.uint32(72).uint32(o.resource_type),o.infos!=null&&o.infos.length)for(var t=0;t<o.infos.length;++t)a.logreport.PlayQualityInfo.encode(o.infos[t],n.uint32(82).fork()).ldelim();return o.room_id!=null&&Object.hasOwnProperty.call(o,"room_id")&&n.uint32(90).string(o.room_id),o.session!=null&&Object.hasOwnProperty.call(o,"session")&&n.uint32(106).string(o.session),o.room_session_id!=null&&Object.hasOwnProperty.call(o,"room_session_id")&&n.uint32(112).uint64(o.room_session_id),o.protocol_type!=null&&Object.hasOwnProperty.call(o,"protocol_type")&&n.uint32(120).uint32(o.protocol_type),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.PlayQualityInfos;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.timestamp_offset_begin=o.uint32();break;case 2:e.timestamp_offset_end=o.uint32();break;case 3:e.stream_id=o.string();break;case 4:e.session_id=o.uint32();break;case 5:e.video_width=o.uint32();break;case 6:e.video_height=o.uint32();break;case 7:e.ipv4=o.uint32();break;case 8:e.ipv6=o.string();break;case 9:e.resource_type=o.uint32();break;case 10:e.infos&&e.infos.length||(e.infos=[]),e.infos.push(a.logreport.PlayQualityInfo.decode(o,o.uint32()));break;case 11:e.room_id=o.string();break;case 13:e.session=o.string();break;case 14:e.room_session_id=o.uint64();break;case 15:e.protocol_type=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&!l.isInteger(o.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&!l.isInteger(o.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(o.stream_id!=null&&o.hasOwnProperty("stream_id")&&!l.isString(o.stream_id))return"stream_id: string expected";if(o.session_id!=null&&o.hasOwnProperty("session_id")&&!l.isInteger(o.session_id))return"session_id: integer expected";if(o.video_width!=null&&o.hasOwnProperty("video_width")&&!l.isInteger(o.video_width))return"video_width: integer expected";if(o.video_height!=null&&o.hasOwnProperty("video_height")&&!l.isInteger(o.video_height))return"video_height: integer expected";if(o.ipv4!=null&&o.hasOwnProperty("ipv4")&&!l.isInteger(o.ipv4))return"ipv4: integer expected";if(o.ipv6!=null&&o.hasOwnProperty("ipv6")&&!l.isString(o.ipv6))return"ipv6: string expected";if(o.resource_type!=null&&o.hasOwnProperty("resource_type")&&!l.isInteger(o.resource_type))return"resource_type: integer expected";if(o.infos!=null&&o.hasOwnProperty("infos")){if(!Array.isArray(o.infos))return"infos: array expected";for(var n=0;n<o.infos.length;++n){var t=a.logreport.PlayQualityInfo.verify(o.infos[n]);if(t)return"infos."+t}}return o.room_id!=null&&o.hasOwnProperty("room_id")&&!l.isString(o.room_id)?"room_id: string expected":o.session!=null&&o.hasOwnProperty("session")&&!l.isString(o.session)?"session: string expected":o.room_session_id!=null&&o.hasOwnProperty("room_session_id")&&!(l.isInteger(o.room_session_id)||o.room_session_id&&l.isInteger(o.room_session_id.low)&&l.isInteger(o.room_session_id.high))?"room_session_id: integer|Long expected":o.protocol_type!=null&&o.hasOwnProperty("protocol_type")&&!l.isInteger(o.protocol_type)?"protocol_type: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.PlayQualityInfos)return o;var n=new a.logreport.PlayQualityInfos;if(o.timestamp_offset_begin!=null&&(n.timestamp_offset_begin=o.timestamp_offset_begin>>>0),o.timestamp_offset_end!=null&&(n.timestamp_offset_end=o.timestamp_offset_end>>>0),o.stream_id!=null&&(n.stream_id=String(o.stream_id)),o.session_id!=null&&(n.session_id=o.session_id>>>0),o.video_width!=null&&(n.video_width=o.video_width>>>0),o.video_height!=null&&(n.video_height=o.video_height>>>0),o.ipv4!=null&&(n.ipv4=o.ipv4>>>0),o.ipv6!=null&&(n.ipv6=String(o.ipv6)),o.resource_type!=null&&(n.resource_type=o.resource_type>>>0),o.infos){if(!Array.isArray(o.infos))throw TypeError(".logreport.PlayQualityInfos.infos: array expected");n.infos=[];for(var t=0;t<o.infos.length;++t){if(typeof o.infos[t]!="object")throw TypeError(".logreport.PlayQualityInfos.infos: object expected");n.infos[t]=a.logreport.PlayQualityInfo.fromObject(o.infos[t])}}return o.room_id!=null&&(n.room_id=String(o.room_id)),o.session!=null&&(n.session=String(o.session)),o.room_session_id!=null&&(l.Long?(n.room_session_id=l.Long.fromValue(o.room_session_id)).unsigned=!0:typeof o.room_session_id=="string"?n.room_session_id=parseInt(o.room_session_id,10):typeof o.room_session_id=="number"?n.room_session_id=o.room_session_id:typeof o.room_session_id=="object"&&(n.room_session_id=new l.LongBits(o.room_session_id.low>>>0,o.room_session_id.high>>>0).toNumber(!0))),o.protocol_type!=null&&(n.protocol_type=o.protocol_type>>>0),n},c.toObject=function(o,n){n||(n={});var t={};if((n.arrays||n.defaults)&&(t.infos=[]),n.defaults){if(t.timestamp_offset_begin=0,t.timestamp_offset_end=0,t.stream_id="",t.session_id=0,t.video_width=0,t.video_height=0,t.ipv4=0,t.ipv6="",t.resource_type=0,t.room_id="",t.session="",l.Long){var e=new l.Long(0,0,!0);t.room_session_id=n.longs===String?e.toString():n.longs===Number?e.toNumber():e}else t.room_session_id=n.longs===String?"0":0;t.protocol_type=0}if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&(t.timestamp_offset_begin=o.timestamp_offset_begin),o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&(t.timestamp_offset_end=o.timestamp_offset_end),o.stream_id!=null&&o.hasOwnProperty("stream_id")&&(t.stream_id=o.stream_id),o.session_id!=null&&o.hasOwnProperty("session_id")&&(t.session_id=o.session_id),o.video_width!=null&&o.hasOwnProperty("video_width")&&(t.video_width=o.video_width),o.video_height!=null&&o.hasOwnProperty("video_height")&&(t.video_height=o.video_height),o.ipv4!=null&&o.hasOwnProperty("ipv4")&&(t.ipv4=o.ipv4),o.ipv6!=null&&o.hasOwnProperty("ipv6")&&(t.ipv6=o.ipv6),o.resource_type!=null&&o.hasOwnProperty("resource_type")&&(t.resource_type=o.resource_type),o.infos&&o.infos.length){t.infos=[];for(var r=0;r<o.infos.length;++r)t.infos[r]=a.logreport.PlayQualityInfo.toObject(o.infos[r],n)}return o.room_id!=null&&o.hasOwnProperty("room_id")&&(t.room_id=o.room_id),o.session!=null&&o.hasOwnProperty("session")&&(t.session=o.session),o.room_session_id!=null&&o.hasOwnProperty("room_session_id")&&(typeof o.room_session_id=="number"?t.room_session_id=n.longs===String?String(o.room_session_id):o.room_session_id:t.room_session_id=n.longs===String?l.Long.prototype.toString.call(o.room_session_id):n.longs===Number?new l.LongBits(o.room_session_id.low>>>0,o.room_session_id.high>>>0).toNumber(!0):o.room_session_id),o.protocol_type!=null&&o.hasOwnProperty("protocol_type")&&(t.protocol_type=o.protocol_type),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.ChargeInfos=function(){function c(o){if(this.infos=[],o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.timestamp_offset_begin=0,c.prototype.timestamp_offset_end=0,c.prototype.timestamp_diff_flag=0,c.prototype.timestamp_diff=0,c.prototype.room_id="",c.prototype.infos=l.emptyArray,c.create=function(o){return new c(o)},c.encode=function(o,n){if(n||(n=d.create()),o.timestamp_offset_begin!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_begin")&&n.uint32(8).uint32(o.timestamp_offset_begin),o.timestamp_offset_end!=null&&Object.hasOwnProperty.call(o,"timestamp_offset_end")&&n.uint32(16).uint32(o.timestamp_offset_end),o.timestamp_diff_flag!=null&&Object.hasOwnProperty.call(o,"timestamp_diff_flag")&&n.uint32(24).uint32(o.timestamp_diff_flag),o.timestamp_diff!=null&&Object.hasOwnProperty.call(o,"timestamp_diff")&&n.uint32(32).uint32(o.timestamp_diff),o.room_id!=null&&Object.hasOwnProperty.call(o,"room_id")&&n.uint32(42).string(o.room_id),o.infos!=null&&o.infos.length)for(var t=0;t<o.infos.length;++t)a.logreport.ChargeInfo.encode(o.infos[t],n.uint32(802).fork()).ldelim();return n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.ChargeInfos;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.timestamp_offset_begin=o.uint32();break;case 2:e.timestamp_offset_end=o.uint32();break;case 3:e.timestamp_diff_flag=o.uint32();break;case 4:e.timestamp_diff=o.uint32();break;case 5:e.room_id=o.string();break;case 100:e.infos&&e.infos.length||(e.infos=[]),e.infos.push(a.logreport.ChargeInfo.decode(o,o.uint32()));break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&!l.isInteger(o.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&!l.isInteger(o.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(o.timestamp_diff_flag!=null&&o.hasOwnProperty("timestamp_diff_flag")&&!l.isInteger(o.timestamp_diff_flag))return"timestamp_diff_flag: integer expected";if(o.timestamp_diff!=null&&o.hasOwnProperty("timestamp_diff")&&!l.isInteger(o.timestamp_diff))return"timestamp_diff: integer expected";if(o.room_id!=null&&o.hasOwnProperty("room_id")&&!l.isString(o.room_id))return"room_id: string expected";if(o.infos!=null&&o.hasOwnProperty("infos")){if(!Array.isArray(o.infos))return"infos: array expected";for(var n=0;n<o.infos.length;++n){var t=a.logreport.ChargeInfo.verify(o.infos[n]);if(t)return"infos."+t}}return null},c.fromObject=function(o){if(o instanceof a.logreport.ChargeInfos)return o;var n=new a.logreport.ChargeInfos;if(o.timestamp_offset_begin!=null&&(n.timestamp_offset_begin=o.timestamp_offset_begin>>>0),o.timestamp_offset_end!=null&&(n.timestamp_offset_end=o.timestamp_offset_end>>>0),o.timestamp_diff_flag!=null&&(n.timestamp_diff_flag=o.timestamp_diff_flag>>>0),o.timestamp_diff!=null&&(n.timestamp_diff=o.timestamp_diff>>>0),o.room_id!=null&&(n.room_id=String(o.room_id)),o.infos){if(!Array.isArray(o.infos))throw TypeError(".logreport.ChargeInfos.infos: array expected");n.infos=[];for(var t=0;t<o.infos.length;++t){if(typeof o.infos[t]!="object")throw TypeError(".logreport.ChargeInfos.infos: object expected");n.infos[t]=a.logreport.ChargeInfo.fromObject(o.infos[t])}}return n},c.toObject=function(o,n){n||(n={});var t={};if((n.arrays||n.defaults)&&(t.infos=[]),n.defaults&&(t.timestamp_offset_begin=0,t.timestamp_offset_end=0,t.timestamp_diff_flag=0,t.timestamp_diff=0,t.room_id=""),o.timestamp_offset_begin!=null&&o.hasOwnProperty("timestamp_offset_begin")&&(t.timestamp_offset_begin=o.timestamp_offset_begin),o.timestamp_offset_end!=null&&o.hasOwnProperty("timestamp_offset_end")&&(t.timestamp_offset_end=o.timestamp_offset_end),o.timestamp_diff_flag!=null&&o.hasOwnProperty("timestamp_diff_flag")&&(t.timestamp_diff_flag=o.timestamp_diff_flag),o.timestamp_diff!=null&&o.hasOwnProperty("timestamp_diff")&&(t.timestamp_diff=o.timestamp_diff),o.room_id!=null&&o.hasOwnProperty("room_id")&&(t.room_id=o.room_id),o.infos&&o.infos.length){t.infos=[];for(var e=0;e<o.infos.length;++e)t.infos[e]=a.logreport.ChargeInfo.toObject(o.infos[e],n)}return t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.HardwareInfo=function(){function c(o){if(o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.sys_cpu_used=0,c.prototype.app_cpu_used=0,c.prototype.sys_mem_used=0,c.prototype.app_mem_used=0,c.create=function(o){return new c(o)},c.encode=function(o,n){return n||(n=d.create()),o.sys_cpu_used!=null&&Object.hasOwnProperty.call(o,"sys_cpu_used")&&n.uint32(8).uint32(o.sys_cpu_used),o.app_cpu_used!=null&&Object.hasOwnProperty.call(o,"app_cpu_used")&&n.uint32(16).uint32(o.app_cpu_used),o.sys_mem_used!=null&&Object.hasOwnProperty.call(o,"sys_mem_used")&&n.uint32(24).uint32(o.sys_mem_used),o.app_mem_used!=null&&Object.hasOwnProperty.call(o,"app_mem_used")&&n.uint32(32).uint32(o.app_mem_used),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.HardwareInfo;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.sys_cpu_used=o.uint32();break;case 2:e.app_cpu_used=o.uint32();break;case 3:e.sys_mem_used=o.uint32();break;case 4:e.app_mem_used=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){return typeof o!="object"||o===null?"object expected":o.sys_cpu_used!=null&&o.hasOwnProperty("sys_cpu_used")&&!l.isInteger(o.sys_cpu_used)?"sys_cpu_used: integer expected":o.app_cpu_used!=null&&o.hasOwnProperty("app_cpu_used")&&!l.isInteger(o.app_cpu_used)?"app_cpu_used: integer expected":o.sys_mem_used!=null&&o.hasOwnProperty("sys_mem_used")&&!l.isInteger(o.sys_mem_used)?"sys_mem_used: integer expected":o.app_mem_used!=null&&o.hasOwnProperty("app_mem_used")&&!l.isInteger(o.app_mem_used)?"app_mem_used: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.HardwareInfo)return o;var n=new a.logreport.HardwareInfo;return o.sys_cpu_used!=null&&(n.sys_cpu_used=o.sys_cpu_used>>>0),o.app_cpu_used!=null&&(n.app_cpu_used=o.app_cpu_used>>>0),o.sys_mem_used!=null&&(n.sys_mem_used=o.sys_mem_used>>>0),o.app_mem_used!=null&&(n.app_mem_used=o.app_mem_used>>>0),n},c.toObject=function(o,n){n||(n={});var t={};return n.defaults&&(t.sys_cpu_used=0,t.app_cpu_used=0,t.sys_mem_used=0,t.app_mem_used=0),o.sys_cpu_used!=null&&o.hasOwnProperty("sys_cpu_used")&&(t.sys_cpu_used=o.sys_cpu_used),o.app_cpu_used!=null&&o.hasOwnProperty("app_cpu_used")&&(t.app_cpu_used=o.app_cpu_used),o.sys_mem_used!=null&&o.hasOwnProperty("sys_mem_used")&&(t.sys_mem_used=o.sys_mem_used),o.app_mem_used!=null&&o.hasOwnProperty("app_mem_used")&&(t.app_mem_used=o.app_mem_used),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.PublishQualityInfo=function(){function c(o){if(o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.audio_bitrate=0,c.prototype.video_bitrate=0,c.prototype.video_capture_fps=0,c.prototype.video_network_fps=0,c.prototype.uplink_plr=0,c.prototype.rtt=0,c.prototype.audio_network_fps=0,c.prototype.captured_sound_level=0,c.prototype.sample_time_window=0,c.create=function(o){return new c(o)},c.encode=function(o,n){return n||(n=d.create()),o.audio_bitrate!=null&&Object.hasOwnProperty.call(o,"audio_bitrate")&&n.uint32(8).uint32(o.audio_bitrate),o.video_bitrate!=null&&Object.hasOwnProperty.call(o,"video_bitrate")&&n.uint32(16).uint32(o.video_bitrate),o.video_capture_fps!=null&&Object.hasOwnProperty.call(o,"video_capture_fps")&&n.uint32(24).uint32(o.video_capture_fps),o.video_network_fps!=null&&Object.hasOwnProperty.call(o,"video_network_fps")&&n.uint32(32).uint32(o.video_network_fps),o.uplink_plr!=null&&Object.hasOwnProperty.call(o,"uplink_plr")&&n.uint32(40).uint32(o.uplink_plr),o.rtt!=null&&Object.hasOwnProperty.call(o,"rtt")&&n.uint32(48).uint32(o.rtt),o.audio_network_fps!=null&&Object.hasOwnProperty.call(o,"audio_network_fps")&&n.uint32(56).uint32(o.audio_network_fps),o.captured_sound_level!=null&&Object.hasOwnProperty.call(o,"captured_sound_level")&&n.uint32(64).uint32(o.captured_sound_level),o.sample_time_window!=null&&Object.hasOwnProperty.call(o,"sample_time_window")&&n.uint32(800).uint32(o.sample_time_window),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.PublishQualityInfo;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.audio_bitrate=o.uint32();break;case 2:e.video_bitrate=o.uint32();break;case 3:e.video_capture_fps=o.uint32();break;case 4:e.video_network_fps=o.uint32();break;case 5:e.uplink_plr=o.uint32();break;case 6:e.rtt=o.uint32();break;case 7:e.audio_network_fps=o.uint32();break;case 8:e.captured_sound_level=o.uint32();break;case 100:e.sample_time_window=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){return typeof o!="object"||o===null?"object expected":o.audio_bitrate!=null&&o.hasOwnProperty("audio_bitrate")&&!l.isInteger(o.audio_bitrate)?"audio_bitrate: integer expected":o.video_bitrate!=null&&o.hasOwnProperty("video_bitrate")&&!l.isInteger(o.video_bitrate)?"video_bitrate: integer expected":o.video_capture_fps!=null&&o.hasOwnProperty("video_capture_fps")&&!l.isInteger(o.video_capture_fps)?"video_capture_fps: integer expected":o.video_network_fps!=null&&o.hasOwnProperty("video_network_fps")&&!l.isInteger(o.video_network_fps)?"video_network_fps: integer expected":o.uplink_plr!=null&&o.hasOwnProperty("uplink_plr")&&!l.isInteger(o.uplink_plr)?"uplink_plr: integer expected":o.rtt!=null&&o.hasOwnProperty("rtt")&&!l.isInteger(o.rtt)?"rtt: integer expected":o.audio_network_fps!=null&&o.hasOwnProperty("audio_network_fps")&&!l.isInteger(o.audio_network_fps)?"audio_network_fps: integer expected":o.captured_sound_level!=null&&o.hasOwnProperty("captured_sound_level")&&!l.isInteger(o.captured_sound_level)?"captured_sound_level: integer expected":o.sample_time_window!=null&&o.hasOwnProperty("sample_time_window")&&!l.isInteger(o.sample_time_window)?"sample_time_window: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.PublishQualityInfo)return o;var n=new a.logreport.PublishQualityInfo;return o.audio_bitrate!=null&&(n.audio_bitrate=o.audio_bitrate>>>0),o.video_bitrate!=null&&(n.video_bitrate=o.video_bitrate>>>0),o.video_capture_fps!=null&&(n.video_capture_fps=o.video_capture_fps>>>0),o.video_network_fps!=null&&(n.video_network_fps=o.video_network_fps>>>0),o.uplink_plr!=null&&(n.uplink_plr=o.uplink_plr>>>0),o.rtt!=null&&(n.rtt=o.rtt>>>0),o.audio_network_fps!=null&&(n.audio_network_fps=o.audio_network_fps>>>0),o.captured_sound_level!=null&&(n.captured_sound_level=o.captured_sound_level>>>0),o.sample_time_window!=null&&(n.sample_time_window=o.sample_time_window>>>0),n},c.toObject=function(o,n){n||(n={});var t={};return n.defaults&&(t.audio_bitrate=0,t.video_bitrate=0,t.video_capture_fps=0,t.video_network_fps=0,t.uplink_plr=0,t.rtt=0,t.audio_network_fps=0,t.captured_sound_level=0,t.sample_time_window=0),o.audio_bitrate!=null&&o.hasOwnProperty("audio_bitrate")&&(t.audio_bitrate=o.audio_bitrate),o.video_bitrate!=null&&o.hasOwnProperty("video_bitrate")&&(t.video_bitrate=o.video_bitrate),o.video_capture_fps!=null&&o.hasOwnProperty("video_capture_fps")&&(t.video_capture_fps=o.video_capture_fps),o.video_network_fps!=null&&o.hasOwnProperty("video_network_fps")&&(t.video_network_fps=o.video_network_fps),o.uplink_plr!=null&&o.hasOwnProperty("uplink_plr")&&(t.uplink_plr=o.uplink_plr),o.rtt!=null&&o.hasOwnProperty("rtt")&&(t.rtt=o.rtt),o.audio_network_fps!=null&&o.hasOwnProperty("audio_network_fps")&&(t.audio_network_fps=o.audio_network_fps),o.captured_sound_level!=null&&o.hasOwnProperty("captured_sound_level")&&(t.captured_sound_level=o.captured_sound_level),o.sample_time_window!=null&&o.hasOwnProperty("sample_time_window")&&(t.sample_time_window=o.sample_time_window),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m.PlayQualityInfo=function(){function c(o){if(o)for(var n=Object.keys(o),t=0;t<n.length;++t)o[n[t]]!=null&&(this[n[t]]=o[n[t]])}return c.prototype.audio_bitrate=0,c.prototype.video_bitrate=0,c.prototype.video_network_fps=0,c.prototype.audio_break_count=0,c.prototype.video_break_count=0,c.prototype.downlink_plr=0,c.prototype.peer_to_peer_plr=0,c.prototype.peer_to_peer_delay=0,c.prototype.audio_network_fps=0,c.prototype.audio_break_duration=0,c.prototype.video_break_duration=0,c.prototype.audio_break_rate=0,c.prototype.video_break_rate=0,c.prototype.audio_break_cancel=0,c.prototype.video_break_cancel=0,c.prototype.rtt=0,c.prototype.rendered_sound_level=0,c.prototype.audio_break_cancel_duration=0,c.prototype.video_break_cancel_duration=0,c.prototype.audio_decode_time=0,c.prototype.video_decode_time=0,c.prototype.real_sampling_interval=0,c.prototype.mos=0,c.prototype.audio_decode_fps=0,c.prototype.video_decode_fps=0,c.prototype.video_frames_decoded=0,c.prototype.video_frames_dropped=0,c.prototype.sample_time_window=0,c.create=function(o){return new c(o)},c.encode=function(o,n){return n||(n=d.create()),o.audio_bitrate!=null&&Object.hasOwnProperty.call(o,"audio_bitrate")&&n.uint32(8).uint32(o.audio_bitrate),o.video_bitrate!=null&&Object.hasOwnProperty.call(o,"video_bitrate")&&n.uint32(16).uint32(o.video_bitrate),o.video_network_fps!=null&&Object.hasOwnProperty.call(o,"video_network_fps")&&n.uint32(24).uint32(o.video_network_fps),o.audio_break_count!=null&&Object.hasOwnProperty.call(o,"audio_break_count")&&n.uint32(32).uint32(o.audio_break_count),o.video_break_count!=null&&Object.hasOwnProperty.call(o,"video_break_count")&&n.uint32(40).uint32(o.video_break_count),o.downlink_plr!=null&&Object.hasOwnProperty.call(o,"downlink_plr")&&n.uint32(48).uint32(o.downlink_plr),o.peer_to_peer_plr!=null&&Object.hasOwnProperty.call(o,"peer_to_peer_plr")&&n.uint32(56).uint32(o.peer_to_peer_plr),o.peer_to_peer_delay!=null&&Object.hasOwnProperty.call(o,"peer_to_peer_delay")&&n.uint32(64).uint32(o.peer_to_peer_delay),o.audio_network_fps!=null&&Object.hasOwnProperty.call(o,"audio_network_fps")&&n.uint32(72).uint32(o.audio_network_fps),o.audio_break_duration!=null&&Object.hasOwnProperty.call(o,"audio_break_duration")&&n.uint32(80).uint32(o.audio_break_duration),o.video_break_duration!=null&&Object.hasOwnProperty.call(o,"video_break_duration")&&n.uint32(88).uint32(o.video_break_duration),o.audio_break_rate!=null&&Object.hasOwnProperty.call(o,"audio_break_rate")&&n.uint32(96).uint32(o.audio_break_rate),o.video_break_rate!=null&&Object.hasOwnProperty.call(o,"video_break_rate")&&n.uint32(104).uint32(o.video_break_rate),o.audio_break_cancel!=null&&Object.hasOwnProperty.call(o,"audio_break_cancel")&&n.uint32(112).uint32(o.audio_break_cancel),o.video_break_cancel!=null&&Object.hasOwnProperty.call(o,"video_break_cancel")&&n.uint32(120).uint32(o.video_break_cancel),o.rtt!=null&&Object.hasOwnProperty.call(o,"rtt")&&n.uint32(128).uint32(o.rtt),o.rendered_sound_level!=null&&Object.hasOwnProperty.call(o,"rendered_sound_level")&&n.uint32(136).uint32(o.rendered_sound_level),o.audio_break_cancel_duration!=null&&Object.hasOwnProperty.call(o,"audio_break_cancel_duration")&&n.uint32(144).uint32(o.audio_break_cancel_duration),o.video_break_cancel_duration!=null&&Object.hasOwnProperty.call(o,"video_break_cancel_duration")&&n.uint32(152).uint32(o.video_break_cancel_duration),o.audio_decode_time!=null&&Object.hasOwnProperty.call(o,"audio_decode_time")&&n.uint32(160).uint32(o.audio_decode_time),o.video_decode_time!=null&&Object.hasOwnProperty.call(o,"video_decode_time")&&n.uint32(168).uint32(o.video_decode_time),o.real_sampling_interval!=null&&Object.hasOwnProperty.call(o,"real_sampling_interval")&&n.uint32(176).uint32(o.real_sampling_interval),o.mos!=null&&Object.hasOwnProperty.call(o,"mos")&&n.uint32(184).int32(o.mos),o.audio_decode_fps!=null&&Object.hasOwnProperty.call(o,"audio_decode_fps")&&n.uint32(192).uint32(o.audio_decode_fps),o.video_decode_fps!=null&&Object.hasOwnProperty.call(o,"video_decode_fps")&&n.uint32(200).uint32(o.video_decode_fps),o.video_frames_decoded!=null&&Object.hasOwnProperty.call(o,"video_frames_decoded")&&n.uint32(208).uint32(o.video_frames_decoded),o.video_frames_dropped!=null&&Object.hasOwnProperty.call(o,"video_frames_dropped")&&n.uint32(216).uint32(o.video_frames_dropped),o.sample_time_window!=null&&Object.hasOwnProperty.call(o,"sample_time_window")&&n.uint32(800).uint32(o.sample_time_window),n},c.encodeDelimited=function(o,n){return this.encode(o,n).ldelim()},c.decode=function(o,n){o instanceof _||(o=_.create(o));for(var t=n===void 0?o.len:o.pos+n,e=new a.logreport.PlayQualityInfo;o.pos<t;){var r=o.uint32();switch(r>>>3){case 1:e.audio_bitrate=o.uint32();break;case 2:e.video_bitrate=o.uint32();break;case 3:e.video_network_fps=o.uint32();break;case 4:e.audio_break_count=o.uint32();break;case 5:e.video_break_count=o.uint32();break;case 6:e.downlink_plr=o.uint32();break;case 7:e.peer_to_peer_plr=o.uint32();break;case 8:e.peer_to_peer_delay=o.uint32();break;case 9:e.audio_network_fps=o.uint32();break;case 10:e.audio_break_duration=o.uint32();break;case 11:e.video_break_duration=o.uint32();break;case 12:e.audio_break_rate=o.uint32();break;case 13:e.video_break_rate=o.uint32();break;case 14:e.audio_break_cancel=o.uint32();break;case 15:e.video_break_cancel=o.uint32();break;case 16:e.rtt=o.uint32();break;case 17:e.rendered_sound_level=o.uint32();break;case 18:e.audio_break_cancel_duration=o.uint32();break;case 19:e.video_break_cancel_duration=o.uint32();break;case 20:e.audio_decode_time=o.uint32();break;case 21:e.video_decode_time=o.uint32();break;case 22:e.real_sampling_interval=o.uint32();break;case 23:e.mos=o.int32();break;case 24:e.audio_decode_fps=o.uint32();break;case 25:e.video_decode_fps=o.uint32();break;case 26:e.video_frames_decoded=o.uint32();break;case 27:e.video_frames_dropped=o.uint32();break;case 100:e.sample_time_window=o.uint32();break;default:o.skipType(7&r)}}return e},c.decodeDelimited=function(o){return o instanceof _||(o=new _(o)),this.decode(o,o.uint32())},c.verify=function(o){return typeof o!="object"||o===null?"object expected":o.audio_bitrate!=null&&o.hasOwnProperty("audio_bitrate")&&!l.isInteger(o.audio_bitrate)?"audio_bitrate: integer expected":o.video_bitrate!=null&&o.hasOwnProperty("video_bitrate")&&!l.isInteger(o.video_bitrate)?"video_bitrate: integer expected":o.video_network_fps!=null&&o.hasOwnProperty("video_network_fps")&&!l.isInteger(o.video_network_fps)?"video_network_fps: integer expected":o.audio_break_count!=null&&o.hasOwnProperty("audio_break_count")&&!l.isInteger(o.audio_break_count)?"audio_break_count: integer expected":o.video_break_count!=null&&o.hasOwnProperty("video_break_count")&&!l.isInteger(o.video_break_count)?"video_break_count: integer expected":o.downlink_plr!=null&&o.hasOwnProperty("downlink_plr")&&!l.isInteger(o.downlink_plr)?"downlink_plr: integer expected":o.peer_to_peer_plr!=null&&o.hasOwnProperty("peer_to_peer_plr")&&!l.isInteger(o.peer_to_peer_plr)?"peer_to_peer_plr: integer expected":o.peer_to_peer_delay!=null&&o.hasOwnProperty("peer_to_peer_delay")&&!l.isInteger(o.peer_to_peer_delay)?"peer_to_peer_delay: integer expected":o.audio_network_fps!=null&&o.hasOwnProperty("audio_network_fps")&&!l.isInteger(o.audio_network_fps)?"audio_network_fps: integer expected":o.audio_break_duration!=null&&o.hasOwnProperty("audio_break_duration")&&!l.isInteger(o.audio_break_duration)?"audio_break_duration: integer expected":o.video_break_duration!=null&&o.hasOwnProperty("video_break_duration")&&!l.isInteger(o.video_break_duration)?"video_break_duration: integer expected":o.audio_break_rate!=null&&o.hasOwnProperty("audio_break_rate")&&!l.isInteger(o.audio_break_rate)?"audio_break_rate: integer expected":o.video_break_rate!=null&&o.hasOwnProperty("video_break_rate")&&!l.isInteger(o.video_break_rate)?"video_break_rate: integer expected":o.audio_break_cancel!=null&&o.hasOwnProperty("audio_break_cancel")&&!l.isInteger(o.audio_break_cancel)?"audio_break_cancel: integer expected":o.video_break_cancel!=null&&o.hasOwnProperty("video_break_cancel")&&!l.isInteger(o.video_break_cancel)?"video_break_cancel: integer expected":o.rtt!=null&&o.hasOwnProperty("rtt")&&!l.isInteger(o.rtt)?"rtt: integer expected":o.rendered_sound_level!=null&&o.hasOwnProperty("rendered_sound_level")&&!l.isInteger(o.rendered_sound_level)?"rendered_sound_level: integer expected":o.audio_break_cancel_duration!=null&&o.hasOwnProperty("audio_break_cancel_duration")&&!l.isInteger(o.audio_break_cancel_duration)?"audio_break_cancel_duration: integer expected":o.video_break_cancel_duration!=null&&o.hasOwnProperty("video_break_cancel_duration")&&!l.isInteger(o.video_break_cancel_duration)?"video_break_cancel_duration: integer expected":o.audio_decode_time!=null&&o.hasOwnProperty("audio_decode_time")&&!l.isInteger(o.audio_decode_time)?"audio_decode_time: integer expected":o.video_decode_time!=null&&o.hasOwnProperty("video_decode_time")&&!l.isInteger(o.video_decode_time)?"video_decode_time: integer expected":o.real_sampling_interval!=null&&o.hasOwnProperty("real_sampling_interval")&&!l.isInteger(o.real_sampling_interval)?"real_sampling_interval: integer expected":o.mos!=null&&o.hasOwnProperty("mos")&&!l.isInteger(o.mos)?"mos: integer expected":o.audio_decode_fps!=null&&o.hasOwnProperty("audio_decode_fps")&&!l.isInteger(o.audio_decode_fps)?"audio_decode_fps: integer expected":o.video_decode_fps!=null&&o.hasOwnProperty("video_decode_fps")&&!l.isInteger(o.video_decode_fps)?"video_decode_fps: integer expected":o.video_frames_decoded!=null&&o.hasOwnProperty("video_frames_decoded")&&!l.isInteger(o.video_frames_decoded)?"video_frames_decoded: integer expected":o.video_frames_dropped!=null&&o.hasOwnProperty("video_frames_dropped")&&!l.isInteger(o.video_frames_dropped)?"video_frames_dropped: integer expected":o.sample_time_window!=null&&o.hasOwnProperty("sample_time_window")&&!l.isInteger(o.sample_time_window)?"sample_time_window: integer expected":null},c.fromObject=function(o){if(o instanceof a.logreport.PlayQualityInfo)return o;var n=new a.logreport.PlayQualityInfo;return o.audio_bitrate!=null&&(n.audio_bitrate=o.audio_bitrate>>>0),o.video_bitrate!=null&&(n.video_bitrate=o.video_bitrate>>>0),o.video_network_fps!=null&&(n.video_network_fps=o.video_network_fps>>>0),o.audio_break_count!=null&&(n.audio_break_count=o.audio_break_count>>>0),o.video_break_count!=null&&(n.video_break_count=o.video_break_count>>>0),o.downlink_plr!=null&&(n.downlink_plr=o.downlink_plr>>>0),o.peer_to_peer_plr!=null&&(n.peer_to_peer_plr=o.peer_to_peer_plr>>>0),o.peer_to_peer_delay!=null&&(n.peer_to_peer_delay=o.peer_to_peer_delay>>>0),o.audio_network_fps!=null&&(n.audio_network_fps=o.audio_network_fps>>>0),o.audio_break_duration!=null&&(n.audio_break_duration=o.audio_break_duration>>>0),o.video_break_duration!=null&&(n.video_break_duration=o.video_break_duration>>>0),o.audio_break_rate!=null&&(n.audio_break_rate=o.audio_break_rate>>>0),o.video_break_rate!=null&&(n.video_break_rate=o.video_break_rate>>>0),o.audio_break_cancel!=null&&(n.audio_break_cancel=o.audio_break_cancel>>>0),o.video_break_cancel!=null&&(n.video_break_cancel=o.video_break_cancel>>>0),o.rtt!=null&&(n.rtt=o.rtt>>>0),o.rendered_sound_level!=null&&(n.rendered_sound_level=o.rendered_sound_level>>>0),o.audio_break_cancel_duration!=null&&(n.audio_break_cancel_duration=o.audio_break_cancel_duration>>>0),o.video_break_cancel_duration!=null&&(n.video_break_cancel_duration=o.video_break_cancel_duration>>>0),o.audio_decode_time!=null&&(n.audio_decode_time=o.audio_decode_time>>>0),o.video_decode_time!=null&&(n.video_decode_time=o.video_decode_time>>>0),o.real_sampling_interval!=null&&(n.real_sampling_interval=o.real_sampling_interval>>>0),o.mos!=null&&(n.mos=0|o.mos),o.audio_decode_fps!=null&&(n.audio_decode_fps=o.audio_decode_fps>>>0),o.video_decode_fps!=null&&(n.video_decode_fps=o.video_decode_fps>>>0),o.video_frames_decoded!=null&&(n.video_frames_decoded=o.video_frames_decoded>>>0),o.video_frames_dropped!=null&&(n.video_frames_dropped=o.video_frames_dropped>>>0),o.sample_time_window!=null&&(n.sample_time_window=o.sample_time_window>>>0),n},c.toObject=function(o,n){n||(n={});var t={};return n.defaults&&(t.audio_bitrate=0,t.video_bitrate=0,t.video_network_fps=0,t.audio_break_count=0,t.video_break_count=0,t.downlink_plr=0,t.peer_to_peer_plr=0,t.peer_to_peer_delay=0,t.audio_network_fps=0,t.audio_break_duration=0,t.video_break_duration=0,t.audio_break_rate=0,t.video_break_rate=0,t.audio_break_cancel=0,t.video_break_cancel=0,t.rtt=0,t.rendered_sound_level=0,t.audio_break_cancel_duration=0,t.video_break_cancel_duration=0,t.audio_decode_time=0,t.video_decode_time=0,t.real_sampling_interval=0,t.mos=0,t.audio_decode_fps=0,t.video_decode_fps=0,t.video_frames_decoded=0,t.video_frames_dropped=0,t.sample_time_window=0),o.audio_bitrate!=null&&o.hasOwnProperty("audio_bitrate")&&(t.audio_bitrate=o.audio_bitrate),o.video_bitrate!=null&&o.hasOwnProperty("video_bitrate")&&(t.video_bitrate=o.video_bitrate),o.video_network_fps!=null&&o.hasOwnProperty("video_network_fps")&&(t.video_network_fps=o.video_network_fps),o.audio_break_count!=null&&o.hasOwnProperty("audio_break_count")&&(t.audio_break_count=o.audio_break_count),o.video_break_count!=null&&o.hasOwnProperty("video_break_count")&&(t.video_break_count=o.video_break_count),o.downlink_plr!=null&&o.hasOwnProperty("downlink_plr")&&(t.downlink_plr=o.downlink_plr),o.peer_to_peer_plr!=null&&o.hasOwnProperty("peer_to_peer_plr")&&(t.peer_to_peer_plr=o.peer_to_peer_plr),o.peer_to_peer_delay!=null&&o.hasOwnProperty("peer_to_peer_delay")&&(t.peer_to_peer_delay=o.peer_to_peer_delay),o.audio_network_fps!=null&&o.hasOwnProperty("audio_network_fps")&&(t.audio_network_fps=o.audio_network_fps),o.audio_break_duration!=null&&o.hasOwnProperty("audio_break_duration")&&(t.audio_break_duration=o.audio_break_duration),o.video_break_duration!=null&&o.hasOwnProperty("video_break_duration")&&(t.video_break_duration=o.video_break_duration),o.audio_break_rate!=null&&o.hasOwnProperty("audio_break_rate")&&(t.audio_break_rate=o.audio_break_rate),o.video_break_rate!=null&&o.hasOwnProperty("video_break_rate")&&(t.video_break_rate=o.video_break_rate),o.audio_break_cancel!=null&&o.hasOwnProperty("audio_break_cancel")&&(t.audio_break_cancel=o.audio_break_cancel),o.video_break_cancel!=null&&o.hasOwnProperty("video_break_cancel")&&(t.video_break_cancel=o.video_break_cancel),o.rtt!=null&&o.hasOwnProperty("rtt")&&(t.rtt=o.rtt),o.rendered_sound_level!=null&&o.hasOwnProperty("rendered_sound_level")&&(t.rendered_sound_level=o.rendered_sound_level),o.audio_break_cancel_duration!=null&&o.hasOwnProperty("audio_break_cancel_duration")&&(t.audio_break_cancel_duration=o.audio_break_cancel_duration),o.video_break_cancel_duration!=null&&o.hasOwnProperty("video_break_cancel_duration")&&(t.video_break_cancel_duration=o.video_break_cancel_duration),o.audio_decode_time!=null&&o.hasOwnProperty("audio_decode_time")&&(t.audio_decode_time=o.audio_decode_time),o.video_decode_time!=null&&o.hasOwnProperty("video_decode_time")&&(t.video_decode_time=o.video_decode_time),o.real_sampling_interval!=null&&o.hasOwnProperty("real_sampling_interval")&&(t.real_sampling_interval=o.real_sampling_interval),o.mos!=null&&o.hasOwnProperty("mos")&&(t.mos=o.mos),o.audio_decode_fps!=null&&o.hasOwnProperty("audio_decode_fps")&&(t.audio_decode_fps=o.audio_decode_fps),o.video_decode_fps!=null&&o.hasOwnProperty("video_decode_fps")&&(t.video_decode_fps=o.video_decode_fps),o.video_frames_decoded!=null&&o.hasOwnProperty("video_frames_decoded")&&(t.video_frames_decoded=o.video_frames_decoded),o.video_frames_dropped!=null&&o.hasOwnProperty("video_frames_dropped")&&(t.video_frames_dropped=o.video_frames_dropped),o.sample_time_window!=null&&o.hasOwnProperty("sample_time_window")&&(t.sample_time_window=o.sample_time_window),t},c.prototype.toJSON=function(){return this.constructor.toObject(this,h.util.toJSONOptions)},c}(),m),W.exports=a},5515:function(W){W.exports=function T(I,m,h){function _(a,c){if(!m[a]){if(!I[a]){if(d)return d(a,!0);var o=new Error("Cannot find module '"+a+"'");throw o.code="MODULE_NOT_FOUND",o}var n=m[a]={exports:{}};I[a][0].call(n.exports,function(t){return _(I[a][1][t]||t)},n,n.exports,T,I,m,h)}return m[a].exports}for(var d=void 0,l=0;l<h.length;l++)_(h[l]);return _}({1:[function(T,I,m){"use strict";var h=(0,T("./adapter_factory.js").adapterFactory)({window});I.exports=h},{"./adapter_factory.js":2}],2:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.adapterFactory=function(){var n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).window,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},e=h.log,r=h.detectBrowser(n),i={browserDetails:r,commonShim:c,extractVersion:h.extractVersion,disableLog:h.disableLog,disableWarnings:h.disableWarnings};switch(r.browser){case"chrome":if(!_||!_.shimPeerConnection||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),i;e("adapter.js shimming chrome."),i.browserShim=_,_.shimGetUserMedia(n),_.shimMediaStream(n),_.shimPeerConnection(n),_.shimOnTrack(n),_.shimAddTrackRemoveTrack(n),_.shimGetSendersWithDtmf(n),_.shimGetStats(n),_.shimSenderReceiverGetStats(n),_.fixNegotiationNeeded(n),c.shimRTCIceCandidate(n),c.shimConnectionState(n),c.shimMaxMessageSize(n),c.shimSendThrowTypeError(n),c.removeAllowExtmapMixed(n);break;case"firefox":if(!l||!l.shimPeerConnection||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),i;e("adapter.js shimming firefox."),i.browserShim=l,l.shimGetUserMedia(n),l.shimPeerConnection(n),l.shimOnTrack(n),l.shimRemoveStream(n),l.shimSenderGetStats(n),l.shimReceiverGetStats(n),l.shimRTCDataChannel(n),c.shimRTCIceCandidate(n),c.shimConnectionState(n),c.shimMaxMessageSize(n),c.shimSendThrowTypeError(n);break;case"edge":if(!d||!d.shimPeerConnection||!t.shimEdge)return e("MS edge shim is not included in this adapter release."),i;e("adapter.js shimming edge."),i.browserShim=d,d.shimGetUserMedia(n),d.shimGetDisplayMedia(n),d.shimPeerConnection(n),d.shimReplaceTrack(n),c.shimMaxMessageSize(n),c.shimSendThrowTypeError(n);break;case"safari":if(!a||!t.shimSafari)return e("Safari shim is not included in this adapter release."),i;e("adapter.js shimming safari."),i.browserShim=a,a.shimRTCIceServerUrls(n),a.shimCreateOfferLegacy(n),a.shimCallbacksAPI(n),a.shimLocalStreamsAPI(n),a.shimRemoteStreamsAPI(n),a.shimTrackEventTransceiver(n),a.shimGetUserMedia(n),c.shimRTCIceCandidate(n),c.shimMaxMessageSize(n),c.shimSendThrowTypeError(n),c.removeAllowExtmapMixed(n);break;default:e("Unsupported browser!")}return i};var h=o(T("./utils")),_=o(T("./chrome/chrome_shim")),d=o(T("./edge/edge_shim")),l=o(T("./firefox/firefox_shim")),a=o(T("./safari/safari_shim")),c=o(T("./common_shim"));function o(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t.default=n,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=m.shimGetUserMedia=void 0;var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},_=T("./getusermedia");Object.defineProperty(m,"shimGetUserMedia",{enumerable:!0,get:function(){return _.shimGetUserMedia}});var d=T("./getdisplaymedia");Object.defineProperty(m,"shimGetDisplayMedia",{enumerable:!0,get:function(){return d.shimGetDisplayMedia}}),m.shimMediaStream=function(c){c.MediaStream=c.MediaStream||c.webkitMediaStream},m.shimOnTrack=function(c){if((c===void 0?"undefined":h(c))==="object"&&c.RTCPeerConnection&&!("ontrack"in c.RTCPeerConnection.prototype)){Object.defineProperty(c.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});var o=c.RTCPeerConnection.prototype.setRemoteDescription;c.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(e){var r;r=c.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(s){return s.track&&s.track.id===e.track.id}):{track:e.track};var i=new Event("track");i.track=e.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],n.dispatchEvent(i)}),t.stream.getTracks().forEach(function(e){var r;r=c.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(s){return s.track&&s.track.id===e.id}):{track:e};var i=new Event("track");i.track=e,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],n.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),o.apply(this,arguments)}}else l.wrapPeerConnectionEvent(c,"track",function(n){return n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n})},m.shimGetSendersWithDtmf=function(c){if((c===void 0?"undefined":h(c))==="object"&&c.RTCPeerConnection&&!("getSenders"in c.RTCPeerConnection.prototype)&&"createDTMFSender"in c.RTCPeerConnection.prototype){var o=function(s,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=s.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:s}};if(!c.RTCPeerConnection.prototype.getSenders){c.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=c.RTCPeerConnection.prototype.addTrack;c.RTCPeerConnection.prototype.addTrack=function(s,u){var p=n.apply(this,arguments);return p||(p=o(this,s),this._senders.push(p)),p};var t=c.RTCPeerConnection.prototype.removeTrack;c.RTCPeerConnection.prototype.removeTrack=function(s){t.apply(this,arguments);var u=this._senders.indexOf(s);u!==-1&&this._senders.splice(u,1)}}var e=c.RTCPeerConnection.prototype.addStream;c.RTCPeerConnection.prototype.addStream=function(s){var u=this;this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(function(p){u._senders.push(o(u,p))})};var r=c.RTCPeerConnection.prototype.removeStream;c.RTCPeerConnection.prototype.removeStream=function(s){var u=this;this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(function(p){var f=u._senders.find(function(E){return E.track===p});f&&u._senders.splice(u._senders.indexOf(f),1)})}}else if((c===void 0?"undefined":h(c))==="object"&&c.RTCPeerConnection&&"getSenders"in c.RTCPeerConnection.prototype&&"createDTMFSender"in c.RTCPeerConnection.prototype&&c.RTCRtpSender&&!("dtmf"in c.RTCRtpSender.prototype)){var i=c.RTCPeerConnection.prototype.getSenders;c.RTCPeerConnection.prototype.getSenders=function(){var s=this,u=i.apply(this,[]);return u.forEach(function(p){return p._pc=s}),u},Object.defineProperty(c.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},m.shimGetStats=function(c){if(c.RTCPeerConnection){var o=c.RTCPeerConnection.prototype.getStats;c.RTCPeerConnection.prototype.getStats=function(n,t,e){var r=this,i=arguments;if(arguments.length>0&&typeof n=="function")return o.apply(this,arguments);if(o.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return o.apply(this,[]);var s=function(f){var E={};return f.result().forEach(function(y){var b={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(function(S){b[S]=y.stat(S)}),E[b.id]=b}),E},u=function(f){return new Map(Object.keys(f).map(function(E){return[E,f[E]]}))};if(arguments.length>=2){var p=function(f){i[1](u(s(f)))};return o.apply(this,[p,arguments[0]])}return new Promise(function(f,E){o.apply(r,[function(y){f(u(s(y)))},E])}).then(t,e)}}},m.shimSenderReceiverGetStats=function(c){if((c===void 0?"undefined":h(c))==="object"&&c.RTCPeerConnection&&c.RTCRtpSender&&c.RTCRtpReceiver){if(!("getStats"in c.RTCRtpSender.prototype)){var o=c.RTCPeerConnection.prototype.getSenders;o&&(c.RTCPeerConnection.prototype.getSenders=function(){var r=this,i=o.apply(this,[]);return i.forEach(function(s){return s._pc=r}),i});var n=c.RTCPeerConnection.prototype.addTrack;n&&(c.RTCPeerConnection.prototype.addTrack=function(){var r=n.apply(this,arguments);return r._pc=this,r}),c.RTCRtpSender.prototype.getStats=function(){var r=this;return this._pc.getStats().then(function(i){return l.filterStats(i,r.track,!0)})}}if(!("getStats"in c.RTCRtpReceiver.prototype)){var t=c.RTCPeerConnection.prototype.getReceivers;t&&(c.RTCPeerConnection.prototype.getReceivers=function(){var r=this,i=t.apply(this,[]);return i.forEach(function(s){return s._pc=r}),i}),l.wrapPeerConnectionEvent(c,"track",function(r){return r.receiver._pc=r.srcElement,r}),c.RTCRtpReceiver.prototype.getStats=function(){var r=this;return this._pc.getStats().then(function(i){return l.filterStats(i,r.track,!1)})}}if("getStats"in c.RTCRtpSender.prototype&&"getStats"in c.RTCRtpReceiver.prototype){var e=c.RTCPeerConnection.prototype.getStats;c.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof c.MediaStreamTrack){var r=arguments[0],i=void 0,s=void 0,u=void 0;return this.getSenders().forEach(function(p){p.track===r&&(i?u=!0:i=p)}),this.getReceivers().forEach(function(p){return p.track===r&&(s?u=!0:s=p),p.track===r}),u||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}}},m.shimAddTrackRemoveTrackWithNative=a,m.shimAddTrackRemoveTrack=function(c){if(c.RTCPeerConnection){var o=l.detectBrowser(c);if(c.RTCPeerConnection.prototype.addTrack&&o.version>=65)return a(c);var n=c.RTCPeerConnection.prototype.getLocalStreams;c.RTCPeerConnection.prototype.getLocalStreams=function(){var p=this,f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(function(E){return p._reverseStreams[E.id]})};var t=c.RTCPeerConnection.prototype.addStream;c.RTCPeerConnection.prototype.addStream=function(p){var f=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(function(y){if(f.getSenders().find(function(b){return b.track===y}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){var E=new c.MediaStream(p.getTracks());this._streams[p.id]=E,this._reverseStreams[E.id]=p,p=E}t.apply(this,[p])};var e=c.RTCPeerConnection.prototype.removeStream;c.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},c.RTCPeerConnection.prototype.addTrack=function(p,f){var E=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(function(k){return k===p}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(k){return k.track===p}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var b=this._streams[f.id];if(b)b.addTrack(p),Promise.resolve().then(function(){E.dispatchEvent(new Event("negotiationneeded"))});else{var S=new c.MediaStream([p]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(function(k){return k.track===p})},["createOffer","createAnswer"].forEach(function(p){var f=c.RTCPeerConnection.prototype[p];c.RTCPeerConnection.prototype[p]=function(){var E=this,y=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[function(b){var S=s(E,b);y[0].apply(null,[S])},function(b){y[1]&&y[1].apply(null,b)},arguments[2]]):f.apply(this,arguments).then(function(b){return s(E,b)})}});var r=c.RTCPeerConnection.prototype.setLocalDescription;c.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=u(this,arguments[0]),r.apply(this,arguments)):r.apply(this,arguments)};var i=Object.getOwnPropertyDescriptor(c.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(c.RTCPeerConnection.prototype,"localDescription",{get:function(){var p=i.get.apply(this);return p.type===""?p:s(this,p)}}),c.RTCPeerConnection.prototype.removeTrack=function(p){var f=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var E=void 0;Object.keys(this._streams).forEach(function(y){f._streams[y].getTracks().find(function(b){return p.track===b})&&(E=f._streams[y])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(p,f){var E=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(function(y){var b=p._reverseStreams[y],S=p._streams[b.id];E=E.replace(new RegExp(S.id,"g"),b.id)}),new RTCSessionDescription({type:f.type,sdp:E})}function u(p,f){var E=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(function(y){var b=p._reverseStreams[y],S=p._streams[b.id];E=E.replace(new RegExp(b.id,"g"),S.id)}),new RTCSessionDescription({type:f.type,sdp:E})}},m.shimPeerConnection=function(c){if(!c.RTCPeerConnection&&c.webkitRTCPeerConnection&&(c.RTCPeerConnection=c.webkitRTCPeerConnection),c.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var t=c.RTCPeerConnection.prototype[n];c.RTCPeerConnection.prototype[n]=function(){return arguments[0]=new(n==="addIceCandidate"?c.RTCIceCandidate:c.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var o=c.RTCPeerConnection.prototype.addIceCandidate;c.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},m.fixNegotiationNeeded=function(c){l.wrapPeerConnectionEvent(c,"negotiationneeded",function(o){if(o.target.signalingState==="stable")return o})};var l=function(c){if(c&&c.__esModule)return c;var o={};if(c!=null)for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o.default=c,o}(T("../utils.js"));function a(c){c.RTCPeerConnection.prototype.getLocalStreams=function(){var r=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(i){return r._shimmedLocalStreams[i][0]})};var o=c.RTCPeerConnection.prototype.addTrack;c.RTCPeerConnection.prototype.addTrack=function(r,i){if(!i)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var s=o.apply(this,arguments);return this._shimmedLocalStreams[i.id]?this._shimmedLocalStreams[i.id].indexOf(s)===-1&&this._shimmedLocalStreams[i.id].push(s):this._shimmedLocalStreams[i.id]=[i,s],s};var n=c.RTCPeerConnection.prototype.addStream;c.RTCPeerConnection.prototype.addStream=function(r){var i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach(function(p){if(i.getSenders().find(function(f){return f.track===p}))throw new DOMException("Track already exists.","InvalidAccessError")});var s=this.getSenders();n.apply(this,arguments);var u=this.getSenders().filter(function(p){return s.indexOf(p)===-1});this._shimmedLocalStreams[r.id]=[r].concat(u)};var t=c.RTCPeerConnection.prototype.removeStream;c.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],t.apply(this,arguments)};var e=c.RTCPeerConnection.prototype.removeTrack;c.RTCPeerConnection.prototype.removeTrack=function(r){var i=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(s){var u=i._shimmedLocalStreams[s].indexOf(r);u!==-1&&i._shimmedLocalStreams[s].splice(u,1),i._shimmedLocalStreams[s].length===1&&delete i._shimmedLocalStreams[s]}),e.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=function(h,_){h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||h.navigator.mediaDevices&&(typeof _=="function"?h.navigator.mediaDevices.getDisplayMedia=function(d){return _(d).then(function(l){var a=d.video&&d.video.width,c=d.video&&d.video.height,o=d.video&&d.video.frameRate;return d.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:l,maxFrameRate:o||3}},a&&(d.video.mandatory.maxWidth=a),c&&(d.video.mandatory.maxHeight=c),h.navigator.mediaDevices.getUserMedia(d)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l};m.shimGetUserMedia=function(l){var a=l&&l.navigator;if(a.mediaDevices){var c=_.detectBrowser(l),o=function(r){if((r===void 0?"undefined":h(r))!=="object"||r.mandatory||r.optional)return r;var i={};return Object.keys(r).forEach(function(s){if(s!=="require"&&s!=="advanced"&&s!=="mediaSource"){var u=h(r[s])==="object"?r[s]:{ideal:r[s]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);var p=function(E,y){return E?E+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(u.ideal!==void 0){i.optional=i.optional||[];var f={};typeof u.ideal=="number"?(f[p("min",s)]=u.ideal,i.optional.push(f),(f={})[p("max",s)]=u.ideal,i.optional.push(f)):(f[p("",s)]=u.ideal,i.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(i.mandatory=i.mandatory||{},i.mandatory[p("",s)]=u.exact):["min","max"].forEach(function(E){u[E]!==void 0&&(i.mandatory=i.mandatory||{},i.mandatory[p(E,s)]=u[E])})}}),r.advanced&&(i.optional=(i.optional||[]).concat(r.advanced)),i},n=function(r,i){if(c.version>=61)return i(r);if((r=JSON.parse(JSON.stringify(r)))&&h(r.audio)==="object"){var s=function(E,y,b){y in E&&!(b in E)&&(E[b]=E[y],delete E[y])};s((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),s(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=o(r.audio)}if(r&&h(r.video)==="object"){var u=r.video.facingMode;u=u&&((u===void 0?"undefined":h(u))==="object"?u:{ideal:u});var p=c.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||p)){delete r.video.facingMode;var f=void 0;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(f=["front"]),f)return a.mediaDevices.enumerateDevices().then(function(E){var y=(E=E.filter(function(b){return b.kind==="videoinput"})).find(function(b){return f.some(function(S){return b.label.toLowerCase().includes(S)})});return!y&&E.length&&f.includes("back")&&(y=E[E.length-1]),y&&(r.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),r.video=o(r.video),d("chrome: "+JSON.stringify(r)),i(r)})}r.video=o(r.video)}return d("chrome: "+JSON.stringify(r)),i(r)},t=function(r){return c.version>=64?r:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[r.name]||r.name,message:r.message,constraint:r.constraint||r.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(a.getUserMedia=function(r,i,s){n(r,function(u){a.webkitGetUserMedia(u,i,function(p){s&&s(t(p))})})}.bind(a),a.mediaDevices.getUserMedia){var e=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(r){return n(r,function(i){return e(i).then(function(s){if(i.audio&&!s.getAudioTracks().length||i.video&&!s.getVideoTracks().length)throw s.getTracks().forEach(function(u){u.stop()}),new DOMException("","NotFoundError");return s},function(s){return Promise.reject(t(s))})})}}}};var _=function(l){if(l&&l.__esModule)return l;var a={};if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(a[c]=l[c]);return a.default=l,a}(T("../utils.js")),d=_.log},{"../utils.js":15}],6:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};m.shimRTCIceCandidate=function(a){if(!(!a.RTCIceCandidate||a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var c=a.RTCIceCandidate;a.RTCIceCandidate=function(o){if((o===void 0?"undefined":h(o))==="object"&&o.candidate&&o.candidate.indexOf("a=")===0&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){var n=new c(o),t=d.default.parseCandidate(o.candidate),e=Object.assign(n,t);return e.toJSON=function(){return{candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment}},e}return new c(o)},a.RTCIceCandidate.prototype=c.prototype,l.wrapPeerConnectionEvent(a,"icecandidate",function(o){return o.candidate&&Object.defineProperty(o,"candidate",{value:new a.RTCIceCandidate(o.candidate),writable:"false"}),o})}},m.shimMaxMessageSize=function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var c=l.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var o=function(i){if(!i||!i.sdp)return!1;var s=d.default.splitSections(i.sdp);return s.shift(),s.some(function(u){var p=d.default.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},n=function(i){var s=i.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;var u=parseInt(s[1],10);return u!=u?-1:u},t=function(i){var s=65536;return c.browser==="firefox"&&(s=c.version<57?i===-1?16384:2147483637:c.version<60?c.version===57?65535:65536:2147483637),s},e=function(i,s){var u=65536;c.browser==="firefox"&&c.version===57&&(u=65535);var p=d.default.matchPrefix(i.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substr(19),10):c.browser==="firefox"&&s!==-1&&(u=2147483637),u},r=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,o(arguments[0])){var i=n(arguments[0]),s=t(i),u=e(arguments[0],i),p=void 0;p=s===0&&u===0?Number.POSITIVE_INFINITY:s===0||u===0?Math.max(s,u):Math.min(s,u);var f={};Object.defineProperty(f,"maxMessageSize",{get:function(){return p}}),this._sctp=f}return r.apply(this,arguments)}}},m.shimSendThrowTypeError=function(a){if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var n=c.apply(this,arguments);return o(n,this),n},l.wrapPeerConnectionEvent(a,"datachannel",function(n){return o(n.channel,n.target),n})}function o(n,t){var e=n.send;n.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if(n.readyState==="open"&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return e.apply(n,arguments)}}},m.shimConnectionState=function(a){if(a.RTCPeerConnection&&!("connectionState"in a.RTCPeerConnection.prototype)){var c=a.RTCPeerConnection.prototype;Object.defineProperty(c,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(c,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(o){var n=c[o];c[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(t){var e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;var r=new Event("connectionstatechange",t);e.dispatchEvent(r)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}},m.removeAllowExtmapMixed=function(a){if(a.RTCPeerConnection){var c=l.detectBrowser(a);if(!(c.browser==="chrome"&&c.version>=71)){var o=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(n){return n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1&&(n.sdp=n.sdp.split(`
`).filter(function(t){return t.trim()!=="a=extmap-allow-mixed"}).join(`
`)),o.apply(this,arguments)}}}};var _,d=(_=T("sdp"))&&_.__esModule?_:{default:_},l=function(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(c[o]=a[o]);return c.default=a,c}(T("./utils"))},{"./utils":15,sdp:17}],7:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=m.shimGetUserMedia=void 0;var h=T("./getusermedia");Object.defineProperty(m,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}});var _=T("./getdisplaymedia");Object.defineProperty(m,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _.shimGetDisplayMedia}}),m.shimPeerConnection=function(o){var n=l.detectBrowser(o);if(o.RTCIceGatherer&&(o.RTCIceCandidate||(o.RTCIceCandidate=function(r){return r}),o.RTCSessionDescription||(o.RTCSessionDescription=function(r){return r}),n.version<15025)){var t=Object.getOwnPropertyDescriptor(o.MediaStreamTrack.prototype,"enabled");Object.defineProperty(o.MediaStreamTrack.prototype,"enabled",{set:function(r){t.set.call(this,r);var i=new Event("enabled");i.enabled=r,this.dispatchEvent(i)}})}o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)&&Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new o.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),o.RTCDtmfSender&&!o.RTCDTMFSender&&(o.RTCDTMFSender=o.RTCDtmfSender);var e=(0,c.default)(o,n.version);o.RTCPeerConnection=function(r){return r&&r.iceServers&&(r.iceServers=(0,a.filterIceServers)(r.iceServers,n.version),l.log("ICE servers after filtering:",r.iceServers)),new e(r)},o.RTCPeerConnection.prototype=e.prototype},m.shimReplaceTrack=function(o){o.RTCRtpSender&&!("replaceTrack"in o.RTCRtpSender.prototype)&&(o.RTCRtpSender.prototype.replaceTrack=o.RTCRtpSender.prototype.setTrack)};var d,l=function(o){if(o&&o.__esModule)return o;var n={};if(o!=null)for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(n[t]=o[t]);return n.default=o,n}(T("../utils")),a=T("./filtericeservers"),c=(d=T("rtcpeerconnection-shim"))&&d.__esModule?d:{default:d}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.filterIceServers=function(_,d){var l=!1;return(_=JSON.parse(JSON.stringify(_))).filter(function(a){if(a&&(a.urls||a.url)){var c=a.urls||a.url;a.url&&!a.urls&&h.deprecated("RTCIceServer.url","RTCIceServer.urls");var o=typeof c=="string";return o&&(c=[c]),c=c.filter(function(n){if(n.indexOf("stun:")===0)return!1;var t=n.startsWith("turn")&&!n.startsWith("turn:[")&&n.includes("transport=udp");return t&&!l?(l=!0,!0):t&&!l}),delete a.url,a.urls=o?c[0]:c,!!c.length}})};var h=function(_){if(_&&_.__esModule)return _;var d={};if(_!=null)for(var l in _)Object.prototype.hasOwnProperty.call(_,l)&&(d[l]=_[l]);return d.default=_,d}(T("../utils"))},{"../utils":15}],9:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=function(h){"getDisplayMedia"in h.navigator&&h.navigator.mediaDevices&&(h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||(h.navigator.mediaDevices.getDisplayMedia=h.navigator.getDisplayMedia.bind(h.navigator)))}},{}],10:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetUserMedia=function(h){var _=h&&h.navigator,d=_.mediaDevices.getUserMedia.bind(_.mediaDevices);_.mediaDevices.getUserMedia=function(l){return d(l).catch(function(a){return Promise.reject(function(c){return{name:{PermissionDeniedError:"NotAllowedError"}[c.name]||c.name,message:c.message,constraint:c.constraint,toString:function(){return this.name}}}(a))})}}},{}],11:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=m.shimGetUserMedia=void 0;var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_=T("./getusermedia");Object.defineProperty(m,"shimGetUserMedia",{enumerable:!0,get:function(){return _.shimGetUserMedia}});var d=T("./getdisplaymedia");Object.defineProperty(m,"shimGetDisplayMedia",{enumerable:!0,get:function(){return d.shimGetDisplayMedia}}),m.shimOnTrack=function(a){(a===void 0?"undefined":h(a))==="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},m.shimPeerConnection=function(a){var c=l.detectBrowser(a);if((a===void 0?"undefined":h(a))==="object"&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var r=a.RTCPeerConnection.prototype[e];a.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new(e==="addIceCandidate"?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},t=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(e,r,i){return t.apply(this,[e||null]).then(function(s){if(c.version<53&&!r)try{s.forEach(function(u){u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;s.forEach(function(p,f){s.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return s}).then(r,i)}}},m.shimSenderGetStats=function(a){if((a===void 0?"undefined":h(a))==="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpSender.prototype))){var c=a.RTCPeerConnection.prototype.getSenders;c&&(a.RTCPeerConnection.prototype.getSenders=function(){var n=this,t=c.apply(this,[]);return t.forEach(function(e){return e._pc=n}),t});var o=a.RTCPeerConnection.prototype.addTrack;o&&(a.RTCPeerConnection.prototype.addTrack=function(){var n=o.apply(this,arguments);return n._pc=this,n}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},m.shimReceiverGetStats=function(a){if((a===void 0?"undefined":h(a))==="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpReceiver.prototype))){var c=a.RTCPeerConnection.prototype.getReceivers;c&&(a.RTCPeerConnection.prototype.getReceivers=function(){var o=this,n=c.apply(this,[]);return n.forEach(function(t){return t._pc=o}),n}),l.wrapPeerConnectionEvent(a,"track",function(o){return o.receiver._pc=o.srcElement,o}),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},m.shimRemoveStream=function(a){a.RTCPeerConnection&&!("removeStream"in a.RTCPeerConnection.prototype)&&(a.RTCPeerConnection.prototype.removeStream=function(c){var o=this;l.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&c.getTracks().includes(n.track)&&o.removeTrack(n)})})},m.shimRTCDataChannel=function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)};var l=function(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(c[o]=a[o]);return c.default=a,c}(T("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.shimGetDisplayMedia=function(h,_){h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||h.navigator.mediaDevices&&(h.navigator.mediaDevices.getDisplayMedia=function(d){if(!d||!d.video){var l=new DOMException("getDisplayMedia without video constraints is undefined");return l.name="NotFoundError",l.code=8,Promise.reject(l)}return d.video===!0?d.video={mediaSource:_}:d.video.mediaSource=_,h.navigator.mediaDevices.getUserMedia(d)})}},{}],13:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d};m.shimGetUserMedia=function(d){var l=_.detectBrowser(d),a=d&&d.navigator,c=d&&d.MediaStreamTrack;if(a.getUserMedia=function(r,i,s){_.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(r).then(i,s)},!(l.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){var o=function(r,i,s){i in r&&!(s in r)&&(r[s]=r[i],delete r[i])},n=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(r){return(r===void 0?"undefined":h(r))==="object"&&h(r.audio)==="object"&&(r=JSON.parse(JSON.stringify(r)),o(r.audio,"autoGainControl","mozAutoGainControl"),o(r.audio,"noiseSuppression","mozNoiseSuppression")),n(r)},c&&c.prototype.getSettings){var t=c.prototype.getSettings;c.prototype.getSettings=function(){var r=t.apply(this,arguments);return o(r,"mozAutoGainControl","autoGainControl"),o(r,"mozNoiseSuppression","noiseSuppression"),r}}if(c&&c.prototype.applyConstraints){var e=c.prototype.applyConstraints;c.prototype.applyConstraints=function(r){return this.kind==="audio"&&(r===void 0?"undefined":h(r))==="object"&&(r=JSON.parse(JSON.stringify(r)),o(r,"autoGainControl","mozAutoGainControl"),o(r,"noiseSuppression","mozNoiseSuppression")),e.apply(this,[r])}}}};var _=function(d){if(d&&d.__esModule)return d;var l={};if(d!=null)for(var a in d)Object.prototype.hasOwnProperty.call(d,a)&&(l[a]=d[a]);return l.default=d,l}(T("../utils"))},{"../utils":15}],14:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l};m.shimLocalStreamsAPI=function(l){if((l===void 0?"undefined":h(l))==="object"&&l.RTCPeerConnection){if("getLocalStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in l.RTCPeerConnection.prototype)){var a=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addStream=function(c){var o=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(c)||this._localStreams.push(c),c.getTracks().forEach(function(n){return a.call(o,n,c)})},l.RTCPeerConnection.prototype.addTrack=function(c,o){return o&&(this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]),a.call(this,c,o)}}"removeStream"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.removeStream=function(c){var o=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(c);if(n!==-1){this._localStreams.splice(n,1);var t=c.getTracks();this.getSenders().forEach(function(e){t.includes(e.track)&&o.removeTrack(e)})}})}},m.shimRemoteStreamsAPI=function(l){if((l===void 0?"undefined":h(l))==="object"&&l.RTCPeerConnection&&("getRemoteStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in l.RTCPeerConnection.prototype))){Object.defineProperty(l.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(c){var o=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=c),this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(function(t){if(o._remoteStreams||(o._remoteStreams=[]),!o._remoteStreams.includes(t)){o._remoteStreams.push(t);var e=new Event("addstream");e.stream=t,o.dispatchEvent(e)}})})}});var a=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(function(n){if(c._remoteStreams||(c._remoteStreams=[]),!(c._remoteStreams.indexOf(n)>=0)){c._remoteStreams.push(n);var t=new Event("addstream");t.stream=n,c.dispatchEvent(t)}})}),a.apply(c,arguments)}}},m.shimCallbacksAPI=function(l){if((l===void 0?"undefined":h(l))==="object"&&l.RTCPeerConnection){var a=l.RTCPeerConnection.prototype,c=a.createOffer,o=a.createAnswer,n=a.setLocalDescription,t=a.setRemoteDescription,e=a.addIceCandidate;a.createOffer=function(i,s){var u=arguments.length>=2?arguments[2]:arguments[0],p=c.apply(this,[u]);return s?(p.then(i,s),Promise.resolve()):p},a.createAnswer=function(i,s){var u=arguments.length>=2?arguments[2]:arguments[0],p=o.apply(this,[u]);return s?(p.then(i,s),Promise.resolve()):p};var r=function(i,s,u){var p=n.apply(this,[i]);return u?(p.then(s,u),Promise.resolve()):p};a.setLocalDescription=r,r=function(i,s,u){var p=t.apply(this,[i]);return u?(p.then(s,u),Promise.resolve()):p},a.setRemoteDescription=r,r=function(i,s,u){var p=e.apply(this,[i]);return u?(p.then(s,u),Promise.resolve()):p},a.addIceCandidate=r}},m.shimGetUserMedia=function(l){var a=l&&l.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){var c=a.mediaDevices,o=c.getUserMedia.bind(c);a.mediaDevices.getUserMedia=function(n){return o(d(n))}}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=function(n,t,e){a.mediaDevices.getUserMedia(n).then(t,e)}.bind(a))},m.shimConstraints=d,m.shimRTCIceServerUrls=function(l){var a=l.RTCPeerConnection;l.RTCPeerConnection=function(c,o){if(c&&c.iceServers){for(var n=[],t=0;t<c.iceServers.length;t++){var e=c.iceServers[t];!e.hasOwnProperty("urls")&&e.hasOwnProperty("url")?(_.deprecated("RTCIceServer.url","RTCIceServer.urls"),(e=JSON.parse(JSON.stringify(e))).urls=e.url,delete e.url,n.push(e)):n.push(c.iceServers[t])}c.iceServers=n}return new a(c,o)},l.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in l.RTCPeerConnection&&Object.defineProperty(l.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}})},m.shimTrackEventTransceiver=function(l){(l===void 0?"undefined":h(l))==="object"&&l.RTCPeerConnection&&"receiver"in l.RTCTrackEvent.prototype&&!l.RTCTransceiver&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},m.shimCreateOfferLegacy=function(l){var a=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(c){if(c){c.offerToReceiveAudio!==void 0&&(c.offerToReceiveAudio=!!c.offerToReceiveAudio);var o=this.getTransceivers().find(function(t){return t.receiver.track.kind==="audio"});c.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):c.offerToReceiveAudio!==!0||o||this.addTransceiver("audio"),c.offerToReceiveVideo!==void 0&&(c.offerToReceiveVideo=!!c.offerToReceiveVideo);var n=this.getTransceivers().find(function(t){return t.receiver.track.kind==="video"});c.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):c.offerToReceiveVideo!==!0||n||this.addTransceiver("video")}return a.apply(this,arguments)}};var _=function(l){if(l&&l.__esModule)return l;var a={};if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(a[c]=l[c]);return a.default=l,a}(T("../utils"));function d(l){return l&&l.video!==void 0?Object.assign({},l,{video:_.compactObject(l.video)}):l}},{"../utils":15}],15:[function(T,I,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};m.extractVersion=l,m.wrapPeerConnectionEvent=function(c,o,n){if(c.RTCPeerConnection){var t=c.RTCPeerConnection.prototype,e=t.addEventListener;t.addEventListener=function(i,s){if(i!==o)return e.apply(this,arguments);var u=function(p){var f=n(p);f&&s(f)};return this._eventMap=this._eventMap||{},this._eventMap[s]=u,e.apply(this,[i,u])};var r=t.removeEventListener;t.removeEventListener=function(i,s){if(i!==o||!this._eventMap||!this._eventMap[s])return r.apply(this,arguments);var u=this._eventMap[s];return delete this._eventMap[s],r.apply(this,[i,u])},Object.defineProperty(t,"on"+o,{get:function(){return this["_on"+o]},set:function(i){this["_on"+o]&&(this.removeEventListener(o,this["_on"+o]),delete this["_on"+o]),i&&this.addEventListener(o,this["_on"+o]=i)},enumerable:!0,configurable:!0})}},m.disableLog=function(c){return typeof c!="boolean"?new Error("Argument type: "+(c===void 0?"undefined":h(c))+". Please use a boolean."):(_=c,c?"adapter.js logging disabled":"adapter.js logging enabled")},m.disableWarnings=function(c){return typeof c!="boolean"?new Error("Argument type: "+(c===void 0?"undefined":h(c))+". Please use a boolean."):(d=!c,"adapter.js deprecation warnings "+(c?"disabled":"enabled"))},m.log=function(){if((typeof window=="undefined"?"undefined":h(window))==="object"){if(_)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},m.deprecated=function(c,o){d&&console.warn(c+" is deprecated, please use "+o+" instead.")},m.detectBrowser=function(c){var o=c.navigator,n={browser:null,version:null};if(c===void 0||!c.navigator)return n.browser="Not a browser.",n;if(o.mozGetUserMedia)n.browser="firefox",n.version=l(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection&&!c.RTCIceGatherer)n.browser="chrome",n.version=l(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(o.mediaDevices&&o.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=l(o.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!c.RTCPeerConnection||!o.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=l(o.userAgent,/AppleWebKit\/(\d+)\./,1)}return n},m.compactObject=function c(o){return(o===void 0?"undefined":h(o))!=="object"?o:Object.keys(o).reduce(function(n,t){var e=h(o[t])==="object",r=e?c(o[t]):o[t],i=e&&!Object.keys(r).length;return r===void 0||i?n:Object.assign(n,function(s,u,p){return u in s?Object.defineProperty(s,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):s[u]=p,s}({},t,r))},{})},m.walkStats=a,m.filterStats=function(c,o,n){var t=n?"outbound-rtp":"inbound-rtp",e=new Map;if(o===null)return e;var r=[];return c.forEach(function(i){i.type==="track"&&i.trackIdentifier===o.id&&r.push(i)}),r.forEach(function(i){c.forEach(function(s){s.type===t&&s.trackId===i.id&&a(c,s,e)})}),e};var _=!0,d=!0;function l(c,o,n){var t=c.match(o);return t&&t.length>=n&&parseInt(t[n],10)}function a(c,o,n){o&&!n.has(o.id)&&(n.set(o.id,o),Object.keys(o).forEach(function(t){t.endsWith("Id")?a(c,c.get(o[t]),n):t.endsWith("Ids")&&o[t].forEach(function(e){a(c,c.get(e),n)})}))}},{}],16:[function(T,I,m){"use strict";var h=T("sdp");function _(o,n,t,e,r){var i=h.writeRtpDescription(o.kind,n);if(i+=h.writeIceParameters(o.iceGatherer.getLocalParameters()),i+=h.writeDtlsParameters(o.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":r||"active"),i+="a=mid:"+o.mid+`\r
`,o.rtpSender&&o.rtpReceiver?i+=`a=sendrecv\r
`:o.rtpSender?i+=`a=sendonly\r
`:o.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,o.rtpSender){var s=o.rtpSender._initialTrackId||o.rtpSender.track.id;o.rtpSender._initialTrackId=s;var u="msid:"+(e?e.id:"-")+" "+s+`\r
`;i+="a="+u,i+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" "+u,o.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" "+u,i+="a=ssrc-group:FID "+o.sendEncodingParameters[0].ssrc+" "+o.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" cname:"+h.localCName+`\r
`,o.rtpSender&&o.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" cname:"+h.localCName+`\r
`),i}function d(o,n){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},e=function(i,s){i=parseInt(i,10);for(var u=0;u<s.length;u++)if(s[u].payloadType===i||s[u].preferredPayloadType===i)return s[u]},r=function(i,s,u,p){var f=e(i.parameters.apt,u),E=e(s.parameters.apt,p);return f&&E&&f.name.toLowerCase()===E.name.toLowerCase()};return o.codecs.forEach(function(i){for(var s=0;s<n.codecs.length;s++){var u=n.codecs[s];if(i.name.toLowerCase()===u.name.toLowerCase()&&i.clockRate===u.clockRate){if(i.name.toLowerCase()==="rtx"&&i.parameters&&u.parameters.apt&&!r(i,u,o.codecs,n.codecs))continue;(u=JSON.parse(JSON.stringify(u))).numChannels=Math.min(i.numChannels,u.numChannels),t.codecs.push(u),u.rtcpFeedback=u.rtcpFeedback.filter(function(p){for(var f=0;f<i.rtcpFeedback.length;f++)if(i.rtcpFeedback[f].type===p.type&&i.rtcpFeedback[f].parameter===p.parameter)return!0;return!1});break}}}),o.headerExtensions.forEach(function(i){for(var s=0;s<n.headerExtensions.length;s++){var u=n.headerExtensions[s];if(i.uri===u.uri){t.headerExtensions.push(u);break}}}),t}function l(o,n,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][o].indexOf(t)!==-1}function a(o,n){var t=o.getRemoteCandidates().find(function(e){return n.foundation===e.foundation&&n.ip===e.ip&&n.port===e.port&&n.priority===e.priority&&n.protocol===e.protocol&&n.type===e.type});return t||o.addRemoteCandidate(n),!t}function c(o,n){var t=new Error(n);return t.name=o,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[o],t}I.exports=function(o,n){function t(s,u){u.addTrack(s),u.dispatchEvent(new o.MediaStreamTrackEvent("addtrack",{track:s}))}function e(s,u,p,f){var E=new Event("track");E.track=u,E.receiver=p,E.transceiver={receiver:p},E.streams=f,o.setTimeout(function(){s._dispatchEvent("track",E)})}var r=function(s){var u=this,p=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){u[E]=p[E].bind(p)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all"}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced"}if(s.iceServers=function(E,y){var b=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(S){if(S&&(S.urls||S.url)){var k=S.urls||S.url;S.url&&!S.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var O=typeof k=="string";return O&&(k=[k]),k=k.filter(function(g){return g.indexOf("turn:")!==0||g.indexOf("transport=udp")===-1||g.indexOf("turn:[")!==-1||b?g.indexOf("stun:")===0&&y>=14393&&g.indexOf("?transport=udp")===-1:(b=!0,!0)}),delete S.url,S.urls=O?k[0]:k,!!k.length}})}(s.iceServers||[],n),this._iceGatherers=[],s.iceCandidatePoolSize)for(var f=s.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new o.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=h.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(s,u){this._isClosed||(this.dispatchEvent(u),typeof this["on"+s]=="function"&&this["on"+s](u))},r.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(s,u){var p=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&p)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var E=this._createIceAndDtlsTransports();f.iceTransport=E.iceTransport,f.dtlsTransport=E.dtlsTransport}return u||this.transceivers.push(f),f},r.prototype.addTrack=function(s,u){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var p;if(this.transceivers.find(function(E){return E.track===s}))throw c("InvalidAccessError","Track already exists.");for(var f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==s.kind||(p=this.transceivers[f]);return p||(p=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(u)===-1&&this.localStreams.push(u),p.track=s,p.stream=u,p.rtpSender=new o.RTCRtpSender(s,p.dtlsTransport),p.rtpSender},r.prototype.addStream=function(s){var u=this;if(n>=15025)s.getTracks().forEach(function(f){u.addTrack(f,s)});else{var p=s.clone();s.getTracks().forEach(function(f,E){var y=p.getTracks()[E];f.addEventListener("enabled",function(b){y.enabled=b.enabled})}),p.getTracks().forEach(function(f){u.addTrack(f,p)})}},r.prototype.removeTrack=function(s){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof o.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var u=this.transceivers.find(function(f){return f.rtpSender===s});if(!u)throw c("InvalidAccessError","Sender was not created by this connection.");var p=u.stream;u.rtpSender.stop(),u.rtpSender=null,u.track=null,u.stream=null,this.transceivers.map(function(f){return f.stream}).indexOf(p)===-1&&this.localStreams.indexOf(p)>-1&&this.localStreams.splice(this.localStreams.indexOf(p),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(s){var u=this;s.getTracks().forEach(function(p){var f=u.getSenders().find(function(E){return E.track===p});f&&u.removeTrack(f)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},r.prototype._createIceGatherer=function(s,u){var p=this;if(u&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new o.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(E){var y=!E.candidate||Object.keys(E.candidate).length===0;f.state=y?"completed":"gathering",p.transceivers[s].bufferedCandidateEvents!==null&&p.transceivers[s].bufferedCandidateEvents.push(E)},f.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),f},r.prototype._gather=function(s,u){var p=this,f=this.transceivers[u].iceGatherer;if(!f.onlocalcandidate){var E=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),f.onlocalcandidate=function(y){if(!(p.usingBundle&&u>0)){var b=new Event("icecandidate");b.candidate={sdpMid:s,sdpMLineIndex:u};var S=y.candidate,k=!S||Object.keys(S).length===0;if(k)f.state!=="new"&&f.state!=="gathering"||(f.state="completed");else{f.state==="new"&&(f.state="gathering"),S.component=1,S.ufrag=f.getLocalParameters().usernameFragment;var O=h.writeCandidate(S);b.candidate=Object.assign(b.candidate,h.parseCandidate(O)),b.candidate.candidate=O,b.candidate.toJSON=function(){return{candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex,usernameFragment:b.candidate.usernameFragment}}}var g=h.getMediaSections(p._localDescription.sdp);g[b.candidate.sdpMLineIndex]+=k?`a=end-of-candidates\r
`:"a="+b.candidate.candidate+`\r
`,p._localDescription.sdp=h.getDescription(p._localDescription.sdp)+g.join("");var v=p.transceivers.every(function(R){return R.iceGatherer&&R.iceGatherer.state==="completed"});p.iceGatheringState!=="gathering"&&(p.iceGatheringState="gathering",p._emitGatheringStateChange()),k||p._dispatchEvent("icecandidate",b),v&&(p._dispatchEvent("icecandidate",new Event("icecandidate")),p.iceGatheringState="complete",p._emitGatheringStateChange())}},o.setTimeout(function(){E.forEach(function(y){f.onlocalcandidate(y)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var s=this,u=new o.RTCIceTransport(null);u.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var p=new o.RTCDtlsTransport(u);return p.ondtlsstatechange=function(){s._updateConnectionState()},p.onerror=function(){Object.defineProperty(p,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:u,dtlsTransport:p}},r.prototype._disposeIceAndDtlsTransports=function(s){var u=this.transceivers[s].iceGatherer;u&&(delete u.onlocalcandidate,delete this.transceivers[s].iceGatherer);var p=this.transceivers[s].iceTransport;p&&(delete p.onicestatechange,delete this.transceivers[s].iceTransport);var f=this.transceivers[s].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[s].dtlsTransport)},r.prototype._transceive=function(s,u,p){var f=d(s.localCapabilities,s.remoteCapabilities);u&&s.rtpSender&&(f.encodings=s.sendEncodingParameters,f.rtcp={cname:h.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(f.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(f)),p&&s.rtpReceiver&&f.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&n<15019&&s.recvEncodingParameters.forEach(function(E){delete E.rtx}),s.recvEncodingParameters.length?f.encodings=s.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(f.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(f.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(f))},r.prototype.setLocalDescription=function(s){var u,p,f=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+s.type+'"'));if(!l("setLocalDescription",s.type,f.signalingState)||f._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+s.type+" in state "+f.signalingState));if(s.type==="offer")u=h.splitSections(s.sdp),p=u.shift(),u.forEach(function(y,b){var S=h.parseRtpParameters(y);f.transceivers[b].localCapabilities=S}),f.transceivers.forEach(function(y,b){f._gather(y.mid,b)});else if(s.type==="answer"){u=h.splitSections(f._remoteDescription.sdp),p=u.shift();var E=h.matchPrefix(p,"a=ice-lite").length>0;u.forEach(function(y,b){var S=f.transceivers[b],k=S.iceGatherer,O=S.iceTransport,g=S.dtlsTransport,v=S.localCapabilities,R=S.remoteCapabilities;if(!(h.isRejected(y)&&h.matchPrefix(y,"a=bundle-only").length===0||S.rejected)){var L=h.getIceParameters(y,p),N=h.getDtlsParameters(y,p);E&&(N.role="server"),f.usingBundle&&b!==0||(f._gather(S.mid,b),O.state==="new"&&O.start(k,L,E?"controlling":"controlled"),g.state==="new"&&g.start(N));var w=d(v,R);f._transceive(S,w.codecs.length>0,!1)}})}return f._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(s){var u=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(c("TypeError",'Unsupported type "'+s.type+'"'));if(!l("setRemoteDescription",s.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+s.type+" in state "+u.signalingState));var p={};u.remoteStreams.forEach(function(O){p[O.id]=O});var f=[],E=h.splitSections(s.sdp),y=E.shift(),b=h.matchPrefix(y,"a=ice-lite").length>0,S=h.matchPrefix(y,"a=group:BUNDLE ").length>0;u.usingBundle=S;var k=h.matchPrefix(y,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!k&&k.substr(14).split(" ").indexOf("trickle")>=0,E.forEach(function(O,g){var v=h.splitLines(O),R=h.getKind(O),L=h.isRejected(O)&&h.matchPrefix(O,"a=bundle-only").length===0,N=v[0].substr(2).split(" ")[2],w=h.getDirection(O,y),B=h.parseMsid(O),x=h.getMid(O)||h.generateIdentifier();if(L||R==="application"&&(N==="DTLS/SCTP"||N==="UDP/DTLS/SCTP"))u.transceivers[g]={mid:x,kind:R,protocol:N,rejected:!0};else{var Z,V,Y,te,F,K,J,oe,ae;!L&&u.transceivers[g]&&u.transceivers[g].rejected&&(u.transceivers[g]=u._createTransceiver(R,!0));var ee,se,de=h.parseRtpParameters(O);L||(ee=h.getIceParameters(O,y),(se=h.getDtlsParameters(O,y)).role="client"),J=h.parseRtpEncodingParameters(O);var ge=h.parseRtcpParameters(O),me=h.matchPrefix(O,"a=end-of-candidates",y).length>0,le=h.matchPrefix(O,"a=candidate:").map(function(pe){return h.parseCandidate(pe)}).filter(function(pe){return pe.component===1});if((s.type==="offer"||s.type==="answer")&&!L&&S&&g>0&&u.transceivers[g]&&(u._disposeIceAndDtlsTransports(g),u.transceivers[g].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[g].iceTransport=u.transceivers[0].iceTransport,u.transceivers[g].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[g].rtpSender&&u.transceivers[g].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[g].rtpReceiver&&u.transceivers[g].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),s.type!=="offer"||L)s.type!=="answer"||L||(V=(Z=u.transceivers[g]).iceGatherer,Y=Z.iceTransport,te=Z.dtlsTransport,F=Z.rtpReceiver,K=Z.sendEncodingParameters,oe=Z.localCapabilities,u.transceivers[g].recvEncodingParameters=J,u.transceivers[g].remoteCapabilities=de,u.transceivers[g].rtcpParameters=ge,le.length&&Y.state==="new"&&(!b&&!me||S&&g!==0?le.forEach(function(pe){a(Z.iceTransport,pe)}):Y.setRemoteCandidates(le)),S&&g!==0||(Y.state==="new"&&Y.start(V,ee,"controlling"),te.state==="new"&&te.start(se)),!d(Z.localCapabilities,Z.remoteCapabilities).codecs.filter(function(pe){return pe.name.toLowerCase()==="rtx"}).length&&Z.sendEncodingParameters[0].rtx&&delete Z.sendEncodingParameters[0].rtx,u._transceive(Z,w==="sendrecv"||w==="recvonly",w==="sendrecv"||w==="sendonly"),!F||w!=="sendrecv"&&w!=="sendonly"?delete Z.rtpReceiver:(ae=F.track,B?(p[B.stream]||(p[B.stream]=new o.MediaStream),t(ae,p[B.stream]),f.push([ae,F,p[B.stream]])):(p.default||(p.default=new o.MediaStream),t(ae,p.default),f.push([ae,F,p.default]))));else{(Z=u.transceivers[g]||u._createTransceiver(R)).mid=x,Z.iceGatherer||(Z.iceGatherer=u._createIceGatherer(g,S)),le.length&&Z.iceTransport.state==="new"&&(!me||S&&g!==0?le.forEach(function(pe){a(Z.iceTransport,pe)}):Z.iceTransport.setRemoteCandidates(le)),oe=o.RTCRtpReceiver.getCapabilities(R),n<15019&&(oe.codecs=oe.codecs.filter(function(pe){return pe.name!=="rtx"})),K=Z.sendEncodingParameters||[{ssrc:1001*(2*g+2)}];var Te,Re=!1;w==="sendrecv"||w==="sendonly"?(Re=!Z.rtpReceiver,F=Z.rtpReceiver||new o.RTCRtpReceiver(Z.dtlsTransport,R),Re&&(ae=F.track,B&&B.stream==="-"||(B?(p[B.stream]||(p[B.stream]=new o.MediaStream,Object.defineProperty(p[B.stream],"id",{get:function(){return B.stream}})),Object.defineProperty(ae,"id",{get:function(){return B.track}}),Te=p[B.stream]):(p.default||(p.default=new o.MediaStream),Te=p.default)),Te&&(t(ae,Te),Z.associatedRemoteMediaStreams.push(Te)),f.push([ae,F,Te]))):Z.rtpReceiver&&Z.rtpReceiver.track&&(Z.associatedRemoteMediaStreams.forEach(function(pe){var ke=pe.getTracks().find(function($){return $.id===Z.rtpReceiver.track.id});ke&&function($,Se){Se.removeTrack($),Se.dispatchEvent(new o.MediaStreamTrackEvent("removetrack",{track:$}))}(ke,pe)}),Z.associatedRemoteMediaStreams=[]),Z.localCapabilities=oe,Z.remoteCapabilities=de,Z.rtpReceiver=F,Z.rtcpParameters=ge,Z.sendEncodingParameters=K,Z.recvEncodingParameters=J,u._transceive(u.transceivers[g],!1,Re)}}}),u._dtlsRole===void 0&&(u._dtlsRole=s.type==="offer"?"active":"passive"),u._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(p).forEach(function(O){var g=p[O];if(g.getTracks().length){if(u.remoteStreams.indexOf(g)===-1){u.remoteStreams.push(g);var v=new Event("addstream");v.stream=g,o.setTimeout(function(){u._dispatchEvent("addstream",v)})}f.forEach(function(R){var L=R[0],N=R[1];g.id===R[2].id&&e(u,L,N,[g])})}}),f.forEach(function(O){O[2]||e(u,O[0],O[1],[])}),o.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(O){O.iceTransport&&O.iceTransport.state==="new"&&O.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),O.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(s){this.signalingState=s;var u=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",u)},r.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,o.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var u=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",u)}},0))},r.prototype._updateIceConnectionState=function(){var s,u={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&u[f.iceTransport.state]++}),s="new",u.failed>0?s="failed":u.checking>0?s="checking":u.disconnected>0?s="disconnected":u.new>0?s="new":u.connected>0?s="connected":u.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var p=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",p)}},r.prototype._updateConnectionState=function(){var s,u={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(u[f.iceTransport.state]++,u[f.dtlsTransport.state]++)}),u.connected+=u.completed,s="new",u.failed>0?s="failed":u.connecting>0?s="connecting":u.disconnected>0?s="disconnected":u.new>0?s="new":u.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var p=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",p)}},r.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var u=s.transceivers.filter(function(b){return b.kind==="audio"}).length,p=s.transceivers.filter(function(b){return b.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(u=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(p=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(s.transceivers.forEach(function(b){b.kind==="audio"?--u<0&&(b.wantReceive=!1):b.kind==="video"&&--p<0&&(b.wantReceive=!1)});u>0||p>0;)u>0&&(s._createTransceiver("audio"),u--),p>0&&(s._createTransceiver("video"),p--);var E=h.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(b,S){var k=b.track,O=b.kind,g=b.mid||h.generateIdentifier();b.mid=g,b.iceGatherer||(b.iceGatherer=s._createIceGatherer(S,s.usingBundle));var v=o.RTCRtpSender.getCapabilities(O);n<15019&&(v.codecs=v.codecs.filter(function(L){return L.name!=="rtx"})),v.codecs.forEach(function(L){L.name==="H264"&&L.parameters["level-asymmetry-allowed"]===void 0&&(L.parameters["level-asymmetry-allowed"]="1"),b.remoteCapabilities&&b.remoteCapabilities.codecs&&b.remoteCapabilities.codecs.forEach(function(N){L.name.toLowerCase()===N.name.toLowerCase()&&L.clockRate===N.clockRate&&(L.preferredPayloadType=N.payloadType)})}),v.headerExtensions.forEach(function(L){(b.remoteCapabilities&&b.remoteCapabilities.headerExtensions||[]).forEach(function(N){L.uri===N.uri&&(L.id=N.id)})});var R=b.sendEncodingParameters||[{ssrc:1001*(2*S+1)}];k&&n>=15019&&O==="video"&&!R[0].rtx&&(R[0].rtx={ssrc:R[0].ssrc+1}),b.wantReceive&&(b.rtpReceiver=new o.RTCRtpReceiver(b.dtlsTransport,O)),b.localCapabilities=v,b.sendEncodingParameters=R}),s._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+s.transceivers.map(function(b){return b.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(b,S){E+=_(b,b.localCapabilities,"offer",b.stream,s._dtlsRole),E+=`a=rtcp-rsize\r
`,!b.iceGatherer||s.iceGatheringState==="new"||S!==0&&s.usingBundle||(b.iceGatherer.getLocalCandidates().forEach(function(k){k.component=1,E+="a="+h.writeCandidate(k)+`\r
`}),b.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))});var y=new o.RTCSessionDescription({type:"offer",sdp:E});return Promise.resolve(y)},r.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if(s.signalingState!=="have-remote-offer"&&s.signalingState!=="have-local-pranswer")return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var u=h.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(u+="a=group:BUNDLE "+s.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`;var p=h.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(E,y){if(!(y+1>p)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?u+=`m=application 0 DTLS/SCTP 5000\r
`:u+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?u+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(u+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(u+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var b;E.stream&&(E.kind==="audio"?b=E.stream.getAudioTracks()[0]:E.kind==="video"&&(b=E.stream.getVideoTracks()[0]),b&&n>=15019&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1}));var S=d(E.localCapabilities,E.remoteCapabilities);!S.codecs.filter(function(k){return k.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,u+=_(E,S,"answer",E.stream,s._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(u+=`a=rtcp-rsize\r
`)}});var f=new o.RTCSessionDescription({type:"answer",sdp:u});return Promise.resolve(f)},r.prototype.addIceCandidate=function(s){var u,p=this;return s&&s.sdpMLineIndex===void 0&&!s.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,E){if(!p._remoteDescription)return E(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(s&&s.candidate!==""){var y=s.sdpMLineIndex;if(s.sdpMid){for(var b=0;b<p.transceivers.length;b++)if(p.transceivers[b].mid===s.sdpMid){y=b;break}}var S=p.transceivers[y];if(!S)return E(c("OperationError","Can not add ICE candidate"));if(S.rejected)return f();var k=Object.keys(s.candidate).length>0?h.parseCandidate(s.candidate):{};if(k.protocol==="tcp"&&(k.port===0||k.port===9)||k.component&&k.component!==1)return f();if((y===0||y>0&&S.iceTransport!==p.transceivers[0].iceTransport)&&!a(S.iceTransport,k))return E(c("OperationError","Can not add ICE candidate"));var O=s.candidate.trim();O.indexOf("a=")===0&&(O=O.substr(2)),(u=h.getMediaSections(p._remoteDescription.sdp))[y]+="a="+(k.type?O:"end-of-candidates")+`\r
`,p._remoteDescription.sdp=h.getDescription(p._remoteDescription.sdp)+u.join("")}else for(var g=0;g<p.transceivers.length&&(p.transceivers[g].rejected||(p.transceivers[g].iceTransport.addRemoteCandidate({}),(u=h.getMediaSections(p._remoteDescription.sdp))[g]+=`a=end-of-candidates\r
`,p._remoteDescription.sdp=h.getDescription(p._remoteDescription.sdp)+u.join(""),!p.usingBundle));g++);f()})},r.prototype.getStats=function(s){if(s&&s instanceof o.MediaStreamTrack){var u=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===s?u=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===s&&(u=f.rtpReceiver)}),!u)throw c("InvalidAccessError","Invalid selector.");return u.getStats()}var p=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){f[E]&&p.push(f[E].getStats())})}),Promise.all(p).then(function(f){var E=new Map;return f.forEach(function(y){y.forEach(function(b){E.set(b.id,b)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(s){var u=o[s];if(u&&u.prototype&&u.prototype.getStats){var p=u.prototype.getStats;u.prototype.getStats=function(){return p.apply(this).then(function(f){var E=new Map;return Object.keys(f).forEach(function(y){var b;f[y].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(b=f[y]).type]||b.type,E.set(y,f[y])}),E})}}});var i=["createOffer","createAnswer"];return i.forEach(function(s){var u=r.prototype[s];r.prototype[s]=function(){var p=arguments;return typeof p[0]=="function"||typeof p[1]=="function"?u.apply(this,[arguments[2]]).then(function(f){typeof p[0]=="function"&&p[0].apply(null,[f])},function(f){typeof p[1]=="function"&&p[1].apply(null,[f])}):u.apply(this,arguments)}}),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(s){var u=r.prototype[s];r.prototype[s]=function(){var p=arguments;return typeof p[1]=="function"||typeof p[2]=="function"?u.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)},function(f){typeof p[2]=="function"&&p[2].apply(null,[f])}):u.apply(this,arguments)}}),["getStats"].forEach(function(s){var u=r.prototype[s];r.prototype[s]=function(){var p=arguments;return typeof p[1]=="function"?u.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)}):u.apply(this,arguments)}}),r}},{sdp:17}],17:[function(T,I,m){"use strict";var h={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};h.localCName=h.generateIdentifier(),h.splitLines=function(_){return _.trim().split(`
`).map(function(d){return d.trim()})},h.splitSections=function(_){return _.split(`
m=`).map(function(d,l){return(l>0?"m="+d:d).trim()+`\r
`})},h.getDescription=function(_){var d=h.splitSections(_);return d&&d[0]},h.getMediaSections=function(_){var d=h.splitSections(_);return d.shift(),d},h.matchPrefix=function(_,d){return h.splitLines(_).filter(function(l){return l.indexOf(d)===0})},h.parseCandidate=function(_){for(var d,l={foundation:(d=_.indexOf("a=candidate:")===0?_.substring(12).split(" "):_.substring(10).split(" "))[0],component:parseInt(d[1],10),protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]},a=8;a<d.length;a+=2)switch(d[a]){case"raddr":l.relatedAddress=d[a+1];break;case"rport":l.relatedPort=parseInt(d[a+1],10);break;case"tcptype":l.tcpType=d[a+1];break;case"ufrag":l.ufrag=d[a+1],l.usernameFragment=d[a+1];break;default:l[d[a]]=d[a+1]}return l},h.writeCandidate=function(_){var d=[];d.push(_.foundation),d.push(_.component),d.push(_.protocol.toUpperCase()),d.push(_.priority),d.push(_.address||_.ip),d.push(_.port);var l=_.type;return d.push("typ"),d.push(l),l!=="host"&&_.relatedAddress&&_.relatedPort&&(d.push("raddr"),d.push(_.relatedAddress),d.push("rport"),d.push(_.relatedPort)),_.tcpType&&_.protocol.toLowerCase()==="tcp"&&(d.push("tcptype"),d.push(_.tcpType)),(_.usernameFragment||_.ufrag)&&(d.push("ufrag"),d.push(_.usernameFragment||_.ufrag)),"candidate:"+d.join(" ")},h.parseIceOptions=function(_){return _.substr(14).split(" ")},h.parseRtpMap=function(_){var d=_.substr(9).split(" "),l={payloadType:parseInt(d.shift(),10)};return d=d[0].split("/"),l.name=d[0],l.clockRate=parseInt(d[1],10),l.channels=d.length===3?parseInt(d[2],10):1,l.numChannels=l.channels,l},h.writeRtpMap=function(_){var d=_.payloadType;_.preferredPayloadType!==void 0&&(d=_.preferredPayloadType);var l=_.channels||_.numChannels||1;return"a=rtpmap:"+d+" "+_.name+"/"+_.clockRate+(l!==1?"/"+l:"")+`\r
`},h.parseExtmap=function(_){var d=_.substr(9).split(" ");return{id:parseInt(d[0],10),direction:d[0].indexOf("/")>0?d[0].split("/")[1]:"sendrecv",uri:d[1]}},h.writeExtmap=function(_){return"a=extmap:"+(_.id||_.preferredId)+(_.direction&&_.direction!=="sendrecv"?"/"+_.direction:"")+" "+_.uri+`\r
`},h.parseFmtp=function(_){for(var d,l={},a=_.substr(_.indexOf(" ")+1).split(";"),c=0;c<a.length;c++)l[(d=a[c].trim().split("="))[0].trim()]=d[1];return l},h.writeFmtp=function(_){var d="",l=_.payloadType;if(_.preferredPayloadType!==void 0&&(l=_.preferredPayloadType),_.parameters&&Object.keys(_.parameters).length){var a=[];Object.keys(_.parameters).forEach(function(c){_.parameters[c]?a.push(c+"="+_.parameters[c]):a.push(c)}),d+="a=fmtp:"+l+" "+a.join(";")+`\r
`}return d},h.parseRtcpFb=function(_){var d=_.substr(_.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}},h.writeRtcpFb=function(_){var d="",l=_.payloadType;return _.preferredPayloadType!==void 0&&(l=_.preferredPayloadType),_.rtcpFeedback&&_.rtcpFeedback.length&&_.rtcpFeedback.forEach(function(a){d+="a=rtcp-fb:"+l+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),d},h.parseSsrcMedia=function(_){var d=_.indexOf(" "),l={ssrc:parseInt(_.substr(7,d-7),10)},a=_.indexOf(":",d);return a>-1?(l.attribute=_.substr(d+1,a-d-1),l.value=_.substr(a+1)):l.attribute=_.substr(d+1),l},h.parseSsrcGroup=function(_){var d=_.substr(13).split(" ");return{semantics:d.shift(),ssrcs:d.map(function(l){return parseInt(l,10)})}},h.getMid=function(_){var d=h.matchPrefix(_,"a=mid:")[0];if(d)return d.substr(6)},h.parseFingerprint=function(_){var d=_.substr(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1]}},h.getDtlsParameters=function(_,d){return{role:"auto",fingerprints:h.matchPrefix(_+d,"a=fingerprint:").map(h.parseFingerprint)}},h.writeDtlsParameters=function(_,d){var l="a=setup:"+d+`\r
`;return _.fingerprints.forEach(function(a){l+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),l},h.getIceParameters=function(_,d){var l=h.splitLines(_);return{usernameFragment:(l=l.concat(h.splitLines(d))).filter(function(a){return a.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:l.filter(function(a){return a.indexOf("a=ice-pwd:")===0})[0].substr(10)}},h.writeIceParameters=function(_){return"a=ice-ufrag:"+_.usernameFragment+`\r
a=ice-pwd:`+_.password+`\r
`},h.parseRtpParameters=function(_){for(var d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=h.splitLines(_)[0].split(" "),a=3;a<l.length;a++){var c=l[a],o=h.matchPrefix(_,"a=rtpmap:"+c+" ")[0];if(o){var n=h.parseRtpMap(o),t=h.matchPrefix(_,"a=fmtp:"+c+" ");switch(n.parameters=t.length?h.parseFmtp(t[0]):{},n.rtcpFeedback=h.matchPrefix(_,"a=rtcp-fb:"+c+" ").map(h.parseRtcpFb),d.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(n.name.toUpperCase())}}}return h.matchPrefix(_,"a=extmap:").forEach(function(e){d.headerExtensions.push(h.parseExtmap(e))}),d},h.writeRtpDescription=function(_,d){var l="";l+="m="+_+" ",l+=d.codecs.length>0?"9":"0",l+=" UDP/TLS/RTP/SAVPF ",l+=d.codecs.map(function(c){return c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType}).join(" ")+`\r
`,l+=`c=IN IP4 0.0.0.0\r
`,l+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,d.codecs.forEach(function(c){l+=h.writeRtpMap(c),l+=h.writeFmtp(c),l+=h.writeRtcpFb(c)});var a=0;return d.codecs.forEach(function(c){c.maxptime>a&&(a=c.maxptime)}),a>0&&(l+="a=maxptime:"+a+`\r
`),l+=`a=rtcp-mux\r
`,d.headerExtensions&&d.headerExtensions.forEach(function(c){l+=h.writeExtmap(c)}),l},h.parseRtpEncodingParameters=function(_){var d,l=[],a=h.parseRtpParameters(_),c=a.fecMechanisms.indexOf("RED")!==-1,o=a.fecMechanisms.indexOf("ULPFEC")!==-1,n=h.matchPrefix(_,"a=ssrc:").map(function(i){return h.parseSsrcMedia(i)}).filter(function(i){return i.attribute==="cname"}),t=n.length>0&&n[0].ssrc,e=h.matchPrefix(_,"a=ssrc-group:FID").map(function(i){return i.substr(17).split(" ").map(function(s){return parseInt(s,10)})});e.length>0&&e[0].length>1&&e[0][0]===t&&(d=e[0][1]),a.codecs.forEach(function(i){if(i.name.toUpperCase()==="RTX"&&i.parameters.apt){var s={ssrc:t,codecPayloadType:parseInt(i.parameters.apt,10)};t&&d&&(s.rtx={ssrc:d}),l.push(s),c&&((s=JSON.parse(JSON.stringify(s))).fec={ssrc:t,mechanism:o?"red+ulpfec":"red"},l.push(s))}}),l.length===0&&t&&l.push({ssrc:t});var r=h.matchPrefix(_,"b=");return r.length&&(r=r[0].indexOf("b=TIAS:")===0?parseInt(r[0].substr(7),10):r[0].indexOf("b=AS:")===0?1e3*parseInt(r[0].substr(5),10)*.95-16e3:void 0,l.forEach(function(i){i.maxBitrate=r})),l},h.parseRtcpParameters=function(_){var d={},l=h.matchPrefix(_,"a=ssrc:").map(function(o){return h.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="cname"})[0];l&&(d.cname=l.value,d.ssrc=l.ssrc);var a=h.matchPrefix(_,"a=rtcp-rsize");d.reducedSize=a.length>0,d.compound=a.length===0;var c=h.matchPrefix(_,"a=rtcp-mux");return d.mux=c.length>0,d},h.parseMsid=function(_){var d,l=h.matchPrefix(_,"a=msid:");if(l.length===1)return{stream:(d=l[0].substr(7).split(" "))[0],track:d[1]};var a=h.matchPrefix(_,"a=ssrc:").map(function(c){return h.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="msid"});return a.length>0?{stream:(d=a[0].value.split(" "))[0],track:d[1]}:void 0},h.generateSessionId=function(){return Math.random().toString().substr(2,21)},h.writeSessionBoilerplate=function(_,d,l){var a=d!==void 0?d:2;return`v=0\r
o=`+(l||"thisisadapterortc")+" "+(_||h.generateSessionId())+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},h.writeMediaSection=function(_,d,l,a){var c=h.writeRtpDescription(_.kind,d);if(c+=h.writeIceParameters(_.iceGatherer.getLocalParameters()),c+=h.writeDtlsParameters(_.dtlsTransport.getLocalParameters(),l==="offer"?"actpass":"active"),c+="a=mid:"+_.mid+`\r
`,_.direction?c+="a="+_.direction+`\r
`:_.rtpSender&&_.rtpReceiver?c+=`a=sendrecv\r
`:_.rtpSender?c+=`a=sendonly\r
`:_.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,_.rtpSender){var o="msid:"+a.id+" "+_.rtpSender.track.id+`\r
`;c+="a="+o,c+="a=ssrc:"+_.sendEncodingParameters[0].ssrc+" "+o,_.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+_.sendEncodingParameters[0].rtx.ssrc+" "+o,c+="a=ssrc-group:FID "+_.sendEncodingParameters[0].ssrc+" "+_.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return c+="a=ssrc:"+_.sendEncodingParameters[0].ssrc+" cname:"+h.localCName+`\r
`,_.rtpSender&&_.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+_.sendEncodingParameters[0].rtx.ssrc+" cname:"+h.localCName+`\r
`),c},h.getDirection=function(_,d){for(var l=h.splitLines(_),a=0;a<l.length;a++)switch(l[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[a].substr(2)}return d?h.getDirection(d):"sendrecv"},h.getKind=function(_){return h.splitLines(_)[0].split(" ")[0].substr(2)},h.isRejected=function(_){return _.split(" ",2)[1]==="0"},h.parseMLine=function(_){var d=h.splitLines(_)[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},h.parseOLine=function(_){var d=h.matchPrefix(_,"o=")[0].substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},h.isValidSDP=function(_){if(typeof _!="string"||_.length===0)return!1;for(var d=h.splitLines(_),l=0;l<d.length;l++)if(d[l].length<2||d[l].charAt(1)!=="=")return!1;return!0},typeof I=="object"&&(I.exports=h)},{}]},{},[1])(1)},9869:function(W){W.exports=function(T){var I={};function m(h){if(I[h])return I[h].exports;var _=I[h]={i:h,l:!1,exports:{}};return T[h].call(_.exports,_,_.exports,m),_.l=!0,_.exports}return m.m=T,m.c=I,m.d=function(h,_,d){m.o(h,_)||Object.defineProperty(h,_,{enumerable:!0,get:d})},m.r=function(h){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},m.t=function(h,_){if(1&_&&(h=m(h)),8&_||4&_&&typeof h=="object"&&h&&h.__esModule)return h;var d=Object.create(null);if(m.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:h}),2&_&&typeof h!="string")for(var l in h)m.d(d,l,function(a){return h[a]}.bind(null,l));return d},m.n=function(h){var _=h&&h.__esModule?function(){return h.default}:function(){return h};return m.d(_,"a",_),_},m.o=function(h,_){return Object.prototype.hasOwnProperty.call(h,_)},m.p="",m(m.s=99)}({100:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.modulePros=I.servicePros=I.rtmPros=void 0;var h=m(38),_=m(39),d=m(101);I.rtmPros={requestJoinLive:function(l,a,c,o,n){var t=this.getRoomModules(n)||this.stateCenter.roomModulesList[0];return t?t.liveHandler.requestJoinLive(l,a,c,o):(c&&c(_.errorCodeList.ROOM_NOT_EXIST,0),!1)},inviteJoinLive:function(l,a,c,o,n){var t=this.getRoomModules(n)||this.stateCenter.roomModulesList[0];return t?t.liveHandler.inviteJoinLive(l,a,c,o):(c&&c(_.errorCodeList.ROOM_NOT_EXIST,0),!1)},endJoinLive:function(l,a,c,o){var n=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return n?n.liveHandler.endJoinLive(l,a,c):(c&&c(_.errorCodeList.ROOM_NOT_EXIST,0),!1)},respondJoinLive:function(l,a,c,o,n){var t=this.getRoomModules(n)||this.stateCenter.roomModulesList[0];return t?t.liveHandler.respondJoinLive(l,a,c,o):(o&&o(_.errorCodeList.ROOM_NOT_EXIST,0),!1)}},I.servicePros={handlePushSignalMsg:function(l){var a,c=(a=l==null?void 0:l.header)===null||a===void 0?void 0:a.room_id,o=this.stateCenter.roomModulesList.find(function(n){return n.roomID==c});o?o.liveHandler.handlePushSignalMsg(l):this.logger.error(h.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(l))}},I.modulePros={initLiveHandler:function(){this.liveHandler=new d.LiveHandler(this.logger,this.stateCenter,this.service,this.liveRoomHandler,this.rtm,this)}}},101:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.LiveHandler=void 0;var h=m(102),_=m(38),d=m(39),l=function(){function a(c,o,n,t,e,r){this.logger=c,this.stateCenter=o,this.service=n,this.liveRoomHandler=t,this.rtm=e,this.room=r,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return a.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},a.prototype.getSignalCmdContent=function(c,o,n){var t={request_id:c,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:o};return n!=null&&(t.result=n),JSON.stringify(t)},a.prototype.requestJoinLive=function(c,o,n,t){var e=this.stateCenter.getRequestId(),r=this.getSignalCmdContent(e,c);return t!=null&&(this.joinLiveCallbackMap[e]=t,this.sendSignalCmd(h.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,r,c,o,n),!0)},a.prototype.sendSignalCmd=function(c,o,n,t,e){var r=this;if(this.room.isLogin()){var i={sub_cmd:c,signal_msg:o,dest_id_name:[n]};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendSignalCmd(i,function(s){t&&t(s.header.seq)},function(s){var u=d.errorCodeList.ROOM_INNER_ERROR;if(!s.header||!s.body)return s.code&&s.msg&&(u=s),void(e&&e(u,0));e&&e(r.rtm.getServerError(s.body.err_code),s.header.seq)},this.room),this.logger.info(_.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+c)}else this.logger.error(_.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},a.prototype.inviteJoinLive=function(c,o,n,t){var e=this.stateCenter.getRequestId(),r=this.getSignalCmdContent(e,c);return t!=null&&(this.joinLiveCallbackMap[e]=t,this.sendSignalCmd(h.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,r,c,o,n),!0)},a.prototype.endJoinLive=function(c,o,n){var t=this.stateCenter.getRequestId(),e=this.getSignalCmdContent(t,c);return this.sendSignalCmd(h.ENUM_SIGNAL_SUB_CMD.joinLiveStop,e,c,o,n),!0},a.prototype.respondJoinLive=function(c,o,n,t){var e=this.joinLiveRequestMap[c];if(!e)return this.logger.info(_.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var r=0;o===!0&&(r=1);var i=this.getSignalCmdContent(c,e,r);return this.sendSignalCmd(h.ENUM_SIGNAL_SUB_CMD.joinLiveResult,i,e,n,t),delete this.joinLiveRequestMap[c],!0},a.prototype.handlePushSignalMsg=function(c){var o=JSON.parse(c.body.signal_msg);switch(this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",o),c.body.sub_cmd){case h.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(o);break;case h.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(o);break;case h.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(o);break;case h.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(o)}},a.prototype.handlePushJoinLiveRequestMsg=function(c){var o=c.request_id;if(typeof o=="string"){var n=c.from_userid;typeof n=="string"?(this.joinLiveRequestMap[o]=n,this.onRecvJoinLiveRequest(o,c.from_userid,c.from_username,c.room_id),this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+n)):this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},a.prototype.onRecvJoinLiveRequest=function(c,o,n,t){this.stateCenter.actionListener("recvJoinLiveRequest",c,o,n,t)},a.prototype.handlePushJoinLiveInviteMsg=function(c){var o=c.request_id;if(typeof o=="string"){var n=c.from_userid;typeof n=="string"?(this.joinLiveRequestMap[o]=n,this.onRecvInviteJoinLiveRequest(o,c.from_userid,c.from_username,c.room_id),this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+n)):this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},a.prototype.onRecvInviteJoinLiveRequest=function(c,o,n,t){this.stateCenter.actionListener("recvInviteJoinLiveRequest",c,o,n,t)},a.prototype.handlePushJoinLiveResultMsg=function(c){var o=c.request_id;if(typeof o=="string"){var n=c.result;if(n!=null){var t=n==1;if(this.joinLiveCallbackMap[o]){var e=this.joinLiveCallbackMap[o];if(!e)return void this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+t),delete this.joinLiveCallbackMap[o],e(t,c.from_userid,c.from_username)}}else this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},a.prototype.handlePushJoinLiveStopMsg=function(c){var o=c.request_id;typeof o=="string"?(this.logger.info(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+c.from_userid),this.onRecvEndJoinLiveCommand(o,c.from_userid,c.from_username,c.room_id)):this.logger.error(_.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},a.prototype.onRecvEndJoinLiveCommand=function(c,o,n,t){this.stateCenter.actionListener("recvEndJoinLiveCommand",c,o,n,t)},a}();I.LiveHandler=l},102:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ENUM_PUSH_SIGNAL_SUB_CMD=I.ENUM_SIGNAL_SUB_CMD=void 0,I.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},I.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004}},38:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ZEGO_RTM_ACTION=void 0,function(h){h.LIVE_SEND_SIGNAL="zm.lv.ssg",h.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",h.LIVE_PUSH_SIGNAL="zm.lv.pss",h.SERVICE_PUSH="zm.sv.ps",h.SERVICE_SEND="zm.sv.sd"}(I.ZEGO_RTM_ACTION||(I.ZEGO_RTM_ACTION={}))},39:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.errorCodeList=void 0,I.errorCodeList={ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"}}},99:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0});var h=m(100);I.default={type:"live",install:function(_,d,l,a){for(var c in h.rtmPros)Object.defineProperty(_.prototype,c,{value:h.rtmPros[c],writable:!1});for(var c in h.servicePros)Object.defineProperty(l.prototype,c,{value:h.servicePros[c],writable:!1}),Object.defineProperty(a.prototype,c,{value:h.servicePros[c],writable:!1});for(var c in h.modulePros)Object.defineProperty(d.prototype,c,{value:h.modulePros[c],writable:!1})}}}})},3126:function(W){W.exports=function(T){var I={};function m(h){if(I[h])return I[h].exports;var _=I[h]={i:h,l:!1,exports:{}};return T[h].call(_.exports,_,_.exports,m),_.l=!0,_.exports}return m.m=T,m.c=I,m.d=function(h,_,d){m.o(h,_)||Object.defineProperty(h,_,{enumerable:!0,get:d})},m.r=function(h){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},m.t=function(h,_){if(1&_&&(h=m(h)),8&_||4&_&&typeof h=="object"&&h&&h.__esModule)return h;var d=Object.create(null);if(m.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:h}),2&_&&typeof h!="string")for(var l in h)m.d(d,l,function(a){return h[a]}.bind(null,l));return d},m.n=function(h){var _=h&&h.__esModule?function(){return h.default}:function(){return h};return m.d(_,"a",_),_},m.o=function(h,_){return Object.prototype.hasOwnProperty.call(h,_)},m.p="",m(m.s=96)}({12:function(T,I){T.exports=h;var m=null;try{m=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(v){}function h(v,R,L){this.low=0|v,this.high=0|R,this.unsigned=!!L}function _(v){return(v&&v.__isLong__)===!0}h.prototype.__isLong__,Object.defineProperty(h.prototype,"__isLong__",{value:!0}),h.isLong=_;var d={},l={};function a(v,R){var L,N,w;return R?(w=0<=(v>>>=0)&&v<256)&&(N=l[v])?N:(L=o(v,(0|v)<0?-1:0,!0),w&&(l[v]=L),L):(w=-128<=(v|=0)&&v<128)&&(N=d[v])?N:(L=o(v,v<0?-1:0,!1),w&&(d[v]=L),L)}function c(v,R){if(isNaN(v))return R?f:p;if(R){if(v<0)return f;if(v>=i)return k}else{if(v<=-s)return O;if(v+1>=s)return S}return v<0?c(-v,R).neg():o(v%r|0,v/r|0,R)}function o(v,R,L){return new h(v,R,L)}h.fromInt=a,h.fromNumber=c,h.fromBits=o;var n=Math.pow;function t(v,R,L){if(v.length===0)throw Error("empty string");if(v==="NaN"||v==="Infinity"||v==="+Infinity"||v==="-Infinity")return p;if(typeof R=="number"?(L=R,R=!1):R=!!R,(L=L||10)<2||36<L)throw RangeError("radix");var N;if((N=v.indexOf("-"))>0)throw Error("interior hyphen");if(N===0)return t(v.substring(1),R,L).neg();for(var w=c(n(L,8)),B=p,x=0;x<v.length;x+=8){var Z=Math.min(8,v.length-x),V=parseInt(v.substring(x,x+Z),L);if(Z<8){var Y=c(n(L,Z));B=B.mul(Y).add(c(V))}else B=(B=B.mul(w)).add(c(V))}return B.unsigned=R,B}function e(v,R){return typeof v=="number"?c(v,R):typeof v=="string"?t(v,R):o(v.low,v.high,typeof R=="boolean"?R:v.unsigned)}h.fromString=t,h.fromValue=e;var r=4294967296,i=r*r,s=i/2,u=a(1<<24),p=a(0);h.ZERO=p;var f=a(0,!0);h.UZERO=f;var E=a(1);h.ONE=E;var y=a(1,!0);h.UONE=y;var b=a(-1);h.NEG_ONE=b;var S=o(-1,2147483647,!1);h.MAX_VALUE=S;var k=o(-1,-1,!0);h.MAX_UNSIGNED_VALUE=k;var O=o(0,-2147483648,!1);h.MIN_VALUE=O;var g=h.prototype;g.toInt=function(){return this.unsigned?this.low>>>0:this.low},g.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},g.toString=function(v){if((v=v||10)<2||36<v)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(O)){var R=c(v),L=this.div(R),N=L.mul(R).sub(this);return L.toString(v)+N.toInt().toString(v)}return"-"+this.neg().toString(v)}for(var w=c(n(v,6),this.unsigned),B=this,x="";;){var Z=B.div(w),V=(B.sub(Z.mul(w)).toInt()>>>0).toString(v);if((B=Z).isZero())return V+x;for(;V.length<6;)V="0"+V;x=""+V+x}},g.getHighBits=function(){return this.high},g.getHighBitsUnsigned=function(){return this.high>>>0},g.getLowBits=function(){return this.low},g.getLowBitsUnsigned=function(){return this.low>>>0},g.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var v=this.high!=0?this.high:this.low,R=31;R>0&&(v&1<<R)==0;R--);return this.high!=0?R+33:R+1},g.isZero=function(){return this.high===0&&this.low===0},g.eqz=g.isZero,g.isNegative=function(){return!this.unsigned&&this.high<0},g.isPositive=function(){return this.unsigned||this.high>=0},g.isOdd=function(){return(1&this.low)==1},g.isEven=function(){return(1&this.low)==0},g.equals=function(v){return _(v)||(v=e(v)),(this.unsigned===v.unsigned||this.high>>>31!=1||v.high>>>31!=1)&&this.high===v.high&&this.low===v.low},g.eq=g.equals,g.notEquals=function(v){return!this.eq(v)},g.neq=g.notEquals,g.ne=g.notEquals,g.lessThan=function(v){return this.comp(v)<0},g.lt=g.lessThan,g.lessThanOrEqual=function(v){return this.comp(v)<=0},g.lte=g.lessThanOrEqual,g.le=g.lessThanOrEqual,g.greaterThan=function(v){return this.comp(v)>0},g.gt=g.greaterThan,g.greaterThanOrEqual=function(v){return this.comp(v)>=0},g.gte=g.greaterThanOrEqual,g.ge=g.greaterThanOrEqual,g.compare=function(v){if(_(v)||(v=e(v)),this.eq(v))return 0;var R=this.isNegative(),L=v.isNegative();return R&&!L?-1:!R&&L?1:this.unsigned?v.high>>>0>this.high>>>0||v.high===this.high&&v.low>>>0>this.low>>>0?-1:1:this.sub(v).isNegative()?-1:1},g.comp=g.compare,g.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(E)},g.neg=g.negate,g.add=function(v){_(v)||(v=e(v));var R=this.high>>>16,L=65535&this.high,N=this.low>>>16,w=65535&this.low,B=v.high>>>16,x=65535&v.high,Z=v.low>>>16,V=0,Y=0,te=0,F=0;return te+=(F+=w+(65535&v.low))>>>16,Y+=(te+=N+Z)>>>16,V+=(Y+=L+x)>>>16,V+=R+B,o((te&=65535)<<16|(F&=65535),(V&=65535)<<16|(Y&=65535),this.unsigned)},g.subtract=function(v){return _(v)||(v=e(v)),this.add(v.neg())},g.sub=g.subtract,g.multiply=function(v){if(this.isZero())return p;if(_(v)||(v=e(v)),m)return o(m.mul(this.low,this.high,v.low,v.high),m.get_high(),this.unsigned);if(v.isZero())return p;if(this.eq(O))return v.isOdd()?O:p;if(v.eq(O))return this.isOdd()?O:p;if(this.isNegative())return v.isNegative()?this.neg().mul(v.neg()):this.neg().mul(v).neg();if(v.isNegative())return this.mul(v.neg()).neg();if(this.lt(u)&&v.lt(u))return c(this.toNumber()*v.toNumber(),this.unsigned);var R=this.high>>>16,L=65535&this.high,N=this.low>>>16,w=65535&this.low,B=v.high>>>16,x=65535&v.high,Z=v.low>>>16,V=65535&v.low,Y=0,te=0,F=0,K=0;return F+=(K+=w*V)>>>16,te+=(F+=N*V)>>>16,F&=65535,te+=(F+=w*Z)>>>16,Y+=(te+=L*V)>>>16,te&=65535,Y+=(te+=N*Z)>>>16,te&=65535,Y+=(te+=w*x)>>>16,Y+=R*V+L*Z+N*x+w*B,o((F&=65535)<<16|(K&=65535),(Y&=65535)<<16|(te&=65535),this.unsigned)},g.mul=g.multiply,g.divide=function(v){if(_(v)||(v=e(v)),v.isZero())throw Error("division by zero");var R,L,N;if(m)return this.unsigned||this.high!==-2147483648||v.low!==-1||v.high!==-1?o((this.unsigned?m.div_u:m.div_s)(this.low,this.high,v.low,v.high),m.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?f:p;if(this.unsigned){if(v.unsigned||(v=v.toUnsigned()),v.gt(this))return f;if(v.gt(this.shru(1)))return y;N=f}else{if(this.eq(O))return v.eq(E)||v.eq(b)?O:v.eq(O)?E:(R=this.shr(1).div(v).shl(1)).eq(p)?v.isNegative()?E:b:(L=this.sub(v.mul(R)),N=R.add(L.div(v)));if(v.eq(O))return this.unsigned?f:p;if(this.isNegative())return v.isNegative()?this.neg().div(v.neg()):this.neg().div(v).neg();if(v.isNegative())return this.div(v.neg()).neg();N=p}for(L=this;L.gte(v);){R=Math.max(1,Math.floor(L.toNumber()/v.toNumber()));for(var w=Math.ceil(Math.log(R)/Math.LN2),B=w<=48?1:n(2,w-48),x=c(R),Z=x.mul(v);Z.isNegative()||Z.gt(L);)Z=(x=c(R-=B,this.unsigned)).mul(v);x.isZero()&&(x=E),N=N.add(x),L=L.sub(Z)}return N},g.div=g.divide,g.modulo=function(v){return _(v)||(v=e(v)),m?o((this.unsigned?m.rem_u:m.rem_s)(this.low,this.high,v.low,v.high),m.get_high(),this.unsigned):this.sub(this.div(v).mul(v))},g.mod=g.modulo,g.rem=g.modulo,g.not=function(){return o(~this.low,~this.high,this.unsigned)},g.and=function(v){return _(v)||(v=e(v)),o(this.low&v.low,this.high&v.high,this.unsigned)},g.or=function(v){return _(v)||(v=e(v)),o(this.low|v.low,this.high|v.high,this.unsigned)},g.xor=function(v){return _(v)||(v=e(v)),o(this.low^v.low,this.high^v.high,this.unsigned)},g.shiftLeft=function(v){return _(v)&&(v=v.toInt()),(v&=63)==0?this:v<32?o(this.low<<v,this.high<<v|this.low>>>32-v,this.unsigned):o(0,this.low<<v-32,this.unsigned)},g.shl=g.shiftLeft,g.shiftRight=function(v){return _(v)&&(v=v.toInt()),(v&=63)==0?this:v<32?o(this.low>>>v|this.high<<32-v,this.high>>v,this.unsigned):o(this.high>>v-32,this.high>=0?0:-1,this.unsigned)},g.shr=g.shiftRight,g.shiftRightUnsigned=function(v){if(_(v)&&(v=v.toInt()),(v&=63)==0)return this;var R=this.high;return v<32?o(this.low>>>v|R<<32-v,R>>>v,this.unsigned):o(v===32?R:R>>>v-32,0,this.unsigned)},g.shru=g.shiftRightUnsigned,g.shr_u=g.shiftRightUnsigned,g.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},g.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},g.toBytes=function(v){return v?this.toBytesLE():this.toBytesBE()},g.toBytesLE=function(){var v=this.high,R=this.low;return[255&R,R>>>8&255,R>>>16&255,R>>>24,255&v,v>>>8&255,v>>>16&255,v>>>24]},g.toBytesBE=function(){var v=this.high,R=this.low;return[v>>>24,v>>>16&255,v>>>8&255,255&v,R>>>24,R>>>16&255,R>>>8&255,255&R]},h.fromBytes=function(v,R,L){return L?h.fromBytesLE(v,R):h.fromBytesBE(v,R)},h.fromBytesLE=function(v,R){return new h(v[0]|v[1]<<8|v[2]<<16|v[3]<<24,v[4]|v[5]<<8|v[6]<<16|v[7]<<24,R)},h.fromBytesBE=function(v,R){return new h(v[4]<<24|v[5]<<16|v[6]<<8|v[7],v[0]<<24|v[1]<<16|v[2]<<8|v[3],R)}},19:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.errorCodeList=void 0,I.errorCodeList={INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}},35:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ZEGO_RTM_ACTION=void 0,function(h){h.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",h.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",h.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",h.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",h.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",h.MESSAGE_SEND_RELIABLE="zm.msg.sdr",h.MESSAGE_FETCH_RELIABLE="zm.msg.frm",h.MESSAGE_RELIABLE_RSP="zm.msg.rlr",h.MESSAGE_RELIABLE_PUSH="zm.msg.rps",h.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",h.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",h.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",h.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",h.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",h.SERVICE_PUSH="zm.sv.ps"}(I.ZEGO_RTM_ACTION||(I.ZEGO_RTM_ACTION={}))},36:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ZegoRTMLogEvent=void 0;var h=m(19),_=function(d){return d};I.ZegoRTMLogEvent={kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:_,error:{INPUT_PARAM:h.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:h.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:h.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:h.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:_,error:{INPUT_PARAM:h.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:h.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:h.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:h.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:_,error:{INPUT_PARAM:h.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:h.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:h.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:h.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:_,error:{INPUT_PARAM:h.errorCodeList.INPUT_PARAM,TRANS_FREQUENTLY:h.errorCodeList.TRANS_FREQUENTLY,ROOM_NOT_EXIST:h.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:_},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"}}},37:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.MAX_MESSAGE_LENGTH=I.MAX_TRANS_DATA_LENGTH=I.MAX_TRANS_TYPE_LENGTH=I.ERROR_CODES=void 0,I.ERROR_CODES={FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},I.MAX_TRANS_TYPE_LENGTH=128,I.MAX_TRANS_DATA_LENGTH=4096,I.MAX_MESSAGE_LENGTH=1024},96:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0});var h=m(97);I.default={type:"message",install:function(_,d,l,a,c,o){for(var n in h.rtmPros)Object.defineProperty(_.prototype,n,{value:h.rtmPros[n],writable:!1});for(var n in h.servicePros)Object.defineProperty(l.prototype,n,{value:h.servicePros[n],writable:!1}),Object.defineProperty(o.prototype,n,{value:h.servicePros[n],writable:!1}),Object.defineProperty(a.prototype,n,{value:h.servicePros[n],writable:!1});for(var n in h.modulePros)Object.defineProperty(d.prototype,n,{value:h.modulePros[n],writable:!1}),Object.defineProperty(c.prototype,n,{value:h.modulePros[n],writable:!1})}}},97:function(T,I,m){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.modulePros=I.initMessageHandler=I.servicePros=I.handlePushMsg=I.handleBigImMsgRsp=I.handlePushTransMsg=I.handlePushMergeMsg=I.handlePushCustomMsg=I.handlePushRoomMsg=I.rtmPros=void 0;var h=m(35),_=m(36),d=m(37),l=m(98),a=m(19);function c(E,y,b,S){var k=this;return b===void 0&&(b=1),S===void 0&&(S=1),new Promise(function(O,g){var v=k.getReportSeq();k.dataReport.newReport(v,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event);var R=k.proxyRes(k.dataReport,v,O,g),L=R.interResolve,N=R.interReject;if(typeof E!="string"||E=="")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(y===void 0||y=="")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if(typeof y!="string")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(y.length>d.MAX_MESSAGE_LENGTH)return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var w=k.stateCenter.type=="PUBLIC"?k.getRoomModules(E):k.stateCenter.priModules;w?(k.dataReport.addMsgInfo(v,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(w.sessionID)}),w.messageHandler.sendRoomMsg(b,S,E,y,L,N)):N(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)})}function o(E,y,b){var S=this;return new Promise(function(k,O){var g=S.getReportSeq();S.dataReport.newReport(g,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event);var v=S.proxyRes(S.dataReport,g,k,O),R=v.interResolve,L=v.interReject;if(typeof E!="string"||E=="")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void L(a.errorCodeList.INPUT_PARAM," param roomID error");if(!(b instanceof Array)||b.find(function(w){return typeof w!="string"}))return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if(S.stateCenter.type==="PUBLIC"&&typeof y!="string"&&typeof y!="object")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if(S.stateCenter.type==="PRIVATE"&&typeof y!="string")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a not empty string"),void L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if(typeof y=="string"&&y.length>d.MAX_MESSAGE_LENGTH)return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var N=S.stateCenter.type=="PUBLIC"?S.getRoomModules(E):S.stateCenter.priModules;N?(S.dataReport.addMsgInfo(g,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(N.sessionID)}),N.messageHandler.sendCustomCommand(b,y,R,L)):L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)})}function n(E,y,b,S){var k=this;return b===void 0&&(b=1),S===void 0&&(S=1),new Promise(function(O,g){var v=k.getReportSeq();k.dataReport.newReport(v,_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event);var R=k.proxyRes(k.dataReport,v,O,g),L=R.interResolve,N=R.interReject;if(typeof E!="string"||E=="")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(y===void 0||y=="")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if(typeof y!="string")return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(y.length>d.MAX_MESSAGE_LENGTH)return k.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void N(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var w=k.stateCenter.type=="PUBLIC"?k.getRoomModules(E):k.stateCenter.priModules;w?(k.dataReport.addMsgInfo(v,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(w.sessionID)}),w.messageHandler.sendBigRoomMessage(b,S,E,y,L,N)):N(_.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)})}function t(E,y,b){var S=this;return new Promise(function(k,O){var g=S.getReportSeq();S.dataReport.newReport(g,_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event);var v=S.proxyRes(S.dataReport,g,k,O),R=v.interResolve,L=v.interReject;if(typeof E!="string"||E=="")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!y||typeof y!="string")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void L({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(y.length>d.MAX_TRANS_TYPE_LENGTH)return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void L({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(!b||typeof b!="string")return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void L({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(b.length>d.MAX_TRANS_DATA_LENGTH)return S.logger.error(h.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void L({errorCode:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var N=S.stateCenter.type=="PUBLIC"?S.getRoomModules(E):S.stateCenter.priModules;N?(S.dataReport.addMsgInfo(g,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(N.sessionID)}),N.messageHandler.sendReliableMessage(y,b,R,L)):L(_.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)})}function e(E){var y=this.handlePushMsg(E),b=y[0];E=y[1],b.messageHandler.handlePushRoomMsg(E)}function r(E){var y=this.handlePushMsg(E),b=y[0];E=y[1],b.messageHandler.handlePushCustomMsg(E)}function i(E){var y,b=(y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id,S=this.stateCenter.type=="PUBLIC"?this.rtm.getRoomModules(b):this.stateCenter.priModules;S?S.messageHandler.handlePushMergeMsg(E):this.logger.error(h.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(E))}function s(E){var y=this.handlePushMsg(E),b=y[0];E=y[1],b.messageHandler.handlePushTransMsg(E)}function u(E){var y,b=(y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id,S=this.stateCenter.type=="PUBLIC"?this.rtm.getRoomModules(b):this.stateCenter.priModules;S?S.messageHandler.handleBigImMsgRsp(E):this.logger.error(h.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(E))}function p(E){var y,b=(y=E==null?void 0:E.header)===null||y===void 0?void 0:y.room_id,S=this.rtm.getRoomModules(b);if(S)return[S,E];this.logger.error(h.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(E))}function f(){this.messageHandler=new l.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}I.rtmPros={_sendBroadcastMessage:c,sendBroadcastMessage:function(E,y){var b=this;return new Promise(function(S,k){c.call(b,E,y).then(function(O){S({errorCode:O.errorCode,messageID:O.messageID,extendedData:O.extendedData})}).catch(function(O){k(O)})})},_sendCustomCommand:o,sendCustomCommand:function(E,y,b){var S=this;return new Promise(function(k,O){o.call(S,E,y,b).then(function(g){k({errorCode:g.errorCode,extendedData:g.extendedData})}).catch(function(g){O(g)})})},_sendBarrageMessage:n,sendBarrageMessage:function(E,y){var b=this;return new Promise(function(S,k){n.call(b,E,y).then(function(O){S({errorCode:O.errorCode,messageID:O.messageID,extendedData:O.extendedData})}).catch(function(O){k(O)})})},_setRoomExtraInfo:t,setRoomExtraInfo:function(E,y,b){return t.call(this,E,y,b)},sendRelayMessage:function(E,y,b,S,k){var O=this.getRoomModules(k)||this.stateCenter.roomModulesList[0];O?O.messageHandler.sendRelayMessage(E,y,b,S):S&&S(a.errorCodeList.ROOM_NOT_EXIST,0)}},I.handlePushRoomMsg=e,I.handlePushCustomMsg=r,I.handlePushMergeMsg=i,I.handlePushTransMsg=s,I.handleBigImMsgRsp=u,I.handlePushMsg=p,I.servicePros={handlePushRoomMsg:e,handlePushCustomMsg:r,handlePushMergeMsg:i,handlePushTransMsg:s,handleBigImMsgRsp:u,handlePushMsg:p},I.initMessageHandler=f,I.modulePros={initMessageHandler:f}},98:function(T,I,m){"use strict";var h=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(I,"__esModule",{value:!0}),I.MessageHandler=void 0;var _=m(19),d=m(35),l=m(36),a=m(37),c=h(m(12)),o=function(){function n(t,e,r,i,s,u,p){var f=this;this.logger=t,this.stateCenter=e,this.dataReport=r,this.service=i,this.liveRoomHandler=s,this.rtm=u,this.room=p,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(E){var y=(E=E.filter(function(b){return b.trans_idname!==f.stateCenter.idName})).map(function(b){return{key:b.trans_type,value:b.trans_data,updateUser:{userID:b.trans_idname,userName:b.trans_nickname},updateTime:c.default.isLong(b.trans_send_time)?b.trans_send_time.toNumber():b.trans_send_time}});f.stateCenter.actionListener("roomExtraInfoUpdate",f.room.roomID,y),E.forEach(function(b){f.stateCenter.actionListener("recvReliableMessage",b.trans_type,b.trans_seq,b.trans_data)})},this.realyMessageList=[]}return n.prototype.loginRsp=function(t){var e=this;if(t.body.ret_timestamp!=null&&typeof t.body.ret_timestamp=="string"){var r=parseFloat(t.body.ret_timestamp);this.serverTimeOffset=r==0?0:t.body.ret_timestamp-new Date().getTime()}if(t.body.bigim_time_window&&typeof t.body.bigim_time_window=="number"&&(this.bigimTimeWindow=t.body.bigim_time_window),t.body.dati_time_window&&typeof t.body.dati_time_window=="number"&&(this.datiTimeWindow=t.body.dati_time_window),t.body.trans_seqs)for(var i=0;i<t.body.trans_seqs.length;i++){var s=t.body.trans_seqs[i].trans_channel,u=t.body.trans_seqs[i].trans_seq_array;(u=(u=u.filter(function(p){var f=p.trans_type,E=p.trans_seq;return!e.transSeqMap[f]||e.transSeqMap[f].seq<E})).map(function(p){return{trans_type:p.trans_type,trans_local_seq:p.trans_seq}})).length>0&&this.fetchReliableMessage(s,u)}},n.prototype.sendReliableMessage=function(t,e,r,i){var s=this;if(this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.isReliable)return this.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" send too often"),void i(l.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY);this.transSeqMap[t]||(this.transSeqMap[t]={seq:0});var u={trans_type:t,trans_data:e,trans_local_seq:this.transSeqMap[t].seq,trans_channel:"clt"};this.isReliable=!0,(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendReliableMessage(u,function(p){s.transSeqMap[t].seq=p.body.trans_seq,s.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+t+" seq "+p.body.trans_seq),s.isReliable=!1,r({seq:p.header.seq,errorCode:0})},function(p){var f=_.errorCodeList.ROOM_INNER_ERROR;p.body&&p.body.err_code?(f=s.rtm.getServerError(p.body.err_code),s.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+f.msg)):f=p==_.errorCodeList.TIMEOUT?_.errorCodeList.IM_SEND_FAILED:p,s.isReliable=!1,i(f)},this.room)},n.prototype.fetchReliableMessage=function(t,e){var r=this,i={trans_channel:t,fetch_array:e},s=function(u){r.handleFetchTransRsp(u)};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).fetchReliableMessage(i,s,s,this.room),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},n.prototype.handleFetchTransRsp=function(t){if(t.body&&t.body.err_code!=0)this.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+t.body.err_code);else if(t.header&&t.body){var e=t.body.trans_fetch_results,r=[];if(Array.isArray(e)&&e.length>0)for(var i=0;i<e.length;i++){var s=e[i];if(s.err_code!==a.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var u=s.trans_type,p=s.trans_seq;s.err_code!==a.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[u]||this.transSeqMap[u].seq<p?(this.transSeqMap[u]={seq:p},r.push(s)):this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r)):(this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+s.err_code),this.transSeqMap[u]={seq:p})}else this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+s.err_code)}}else this.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+t)},n.prototype.handlePushTransMsg=function(t){var e=t.body.trans_type,r=t.body.trans_seq;!this.transSeqMap[e]||this.transSeqMap[e].seq<r?(this.transSeqMap[e]={seq:r},this.onRecvReliableMessage([t.body])):this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+e+" seq "+r)},n.prototype.sendRoomMsg=function(t,e,r,i,s,u){var p=this;if(!this.room.isLogin())return this.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var f=Date.parse(new Date+"");if(this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>f)return this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),u&&u(_.errorCodeList.FREQ_LIMITED,0,t,i),!1;this.sendRoomMsgTime=f;var E={msg_category:t,msg_type:1,msg_priority:1,msg_content:i};return(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendRoomMsg(E,function(y){s({seq:y.header.seq,errorCode:0,messageID:y.body.msg_id})},function(y){var b,S,k=_.errorCodeList.ROOM_INNER_ERROR;if(!y.header||!y.body)return y.code&&y.msg&&(k=y),void u({seq:0,errorCode:k.code,messageID:0});k=(b=[p.rtm.getServerError(p.stateCenter.type=="PRIVATE"?y.body.code:y.body.err_code),y.body.msg_id])[0],S=b[1],p.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+k.msg),k==_.errorCodeList.TIMEOUT&&(k=_.errorCodeList.IM_SEND_FAILED),u({seq:y.header.seq,errorCode:k.code,messageID:S})},this.room),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0},n.prototype.handlePushRoomMsg=function(t){var e,r=this;e=this.stateCenter.useNetAgent?this.room.roomSessionID:t.header.session_id;var i=this.rtm.getReportSeq();this.dataReport.newReport(i),this.dataReport.addMsgInfo(i,{room_sid:l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e)});var s=[];this.stateCenter.useNetAgent?(t.body.msg_data.forEach(function(u){var p={fromUser:{userID:u.id_name,userName:u.nick_name},message:u.msg_content,sendTime:u.send_time.toNumber(),messageID:u.msg_id.toNumber()};s.push(p)}),t.body.server_msg_id=t.body.server_msg_id.toNumber(),t.body.ret_msg_id=t.body.ret_msg_id.toNumber()):t.body.chat_data.forEach(function(u){var p={fromUser:{userID:u.id_name,userName:u.nick_name},message:u.msg_content,sendTime:u.send_time,messageID:u.msg_id};s.push(p),r.dataReport.addMsgInfo(i,{from_msg_id:u.id_name})}),this.dataReport.uploadReport(i,l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,s),this.stateCenter.actionListener("_recvRoomMsg",t.body.chat_data,t.body.server_msg_id,t.body.ret_msg_id)},n.prototype.sendCustomCommand=function(t,e,r,i){var s=this;if(!this.room.isLogin())return this.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var u={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:e||"",room_id:this.room.roomID},p={dest_id_name:t,custom_msg:JSON.stringify(u)};return(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendCustomCommand(p,function(f){r({seq:f.header.seq,errorCode:0})},function(f){var E,y=s.rtm.getServerError(s.stateCenter.type=="PRIVATE"?f.body.code:f.body.err_code);s.logger.error(d.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+y.msg),E=y==_.errorCodeList.TIMEOUT?_.errorCodeList.IM_SEND_FAILED:y,i({seq:f.header.seq,errorCode:E.code})},this.room),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},n.prototype.handlePushCustomMsg=function(t){var e,r,i,s,u,p=JSON.parse(t.body.custommsg);r=(e=[p.from_userid,p.from_username,p.room_id,p.custom_content])[0],i=e[1],s=e[2],u=e[3];var f=this.rtm.getReportSeq();this.dataReport.newReport(f),this.dataReport.uploadReport(f,l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",s,{userID:r,userName:i},u)},n.prototype.sendBigRoomMessage=function(t,e,r,i,s,u){var p=this,f=this.bigimTimeWindow,E=this.serverTimeOffset,y=new Date().getTime()+E,b=this.rtm.getSeq().toString();if(this.bigImCallbackMap[b]={success:s,error:u},f==0){var S={msg_category:t,msg_type:1,msg_content:i,bigmsg_client_id:b};this.sendBigRoomMessageInternal([S],function(g){p.handleBigImMsgRsp(g)},function(g){u&&u(g)})}else{var k=Math.floor(y/f);if(this.bigImLastTimeIndex<k&&this.bigIMmessageList.length==0){this.bigImLastTimeIndex=k;var O={msg_category:t,msg_type:1,msg_content:i,bigmsg_client_id:b};this.sendBigRoomMessageInternal([O],function(g){p.handleBigImMsgRsp(g)},function(g){u&&u(g)})}else this.bigIMmessageList.push({msg_category:t,msg_type:1,msg_content:i,bigmsg_client_id:b}),this.bigIMmessageList.length==1&&this.setBigImTimer(E,f)}},n.prototype.sendBigRoomMessageInternal=function(t,e,r){var i={msgs:t};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendBigRoomMessage(i,function(s){e(s)},function(s){var u=_.errorCodeList.ROOM_INNER_ERROR;s.header&&s.body||(s.code&&s.msg&&(u=s),r(u)),r(u)},this.room),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},n.prototype.handleBigImMsgRsp=function(t){this.bigimTimeWindow=t.body.bigim_time_window;for(var e=0;e<t.body.msgs.length;e++){var r=t.body.msgs[e].bigmsg_client_id,i=t.body.msgs[e].bigmsg_id;if(this.bigImCallbackMap[r]){var s=this.bigImCallbackMap[r].success;s!=null&&s({seq:t.header.seq,errorCode:0,messageID:i}),delete this.bigImCallbackMap[r]}}},n.prototype.setBigImTimer=function(t,e){var r=this,i=e-(new Date().getTime()+t)%e,s=this.rtm.generateRandumNumber(e)+i;this.bigImTimer=setTimeout(function(){r.onBigImTimer()},s)},n.prototype.onBigImTimer=function(){var t=this,e=new Date().getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(e/this.bigimTimeWindow);for(var r=[],i=[],s=0;s<this.bigIMmessageList.length&&!(s>=20);s++){var u=this.bigIMmessageList[s];r.push({msg_category:u.msg_category,msg_type:u.msg_type,msg_content:u.msg_content,bigmsg_client_id:u.bigmsg_client_id}),i.push(u.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,function(p){t.handleBigImMsgRsp(p)},function(p,f){for(var E=0;E<i.length;E++){var y=i[E],b=t.bigImCallbackMap[y];b&&(b.error!=null&&b.error(p,f),delete t.bigImCallbackMap[y])}}),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},n.prototype.handlePushMergeMsg=function(t){for(var e=0;e<t.body.messages.length;e++)t.body.messages[e].sub_cmd!==14001&&t.body.messages[e].sub_cmd!=="/lr/push/bigim_chat"||this.handlePushBigRooMsg(t.body.messages[e].msg_body)},n.prototype.handlePushBigRooMsg=function(t){var e;if(typeof t=="string")try{e=JSON.parse(t)}catch(p){return void this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}else e=t;if(e){for(var r=e.room_id,i=[],s=0;s<e.msg_data.length;s++){var u=e.msg_data[s];u.id_name!=this.stateCenter.idName?i.push({idName:u.id_name,nickName:u.nick_name,messageId:u.bigmsg_id,category:u.msg_category,type:u.msg_type,content:u.msg_content,time:u.send_time||c.default.isLong(u.msg_timestamp)&&u.msg_timestamp.toNumber()}):this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}i.length==0?this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(i,r),this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(d.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},n.prototype.onRecvBigRoomMessage=function(t,e){var r=this.rtm.getReportSeq();this.dataReport.newReport(r);var i=[];t.forEach(function(s){var u={fromUser:{userID:s.idName,userName:s.nickName},message:s.content,sendTime:s.time,messageID:s.messageId};i.push(u)}),this.dataReport.uploadReport(r,l.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",e,i),this.stateCenter.actionListener("_recvBigRoomMessage",t,e)},n.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},n.prototype.sendRelayMessage=function(t,e,r,i){var s=this.datiTimeWindow,u=this.serverTimeOffset;s>0?(this.realyMessageList.push({type:t,data:e,success:r,error:i}),this.realyMessageList.length==1&&this.setRelayTimer(u,s)):this.sendRelayMessageInternal(t,e,r,i)},n.prototype.sendRelayMessageInternal=function(t,e,r,i){var s=this;this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var u={relay_type:t,relay_data:e},p=this.room;(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendRelayMessage(u,function(f){r&&r(f.header.seq,f.body.relay_result)},function(f){var E=_.errorCodeList.ROOM_INNER_ERROR;if(!f.header||!f.body)return f.code&&f.msg&&(E=f),void(i&&i(E,0));i&&i(s.rtm.getServerError(f.body.err_code),f.header.seq)},p)},n.prototype.setRelayTimer=function(t,e){var r=this,i=2*e-(new Date().getTime()+t)%e,s=this.rtm.generateRandumNumber(i);this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+s),this.relayTimer=setTimeout(function(){r.onRelayTimer()},s)},n.prototype.onRelayTimer=function(){if(this.realyMessageList.length!=0){var t=this.realyMessageList[0];this.sendRelayMessageInternal(t.type,t.data,t.success,t.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(d.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},n.prototype.getRoomChatInfo=function(t,e,r,i){if(this.logger.debug("zb.mh.grc call"),this.room.isLogin()){var s={room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:t,msg_count:e},u=function(p,f){if(p.body.code!==0)i({errorCode:p.body.code,extendData:p.body.message||""});else{var E=p.body.msg_data.map(function(y){return{fromUser:{userID:y.user_id,userName:y.user_name},message:y.msg_content,sendTime:y.send_time,messageID:y.msg_id}});r({chatData:E})}};this.service.sendMessage("zegochat_js.room_im_chat_fetch",s,u,u),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},n}();I.MessageHandler=o}})},4119:function(W){"use strict";W.exports=__WEBPACK_EXTERNAL_MODULE__4119__}},__webpack_module_cache__={};function __nested_webpack_require_771054__(W){var T=__webpack_module_cache__[W];if(T!==void 0)return T.exports;var I=__webpack_module_cache__[W]={exports:{}};return __webpack_modules__[W].call(I.exports,I,I.exports,__nested_webpack_require_771054__),I.exports}__nested_webpack_require_771054__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(W){if(typeof window=="object")return window}}();var __webpack_exports__=__nested_webpack_require_771054__(4780);return __webpack_exports__}()})},28901:function(module,__unused_webpack_exports,__webpack_require__){var Buffer=__webpack_require__(48764).Buffer;(function(W,T){if(!0)module.exports=T();else var I,m})(typeof self!="undefined"?self:this,function(){return function(W){var T={};function I(m){if(T[m])return T[m].exports;var h=T[m]={i:m,l:!1,exports:{}};return W[m].call(h.exports,h,h.exports,I),h.l=!0,h.exports}return I.m=W,I.c=T,I.d=function(m,h,_){I.o(m,h)||Object.defineProperty(m,h,{enumerable:!0,get:_})},I.r=function(m){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},I.t=function(m,h){if(1&h&&(m=I(m)),8&h||4&h&&typeof m=="object"&&m&&m.__esModule)return m;var _=Object.create(null);if(I.r(_),Object.defineProperty(_,"default",{enumerable:!0,value:m}),2&h&&typeof m!="string")for(var d in m)I.d(_,d,function(l){return m[l]}.bind(null,d));return _},I.n=function(m){var h=m&&m.__esModule?function(){return m.default}:function(){return m};return I.d(h,"a",h),h},I.o=function(m,h){return Object.prototype.hasOwnProperty.call(m,h)},I.p="",I(I.s=41)}([function(W,T,I){"use strict";var m;Object.defineProperty(T,"__esModule",{value:!0}),T.createZegoWebSocket=T.LoggerStateCenter=T.ZegoDataReport=T.ZegoLogger=T.MODULE_TIPS=T.LinkedList=T.ListNode=T.getReportSeq=T.getSeq=T.REPORT_ACTION=T.E_CLIENT_TYPE=T.SERVER_ERROR_CODE=T.ENUM_STREAM_UPDATE_CMD=T.MINIUM_HEARTBEAT_INTERVAL=T.NetType=T.ENUM_NETWORK_STATE=T.ENUM_RUN_STATE=T.MAX_MIX_TASK_ID_LENGTH=T.MAX_ROOM_ID_LENGTH=T.MAX_USER_NAME_LENGTH=T.MAX_USER_ID_LENGTH=T.MAX_STREAM_ID_LENGTH=T.MAX_TRY_HEARTBEAT_COUNT=T.SEND_MSG_TIMEOUT=T.SEND_MSG_RESET=T.MAX_TRY_CONNECT_COUNT=T.ENUM_CONNECT_STATE=T.ENUM_SCREEM_RESOLUTION_TYPE=T.ENUM_RESOLUTION_TYPE=T.ENUM_SIGNAL_STATE=T.TermType=T.ERROR_CODES=T.ENUM_REMOTE_TYPE=T.LOG_LEVEL=T.ENUM_LOG_LEVEL=T.ROOMVERSION=T.PROTO_VERSION=void 0,T.PROTO_VERSION="1.14.0",T.ROOMVERSION="V1",function(l){l[l.debug=0]="debug",l[l.info=1]="info",l[l.warn=2]="warn",l[l.error=3]="error",l[l.report=99]="report",l[l.disable=100]="disable"}(T.ENUM_LOG_LEVEL||(T.ENUM_LOG_LEVEL={})),T.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(l){l[l.disable=0]="disable",l[l.websocket=1]="websocket",l[l.https=2]="https"}(T.ENUM_REMOTE_TYPE||(T.ENUM_REMOTE_TYPE={})),T.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152},function(l){l[l.TT_NONE=0]="TT_NONE",l[l.TT_PC=1]="TT_PC",l[l.TT_IOS=2]="TT_IOS",l[l.TT_ANDROID=3]="TT_ANDROID",l[l.TT_MAC=4]="TT_MAC",l[l.TT_LINUX=5]="TT_LINUX",l[l.TT_WEB=6]="TT_WEB",l[l.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",l[l.TT_UNKNOWN=32]="TT_UNKNOWN"}(T.TermType||(T.TermType={})),function(l){l[l.disconnected=0]="disconnected",l[l.connecting=1]="connecting",l[l.connected=2]="connected"}(T.ENUM_SIGNAL_STATE||(T.ENUM_SIGNAL_STATE={})),T.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},T.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},T.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},T.MAX_TRY_CONNECT_COUNT=1,T.SEND_MSG_RESET=2,T.SEND_MSG_TIMEOUT=1,T.MAX_TRY_HEARTBEAT_COUNT=5,T.MAX_STREAM_ID_LENGTH=256,T.MAX_USER_ID_LENGTH=64,T.MAX_USER_NAME_LENGTH=256,T.MAX_ROOM_ID_LENGTH=128,T.MAX_MIX_TASK_ID_LENGTH=256,function(l){l[l.logout=0]="logout",l[l.trylogin=1]="trylogin",l[l.login=2]="login"}(T.ENUM_RUN_STATE||(T.ENUM_RUN_STATE={})),function(l){l[l.offline=0]="offline",l[l.online=1]="online"}(T.ENUM_NETWORK_STATE||(T.ENUM_NETWORK_STATE={})),function(l){l[l.NT_NONE=0]="NT_NONE",l[l.NT_LINE=1]="NT_LINE",l[l.NT_WIFI=2]="NT_WIFI",l[l.NT_2G=3]="NT_2G",l[l.NT_3G=4]="NT_3G",l[l.NT_4G=5]="NT_4G",l[l.NT_UNKNOWN=32]="NT_UNKNOWN"}(T.NetType||(T.NetType={})),T.MINIUM_HEARTBEAT_INTERVAL=3e3,T.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},T.SERVER_ERROR_CODE=1e4,function(l){l[l.ClientType_None=0]="ClientType_None",l[l.ClientType_H5=1]="ClientType_H5",l[l.ClientType_SmallProgram=2]="ClientType_SmallProgram",l[l.ClientType_Webrtc=3]="ClientType_Webrtc"}(T.E_CLIENT_TYPE||(T.E_CLIENT_TYPE={})),T.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},T.getSeq=(m=1,function(){return m++}),T.getReportSeq=function(){var l=1;return function(){return l++}}();var h=function(){function l(a,c){a===void 0&&(a=null),c===void 0&&(c=null),this.next=null,this.prev=null,this._id=a,this._data=c}return Object.defineProperty(l.prototype,"id",{get:function(){return this._id?this._id:null},set:function(a){this._id=a},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!1,configurable:!0}),l.prototype.hasNext=function(){return this.next&&this.next.id},l.prototype.hasPrev=function(){return this.prev&&this.prev.id},l}();T.ListNode=h;var _=function(){function l(){this.start=new h,this.end=new h,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return l.prototype.insertBefore=function(a,c){var o=new h(this._idCounter,c);return o.next=a,o.prev=a.prev,a.prev&&(a.prev.next=o),a.prev=o,++this._idCounter,++this._numNodes,o},l.prototype.addLast=function(a){return this.insertBefore(this.end,a)},l.prototype.add=function(a){return this.addLast(a)},l.prototype.getFirst=function(){return this._numNodes===0?null:this.start.next},l.prototype.getLast=function(){return this._numNodes===0?null:this.end.prev},l.prototype.size=function(){return this._numNodes},l.prototype.getFromFirst=function(a){var c=0,o=this.start.next;if(a>=0)for(;c<a&&o!==null;)o=o.next,++c;else o=null;if(o===null)throw"Index out of bounds.";return o},l.prototype.get=function(a){return a===0?this.getFirst():a===this._numNodes-1?this.getLast():this.getFromFirst(a)},l.prototype.remove=function(a){return a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),--this._numNodes,a},l.prototype.removeFirst=function(){var a=null;return this._numNodes>0&&this.start.next&&(a=this.remove(this.start.next)),a},l.prototype.removeLast=function(){var a=null;return this._numNodes>0&&this.end.prev&&(a=this.remove(this.end.prev)),a},l.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},l.prototype.each=function(a){for(var c=this.start;c.hasNext();)a(c=c.next)},l.prototype.find=function(a){for(var c=this.start,o=!1,n=null;c.hasNext()&&!o;)a(c=c.next)&&(n=c,o=!0);return n},l.prototype.map=function(a){for(var c=this.start,o=[];c.hasNext();)a(c=c.next)&&o.push(c);return o},l.prototype.push=function(a){return this.addLast(a)},l.prototype.unshift=function(a){this._numNodes>0?this.insertBefore(this.start.next,a):this.insertBefore(this.end,a)},l.prototype.pop=function(){return this.removeLast()},l.prototype.shift=function(){return this.removeFirst()},l}();T.LinkedList=_,T.MODULE_TIPS={MESSAGE:"\u672A\u5F15\u5165\u6D88\u606F\u6A21\u5757"};var d=I(43);Object.defineProperty(T,"ZegoLogger",{enumerable:!0,get:function(){return d.ZegoLogger}}),Object.defineProperty(T,"ZegoDataReport",{enumerable:!0,get:function(){return d.ZegoDataReport}}),Object.defineProperty(T,"LoggerStateCenter",{enumerable:!0,get:function(){return d.LoggerStateCenter}}),Object.defineProperty(T,"createZegoWebSocket",{enumerable:!0,get:function(){return d.createZegoWebSocket}})},function(W,T,I){"use strict";var m;Object.defineProperty(T,"__esModule",{value:!0}),T.typeMap=T.BrokenType=T.ConnectedType=T.DisconnectedType=T.Method=T.ConnectionClosedAction=T.NetWorkState=T.externalErrorList=T.Stick=T.PcConnectState=T.StreamType=T.Mode=T.ZegoconnRunEnv=T.BusinessService=T.AccessHub_Error_Code=T.AccessHubMessageType=T.ENUM_NETWORK_STATE=void 0,function(h){h[h.offline=0]="offline",h[h.online=1]="online"}(T.ENUM_NETWORK_STATE||(T.ENUM_NETWORK_STATE={})),function(h){h[h.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",h[h.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",h[h.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",h[h.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",h[h.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",h[h.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",h[h.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",h[h.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",h[h.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",h[h.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",h[h.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",h[h.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",h[h.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",h[h.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",h[h.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",h[h.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",h[h.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",h[h.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",h[h.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",h[h.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",h[h.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION"}(T.AccessHubMessageType||(T.AccessHubMessageType={})),function(h){h[h.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",h[h.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",h[h.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",h[h.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",h[h.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",h[h.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",h[h.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",h[h.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",h[h.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",h[h.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",h[h.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",h[h.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",h[h.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",h[h.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",h[h.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE"}(m=T.AccessHub_Error_Code||(T.AccessHub_Error_Code={})),function(h){h[h.SERVICE_UNSET=0]="SERVICE_UNSET",h[h.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",h[h.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",h[h.SERVICE_MIX=3]="SERVICE_MIX",h[h.SERVICE_ZEUS=4]="SERVICE_ZEUS",h[h.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",h[h.SERVICE_L3=6]="SERVICE_L3",h[h.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",h[h.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",h[h.SERVICE_ZIM=9]="SERVICE_ZIM",h[h.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",h[h.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",h[h.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",h[h.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",h[h.SERVICE_QUALITY=14]="SERVICE_QUALITY",h[h.SERVICE_SECURITY=15]="SERVICE_SECURITY",h[h.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",h[h.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",h[h.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",h[h.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL"}(T.BusinessService||(T.BusinessService={})),function(h){h[h.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",h[h.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",h[h.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET"}(T.ZegoconnRunEnv||(T.ZegoconnRunEnv={})),function(h){h[h.Mode_UNSET=0]="Mode_UNSET",h[h.MODE_ONLINE=1]="MODE_ONLINE",h[h.MODE_TEST=2]="MODE_TEST",h[h.MODE_ALPHA=3]="MODE_ALPHA"}(T.Mode||(T.Mode={})),function(h){h[h.HTTP=0]="HTTP",h[h.PC=1]="PC",h[h.OTHER=2]="OTHER"}(T.StreamType||(T.StreamType={})),function(h){h[h.CONNECTED=0]="CONNECTED",h[h.DISCONNECT=1]="DISCONNECT",h[h.BROKEN=2]="BROKEN"}(T.PcConnectState||(T.PcConnectState={})),T.Stick={DISPATCH:"zego-action-dispatch",RETRY:"zego-action-retry",ABORT:"zego-action-abort",NEXT_GROUP:"zego-action-next-group",PUSH_APP_CONFIG:"push-app-config:"},T.externalErrorList=[m.ACCESSHUB_INVALID_APPID,m.ACCESSHUB_INVALID_SIGNATURE],function(h){h[h.offline=0]="offline",h[h.online=1]="online"}(T.NetWorkState||(T.NetWorkState={})),function(h){h[h.ACTION_RESERVED=0]="ACTION_RESERVED",h[h.ACTION_DISPATCH=1]="ACTION_DISPATCH",h[h.ACTION_RETRY=2]="ACTION_RETRY",h[h.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",h[h.ACTION_ABORT=4]="ACTION_ABORT",h[h.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP"}(T.ConnectionClosedAction||(T.ConnectionClosedAction={})),function(h){h[h.METHOD_UNSET=0]="METHOD_UNSET",h[h.METHOD_GET=1]="METHOD_GET",h[h.METHOD_POST=2]="METHOD_POST"}(T.Method||(T.Method={})),function(h){h[h.CLOSE=0]="CLOSE",h[h.TEMP=1]="TEMP",h[h.TIMEOUT=2]="TIMEOUT"}(T.DisconnectedType||(T.DisconnectedType={})),function(h){h[h.AUTO=0]="AUTO",h[h.MANUAL=1]="MANUAL"}(T.ConnectedType||(T.ConnectedType={})),function(h){h[h.EMPTY=0]="EMPTY",h[h.CLOSE=1]="CLOSE"}(T.BrokenType||(T.BrokenType={})),T.typeMap={2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception"}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."}}},function(W,T,I){(function(m){var h;W.exports=(h=h||function(_,d){var l;if(typeof window!="undefined"&&window.crypto&&(l=window.crypto),typeof self!="undefined"&&self.crypto&&(l=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(l=globalThis.crypto),!l&&typeof window!="undefined"&&window.msCrypto&&(l=window.msCrypto),!l&&m!==void 0&&m.crypto&&(l=m.crypto),!l)try{l=I(45)}catch(E){}var a=function(){if(l){if(typeof l.getRandomValues=="function")try{return l.getRandomValues(new Uint32Array(1))[0]}catch(E){}if(typeof l.randomBytes=="function")try{return l.randomBytes(4).readInt32LE()}catch(E){}}throw new Error("Native crypto module could not be used to get secure random number.")},c=Object.create||function(){function E(){}return function(y){var b;return E.prototype=y,b=new E,E.prototype=null,b}}(),o={},n=o.lib={},t=n.Base={extend:function(E){var y=c(this);return E&&y.mixIn(E),y.hasOwnProperty("init")&&this.init!==y.init||(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var E=this.extend();return E.init.apply(E,arguments),E},init:function(){},mixIn:function(E){for(var y in E)E.hasOwnProperty(y)&&(this[y]=E[y]);E.hasOwnProperty("toString")&&(this.toString=E.toString)},clone:function(){return this.init.prototype.extend(this)}},e=n.WordArray=t.extend({init:function(E,y){E=this.words=E||[],this.sigBytes=y!=null?y:4*E.length},toString:function(E){return(E||i).stringify(this)},concat:function(E){var y=this.words,b=E.words,S=this.sigBytes,k=E.sigBytes;if(this.clamp(),S%4)for(var O=0;O<k;O++){var g=b[O>>>2]>>>24-O%4*8&255;y[S+O>>>2]|=g<<24-(S+O)%4*8}else for(var v=0;v<k;v+=4)y[S+v>>>2]=b[v>>>2];return this.sigBytes+=k,this},clamp:function(){var E=this.words,y=this.sigBytes;E[y>>>2]&=4294967295<<32-y%4*8,E.length=_.ceil(y/4)},clone:function(){var E=t.clone.call(this);return E.words=this.words.slice(0),E},random:function(E){for(var y=[],b=0;b<E;b+=4)y.push(a());return new e.init(y,E)}}),r=o.enc={},i=r.Hex={stringify:function(E){for(var y=E.words,b=E.sigBytes,S=[],k=0;k<b;k++){var O=y[k>>>2]>>>24-k%4*8&255;S.push((O>>>4).toString(16)),S.push((15&O).toString(16))}return S.join("")},parse:function(E){for(var y=E.length,b=[],S=0;S<y;S+=2)b[S>>>3]|=parseInt(E.substr(S,2),16)<<24-S%8*4;return new e.init(b,y/2)}},s=r.Latin1={stringify:function(E){for(var y=E.words,b=E.sigBytes,S=[],k=0;k<b;k++){var O=y[k>>>2]>>>24-k%4*8&255;S.push(String.fromCharCode(O))}return S.join("")},parse:function(E){for(var y=E.length,b=[],S=0;S<y;S++)b[S>>>2]|=(255&E.charCodeAt(S))<<24-S%4*8;return new e.init(b,y)}},u=r.Utf8={stringify:function(E){try{return decodeURIComponent(escape(s.stringify(E)))}catch(y){throw new Error("Malformed UTF-8 data")}},parse:function(E){return s.parse(unescape(encodeURIComponent(E)))}},p=n.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new e.init,this._nDataBytes=0},_append:function(E){typeof E=="string"&&(E=u.parse(E)),this._data.concat(E),this._nDataBytes+=E.sigBytes},_process:function(E){var y,b=this._data,S=b.words,k=b.sigBytes,O=this.blockSize,g=k/(4*O),v=(g=E?_.ceil(g):_.max((0|g)-this._minBufferSize,0))*O,R=_.min(4*v,k);if(v){for(var L=0;L<v;L+=O)this._doProcessBlock(S,L);y=S.splice(0,v),b.sigBytes-=R}return new e.init(y,R)},clone:function(){var E=t.clone.call(this);return E._data=this._data.clone(),E},_minBufferSize:0}),f=(n.Hasher=p.extend({cfg:t.extend(),init:function(E){this.cfg=this.cfg.extend(E),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(E){return this._append(E),this._process(),this},finalize:function(E){return E&&this._append(E),this._doFinalize()},blockSize:16,_createHelper:function(E){return function(y,b){return new E.init(b).finalize(y)}},_createHmacHelper:function(E){return function(y,b){return new f.HMAC.init(E,b).finalize(y)}}}),o.algo={});return o}(Math),h)}).call(this,I(15))},function(W,T,I){"use strict";var m=this&&this.__assign||function(){return(m=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)},h=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(T,"__esModule",{value:!0}),T.ClientUtil=void 0;var _=I(44),d=I(0),l=h(I(20)),a=h(I(23)),c=I(2),o=function(){function n(){}return n.checkConfigParam=function(t,e,r){return t&&typeof t=="number"&&this.checkInteger(t)?!(!e||typeof e!="string"&&!Array.isArray(e)||e=="")||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},n.checkPriConfigParam=function(t,e,r,i,s){return t&&typeof t=="number"&&this.checkInteger(t)?e&&typeof e=="string"?typeof r!="object"||typeof r.deviceID!="string"?(s.error("ccp.0 deviceID must be string and not empty"),!1):i===1||i===0||(s.error("ccp.0 anType must be 0 or 1"),!1):(s.error("ccp.0 dispatchServer must be string and not empty"),!1):(s.error("ccp.0 appid must be positive integer number and not empty"),!1)},n.checkIllegalCharacters=function(t){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(t)&&/^[^:/]*$/g.test(t)},n.isUrl=function(t){return!!(t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))},n.registerCallback=function(t,e,r){var i,s;e.success&&(i=e.success,r[t+"SuccessCallback"]=i),e.error&&(s=e.error,r[t+"ErrorCallback"]=s)},n.actionErrorCallback=function(t,e){return e[t+"ErrorCallback"]},n.actionSuccessCallback=function(t,e){return e[t+"SuccessCallback"]},n.logReportCallback=function(t,e,r,i){n.registerCallback(t,{success:function(s,u){for(var p=[],f=2;f<arguments.length;f++)p[f-2]=arguments[f];n.dataReportEvent(e,r,s,u,p)}},i)},n.proxyRes=function(t,e,r,i){return{interResolve:function(s){t.uploadReport(e),r(s)},interReject:function(s,u){var p;u===void 0&&(u=""),(p=s.code<2e9&&s.code>1e9?n.decodeServerError(s.code,s.msg):{code:s.code,message:s.msg})&&t.addMsgInfo(e,{error:p.code,message:p.message+u}),t.uploadReport(e),i({errorCode:s.code||s.errorCode})}}},n.getServerError=function(t){var e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(t===0)return c.errorCodeList.SUCCESS;var r=m({},c.errorCodeList.ROOM_INNER_ERROR);if(r.code=t,t>1e9){var i=e[t];r.msg=i?"liveroom cmd error, code: "+t+", message: "+i:e[1e9]+t}else r.msg=e[t]?e[t]+" code:"+t:"unknown error code:"+t;return r},n.unregisterCallback=function(t,e){delete e[t+"SuccessCallback"],delete e[t+"ErrorCallback"]},n.decodeServerError=function(t,e){var r={code:-1,message:"server error"};return r.code=t>1e9?t-1e9+52e6:t+2002e6,e&&(r.message=e),r},n.getLiveRoomError=function(t,e){var r={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return e?t>2e5&&t<3e5?r[t-2e5]:t<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[t]||r[t]||"ROOM_INNER_ERROR":r[t]||"ROOM_INNER_ERROR":t>1e9?r[t-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[t]||"ROOM_INNER_ERROR"},n.getKickoutError=function(t,e){var r={code:t,message:"kickout reason = "+t};if(e)switch(t){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 4:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=t,r.message="kickout reason = "+t}else switch(t){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 3:r.code=63000003,r.message="kickout reason = "+t;break;case 4:r.code=63000004,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=t,r.message="kickout reason = "+t}return r},n.dataReportEvent=function(t,e,r,i,s){switch(r){case"eventStart":t.eventStart(e,i);break;case"eventEndWithMsgInfo":t.eventEndWithMsgInfo(e,i,s[0]);break;case"addEventMsg":t.addEventMsg(e,i,s[0],s[1]);break;case"addEvent":t.addEvent(e,i);break;case"eventEnd":t.eventEnd(e,i);break;case"addMsgInfo":t.addMsgInfo(e,s[0])}},n.isKeepTryLogin=function(t){switch(t){case 1002:case 1003:return!0;default:return!1}},n.mergeUserList=function(t,e,r,i){t.debug("msl.0 call");var s,u=[],p=[];r||(r=[]);for(var f=0;f<r.length;f++){s=!1;for(var E=0;E<e.length;E++)if(r[f].userID===e[E].userID){s=!0;break}s||u.push(r[f])}for(var y=0;y<e.length;y++){s=!1;for(var b=0;b<r.length;b++)if(e[y].userID===r[b].userID){s=!0;break}s||p.push(e[y])}for(e.splice(0),f=0;f<r.length;f++)e.push(e[f]);i(u,p),t.debug("msl.0 call success")},n.checkInteger=function(t,e){return e==0?typeof t=="number"&&t%1==0&&t>=0:typeof t=="number"&&t%1==0&&t>0},n.checkValidNumber=function(t,e,r){return e=e||1,r=r||1e4,typeof t=="number"&&t%1==0&&t>=e&&t<=r},n.generateRandumNumber=function(t){return parseInt(Math.random()*(t+1)+"",10)},n.uuid=function(t,e){var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(e=e||i.length,t)for(r=0;r<t;r++)s[r]=i[0|Math.random()*e];else{var u=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(u=0|16*Math.random(),s[r]=i[r==19?3&u|8:u])}return s.join("")},n.compareVersion=function(t,e){t=t.split("."),e=e.split(".");for(var r=Math.max(t.length,e.length);t.length<r;)t.push("0");for(;e.length<r;)e.push("0");for(var i=0;i<r;i++){var s=parseInt(t[i]),u=parseInt(e[i]);if(s>u)return 1;if(s<u)return-1}return 0},n.getBrowser=function(){var t=window.navigator.userAgent,e=window.ActiveXObject!=null&&t.indexOf("MSIE")!=-1,r=t.indexOf("Firefox")!=-1,i=window.opr!=null,s=t.indexOf("Chrome")&&window.chrome,u=t.indexOf("Safari")!=-1&&t.indexOf("Version")!=-1;return e?"IE":r?"Firefox":i?"Opera":s?"Chrome":u?"Safari":"Unkown"},n.isTestEnv=function(t){return t.indexOf("wss://wssliveroom-test.zego.im/ws")!=-1||t.indexOf("wss://test2-wsliveroom-api.zego.im/ws")!=-1||t.indexOf("wss://wsliveroom-test.zegocloud.com/ws")!=-1||t.indexOf("wss://wsliveroom-test.zego.im/ws")!=-1||t.indexOf("wss://webliveroom-test.zego.im/ws")!=-1||t.indexOf("wss://webliveroom-test-bak.zego.im/ws")!=-1||t.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")!=-1||t.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")!=-1},n.getLogLevel=function(t){return d.LOG_LEVEL[t]},n.getUint64=function(t,e,r){var i=r.getUint32(t,e),s=r.getUint32(t+4,e),u=e?i+Math.pow(2,32)*s:Math.pow(2,32)*i+s;return Number.isSafeInteger(u)||console.warn(u,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),u},n.decodeTokenExpire=function(t){try{var e=Uint8Array.from(_.Base64.base64decode(t),function(s){return s.charCodeAt(0)}),r=new DataView(e.buffer),i=void 0;return i=typeof r.getBigInt64=="function"?r.getBigUint64(0):n.getUint64(0,!1,r),Number(i>0?i:r.getBigUint64(0,!0))}catch(s){console.error("token error")}return-1},n.bin2hex=function(t){var e,r,i,s="";for(e=0,r=(t+="").length;e<r;e++)s+=(i=t.charCodeAt(e).toString(16)).length<2?"0"+i:i;return s},n.getCanvasFingerprint=function(t){var e=document.createElement("canvas"),r=e.getContext("2d"),i=t;r.textBaseline="top",r.font="14px 'Arial'",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",r.fillText(i,2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.fillText(i,4,17);var s=e.toDataURL().replace("data:image/png;base64,",""),u=atob(s);return this.bin2hex(u.slice(-16,-12))},n.generateUUID=function(t){var e;if(t===void 0&&(t=0),t===0?e=localStorage.getItem("z_deviceID"):wx.getStorageSync("z_deviceID"),e)return e;var r=new Date().getTime(),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var p=(r+16*Math.random())%16|0;return r=Math.floor(r/16),(u=="x"?p:3&p|8).toString(36)});if(t===0){var s=this.getCanvasFingerprint("hello, zego")+i.slice(8);localStorage.setItem("z_deviceID",s)}else wx.setStorageSync("z_deviceID",i);return i},n.getNetType=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return((t==null?void 0:t.effectiveType)||(t==null?void 0:t.type)||"unknwon").toUpperCase()},n.getNetTypeNum=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=((t==null?void 0:t.effectiveType)||(t==null?void 0:t.type)||"unknwon").toUpperCase();return e.indexOf("4G")>-1?d.NetType.NT_4G:e.indexOf("2G")>-1?d.NetType.NT_2G:e.indexOf("3G")>-1?d.NetType.NT_3G:e.indexOf("WIFI")>-1?d.NetType.NT_WIFI:e.indexOf("LINE")>-1?d.NetType.NT_LINE:e.indexOf("NONE")>-1?d.NetType.NT_NONE:d.NetType.NT_UNKNOWN},n.encryptStores=function(t,e){return l.default.encrypt(t,e).toString()},n.decryptStores=function(t,e){try{return l.default.decrypt(t,e).toString(a.default)}catch(r){return""}},n}();T.ClientUtil=o},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZEGO_RTM_ACTION=void 0,function(m){m.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",m.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",m.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",m.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",m.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",m.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",m.ZEGOEXPRESSWEBRTM_FETCH_APP_CONFIG="zm.fac",m.ZEGOEXPRESSWEBRTM_CREATENETAGENT="zm.cna",m.ZEGOEXPRESSWEBRTM_GETSTOREAPPCONFIG="zm.gsac",m.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS="zm.scsu",m.ZEGOEXPRESSWEBRTM_ON="zm.on",m.ZEGOEXPRESSWEBRTM_OFF="zm.off",m.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",m.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",m.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",m.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",m.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",m.ROOM_LOGIN_ROOM="zm.rm.lg",m.ROOM_TRY_LOGIN="zm.rm.tl",m.ROOM_OPEN_HANDLER="zm.rm.op",m.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",m.ROOM_CLOSEHANDLER="zm.rm.clh",m.ROOM_LOGOUT="zm.rm.lo",m.ROOM_RESET_ROOM="zm.rm.rr",m.ROOM_DISCONNECT="zm.rm.dcn",m.ROOM_KICK_OUT="zm.rm.kco",m.ROOM_STATUS_CALLBACK="zm.rm.scb",m.ROOM_RESETTOKEN_TIMER="zm.rm.rst",m.HEARTBEAT_START="zm.hb.st",m.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",m.HEARTBEAT_RESET="zm.hb.rst",m.SERVICE_PUSH="zm.sv.ps",m.SERVICE_SEND="zm.sv.sd",m.USER_LOGIN_RSP="zm.us.lgr",m.USER_FETCH_USER="zm.us.ftu",m.USER_FETCH_USER_RSP="zm.us.urp",m.USER_USER_PUSH="zm.us.uph",m.USER_MERGE_SEQ="zm.us.mg",m.USER_MERGE_TIMEOUT="zm.us.mto",m.USER_MERGE="zm.us.mg",m.USER_HB_PATCH="zm.us.pt",m.STATE_ACTION="zm.st.at",m.ON_LISTENER="ON_LISTENER",m.LIVEROOMHANDLER_SENDMESSAGE="zm.lrh.sm",m.LIVEROOMHANDLER_HANDLEPUSH="zm.lrh.hp",m.LIVEROOMHANDLER_HANDLESWITCHPUSH="zm.lrh.hsp",m.LIVEROOMHANDLER_PUSHUSERUPDATE="zm.lrh.puu",m.LIVEROOMHANDLER_PUSHKICKOUT="zm.lrh.pk",m.LIVEROOMHANDLER_GETSTREAMLIST="zm.lrh.gs",m.LIVEROOMHANDLER_LOGIN="zm.lrh.lgi",m.LIVEROOMHANDLER_FETCH_USER_LIST="zm.lrh.ful",m.LIVEROOMHANDLER_LOGOUT="zm.lrh.lgo",m.LIVEROOMHANDLER_SENDSTREAMUPDATE="zm.lrh.sru",m.LIVEROOMHANDLER_RENEW_TOKEN="zm.lrh.rt",m.LIVEROOMHANDLER_SENDSIGNALCMD="zm.lrh.ssc",m.LIVEROOMHANDLER_SENDBIGROOMMESSAGE="zm.lrh.sbrm",m.LIVEROOMHANDLER_SENDCUSTOMCOMMAND="zm.lrh.scc",m.LIVEROOMHANDLER_FETCHRELIABLEMESSAGE="zm.lrh.frm",m.LIVEROOMHANDLER_SENDRELIABLEMESSAGE="zm.lrh.srm.0",m.LIVEROOMHANDLER_SENDROOMMSG="zm.lrh.srm.1",m.LIVEROOMHANDLER_HANDLEDISCONNECTED="zm.lrh.hd",m.LIVEROOMHANDLER_HANDLEBROKEN="zm.lrh.hb",m.LIVEROOMHANDLER_HANDLECONNECTED="zm.lrh.hc",m.LIVEROOMHANDLER_RESET="zm.lrh.r.0"}(T.ZEGO_RTM_ACTION||(T.ZEGO_RTM_ACTION={}))},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.APP_CONFIG_KEY=T.NET_ACCESS_SERVERS=T.NET_ACCESS_CONFIG=void 0;var m=I(1);T.NET_ACCESS_CONFIG={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:m.Mode.MODE_ONLINE,sdkType:3,connectVer:1,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},T.NET_ACCESS_SERVERS="z_net_access_servers",T.APP_CONFIG_KEY="z_appconfig"},function(W,T,I){"use strict";W.exports=I(56)},function(W,T,I){"use strict";(function(m){var h=T;function _(l,a,c){for(var o=Object.keys(a),n=0;n<o.length;++n)l[o[n]]!==void 0&&c||(l[o[n]]=a[o[n]]);return l}function d(l){function a(c,o){if(!(this instanceof a))return new a(c,o);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),o&&_(this,o)}return(a.prototype=Object.create(Error.prototype)).constructor=a,Object.defineProperty(a.prototype,"name",{get:function(){return l}}),a.prototype.toString=function(){return this.name+": "+this.message},a}h.asPromise=I(57),h.base64=I(58),h.EventEmitter=I(59),h.float=I(60),h.inquire=I(61),h.utf8=I(62),h.pool=I(63),h.LongBits=I(64),h.isNode=Boolean(m!==void 0&&m&&m.process&&m.process.versions&&m.process.versions.node),h.global=h.isNode&&m||typeof window!="undefined"&&window||typeof self!="undefined"&&self||this,h.emptyArray=Object.freeze?Object.freeze([]):[],h.emptyObject=Object.freeze?Object.freeze({}):{},h.isInteger=Number.isInteger||function(l){return typeof l=="number"&&isFinite(l)&&Math.floor(l)===l},h.isString=function(l){return typeof l=="string"||l instanceof String},h.isObject=function(l){return l&&typeof l=="object"},h.isset=h.isSet=function(l,a){var c=l[a];return!(c==null||!l.hasOwnProperty(a))&&(typeof c!="object"||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},h.Buffer=function(){try{var l=h.inquire("buffer").Buffer;return l.prototype.utf8Write?l:null}catch(a){return null}}(),h._Buffer_from=null,h._Buffer_allocUnsafe=null,h.newBuffer=function(l){return typeof l=="number"?h.Buffer?h._Buffer_allocUnsafe(l):new h.Array(l):h.Buffer?h._Buffer_from(l):typeof Uint8Array=="undefined"?l:new Uint8Array(l)},h.Array=typeof Uint8Array!="undefined"?Uint8Array:Array,h.Long=h.global.dcodeIO&&h.global.dcodeIO.Long||h.global.Long||h.inquire("long"),h.key2Re=/^true|false|0|1$/,h.key32Re=/^-?(?:0|[1-9][0-9]*)$/,h.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,h.longToHash=function(l){return l?h.LongBits.from(l).toHash():h.LongBits.zeroHash},h.longFromHash=function(l,a){var c=h.LongBits.fromHash(l);return h.Long?h.Long.fromBits(c.lo,c.hi,a):c.toNumber(Boolean(a))},h.merge=_,h.lcFirst=function(l){return l.charAt(0).toLowerCase()+l.substring(1)},h.newError=d,h.ProtocolError=d("ProtocolError"),h.oneOfGetter=function(l){for(var a={},c=0;c<l.length;++c)a[l[c]]=1;return function(){for(var o=Object.keys(this),n=o.length-1;n>-1;--n)if(a[o[n]]===1&&this[o[n]]!==void 0&&this[o[n]]!==null)return o[n]}},h.oneOfSetter=function(l){return function(a){for(var c=0;c<l.length;++c)l[c]!==a&&delete this[l[c]]}},h.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},h._configure=function(){var l=h.Buffer;l?(h._Buffer_from=l.from!==Uint8Array.from&&l.from||function(a,c){return new l(a,c)},h._Buffer_allocUnsafe=l.allocUnsafe||function(a){return new l(a)}):h._Buffer_from=h._Buffer_allocUnsafe=null}}).call(this,I(15))},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.errorCodeList=void 0,T.errorCodeList={TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"}}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoRTMLogEvent=void 0;var m=I(2),h=function(d){return d},_=function(d){return d};T.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:m.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:h},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:m.errorCodeList.INPUT_PARAM},log_level:function(d){return d},remote_log_level:h,log_url:h},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:h,max_member_count:h,message:h,token:h,use_na:h,error:{ROOM_ID_NULL:m.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:m.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:m.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:m.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:m.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:m.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:m.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:m.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:m.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:m.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:m.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:m.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:m.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:h,try_cnt:h},liveroom_login:{event:"liveroom_login",server:h,respond_info:h}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:m.errorCodeList.INPUT_PARAM,NOT_LOGIN:m.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:m.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:m.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:m.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:m.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:h,try_cnt:h},liveroom_login:{event:"liveroom_login",server:h,respond_info:h}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:h,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:h,room_id:h,message:h},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:h,error:{NOT_LOGIN:m.errorCodeList.NOT_LOGIN,HB_TIMEOUT:m.errorCodeList.TIMEOUT}},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:h},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:m.errorCodeList.INPUT_PARAM,kAlreadyLoginError:m.errorCodeList.ALREADY_LOGIN}},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"},kZegoTaskCloudSettingRequest:{event:"/cloud_setting/request"},kZegoConnConnect:{event:"/zegoconn/connect",request_count:_,svr_env:h,server_list:h},kZegoConnDisConnect:{event:"/zegoconn/disconnect",server:h},kZegoConnDispatch:{event:"/zegoconn/auto_dispatch",trigger_reason:h,server_list:function(d){return d}},kZegoRequest:{event:"/zegoconn/request",na_req_location:h},kZegoSDKConfigInit:{event:"/sdk_config/init",trigger_reason:h},kZegoSDKProxyConnect:{event:"/zegoconn/proxy_connect",proxy_link_sources:_,recv_time:_}}},,function(W,T){W.exports=m;var I=null;try{I=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(g){}function m(g,v,R){this.low=0|g,this.high=0|v,this.unsigned=!!R}function h(g){return(g&&g.__isLong__)===!0}m.prototype.__isLong__,Object.defineProperty(m.prototype,"__isLong__",{value:!0}),m.isLong=h;var _={},d={};function l(g,v){var R,L,N;return v?(N=0<=(g>>>=0)&&g<256)&&(L=d[g])?L:(R=c(g,(0|g)<0?-1:0,!0),N&&(d[g]=R),R):(N=-128<=(g|=0)&&g<128)&&(L=_[g])?L:(R=c(g,g<0?-1:0,!1),N&&(_[g]=R),R)}function a(g,v){if(isNaN(g))return v?p:u;if(v){if(g<0)return p;if(g>=r)return S}else{if(g<=-i)return k;if(g+1>=i)return b}return g<0?a(-g,v).neg():c(g%e|0,g/e|0,v)}function c(g,v,R){return new m(g,v,R)}m.fromInt=l,m.fromNumber=a,m.fromBits=c;var o=Math.pow;function n(g,v,R){if(g.length===0)throw Error("empty string");if(g==="NaN"||g==="Infinity"||g==="+Infinity"||g==="-Infinity")return u;if(typeof v=="number"?(R=v,v=!1):v=!!v,(R=R||10)<2||36<R)throw RangeError("radix");var L;if((L=g.indexOf("-"))>0)throw Error("interior hyphen");if(L===0)return n(g.substring(1),v,R).neg();for(var N=a(o(R,8)),w=u,B=0;B<g.length;B+=8){var x=Math.min(8,g.length-B),Z=parseInt(g.substring(B,B+x),R);if(x<8){var V=a(o(R,x));w=w.mul(V).add(a(Z))}else w=(w=w.mul(N)).add(a(Z))}return w.unsigned=v,w}function t(g,v){return typeof g=="number"?a(g,v):typeof g=="string"?n(g,v):c(g.low,g.high,typeof v=="boolean"?v:g.unsigned)}m.fromString=n,m.fromValue=t;var e=4294967296,r=e*e,i=r/2,s=l(1<<24),u=l(0);m.ZERO=u;var p=l(0,!0);m.UZERO=p;var f=l(1);m.ONE=f;var E=l(1,!0);m.UONE=E;var y=l(-1);m.NEG_ONE=y;var b=c(-1,2147483647,!1);m.MAX_VALUE=b;var S=c(-1,-1,!0);m.MAX_UNSIGNED_VALUE=S;var k=c(0,-2147483648,!1);m.MIN_VALUE=k;var O=m.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*e+(this.low>>>0):this.high*e+(this.low>>>0)},O.toString=function(g){if((g=g||10)<2||36<g)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(k)){var v=a(g),R=this.div(v),L=R.mul(v).sub(this);return R.toString(g)+L.toInt().toString(g)}return"-"+this.neg().toString(g)}for(var N=a(o(g,6),this.unsigned),w=this,B="";;){var x=w.div(N),Z=(w.sub(x.mul(N)).toInt()>>>0).toString(g);if((w=x).isZero())return Z+B;for(;Z.length<6;)Z="0"+Z;B=""+Z+B}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(k)?64:this.neg().getNumBitsAbs();for(var g=this.high!=0?this.high:this.low,v=31;v>0&&(g&1<<v)==0;v--);return this.high!=0?v+33:v+1},O.isZero=function(){return this.high===0&&this.low===0},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return(1&this.low)==1},O.isEven=function(){return(1&this.low)==0},O.equals=function(g){return h(g)||(g=t(g)),(this.unsigned===g.unsigned||this.high>>>31!=1||g.high>>>31!=1)&&this.high===g.high&&this.low===g.low},O.eq=O.equals,O.notEquals=function(g){return!this.eq(g)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(g){return this.comp(g)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(g){return this.comp(g)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(g){return this.comp(g)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(g){return this.comp(g)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(g){if(h(g)||(g=t(g)),this.eq(g))return 0;var v=this.isNegative(),R=g.isNegative();return v&&!R?-1:!v&&R?1:this.unsigned?g.high>>>0>this.high>>>0||g.high===this.high&&g.low>>>0>this.low>>>0?-1:1:this.sub(g).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(k)?k:this.not().add(f)},O.neg=O.negate,O.add=function(g){h(g)||(g=t(g));var v=this.high>>>16,R=65535&this.high,L=this.low>>>16,N=65535&this.low,w=g.high>>>16,B=65535&g.high,x=g.low>>>16,Z=0,V=0,Y=0,te=0;return Y+=(te+=N+(65535&g.low))>>>16,V+=(Y+=L+x)>>>16,Z+=(V+=R+B)>>>16,Z+=v+w,c((Y&=65535)<<16|(te&=65535),(Z&=65535)<<16|(V&=65535),this.unsigned)},O.subtract=function(g){return h(g)||(g=t(g)),this.add(g.neg())},O.sub=O.subtract,O.multiply=function(g){if(this.isZero())return u;if(h(g)||(g=t(g)),I)return c(I.mul(this.low,this.high,g.low,g.high),I.get_high(),this.unsigned);if(g.isZero())return u;if(this.eq(k))return g.isOdd()?k:u;if(g.eq(k))return this.isOdd()?k:u;if(this.isNegative())return g.isNegative()?this.neg().mul(g.neg()):this.neg().mul(g).neg();if(g.isNegative())return this.mul(g.neg()).neg();if(this.lt(s)&&g.lt(s))return a(this.toNumber()*g.toNumber(),this.unsigned);var v=this.high>>>16,R=65535&this.high,L=this.low>>>16,N=65535&this.low,w=g.high>>>16,B=65535&g.high,x=g.low>>>16,Z=65535&g.low,V=0,Y=0,te=0,F=0;return te+=(F+=N*Z)>>>16,Y+=(te+=L*Z)>>>16,te&=65535,Y+=(te+=N*x)>>>16,V+=(Y+=R*Z)>>>16,Y&=65535,V+=(Y+=L*x)>>>16,Y&=65535,V+=(Y+=N*B)>>>16,V+=v*Z+R*x+L*B+N*w,c((te&=65535)<<16|(F&=65535),(V&=65535)<<16|(Y&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(g){if(h(g)||(g=t(g)),g.isZero())throw Error("division by zero");var v,R,L;if(I)return this.unsigned||this.high!==-2147483648||g.low!==-1||g.high!==-1?c((this.unsigned?I.div_u:I.div_s)(this.low,this.high,g.low,g.high),I.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?p:u;if(this.unsigned){if(g.unsigned||(g=g.toUnsigned()),g.gt(this))return p;if(g.gt(this.shru(1)))return E;L=p}else{if(this.eq(k))return g.eq(f)||g.eq(y)?k:g.eq(k)?f:(v=this.shr(1).div(g).shl(1)).eq(u)?g.isNegative()?f:y:(R=this.sub(g.mul(v)),L=v.add(R.div(g)));if(g.eq(k))return this.unsigned?p:u;if(this.isNegative())return g.isNegative()?this.neg().div(g.neg()):this.neg().div(g).neg();if(g.isNegative())return this.div(g.neg()).neg();L=u}for(R=this;R.gte(g);){v=Math.max(1,Math.floor(R.toNumber()/g.toNumber()));for(var N=Math.ceil(Math.log(v)/Math.LN2),w=N<=48?1:o(2,N-48),B=a(v),x=B.mul(g);x.isNegative()||x.gt(R);)x=(B=a(v-=w,this.unsigned)).mul(g);B.isZero()&&(B=f),L=L.add(B),R=R.sub(x)}return L},O.div=O.divide,O.modulo=function(g){return h(g)||(g=t(g)),I?c((this.unsigned?I.rem_u:I.rem_s)(this.low,this.high,g.low,g.high),I.get_high(),this.unsigned):this.sub(this.div(g).mul(g))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return c(~this.low,~this.high,this.unsigned)},O.and=function(g){return h(g)||(g=t(g)),c(this.low&g.low,this.high&g.high,this.unsigned)},O.or=function(g){return h(g)||(g=t(g)),c(this.low|g.low,this.high|g.high,this.unsigned)},O.xor=function(g){return h(g)||(g=t(g)),c(this.low^g.low,this.high^g.high,this.unsigned)},O.shiftLeft=function(g){return h(g)&&(g=g.toInt()),(g&=63)==0?this:g<32?c(this.low<<g,this.high<<g|this.low>>>32-g,this.unsigned):c(0,this.low<<g-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(g){return h(g)&&(g=g.toInt()),(g&=63)==0?this:g<32?c(this.low>>>g|this.high<<32-g,this.high>>g,this.unsigned):c(this.high>>g-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(g){if(h(g)&&(g=g.toInt()),(g&=63)===0)return this;var v=this.high;return g<32?c(this.low>>>g|v<<32-g,v>>>g,this.unsigned):c(g===32?v:v>>>g-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},O.toBytes=function(g){return g?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var g=this.high,v=this.low;return[255&v,v>>>8&255,v>>>16&255,v>>>24,255&g,g>>>8&255,g>>>16&255,g>>>24]},O.toBytesBE=function(){var g=this.high,v=this.low;return[g>>>24,g>>>16&255,g>>>8&255,255&g,v>>>24,v>>>16&255,v>>>8&255,255&v]},m.fromBytes=function(g,v,R){return R?m.fromBytesLE(g,v):m.fromBytesBE(g,v)},m.fromBytesLE=function(g,v){return new m(g[0]|g[1]<<8|g[2]<<16|g[3]<<24,g[4]|g[5]<<8|g[6]<<16|g[7]<<24,v)},m.fromBytesBE=function(g,v){return new m(g[4]<<24|g[5]<<16|g[6]<<8|g[7],g[0]<<24|g[1]<<16|g[2]<<8|g[3],v)}},,,function(W,T){var I;I=function(){return this}();try{I=I||new Function("return this")()}catch(m){typeof window=="object"&&(I=window)}W.exports=I},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.STORE_SECRET=T.BIZ_TYPE=T.PROTO_VER=T.CRYPT_VERSION=T.SDK_CONN_TYPE=T.ROOM_BASIC=T.INIT=T.CLOUD_SETTING=void 0,T.CLOUD_SETTING={product:"Web_SDK",URL:["https://cloud-setting-api.zego.im/cloud-setting/get","https://cloud-setting-api.zegocloud.com/cloud-setting/get"],ONLINE:!1},T.INIT="init",T.ROOM_BASIC="room",T.SDK_CONN_TYPE=2,T.CRYPT_VERSION=1,T.PROTO_VER=131072,T.BIZ_TYPE=0,T.STORE_SECRET="0c9e6e0f8c0a8f4e"},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Mode=T.NET_ACCESS_CONFIG=T.BusinessService=T.NetAgentHttpRequest=T.NetAgentPCRequest=T.ZegoConnectionAgent=void 0;var m=I(1);Object.defineProperty(T,"BusinessService",{enumerable:!0,get:function(){return m.BusinessService}}),Object.defineProperty(T,"Mode",{enumerable:!0,get:function(){return m.Mode}});var h=I(54);Object.defineProperty(T,"ZegoConnectionAgent",{enumerable:!0,get:function(){return h.ZegoConnectionAgent}});var _=I(29);Object.defineProperty(T,"NetAgentHttpRequest",{enumerable:!0,get:function(){return _.NetAgentHttpRequest}});var d=I(26);Object.defineProperty(T,"NetAgentPCRequest",{enumerable:!0,get:function(){return d.NetAgentPCRequest}});var l=I(6);Object.defineProperty(T,"NET_ACCESS_CONFIG",{enumerable:!0,get:function(){return l.NET_ACCESS_CONFIG}})},function(W,T,I){"use strict";var m,h,_,d,l=I(7),a=l.Reader,c=l.Writer,o=l.util,n=l.roots.default||(l.roots.default={});n.proto_switch=((_={}).CommonRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.proto_switch.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.CommonRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.proto_switch.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),_.RspHead=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.code=0,t.prototype.message="",t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&r.uint32(8).uint32(e.code),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(18).string(e.message),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.RspHead;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.code=e.uint32();break;case 2:s.message=e.string();break;default:e.skipType(7&u)}}return s},t}(),_.LoginRoomReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.app_id=0,t.prototype.id_name=o.newBuffer([]),t.prototype.device_id="",t.prototype.term_type=0,t.prototype.net_type=0,t.prototype.sdk_ver=0,t.prototype.proto_ver=0,t.prototype.nick_name=o.newBuffer([]),t.prototype.client_stamp=o.newBuffer([]),t.prototype.crypt_version=0,t.prototype.k1_sign=o.newBuffer([]),t.prototype.login_token=o.newBuffer([]),t.prototype.relogin_token=o.newBuffer([]),t.prototype.role=0,t.prototype.liveroom_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.room_id=o.newBuffer([]),t.prototype.room_name=o.newBuffer([]),t.prototype.biz_type=0,t.prototype.room_create_flag=0,t.prototype.user_state_flag=0,t.prototype.lv_key="",t.prototype.third_token=o.newBuffer([]),t.prototype.cluster_req=0,t.prototype.user_count_limit=0,t.prototype.relate_service="",t.prototype.biz_version="",t.prototype.login_logic=0,t.prototype.sdk_conn_type=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.app_id!=null&&Object.hasOwnProperty.call(e,"app_id")&&r.uint32(8).uint32(e.app_id),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(18).bytes(e.id_name),e.device_id!=null&&Object.hasOwnProperty.call(e,"device_id")&&r.uint32(26).string(e.device_id),e.term_type!=null&&Object.hasOwnProperty.call(e,"term_type")&&r.uint32(32).int32(e.term_type),e.net_type!=null&&Object.hasOwnProperty.call(e,"net_type")&&r.uint32(40).int32(e.net_type),e.sdk_ver!=null&&Object.hasOwnProperty.call(e,"sdk_ver")&&r.uint32(48).uint32(e.sdk_ver),e.proto_ver!=null&&Object.hasOwnProperty.call(e,"proto_ver")&&r.uint32(56).int32(e.proto_ver),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(66).bytes(e.nick_name),e.client_stamp!=null&&Object.hasOwnProperty.call(e,"client_stamp")&&r.uint32(74).bytes(e.client_stamp),e.crypt_version!=null&&Object.hasOwnProperty.call(e,"crypt_version")&&r.uint32(80).uint32(e.crypt_version),e.k1_sign!=null&&Object.hasOwnProperty.call(e,"k1_sign")&&r.uint32(90).bytes(e.k1_sign),e.login_token!=null&&Object.hasOwnProperty.call(e,"login_token")&&r.uint32(98).bytes(e.login_token),e.relogin_token!=null&&Object.hasOwnProperty.call(e,"relogin_token")&&r.uint32(106).bytes(e.relogin_token),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(112).uint32(e.role),e.liveroom_session_id!=null&&Object.hasOwnProperty.call(e,"liveroom_session_id")&&r.uint32(120).uint64(e.liveroom_session_id),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(130).bytes(e.room_id),e.room_name!=null&&Object.hasOwnProperty.call(e,"room_name")&&r.uint32(138).bytes(e.room_name),e.biz_type!=null&&Object.hasOwnProperty.call(e,"biz_type")&&r.uint32(144).uint32(e.biz_type),e.room_create_flag!=null&&Object.hasOwnProperty.call(e,"room_create_flag")&&r.uint32(152).uint32(e.room_create_flag),e.user_state_flag!=null&&Object.hasOwnProperty.call(e,"user_state_flag")&&r.uint32(160).uint32(e.user_state_flag),e.lv_key!=null&&Object.hasOwnProperty.call(e,"lv_key")&&r.uint32(170).string(e.lv_key),e.third_token!=null&&Object.hasOwnProperty.call(e,"third_token")&&r.uint32(178).bytes(e.third_token),e.cluster_req!=null&&Object.hasOwnProperty.call(e,"cluster_req")&&r.uint32(184).uint32(e.cluster_req),e.user_count_limit!=null&&Object.hasOwnProperty.call(e,"user_count_limit")&&r.uint32(192).uint32(e.user_count_limit),e.relate_service!=null&&Object.hasOwnProperty.call(e,"relate_service")&&r.uint32(202).string(e.relate_service),e.biz_version!=null&&Object.hasOwnProperty.call(e,"biz_version")&&r.uint32(210).string(e.biz_version),e.login_logic!=null&&Object.hasOwnProperty.call(e,"login_logic")&&r.uint32(216).uint32(e.login_logic),e.sdk_conn_type!=null&&Object.hasOwnProperty.call(e,"sdk_conn_type")&&r.uint32(224).int32(e.sdk_conn_type),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.LoginRoomReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.app_id=e.uint32();break;case 2:s.id_name=e.bytes();break;case 3:s.device_id=e.string();break;case 4:s.term_type=e.int32();break;case 5:s.net_type=e.int32();break;case 6:s.sdk_ver=e.uint32();break;case 7:s.proto_ver=e.int32();break;case 8:s.nick_name=e.bytes();break;case 9:s.client_stamp=e.bytes();break;case 10:s.crypt_version=e.uint32();break;case 11:s.k1_sign=e.bytes();break;case 12:s.login_token=e.bytes();break;case 13:s.relogin_token=e.bytes();break;case 14:s.role=e.uint32();break;case 15:s.liveroom_session_id=e.uint64();break;case 16:s.room_id=e.bytes();break;case 17:s.room_name=e.bytes();break;case 18:s.biz_type=e.uint32();break;case 19:s.room_create_flag=e.uint32();break;case 20:s.user_state_flag=e.uint32();break;case 21:s.lv_key=e.string();break;case 22:s.third_token=e.bytes();break;case 23:s.cluster_req=e.uint32();break;case 24:s.user_count_limit=e.uint32();break;case 25:s.relate_service=e.string();break;case 26:s.biz_version=e.string();break;case 27:s.login_logic=e.uint32();break;case 28:s.sdk_conn_type=e.int32();break;default:e.skipType(7&u)}}return s},t}(),_.LoginRoomRsp=function(){function t(e){if(this.stream_info=[],this.stream_mix_info=[],this.trans_seqs=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.room_id=o.newBuffer([]),t.prototype.heartbeat_interval=0,t.prototype.heartbeat_timeout=0,t.prototype.ret_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.crypt_option=0,t.prototype.k2_sign=o.newBuffer([]),t.prototype.liveroom_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.liveroom_hb_interval=0,t.prototype.liveroom_hb_timeout=0,t.prototype.anchor_info=null,t.prototype.stream_seq=0,t.prototype.stream_info=o.emptyArray,t.prototype.stream_fetch_flag=0,t.prototype.lv_key="",t.prototype.zp_key="",t.prototype.online_count=0,t.prototype.bigim_time_window=0,t.prototype.dati_time_window=0,t.prototype.cluster_name="",t.prototype.relogin_token=o.newBuffer([]),t.prototype.stream_mix_info=o.emptyArray,t.prototype.userlist_merge_timeout=0,t.prototype.userlist_interval=0,t.prototype.room_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.trans_seqs=o.emptyArray,t.prototype.stream_list_push_merge_timeout=0,t.prototype.stream_list_hb_wait_merge_time=0,t.prototype.trans_list_seq=0,t.prototype.token_remain_time=0,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.proto_switch.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.heartbeat_interval!=null&&Object.hasOwnProperty.call(e,"heartbeat_interval")&&r.uint32(24).uint32(e.heartbeat_interval),e.heartbeat_timeout!=null&&Object.hasOwnProperty.call(e,"heartbeat_timeout")&&r.uint32(32).uint32(e.heartbeat_timeout),e.ret_timestamp!=null&&Object.hasOwnProperty.call(e,"ret_timestamp")&&r.uint32(40).int64(e.ret_timestamp),e.crypt_option!=null&&Object.hasOwnProperty.call(e,"crypt_option")&&r.uint32(48).uint32(e.crypt_option),e.k2_sign!=null&&Object.hasOwnProperty.call(e,"k2_sign")&&r.uint32(58).bytes(e.k2_sign),e.liveroom_session_id!=null&&Object.hasOwnProperty.call(e,"liveroom_session_id")&&r.uint32(64).uint64(e.liveroom_session_id),e.liveroom_hb_interval!=null&&Object.hasOwnProperty.call(e,"liveroom_hb_interval")&&r.uint32(72).uint32(e.liveroom_hb_interval),e.liveroom_hb_timeout!=null&&Object.hasOwnProperty.call(e,"liveroom_hb_timeout")&&r.uint32(80).uint32(e.liveroom_hb_timeout),e.anchor_info!=null&&Object.hasOwnProperty.call(e,"anchor_info")&&n.proto_switch.StAnchorInfo.encode(e.anchor_info,r.uint32(90).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(96).uint32(e.stream_seq),e.stream_info!=null&&e.stream_info.length)for(var i=0;i<e.stream_info.length;++i)n.proto_switch.StStreamInfo.encode(e.stream_info[i],r.uint32(106).fork()).ldelim();if(e.stream_fetch_flag!=null&&Object.hasOwnProperty.call(e,"stream_fetch_flag")&&r.uint32(112).uint32(e.stream_fetch_flag),e.lv_key!=null&&Object.hasOwnProperty.call(e,"lv_key")&&r.uint32(122).string(e.lv_key),e.zp_key!=null&&Object.hasOwnProperty.call(e,"zp_key")&&r.uint32(130).string(e.zp_key),e.online_count!=null&&Object.hasOwnProperty.call(e,"online_count")&&r.uint32(136).uint32(e.online_count),e.bigim_time_window!=null&&Object.hasOwnProperty.call(e,"bigim_time_window")&&r.uint32(144).uint32(e.bigim_time_window),e.dati_time_window!=null&&Object.hasOwnProperty.call(e,"dati_time_window")&&r.uint32(152).uint32(e.dati_time_window),e.cluster_name!=null&&Object.hasOwnProperty.call(e,"cluster_name")&&r.uint32(162).string(e.cluster_name),e.relogin_token!=null&&Object.hasOwnProperty.call(e,"relogin_token")&&r.uint32(170).bytes(e.relogin_token),e.stream_mix_info!=null&&e.stream_mix_info.length)for(i=0;i<e.stream_mix_info.length;++i)n.proto_switch.StStreamInfo.encode(e.stream_mix_info[i],r.uint32(178).fork()).ldelim();if(e.userlist_merge_timeout!=null&&Object.hasOwnProperty.call(e,"userlist_merge_timeout")&&r.uint32(184).uint32(e.userlist_merge_timeout),e.userlist_interval!=null&&Object.hasOwnProperty.call(e,"userlist_interval")&&r.uint32(192).uint32(e.userlist_interval),e.room_session_id!=null&&Object.hasOwnProperty.call(e,"room_session_id")&&r.uint32(200).uint64(e.room_session_id),e.trans_seqs!=null&&e.trans_seqs.length)for(i=0;i<e.trans_seqs.length;++i)n.proto_switch.StTransInfo.encode(e.trans_seqs[i],r.uint32(210).fork()).ldelim();return e.stream_list_push_merge_timeout!=null&&Object.hasOwnProperty.call(e,"stream_list_push_merge_timeout")&&r.uint32(216).uint32(e.stream_list_push_merge_timeout),e.stream_list_hb_wait_merge_time!=null&&Object.hasOwnProperty.call(e,"stream_list_hb_wait_merge_time")&&r.uint32(224).uint32(e.stream_list_hb_wait_merge_time),e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(232).uint32(e.trans_list_seq),e.token_remain_time!=null&&Object.hasOwnProperty.call(e,"token_remain_time")&&r.uint32(240).uint32(e.token_remain_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.LoginRoomRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.proto_switch.RspHead.decode(e,e.uint32());break;case 2:s.room_id=e.bytes();break;case 3:s.heartbeat_interval=e.uint32();break;case 4:s.heartbeat_timeout=e.uint32();break;case 5:s.ret_timestamp=e.int64();break;case 6:s.crypt_option=e.uint32();break;case 7:s.k2_sign=e.bytes();break;case 8:s.liveroom_session_id=e.uint64();break;case 9:s.liveroom_hb_interval=e.uint32();break;case 10:s.liveroom_hb_timeout=e.uint32();break;case 11:s.anchor_info=n.proto_switch.StAnchorInfo.decode(e,e.uint32());break;case 12:s.stream_seq=e.uint32();break;case 13:s.stream_info&&s.stream_info.length||(s.stream_info=[]),s.stream_info.push(n.proto_switch.StStreamInfo.decode(e,e.uint32()));break;case 14:s.stream_fetch_flag=e.uint32();break;case 15:s.lv_key=e.string();break;case 16:s.zp_key=e.string();break;case 17:s.online_count=e.uint32();break;case 18:s.bigim_time_window=e.uint32();break;case 19:s.dati_time_window=e.uint32();break;case 20:s.cluster_name=e.string();break;case 21:s.relogin_token=e.bytes();break;case 22:s.stream_mix_info&&s.stream_mix_info.length||(s.stream_mix_info=[]),s.stream_mix_info.push(n.proto_switch.StStreamInfo.decode(e,e.uint32()));break;case 23:s.userlist_merge_timeout=e.uint32();break;case 24:s.userlist_interval=e.uint32();break;case 25:s.room_session_id=e.uint64();break;case 26:s.trans_seqs&&s.trans_seqs.length||(s.trans_seqs=[]),s.trans_seqs.push(n.proto_switch.StTransInfo.decode(e,e.uint32()));break;case 27:s.stream_list_push_merge_timeout=e.uint32();break;case 28:s.stream_list_hb_wait_merge_time=e.uint32();break;case 29:s.trans_list_seq=e.uint32();break;case 30:s.token_remain_time=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),_.StAnchorInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.anchor_id_name=o.newBuffer([]),t.prototype.anchor_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.anchor_nick_name=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.anchor_id_name!=null&&Object.hasOwnProperty.call(e,"anchor_id_name")&&r.uint32(10).bytes(e.anchor_id_name),e.anchor_id!=null&&Object.hasOwnProperty.call(e,"anchor_id")&&r.uint32(16).uint64(e.anchor_id),e.anchor_nick_name!=null&&Object.hasOwnProperty.call(e,"anchor_nick_name")&&r.uint32(26).bytes(e.anchor_nick_name),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.StAnchorInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.anchor_id_name=e.bytes();break;case 2:s.anchor_id=e.uint64();break;case 3:s.anchor_nick_name=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.StStreamInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.stream_id=o.newBuffer([]),t.prototype.stream_sid="",t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.create_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.extra_info=o.newBuffer([]),t.prototype.title=o.newBuffer([]),t.prototype.stream_ver=0,t.prototype.stream_attr=o.newBuffer([]),t.prototype.stream_src=0,t.prototype.stream_state=0,t.prototype.stream_type=0,t.prototype.stream_nid=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(10).bytes(e.stream_id),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(18).string(e.stream_sid),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(26).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(34).bytes(e.nick_name),e.create_time!=null&&Object.hasOwnProperty.call(e,"create_time")&&r.uint32(41).fixed64(e.create_time),e.extra_info!=null&&Object.hasOwnProperty.call(e,"extra_info")&&r.uint32(50).bytes(e.extra_info),e.title!=null&&Object.hasOwnProperty.call(e,"title")&&r.uint32(58).bytes(e.title),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(64).uint32(e.stream_ver),e.stream_attr!=null&&Object.hasOwnProperty.call(e,"stream_attr")&&r.uint32(74).bytes(e.stream_attr),e.stream_src!=null&&Object.hasOwnProperty.call(e,"stream_src")&&r.uint32(80).uint32(e.stream_src),e.stream_state!=null&&Object.hasOwnProperty.call(e,"stream_state")&&r.uint32(88).uint32(e.stream_state),e.stream_type!=null&&Object.hasOwnProperty.call(e,"stream_type")&&r.uint32(96).uint32(e.stream_type),e.stream_nid!=null&&Object.hasOwnProperty.call(e,"stream_nid")&&r.uint32(104).uint32(e.stream_nid),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.StStreamInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.stream_id=e.bytes();break;case 2:s.stream_sid=e.string();break;case 3:s.id_name=e.bytes();break;case 4:s.nick_name=e.bytes();break;case 5:s.create_time=e.fixed64();break;case 6:s.extra_info=e.bytes();break;case 7:s.title=e.bytes();break;case 8:s.stream_ver=e.uint32();break;case 9:s.stream_attr=e.bytes();break;case 10:s.stream_src=e.uint32();break;case 11:s.stream_state=e.uint32();break;case 12:s.stream_type=e.uint32();break;case 13:s.stream_nid=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),_.StTransSeqInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(16).uint32(e.trans_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.StTransSeqInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),_.StTransInfo=function(){function t(e){if(this.trans_seq_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_seq_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(10).bytes(e.trans_channel),e.trans_seq_array!=null&&e.trans_seq_array.length)for(var i=0;i<e.trans_seq_array.length;++i)n.proto_switch.StTransSeqInfo.encode(e.trans_seq_array[i],r.uint32(18).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.StTransInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_channel=e.bytes();break;case 2:s.trans_seq_array&&s.trans_seq_array.length||(s.trans_seq_array=[]),s.trans_seq_array.push(n.proto_switch.StTransSeqInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),_.LogoutRoomReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.logout_code=0,t.prototype.logout_check=o.newBuffer([]),t.prototype.liveroom_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.room_id=o.newBuffer([]),t.prototype.role=0,t.prototype.nickname=o.newBuffer([]),t.prototype.logout_logic=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.logout_code!=null&&Object.hasOwnProperty.call(e,"logout_code")&&r.uint32(8).uint32(e.logout_code),e.logout_check!=null&&Object.hasOwnProperty.call(e,"logout_check")&&r.uint32(18).bytes(e.logout_check),e.liveroom_session_id!=null&&Object.hasOwnProperty.call(e,"liveroom_session_id")&&r.uint32(24).uint64(e.liveroom_session_id),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(34).bytes(e.room_id),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(40).uint32(e.role),e.nickname!=null&&Object.hasOwnProperty.call(e,"nickname")&&r.uint32(50).bytes(e.nickname),e.logout_logic!=null&&Object.hasOwnProperty.call(e,"logout_logic")&&r.uint32(56).uint32(e.logout_logic),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.LogoutRoomReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.logout_code=e.uint32();break;case 2:s.logout_check=e.bytes();break;case 3:s.liveroom_session_id=e.uint64();break;case 4:s.room_id=e.bytes();break;case 5:s.role=e.uint32();break;case 6:s.nickname=e.bytes();break;case 7:s.logout_logic=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),_.LogoutRoomRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.proto_switch.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.LogoutRoomRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.proto_switch.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),_.TcpHbReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.TcpHbReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.TcpHbRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.heartbeat_interval=0,t.prototype.heartbeat_timeout=0,t.prototype.server_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.proto_switch.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.heartbeat_interval!=null&&Object.hasOwnProperty.call(e,"heartbeat_interval")&&r.uint32(16).uint32(e.heartbeat_interval),e.heartbeat_timeout!=null&&Object.hasOwnProperty.call(e,"heartbeat_timeout")&&r.uint32(24).uint32(e.heartbeat_timeout),e.server_timestamp!=null&&Object.hasOwnProperty.call(e,"server_timestamp")&&r.uint32(32).int64(e.server_timestamp),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.TcpHbRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.proto_switch.RspHead.decode(e,e.uint32());break;case 2:s.heartbeat_interval=e.uint32();break;case 3:s.heartbeat_timeout=e.uint32();break;case 4:s.server_timestamp=e.int64();break;default:e.skipType(7&u)}}return s},t}(),_.TermType=(m={},(h=Object.create(m))[m[0]="TT_NONE"]=0,h[m[1]="TT_PC"]=1,h[m[2]="TT_IOS"]=2,h[m[3]="TT_ANDROID"]=3,h[m[4]="TT_MAC"]=4,h[m[5]="TT_LINUX"]=5,h[m[6]="TT_WEB"]=6,h[m[7]="TT_MINIPROGRAM"]=7,h[m[32]="TT_UNKNOWN"]=32,h),_.NetType=function(){var t={},e=Object.create(t);return e[t[0]="NT_NONE"]=0,e[t[1]="NT_LINE"]=1,e[t[2]="NT_WIFI"]=2,e[t[3]="NT_2G"]=3,e[t[4]="NT_3G"]=4,e[t[5]="NT_4G"]=5,e[t[32]="NT_UNKNOWN"]=32,e}(),_.ProductType=function(){var t={},e=Object.create(t);return e[t[0]="PRODUCT_TYPE_NONE"]=0,e[t[1]="PRODUCT_TYPE_LIVEROOM"]=1,e[t[2]="PRODUCT_TYPE_IM"]=2,e}(),_.LiveroomProtoVersion=function(){var t={},e=Object.create(t);return e[t[0]="PROTO_VERSION_NONE"]=0,e[t[131072]="RPOTO_V020000"]=131072,e}(),_.SdkConnType=function(){var t={},e=Object.create(t);return e[t[0]="SdkConnType_None"]=0,e[t[1]="SdkConnType_Tcp"]=1,e[t[2]="SdkConnType_Websocket"]=2,e}(),_.Header=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.cmd="",t.prototype.seq=0,t.prototype.timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.app_id=0,t.prototype.user_id="",t.prototype.session_id=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.user_nid=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.controls=o.newBuffer([]),t.prototype.product=0,t.prototype.flags=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.cmd!=null&&Object.hasOwnProperty.call(e,"cmd")&&r.uint32(10).string(e.cmd),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&r.uint32(16).uint32(e.seq),e.timestamp!=null&&Object.hasOwnProperty.call(e,"timestamp")&&r.uint32(24).int64(e.timestamp),e.app_id!=null&&Object.hasOwnProperty.call(e,"app_id")&&r.uint32(32).uint32(e.app_id),e.user_id!=null&&Object.hasOwnProperty.call(e,"user_id")&&r.uint32(42).string(e.user_id),e.session_id!=null&&Object.hasOwnProperty.call(e,"session_id")&&r.uint32(48).int64(e.session_id),e.user_nid!=null&&Object.hasOwnProperty.call(e,"user_nid")&&r.uint32(56).int64(e.user_nid),e.controls!=null&&Object.hasOwnProperty.call(e,"controls")&&r.uint32(66).bytes(e.controls),e.product!=null&&Object.hasOwnProperty.call(e,"product")&&r.uint32(72).int32(e.product),e.flags!=null&&Object.hasOwnProperty.call(e,"flags")&&r.uint32(82).bytes(e.flags),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.Header;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.cmd=e.string();break;case 2:s.seq=e.uint32();break;case 3:s.timestamp=e.int64();break;case 4:s.app_id=e.uint32();break;case 5:s.user_id=e.string();break;case 6:s.session_id=e.int64();break;case 7:s.user_nid=e.int64();break;case 8:s.controls=e.bytes();break;case 9:s.product=e.int32();break;case 10:s.flags=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.PushKickout=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.reason=0,t.prototype.message="",t.prototype.need_relogin=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.reason!=null&&Object.hasOwnProperty.call(e,"reason")&&r.uint32(8).uint32(e.reason),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(18).string(e.message),e.need_relogin!=null&&Object.hasOwnProperty.call(e,"need_relogin")&&r.uint32(24).uint32(e.need_relogin),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.PushKickout;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.reason=e.uint32();break;case 2:s.message=e.string();break;case 3:s.need_relogin=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),_.PushRedirect2Sdk=function(){function t(e){if(this.redirect_server=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.redirect_server=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.redirect_server!=null&&e.redirect_server.length)for(var i=0;i<e.redirect_server.length;++i)r.uint32(10).string(e.redirect_server[i]);return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.PushRedirect2Sdk;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.redirect_server&&s.redirect_server.length||(s.redirect_server=[]),s.redirect_server.push(e.string());break;default:e.skipType(7&u)}}return s},t}(),_.PushReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.head=null,t.prototype.msg_body=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.head!=null&&Object.hasOwnProperty.call(e,"head")&&n.proto_switch.PushReqHead.encode(e.head,r.uint32(10).fork()).ldelim(),e.msg_body!=null&&Object.hasOwnProperty.call(e,"msg_body")&&r.uint32(18).bytes(e.msg_body),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.PushReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.head=n.proto_switch.PushReqHead.decode(e,e.uint32());break;case 2:s.msg_body=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.PushReqHead=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.sub_cmd="",t.prototype.sender_user_id="",t.prototype.qos_flag=0,t.prototype.msg_id="",t.prototype.send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.room_id=o.newBuffer([]),t.prototype.sender_user_nid=o.Long?o.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.sub_cmd!=null&&Object.hasOwnProperty.call(e,"sub_cmd")&&r.uint32(10).string(e.sub_cmd),e.sender_user_id!=null&&Object.hasOwnProperty.call(e,"sender_user_id")&&r.uint32(18).string(e.sender_user_id),e.qos_flag!=null&&Object.hasOwnProperty.call(e,"qos_flag")&&r.uint32(24).uint32(e.qos_flag),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(34).string(e.msg_id),e.send_time!=null&&Object.hasOwnProperty.call(e,"send_time")&&r.uint32(40).int64(e.send_time),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(50).bytes(e.room_id),e.sender_user_nid!=null&&Object.hasOwnProperty.call(e,"sender_user_nid")&&r.uint32(56).uint64(e.sender_user_nid),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.PushReqHead;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.sub_cmd=e.string();break;case 2:s.sender_user_id=e.string();break;case 3:s.qos_flag=e.uint32();break;case 4:s.msg_id=e.string();break;case 5:s.send_time=e.int64();break;case 6:s.room_id=e.bytes();break;case 7:s.sender_user_nid=e.uint64();break;default:e.skipType(7&u)}}return s},t}(),_.PushRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.code=0,t.prototype.message="",t.prototype.sub_cmd="",t.prototype.msg_id="",t.prototype.server_send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&r.uint32(8).uint32(e.code),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(18).string(e.message),e.sub_cmd!=null&&Object.hasOwnProperty.call(e,"sub_cmd")&&r.uint32(26).string(e.sub_cmd),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(34).string(e.msg_id),e.server_send_time!=null&&Object.hasOwnProperty.call(e,"server_send_time")&&r.uint32(40).int64(e.server_send_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.PushRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.code=e.uint32();break;case 2:s.message=e.string();break;case 3:s.sub_cmd=e.string();break;case 4:s.msg_id=e.string();break;case 5:s.server_send_time=e.int64();break;default:e.skipType(7&u)}}return s},t}(),_.MergePushHead=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.qos_flag=0,t.prototype.send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.room_id=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.qos_flag!=null&&Object.hasOwnProperty.call(e,"qos_flag")&&r.uint32(8).uint32(e.qos_flag),e.send_time!=null&&Object.hasOwnProperty.call(e,"send_time")&&r.uint32(16).int64(e.send_time),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(26).bytes(e.room_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.MergePushHead;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.qos_flag=e.uint32();break;case 2:s.send_time=e.int64();break;case 3:s.room_id=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.MergePushInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.sub_cmd="",t.prototype.sub_seq=0,t.prototype.sender_nid=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.msg_id=o.newBuffer([]),t.prototype.msg_body=o.newBuffer([]),t.prototype.msg_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.sub_cmd!=null&&Object.hasOwnProperty.call(e,"sub_cmd")&&r.uint32(10).string(e.sub_cmd),e.sub_seq!=null&&Object.hasOwnProperty.call(e,"sub_seq")&&r.uint32(16).uint32(e.sub_seq),e.sender_nid!=null&&Object.hasOwnProperty.call(e,"sender_nid")&&r.uint32(24).uint64(e.sender_nid),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(34).bytes(e.msg_id),e.msg_body!=null&&Object.hasOwnProperty.call(e,"msg_body")&&r.uint32(42).bytes(e.msg_body),e.msg_timestamp!=null&&Object.hasOwnProperty.call(e,"msg_timestamp")&&r.uint32(48).int64(e.msg_timestamp),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.MergePushInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.sub_cmd=e.string();break;case 2:s.sub_seq=e.uint32();break;case 3:s.sender_nid=e.uint64();break;case 4:s.msg_id=e.bytes();break;case 5:s.msg_body=e.bytes();break;case 6:s.msg_timestamp=e.int64();break;default:e.skipType(7&u)}}return s},t}(),_.CmdMergePushReq=function(){function t(e){if(this.messages=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.head=null,t.prototype.messages=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.head!=null&&Object.hasOwnProperty.call(e,"head")&&n.proto_switch.MergePushHead.encode(e.head,r.uint32(10).fork()).ldelim(),e.messages!=null&&e.messages.length)for(var i=0;i<e.messages.length;++i)n.proto_switch.MergePushInfo.encode(e.messages[i],r.uint32(18).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.CmdMergePushReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.head=n.proto_switch.MergePushHead.decode(e,e.uint32());break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.push(n.proto_switch.MergePushInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),_.CmdMergePushRspInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.sub_cmd="",t.prototype.sub_seq=0,t.prototype.msg_id=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.sub_cmd!=null&&Object.hasOwnProperty.call(e,"sub_cmd")&&r.uint32(10).string(e.sub_cmd),e.sub_seq!=null&&Object.hasOwnProperty.call(e,"sub_seq")&&r.uint32(16).uint32(e.sub_seq),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(26).bytes(e.msg_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.CmdMergePushRspInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.sub_cmd=e.string();break;case 2:s.sub_seq=e.uint32();break;case 3:s.msg_id=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),_.CmdMergePushRsp=function(){function t(e){if(this.messages=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.messages=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.messages!=null&&e.messages.length)for(var i=0;i<e.messages.length;++i)n.proto_switch.CmdMergePushRspInfo.encode(e.messages[i],r.uint32(10).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.proto_switch.CmdMergePushRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.messages&&s.messages.length||(s.messages=[]),s.messages.push(n.proto_switch.CmdMergePushRspInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),_),n.liveroom_cs=((d={}).ReqHead=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id="",t.prototype.user_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.room_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).string(e.room_id),e.user_session_id!=null&&Object.hasOwnProperty.call(e,"user_session_id")&&r.uint32(16).uint64(e.user_session_id),e.room_session_id!=null&&Object.hasOwnProperty.call(e,"room_session_id")&&r.uint32(24).uint64(e.room_session_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.ReqHead;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.string();break;case 2:s.user_session_id=e.uint64();break;case 3:s.room_session_id=e.uint64();break;default:e.skipType(7&u)}}return s},t}(),d.RspHead=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.code=0,t.prototype.message="",t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&r.uint32(8).uint32(e.code),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(18).string(e.message),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RspHead;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.code=e.uint32();break;case 2:s.message=e.string();break;default:e.skipType(7&u)}}return s},t}(),d.CommonRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.CommonRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.HbReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.role=0,t.prototype.lv_key="",t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(16).uint32(e.role),e.lv_key!=null&&Object.hasOwnProperty.call(e,"lv_key")&&r.uint32(26).string(e.lv_key),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.HbReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.role=e.uint32();break;case 3:s.lv_key=e.string();break;default:e.skipType(7&u)}}return s},t}(),d.HbRsp=function(){function t(e){if(this.trans_seqs=[],this.user_trans_seqs=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.ret_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.hb_interval=0,t.prototype.hb_timeout=0,t.prototype.stream_seq=0,t.prototype.user_seq=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.online_count=0,t.prototype.bigim_time_window=0,t.prototype.dati_time_window=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.trans_seqs=o.emptyArray,t.prototype.user_trans_seqs=o.emptyArray,t.prototype.StreamRefresh=0,t.prototype.trans_list_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.ret_timestamp!=null&&Object.hasOwnProperty.call(e,"ret_timestamp")&&r.uint32(16).int64(e.ret_timestamp),e.hb_interval!=null&&Object.hasOwnProperty.call(e,"hb_interval")&&r.uint32(24).uint32(e.hb_interval),e.hb_timeout!=null&&Object.hasOwnProperty.call(e,"hb_timeout")&&r.uint32(32).uint32(e.hb_timeout),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(40).uint32(e.stream_seq),e.user_seq!=null&&Object.hasOwnProperty.call(e,"user_seq")&&r.uint32(48).int64(e.user_seq),e.online_count!=null&&Object.hasOwnProperty.call(e,"online_count")&&r.uint32(56).uint32(e.online_count),e.bigim_time_window!=null&&Object.hasOwnProperty.call(e,"bigim_time_window")&&r.uint32(64).uint32(e.bigim_time_window),e.dati_time_window!=null&&Object.hasOwnProperty.call(e,"dati_time_window")&&r.uint32(72).int64(e.dati_time_window),e.trans_seqs!=null&&e.trans_seqs.length)for(var i=0;i<e.trans_seqs.length;++i)n.liveroom_cs.StTransChannelSeq.encode(e.trans_seqs[i],r.uint32(82).fork()).ldelim();if(e.user_trans_seqs!=null&&e.user_trans_seqs.length)for(i=0;i<e.user_trans_seqs.length;++i)n.liveroom_cs.StTransChannelSeq.encode(e.user_trans_seqs[i],r.uint32(90).fork()).ldelim();return e.StreamRefresh!=null&&Object.hasOwnProperty.call(e,"StreamRefresh")&&r.uint32(96).uint32(e.StreamRefresh),e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(104).uint32(e.trans_list_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.HbRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.ret_timestamp=e.int64();break;case 3:s.hb_interval=e.uint32();break;case 4:s.hb_timeout=e.uint32();break;case 5:s.stream_seq=e.uint32();break;case 6:s.user_seq=e.int64();break;case 7:s.online_count=e.uint32();break;case 8:s.bigim_time_window=e.uint32();break;case 9:s.dati_time_window=e.int64();break;case 10:s.trans_seqs&&s.trans_seqs.length||(s.trans_seqs=[]),s.trans_seqs.push(n.liveroom_cs.StTransChannelSeq.decode(e,e.uint32()));break;case 11:s.user_trans_seqs&&s.user_trans_seqs.length||(s.user_trans_seqs=[]),s.user_trans_seqs.push(n.liveroom_cs.StTransChannelSeq.decode(e,e.uint32()));break;case 12:s.StreamRefresh=e.uint32();break;case 13:s.trans_list_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StTransSeq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(16).uint32(e.trans_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransSeq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StTransChannelSeq=function(){function t(e){if(this.trans_seq_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_seq_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(10).bytes(e.trans_channel),e.trans_seq_array!=null&&e.trans_seq_array.length)for(var i=0;i<e.trans_seq_array.length;++i)n.liveroom_cs.StTransSeq.encode(e.trans_seq_array[i],r.uint32(18).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransChannelSeq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_channel=e.bytes();break;case 2:s.trans_seq_array&&s.trans_seq_array.length||(s.trans_seq_array=[]),s.trans_seq_array.push(n.liveroom_cs.StTransSeq.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.UserlistReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.sort_type=0,t.prototype.user_index=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.sort_type!=null&&Object.hasOwnProperty.call(e,"sort_type")&&r.uint32(16).uint32(e.sort_type),e.user_index!=null&&Object.hasOwnProperty.call(e,"user_index")&&r.uint32(24).uint32(e.user_index),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.UserlistReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.sort_type=e.uint32();break;case 3:s.user_index=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.UserlistRsp=function(){function t(e){if(this.user_basic_list=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.server_user_seq=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.server_user_index=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.ret_user_index=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.user_basic_list=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.server_user_seq!=null&&Object.hasOwnProperty.call(e,"server_user_seq")&&r.uint32(16).uint64(e.server_user_seq),e.server_user_index!=null&&Object.hasOwnProperty.call(e,"server_user_index")&&r.uint32(24).int64(e.server_user_index),e.ret_user_index!=null&&Object.hasOwnProperty.call(e,"ret_user_index")&&r.uint32(32).int64(e.ret_user_index),e.user_basic_list!=null&&e.user_basic_list.length)for(var i=0;i<e.user_basic_list.length;++i)n.liveroom_cs.StUserBasicDef.encode(e.user_basic_list[i],r.uint32(42).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.UserlistRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.server_user_seq=e.uint64();break;case 3:s.server_user_index=e.int64();break;case 4:s.ret_user_index=e.int64();break;case 5:s.user_basic_list&&s.user_basic_list.length||(s.user_basic_list=[]),s.user_basic_list.push(n.liveroom_cs.StUserBasicDef.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StUserBasicDef=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StUserBasicDef;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StreamAddReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.stream_id=o.newBuffer([]),t.prototype.title=o.newBuffer([]),t.prototype.stream_attr=o.newBuffer([]),t.prototype.extra_info=o.newBuffer([]),t.prototype.client_req_seq=0,t.prototype.nickname=o.newBuffer([]),t.prototype.login_mode=0,t.prototype.stream_type=0,t.prototype.third_token=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(18).bytes(e.stream_id),e.title!=null&&Object.hasOwnProperty.call(e,"title")&&r.uint32(26).bytes(e.title),e.stream_attr!=null&&Object.hasOwnProperty.call(e,"stream_attr")&&r.uint32(34).bytes(e.stream_attr),e.extra_info!=null&&Object.hasOwnProperty.call(e,"extra_info")&&r.uint32(42).bytes(e.extra_info),e.client_req_seq!=null&&Object.hasOwnProperty.call(e,"client_req_seq")&&r.uint32(48).uint32(e.client_req_seq),e.nickname!=null&&Object.hasOwnProperty.call(e,"nickname")&&r.uint32(58).bytes(e.nickname),e.login_mode!=null&&Object.hasOwnProperty.call(e,"login_mode")&&r.uint32(64).uint32(e.login_mode),e.stream_type!=null&&Object.hasOwnProperty.call(e,"stream_type")&&r.uint32(72).uint32(e.stream_type),e.third_token!=null&&Object.hasOwnProperty.call(e,"third_token")&&r.uint32(82).bytes(e.third_token),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamAddReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.stream_id=e.bytes();break;case 3:s.title=e.bytes();break;case 4:s.stream_attr=e.bytes();break;case 5:s.extra_info=e.bytes();break;case 6:s.client_req_seq=e.uint32();break;case 7:s.nickname=e.bytes();break;case 8:s.login_mode=e.uint32();break;case 9:s.stream_type=e.uint32();break;case 10:s.third_token=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.StreamAddRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.stream_seq=0,t.prototype.stream_sid="",t.prototype.stream_ver=0,t.prototype.stream_nid=0,t.prototype.token_remain_time=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(16).uint32(e.stream_seq),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(26).string(e.stream_sid),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(32).uint32(e.stream_ver),e.stream_nid!=null&&Object.hasOwnProperty.call(e,"stream_nid")&&r.uint32(40).uint32(e.stream_nid),e.token_remain_time!=null&&Object.hasOwnProperty.call(e,"token_remain_time")&&r.uint32(48).uint32(e.token_remain_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamAddRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.stream_seq=e.uint32();break;case 3:s.stream_sid=e.string();break;case 4:s.stream_ver=e.uint32();break;case 5:s.stream_nid=e.uint32();break;case 6:s.token_remain_time=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StreamDeleteReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.stream_sid="",t.prototype.stream_id=o.newBuffer([]),t.prototype.client_req_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(18).string(e.stream_sid),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(26).bytes(e.stream_id),e.client_req_seq!=null&&Object.hasOwnProperty.call(e,"client_req_seq")&&r.uint32(32).uint32(e.client_req_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamDeleteReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.stream_sid=e.string();break;case 3:s.stream_id=e.bytes();break;case 4:s.client_req_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StreamDeleteRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.stream_seq=0,t.prototype.stream_ver=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(16).uint32(e.stream_seq),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(24).uint32(e.stream_ver),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamDeleteRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.stream_seq=e.uint32();break;case 3:s.stream_ver=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StreamUpdateReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.stream_sid="",t.prototype.stream_id=o.newBuffer([]),t.prototype.title=o.newBuffer([]),t.prototype.stream_attr=o.newBuffer([]),t.prototype.extra_info=o.newBuffer([]),t.prototype.client_req_seq=0,t.prototype.nickname=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(18).string(e.stream_sid),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(26).bytes(e.stream_id),e.title!=null&&Object.hasOwnProperty.call(e,"title")&&r.uint32(34).bytes(e.title),e.stream_attr!=null&&Object.hasOwnProperty.call(e,"stream_attr")&&r.uint32(42).bytes(e.stream_attr),e.extra_info!=null&&Object.hasOwnProperty.call(e,"extra_info")&&r.uint32(50).bytes(e.extra_info),e.client_req_seq!=null&&Object.hasOwnProperty.call(e,"client_req_seq")&&r.uint32(56).uint32(e.client_req_seq),e.nickname!=null&&Object.hasOwnProperty.call(e,"nickname")&&r.uint32(66).bytes(e.nickname),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamUpdateReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.stream_sid=e.string();break;case 3:s.stream_id=e.bytes();break;case 4:s.title=e.bytes();break;case 5:s.stream_attr=e.bytes();break;case 6:s.extra_info=e.bytes();break;case 7:s.client_req_seq=e.uint32();break;case 8:s.nickname=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.StreamUpdateRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.stream_seq=0,t.prototype.stream_ver=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(16).uint32(e.stream_seq),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(24).uint32(e.stream_ver),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamUpdateRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.stream_seq=e.uint32();break;case 3:s.stream_ver=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StreamListReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamListReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.StreamListRsp=function(){function t(e){if(this.stream_info=[],this.stream_mix_info=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.stream_seq=0,t.prototype.stream_info=o.emptyArray,t.prototype.stream_refresh=0,t.prototype.stream_mix_info=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(16).uint32(e.stream_seq),e.stream_info!=null&&e.stream_info.length)for(var i=0;i<e.stream_info.length;++i)n.liveroom_cs.StStreamInfo.encode(e.stream_info[i],r.uint32(26).fork()).ldelim();if(e.stream_refresh!=null&&Object.hasOwnProperty.call(e,"stream_refresh")&&r.uint32(32).uint32(e.stream_refresh),e.stream_mix_info!=null&&e.stream_mix_info.length)for(i=0;i<e.stream_mix_info.length;++i)n.liveroom_cs.StStreamInfo.encode(e.stream_mix_info[i],r.uint32(42).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StreamListRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.stream_seq=e.uint32();break;case 3:s.stream_info&&s.stream_info.length||(s.stream_info=[]),s.stream_info.push(n.liveroom_cs.StStreamInfo.decode(e,e.uint32()));break;case 4:s.stream_refresh=e.uint32();break;case 5:s.stream_mix_info&&s.stream_mix_info.length||(s.stream_mix_info=[]),s.stream_mix_info.push(n.liveroom_cs.StStreamInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StStreamInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.stream_sid="",t.prototype.stream_id=o.newBuffer([]),t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.extra_info=o.newBuffer([]),t.prototype.title=o.newBuffer([]),t.prototype.stream_ver=0,t.prototype.stream_attr=o.newBuffer([]),t.prototype.create_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.stream_src=0,t.prototype.state=0,t.prototype.stream_type=0,t.prototype.stream_nid=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(10).string(e.stream_sid),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(18).bytes(e.stream_id),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(26).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(34).bytes(e.nick_name),e.extra_info!=null&&Object.hasOwnProperty.call(e,"extra_info")&&r.uint32(42).bytes(e.extra_info),e.title!=null&&Object.hasOwnProperty.call(e,"title")&&r.uint32(50).bytes(e.title),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(56).uint32(e.stream_ver),e.stream_attr!=null&&Object.hasOwnProperty.call(e,"stream_attr")&&r.uint32(66).bytes(e.stream_attr),e.create_time!=null&&Object.hasOwnProperty.call(e,"create_time")&&r.uint32(72).int64(e.create_time),e.stream_src!=null&&Object.hasOwnProperty.call(e,"stream_src")&&r.uint32(80).uint32(e.stream_src),e.state!=null&&Object.hasOwnProperty.call(e,"state")&&r.uint32(88).uint32(e.state),e.stream_type!=null&&Object.hasOwnProperty.call(e,"stream_type")&&r.uint32(96).uint32(e.stream_type),e.stream_nid!=null&&Object.hasOwnProperty.call(e,"stream_nid")&&r.uint32(104).uint32(e.stream_nid),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StStreamInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.stream_sid=e.string();break;case 2:s.stream_id=e.bytes();break;case 3:s.id_name=e.bytes();break;case 4:s.nick_name=e.bytes();break;case 5:s.extra_info=e.bytes();break;case 6:s.title=e.bytes();break;case 7:s.stream_ver=e.uint32();break;case 8:s.stream_attr=e.bytes();break;case 9:s.create_time=e.int64();break;case 10:s.stream_src=e.uint32();break;case 11:s.state=e.uint32();break;case 12:s.stream_type=e.uint32();break;case 13:s.stream_nid=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StDstUser=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.id=o.Long?o.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.id!=null&&Object.hasOwnProperty.call(e,"id")&&r.uint32(16).uint64(e.id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StDstUser;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.id=e.uint64();break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.push_message=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.push_message!=null&&Object.hasOwnProperty.call(e,"push_message")&&r.uint32(18).bytes(e.push_message),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.push_message=e.bytes();break;case 3:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveResultReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.push_message=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.push_message!=null&&Object.hasOwnProperty.call(e,"push_message")&&r.uint32(18).bytes(e.push_message),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveResultReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.push_message=e.bytes();break;case 3:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveResulRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveResulRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveInviteReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.push_message=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.push_message!=null&&Object.hasOwnProperty.call(e,"push_message")&&r.uint32(18).bytes(e.push_message),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveInviteReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.push_message=e.bytes();break;case 3:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveInviteRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveInviteRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveStopReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.push_message=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.push_message!=null&&Object.hasOwnProperty.call(e,"push_message")&&r.uint32(18).bytes(e.push_message),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveStopReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.push_message=e.bytes();break;case 3:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveStopRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveStopRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveCustomReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.push_message=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.push_message!=null&&Object.hasOwnProperty.call(e,"push_message")&&r.uint32(18).bytes(e.push_message),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveCustomReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.push_message=e.bytes();break;case 3:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.SignalLiveCustomRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.SignalLiveCustomRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.ImChatReq=function(){function t(e){if(this.dst_userlist=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.msg_category=0,t.prototype.msg_type=0,t.prototype.msg_priority=0,t.prototype.msg_content=o.newBuffer([]),t.prototype.dst_userlist=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.msg_category!=null&&Object.hasOwnProperty.call(e,"msg_category")&&r.uint32(16).uint32(e.msg_category),e.msg_type!=null&&Object.hasOwnProperty.call(e,"msg_type")&&r.uint32(24).uint32(e.msg_type),e.msg_priority!=null&&Object.hasOwnProperty.call(e,"msg_priority")&&r.uint32(32).uint32(e.msg_priority),e.msg_content!=null&&Object.hasOwnProperty.call(e,"msg_content")&&r.uint32(42).bytes(e.msg_content),e.dst_userlist!=null&&e.dst_userlist.length)for(var i=0;i<e.dst_userlist.length;++i)n.liveroom_cs.StDstUser.encode(e.dst_userlist[i],r.uint32(50).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.ImChatReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.msg_category=e.uint32();break;case 3:s.msg_type=e.uint32();break;case 4:s.msg_priority=e.uint32();break;case 5:s.msg_content=e.bytes();break;case 6:s.dst_userlist&&s.dst_userlist.length||(s.dst_userlist=[]),s.dst_userlist.push(n.liveroom_cs.StDstUser.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.ImChatRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(16).uint64(e.msg_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.ImChatRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.msg_id=e.uint64();break;default:e.skipType(7&u)}}return s},t}(),d.ImGethatReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.msg_priority=0,t.prototype.msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.sort_type=0,t.prototype.msg_count=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.msg_priority!=null&&Object.hasOwnProperty.call(e,"msg_priority")&&r.uint32(16).uint32(e.msg_priority),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(24).uint64(e.msg_id),e.sort_type!=null&&Object.hasOwnProperty.call(e,"sort_type")&&r.uint32(32).uint32(e.sort_type),e.msg_count!=null&&Object.hasOwnProperty.call(e,"msg_count")&&r.uint32(40).uint32(e.msg_count),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.ImGethatReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.msg_priority=e.uint32();break;case 3:s.msg_id=e.uint64();break;case 4:s.sort_type=e.uint32();break;case 5:s.msg_count=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.ImGetChatRsp=function(){function t(e){if(this.msg_data=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.server_msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.ret_msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.msg_data=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.server_msg_id!=null&&Object.hasOwnProperty.call(e,"server_msg_id")&&r.uint32(16).uint64(e.server_msg_id),e.ret_msg_id!=null&&Object.hasOwnProperty.call(e,"ret_msg_id")&&r.uint32(24).uint64(e.ret_msg_id),e.msg_data!=null&&e.msg_data.length)for(var i=0;i<e.msg_data.length;++i)n.liveroom_cs.StMsgData.encode(e.msg_data[i],r.uint32(34).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.ImGetChatRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.server_msg_id=e.uint64();break;case 3:s.ret_msg_id=e.uint64();break;case 4:s.msg_data&&s.msg_data.length||(s.msg_data=[]),s.msg_data.push(n.liveroom_cs.StMsgData.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StMsgData=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.msg_category=0,t.prototype.msg_type=0,t.prototype.msg_priority=0,t.prototype.msg_content=o.newBuffer([]),t.prototype.send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(32).uint64(e.msg_id),e.msg_category!=null&&Object.hasOwnProperty.call(e,"msg_category")&&r.uint32(40).uint32(e.msg_category),e.msg_type!=null&&Object.hasOwnProperty.call(e,"msg_type")&&r.uint32(48).uint32(e.msg_type),e.msg_priority!=null&&Object.hasOwnProperty.call(e,"msg_priority")&&r.uint32(56).uint32(e.msg_priority),e.msg_content!=null&&Object.hasOwnProperty.call(e,"msg_content")&&r.uint32(66).bytes(e.msg_content),e.send_time!=null&&Object.hasOwnProperty.call(e,"send_time")&&r.uint32(72).int64(e.send_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StMsgData;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.msg_id=e.uint64();break;case 5:s.msg_category=e.uint32();break;case 6:s.msg_type=e.uint32();break;case 7:s.msg_priority=e.uint32();break;case 8:s.msg_content=e.bytes();break;case 9:s.send_time=e.int64();break;default:e.skipType(7&u)}}return s},t}(),d.EnterReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.switch_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.net_type=0,t.prototype.config=null,t.prototype.lv_key="",t.prototype.third_token=o.newBuffer([]),t.prototype.cluster_req=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.user_count_limit=0,t.prototype.relate_service="",t.prototype.conn_type=0,t.prototype.room_name=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.switch_session_id!=null&&Object.hasOwnProperty.call(e,"switch_session_id")&&r.uint32(16).uint64(e.switch_session_id),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(26).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(32).uint32(e.role),e.net_type!=null&&Object.hasOwnProperty.call(e,"net_type")&&r.uint32(40).uint32(e.net_type),e.config!=null&&Object.hasOwnProperty.call(e,"config")&&n.liveroom_cs.StConfigList.encode(e.config,r.uint32(50).fork()).ldelim(),e.lv_key!=null&&Object.hasOwnProperty.call(e,"lv_key")&&r.uint32(58).string(e.lv_key),e.third_token!=null&&Object.hasOwnProperty.call(e,"third_token")&&r.uint32(66).bytes(e.third_token),e.cluster_req!=null&&Object.hasOwnProperty.call(e,"cluster_req")&&r.uint32(72).uint64(e.cluster_req),e.user_count_limit!=null&&Object.hasOwnProperty.call(e,"user_count_limit")&&r.uint32(80).uint32(e.user_count_limit),e.relate_service!=null&&Object.hasOwnProperty.call(e,"relate_service")&&r.uint32(90).string(e.relate_service),e.conn_type!=null&&Object.hasOwnProperty.call(e,"conn_type")&&r.uint32(96).uint32(e.conn_type),e.room_name!=null&&Object.hasOwnProperty.call(e,"room_name")&&r.uint32(106).bytes(e.room_name),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.EnterReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.switch_session_id=e.uint64();break;case 3:s.nick_name=e.bytes();break;case 4:s.role=e.uint32();break;case 5:s.net_type=e.uint32();break;case 6:s.config=n.liveroom_cs.StConfigList.decode(e,e.uint32());break;case 7:s.lv_key=e.string();break;case 8:s.third_token=e.bytes();break;case 9:s.cluster_req=e.uint64();break;case 10:s.user_count_limit=e.uint32();break;case 11:s.relate_service=e.string();break;case 12:s.conn_type=e.uint32();break;case 13:s.room_name=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.EnterRsp=function(){function t(e){if(this.stream_info=[],this.stream_mix_info=[],this.trans_seqs=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.room_id=o.newBuffer([]),t.prototype.user_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.room_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.user_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.ret_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.bigim_time_window=0,t.prototype.dati_time_window=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.room_id32=0,t.prototype.hb_interval=0,t.prototype.hb_timeout=0,t.prototype.lv_key="",t.prototype.zp_key="",t.prototype.online_count=0,t.prototype.anchor_info=null,t.prototype.stream_seq=0,t.prototype.stream_info=o.emptyArray,t.prototype.stream_mix_info=o.emptyArray,t.prototype.userlist_merge_timeout=0,t.prototype.userlist_interval=0,t.prototype.stream_list_push_merge_timeout=0,t.prototype.stream_list_hb_wait_merge_time=0,t.prototype.trans_list_seq=0,t.prototype.trans_seqs=o.emptyArray,t.prototype.cluster_name="",t.prototype.token_remain_time=0,t.prototype.stream_fetch_flag=0,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.user_session_id!=null&&Object.hasOwnProperty.call(e,"user_session_id")&&r.uint32(24).uint64(e.user_session_id),e.room_session_id!=null&&Object.hasOwnProperty.call(e,"room_session_id")&&r.uint32(32).uint64(e.room_session_id),e.user_id!=null&&Object.hasOwnProperty.call(e,"user_id")&&r.uint32(40).uint64(e.user_id),e.ret_timestamp!=null&&Object.hasOwnProperty.call(e,"ret_timestamp")&&r.uint32(49).fixed64(e.ret_timestamp),e.bigim_time_window!=null&&Object.hasOwnProperty.call(e,"bigim_time_window")&&r.uint32(56).uint32(e.bigim_time_window),e.dati_time_window!=null&&Object.hasOwnProperty.call(e,"dati_time_window")&&r.uint32(64).int64(e.dati_time_window),e.room_id32!=null&&Object.hasOwnProperty.call(e,"room_id32")&&r.uint32(72).uint32(e.room_id32),e.hb_interval!=null&&Object.hasOwnProperty.call(e,"hb_interval")&&r.uint32(80).uint32(e.hb_interval),e.hb_timeout!=null&&Object.hasOwnProperty.call(e,"hb_timeout")&&r.uint32(88).uint32(e.hb_timeout),e.lv_key!=null&&Object.hasOwnProperty.call(e,"lv_key")&&r.uint32(98).string(e.lv_key),e.zp_key!=null&&Object.hasOwnProperty.call(e,"zp_key")&&r.uint32(106).string(e.zp_key),e.online_count!=null&&Object.hasOwnProperty.call(e,"online_count")&&r.uint32(112).uint32(e.online_count),e.anchor_info!=null&&Object.hasOwnProperty.call(e,"anchor_info")&&n.liveroom_cs.StAnchorInfo.encode(e.anchor_info,r.uint32(122).fork()).ldelim(),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(128).uint32(e.stream_seq),e.stream_info!=null&&e.stream_info.length)for(var i=0;i<e.stream_info.length;++i)n.liveroom_cs.StStreamInfo.encode(e.stream_info[i],r.uint32(138).fork()).ldelim();if(e.stream_mix_info!=null&&e.stream_mix_info.length)for(i=0;i<e.stream_mix_info.length;++i)n.liveroom_cs.StStreamInfo.encode(e.stream_mix_info[i],r.uint32(146).fork()).ldelim();if(e.userlist_merge_timeout!=null&&Object.hasOwnProperty.call(e,"userlist_merge_timeout")&&r.uint32(152).uint32(e.userlist_merge_timeout),e.userlist_interval!=null&&Object.hasOwnProperty.call(e,"userlist_interval")&&r.uint32(160).uint32(e.userlist_interval),e.stream_list_push_merge_timeout!=null&&Object.hasOwnProperty.call(e,"stream_list_push_merge_timeout")&&r.uint32(168).uint32(e.stream_list_push_merge_timeout),e.stream_list_hb_wait_merge_time!=null&&Object.hasOwnProperty.call(e,"stream_list_hb_wait_merge_time")&&r.uint32(176).uint32(e.stream_list_hb_wait_merge_time),e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(184).uint32(e.trans_list_seq),e.trans_seqs!=null&&e.trans_seqs.length)for(i=0;i<e.trans_seqs.length;++i)n.liveroom_cs.StTransInfo.encode(e.trans_seqs[i],r.uint32(194).fork()).ldelim();return e.cluster_name!=null&&Object.hasOwnProperty.call(e,"cluster_name")&&r.uint32(202).string(e.cluster_name),e.token_remain_time!=null&&Object.hasOwnProperty.call(e,"token_remain_time")&&r.uint32(208).uint32(e.token_remain_time),e.stream_fetch_flag!=null&&Object.hasOwnProperty.call(e,"stream_fetch_flag")&&r.uint32(216).uint32(e.stream_fetch_flag),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.EnterRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.room_id=e.bytes();break;case 3:s.user_session_id=e.uint64();break;case 4:s.room_session_id=e.uint64();break;case 5:s.user_id=e.uint64();break;case 6:s.ret_timestamp=e.fixed64();break;case 7:s.bigim_time_window=e.uint32();break;case 8:s.dati_time_window=e.int64();break;case 9:s.room_id32=e.uint32();break;case 10:s.hb_interval=e.uint32();break;case 11:s.hb_timeout=e.uint32();break;case 12:s.lv_key=e.string();break;case 13:s.zp_key=e.string();break;case 14:s.online_count=e.uint32();break;case 15:s.anchor_info=n.liveroom_cs.StAnchorInfo.decode(e,e.uint32());break;case 16:s.stream_seq=e.uint32();break;case 17:s.stream_info&&s.stream_info.length||(s.stream_info=[]),s.stream_info.push(n.liveroom_cs.StStreamInfo.decode(e,e.uint32()));break;case 18:s.stream_mix_info&&s.stream_mix_info.length||(s.stream_mix_info=[]),s.stream_mix_info.push(n.liveroom_cs.StStreamInfo.decode(e,e.uint32()));break;case 19:s.userlist_merge_timeout=e.uint32();break;case 20:s.userlist_interval=e.uint32();break;case 21:s.stream_list_push_merge_timeout=e.uint32();break;case 22:s.stream_list_hb_wait_merge_time=e.uint32();break;case 23:s.trans_list_seq=e.uint32();break;case 24:s.trans_seqs&&s.trans_seqs.length||(s.trans_seqs=[]),s.trans_seqs.push(n.liveroom_cs.StTransInfo.decode(e,e.uint32()));break;case 25:s.cluster_name=e.string();break;case 26:s.token_remain_time=e.uint32();break;case 27:s.stream_fetch_flag=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StAnchorInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.anchor_id_name=o.newBuffer([]),t.prototype.anchor_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.anchor_nick_name=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.anchor_id_name!=null&&Object.hasOwnProperty.call(e,"anchor_id_name")&&r.uint32(10).bytes(e.anchor_id_name),e.anchor_id!=null&&Object.hasOwnProperty.call(e,"anchor_id")&&r.uint32(16).uint64(e.anchor_id),e.anchor_nick_name!=null&&Object.hasOwnProperty.call(e,"anchor_nick_name")&&r.uint32(26).bytes(e.anchor_nick_name),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StAnchorInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.anchor_id_name=e.bytes();break;case 2:s.anchor_id=e.uint64();break;case 3:s.anchor_nick_name=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.QuitReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.switch_session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.room_id32=0,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.net_type=0,t.prototype.config_list=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.switch_session_id!=null&&Object.hasOwnProperty.call(e,"switch_session_id")&&r.uint32(16).uint64(e.switch_session_id),e.room_id32!=null&&Object.hasOwnProperty.call(e,"room_id32")&&r.uint32(24).uint32(e.room_id32),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(34).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(40).uint32(e.role),e.net_type!=null&&Object.hasOwnProperty.call(e,"net_type")&&r.uint32(48).uint32(e.net_type),e.config_list!=null&&Object.hasOwnProperty.call(e,"config_list")&&n.liveroom_cs.StConfigList.encode(e.config_list,r.uint32(58).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.QuitReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.switch_session_id=e.uint64();break;case 3:s.room_id32=e.uint32();break;case 4:s.nick_name=e.bytes();break;case 5:s.role=e.uint32();break;case 6:s.net_type=e.uint32();break;case 7:s.config_list=n.liveroom_cs.StConfigList.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.StConfigList=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_create_flag=0,t.prototype.user_state_flag=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.room_create_flag!=null&&Object.hasOwnProperty.call(e,"room_create_flag")&&r.uint32(8).uint32(e.room_create_flag),e.user_state_flag!=null&&Object.hasOwnProperty.call(e,"user_state_flag")&&r.uint32(16).uint32(e.user_state_flag),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StConfigList;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_create_flag=e.uint32();break;case 2:s.user_state_flag=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.QuitRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.room_id=o.newBuffer([]),t.prototype.room_id32=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.room_id32!=null&&Object.hasOwnProperty.call(e,"room_id32")&&r.uint32(24).uint32(e.room_id32),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.QuitRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.room_id=e.bytes();break;case 3:s.room_id32=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.RoomListReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RoomListReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.RoomListRsp=function(){function t(e){if(this.room_list=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.room_list=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.room_list!=null&&e.room_list.length)for(var i=0;i<e.room_list.length;++i)n.liveroom_cs.StRoomListRoom.encode(e.room_list[i],r.uint32(18).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RoomListRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.room_list&&s.room_list.length||(s.room_list=[]),s.room_list.push(n.liveroom_cs.StRoomListRoom.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StRoomListStream=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.stream_id=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(10).bytes(e.stream_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StRoomListStream;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.stream_id=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.StRoomListRoom=function(){function t(e){if(this.stream_list=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id=o.newBuffer([]),t.prototype.room_name=o.newBuffer([]),t.prototype.anchor_id_name=o.newBuffer([]),t.prototype.anchor_nick_name=o.newBuffer([]),t.prototype.stream_list=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).bytes(e.room_id),e.room_name!=null&&Object.hasOwnProperty.call(e,"room_name")&&r.uint32(18).bytes(e.room_name),e.anchor_id_name!=null&&Object.hasOwnProperty.call(e,"anchor_id_name")&&r.uint32(26).bytes(e.anchor_id_name),e.anchor_nick_name!=null&&Object.hasOwnProperty.call(e,"anchor_nick_name")&&r.uint32(34).bytes(e.anchor_nick_name),e.stream_list!=null&&e.stream_list.length)for(var i=0;i<e.stream_list.length;++i)n.liveroom_cs.StRoomListStream.encode(e.stream_list[i],r.uint32(42).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StRoomListRoom;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.bytes();break;case 2:s.room_name=e.bytes();break;case 3:s.anchor_id_name=e.bytes();break;case 4:s.anchor_nick_name=e.bytes();break;case 5:s.stream_list&&s.stream_list.length||(s.stream_list=[]),s.stream_list.push(n.liveroom_cs.StRoomListStream.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StTransSeqInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(16).uint32(e.trans_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransSeqInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.StTransInfo=function(){function t(e){if(this.trans_seq_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_seq_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(10).bytes(e.trans_channel),e.trans_seq_array!=null&&e.trans_seq_array.length)for(var i=0;i<e.trans_seq_array.length;++i)n.liveroom_cs.StTransSeqInfo.encode(e.trans_seq_array[i],r.uint32(18).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_channel=e.bytes();break;case 2:s.trans_seq_array&&s.trans_seq_array.length||(s.trans_seq_array=[]),s.trans_seq_array.push(n.liveroom_cs.StTransSeqInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.TransReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_data=o.newBuffer([]),t.prototype.trans_local_seq=0,t.prototype.trans_channel=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(34).bytes(e.trans_type),e.trans_data!=null&&Object.hasOwnProperty.call(e,"trans_data")&&r.uint32(42).bytes(e.trans_data),e.trans_local_seq!=null&&Object.hasOwnProperty.call(e,"trans_local_seq")&&r.uint32(48).uint32(e.trans_local_seq),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(58).bytes(e.trans_channel),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.TransReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.trans_type=e.bytes();break;case 5:s.trans_data=e.bytes();break;case 6:s.trans_local_seq=e.uint32();break;case 7:s.trans_channel=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.TransRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_seq=0,t.prototype.trans_list_seq=0,t.prototype.trans_channel=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(18).bytes(e.trans_type),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(24).uint32(e.trans_seq),e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(32).uint32(e.trans_list_seq),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(42).bytes(e.trans_channel),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.TransRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.trans_type=e.bytes();break;case 3:s.trans_seq=e.uint32();break;case 4:s.trans_list_seq=e.uint32();break;case 5:s.trans_channel=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.TransFetchReq=function(){function t(e){if(this.fetch_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.trans_channel=o.newBuffer([]),t.prototype.fetch_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(18).bytes(e.trans_channel),e.fetch_array!=null&&e.fetch_array.length)for(var i=0;i<e.fetch_array.length;++i)n.liveroom_cs.StTransFetch.encode(e.fetch_array[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.TransFetchReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.trans_channel=e.bytes();break;case 3:s.fetch_array&&s.fetch_array.length||(s.fetch_array=[]),s.fetch_array.push(n.liveroom_cs.StTransFetch.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StTransFetch=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_local_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_local_seq!=null&&Object.hasOwnProperty.call(e,"trans_local_seq")&&r.uint32(16).uint32(e.trans_local_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransFetch;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_local_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.TransFetchRsp=function(){function t(e){if(this.trans_fetch_results=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_fetch_results=o.emptyArray,t.prototype.trans_list_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(18).bytes(e.trans_channel),e.trans_fetch_results!=null&&e.trans_fetch_results.length)for(var i=0;i<e.trans_fetch_results.length;++i)n.liveroom_cs.TransFetchResult.encode(e.trans_fetch_results[i],r.uint32(26).fork()).ldelim();return e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(32).uint32(e.trans_list_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.TransFetchRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.trans_channel=e.bytes();break;case 3:s.trans_fetch_results&&s.trans_fetch_results.length||(s.trans_fetch_results=[]),s.trans_fetch_results.push(n.liveroom_cs.TransFetchResult.decode(e,e.uint32()));break;case 4:s.trans_list_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.TransFetchResult=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_data=o.newBuffer([]),t.prototype.trans_idname=o.newBuffer([]),t.prototype.trans_nickname=o.newBuffer([]),t.prototype.trans_role=0,t.prototype.trans_send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.trans_seq=0,t.prototype.err_code=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_data!=null&&Object.hasOwnProperty.call(e,"trans_data")&&r.uint32(18).bytes(e.trans_data),e.trans_idname!=null&&Object.hasOwnProperty.call(e,"trans_idname")&&r.uint32(26).bytes(e.trans_idname),e.trans_nickname!=null&&Object.hasOwnProperty.call(e,"trans_nickname")&&r.uint32(34).bytes(e.trans_nickname),e.trans_role!=null&&Object.hasOwnProperty.call(e,"trans_role")&&r.uint32(40).uint32(e.trans_role),e.trans_send_time!=null&&Object.hasOwnProperty.call(e,"trans_send_time")&&r.uint32(48).int64(e.trans_send_time),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(56).uint32(e.trans_seq),e.err_code!=null&&Object.hasOwnProperty.call(e,"err_code")&&r.uint32(64).int32(e.err_code),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.TransFetchResult;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_data=e.bytes();break;case 3:s.trans_idname=e.bytes();break;case 4:s.trans_nickname=e.bytes();break;case 5:s.trans_role=e.uint32();break;case 6:s.trans_send_time=e.int64();break;case 7:s.trans_seq=e.uint32();break;case 8:s.err_code=e.int32();break;default:e.skipType(7&u)}}return s},t}(),d.UserTransFetchReq=function(){function t(e){if(this.fetch_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.trans_channel=o.newBuffer([]),t.prototype.fetch_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(34).bytes(e.trans_channel),e.fetch_array!=null&&e.fetch_array.length)for(var i=0;i<e.fetch_array.length;++i)n.liveroom_cs.StUserTransFetch.encode(e.fetch_array[i],r.uint32(42).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.UserTransFetchReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.trans_channel=e.bytes();break;case 5:s.fetch_array&&s.fetch_array.length||(s.fetch_array=[]),s.fetch_array.push(n.liveroom_cs.StUserTransFetch.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StUserTransFetch=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_local_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_local_seq!=null&&Object.hasOwnProperty.call(e,"trans_local_seq")&&r.uint32(16).uint32(e.trans_local_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StUserTransFetch;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_local_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.UserTransFetchRsp=function(){function t(e){if(this.trans_fetch_results=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_fetch_results=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(18).bytes(e.trans_channel),e.trans_fetch_results!=null&&e.trans_fetch_results.length)for(var i=0;i<e.trans_fetch_results.length;++i)n.liveroom_cs.StUserTransFetchResult.encode(e.trans_fetch_results[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.UserTransFetchRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.trans_channel=e.bytes();break;case 3:s.trans_fetch_results&&s.trans_fetch_results.length||(s.trans_fetch_results=[]),s.trans_fetch_results.push(n.liveroom_cs.StUserTransFetchResult.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StUserTransFetchResult=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_data=o.newBuffer([]),t.prototype.trans_idname=o.newBuffer([]),t.prototype.trans_nickname=o.newBuffer([]),t.prototype.trans_role=0,t.prototype.trans_send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.trans_seq=0,t.prototype.err_code=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_data!=null&&Object.hasOwnProperty.call(e,"trans_data")&&r.uint32(18).bytes(e.trans_data),e.trans_idname!=null&&Object.hasOwnProperty.call(e,"trans_idname")&&r.uint32(26).bytes(e.trans_idname),e.trans_nickname!=null&&Object.hasOwnProperty.call(e,"trans_nickname")&&r.uint32(34).bytes(e.trans_nickname),e.trans_role!=null&&Object.hasOwnProperty.call(e,"trans_role")&&r.uint32(40).uint32(e.trans_role),e.trans_send_time!=null&&Object.hasOwnProperty.call(e,"trans_send_time")&&r.uint32(48).int64(e.trans_send_time),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(56).uint32(e.trans_seq),e.err_code!=null&&Object.hasOwnProperty.call(e,"err_code")&&r.uint32(64).int32(e.err_code),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StUserTransFetchResult;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_data=e.bytes();break;case 3:s.trans_idname=e.bytes();break;case 4:s.trans_nickname=e.bytes();break;case 5:s.trans_role=e.uint32();break;case 6:s.trans_send_time=e.int64();break;case 7:s.trans_seq=e.uint32();break;case 8:s.err_code=e.int32();break;default:e.skipType(7&u)}}return s},t}(),d.BigimChatReq=function(){function t(e){if(this.msgs=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.msgs=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.msgs!=null&&e.msgs.length)for(var i=0;i<e.msgs.length;++i)n.liveroom_cs.StBigimChatData.encode(e.msgs[i],r.uint32(34).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.BigimChatReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.msgs&&s.msgs.length||(s.msgs=[]),s.msgs.push(n.liveroom_cs.StBigimChatData.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StBigimChatData=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.msg_category=0,t.prototype.msg_type=0,t.prototype.msg_content=o.newBuffer([]),t.prototype.msg_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.bigmsg_client_id=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.msg_category!=null&&Object.hasOwnProperty.call(e,"msg_category")&&r.uint32(8).uint32(e.msg_category),e.msg_type!=null&&Object.hasOwnProperty.call(e,"msg_type")&&r.uint32(16).uint32(e.msg_type),e.msg_content!=null&&Object.hasOwnProperty.call(e,"msg_content")&&r.uint32(26).bytes(e.msg_content),e.msg_timestamp!=null&&Object.hasOwnProperty.call(e,"msg_timestamp")&&r.uint32(32).int64(e.msg_timestamp),e.bigmsg_client_id!=null&&Object.hasOwnProperty.call(e,"bigmsg_client_id")&&r.uint32(42).bytes(e.bigmsg_client_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StBigimChatData;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.msg_category=e.uint32();break;case 2:s.msg_type=e.uint32();break;case 3:s.msg_content=e.bytes();break;case 4:s.msg_timestamp=e.int64();break;case 5:s.bigmsg_client_id=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.BigimChatRsp=function(){function t(e){if(this.msgs=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.bigim_time_window=0,t.prototype.msgs=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.bigim_time_window!=null&&Object.hasOwnProperty.call(e,"bigim_time_window")&&r.uint32(16).uint32(e.bigim_time_window),e.msgs!=null&&e.msgs.length)for(var i=0;i<e.msgs.length;++i)n.liveroom_cs.StBigimChatRspData.encode(e.msgs[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.BigimChatRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.bigim_time_window=e.uint32();break;case 3:s.msgs&&s.msgs.length||(s.msgs=[]),s.msgs.push(n.liveroom_cs.StBigimChatRspData.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StBigimChatRspData=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.bigmsg_id=o.newBuffer([]),t.prototype.bigmsg_client_id=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.bigmsg_id!=null&&Object.hasOwnProperty.call(e,"bigmsg_id")&&r.uint32(10).bytes(e.bigmsg_id),e.bigmsg_client_id!=null&&Object.hasOwnProperty.call(e,"bigmsg_client_id")&&r.uint32(18).bytes(e.bigmsg_client_id),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StBigimChatRspData;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.bigmsg_id=e.bytes();break;case 2:s.bigmsg_client_id=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.RelayReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.relay_type=o.newBuffer([]),t.prototype.relay_data=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.relay_type!=null&&Object.hasOwnProperty.call(e,"relay_type")&&r.uint32(34).bytes(e.relay_type),e.relay_data!=null&&Object.hasOwnProperty.call(e,"relay_data")&&r.uint32(42).bytes(e.relay_data),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RelayReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.relay_type=e.bytes();break;case 5:s.relay_data=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.RelayRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.reley_type=o.newBuffer([]),t.prototype.relay_result=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.reley_type!=null&&Object.hasOwnProperty.call(e,"reley_type")&&r.uint32(18).bytes(e.reley_type),e.relay_result!=null&&Object.hasOwnProperty.call(e,"relay_result")&&r.uint32(26).bytes(e.relay_result),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RelayRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.reley_type=e.bytes();break;case 3:s.relay_result=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.RenewTokenReq=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.req_head=null,t.prototype.token="",t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.req_head!=null&&Object.hasOwnProperty.call(e,"req_head")&&n.liveroom_cs.ReqHead.encode(e.req_head,r.uint32(10).fork()).ldelim(),e.token!=null&&Object.hasOwnProperty.call(e,"token")&&r.uint32(18).string(e.token),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RenewTokenReq;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.req_head=n.liveroom_cs.ReqHead.decode(e,e.uint32());break;case 2:s.token=e.string();break;default:e.skipType(7&u)}}return s},t}(),d.RenewTokenRsp=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.rsp_head=null,t.prototype.token_remain_time=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.rsp_head!=null&&Object.hasOwnProperty.call(e,"rsp_head")&&n.liveroom_cs.RspHead.encode(e.rsp_head,r.uint32(10).fork()).ldelim(),e.token_remain_time!=null&&Object.hasOwnProperty.call(e,"token_remain_time")&&r.uint32(16).uint32(e.token_remain_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.RenewTokenRsp;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.rsp_head=n.liveroom_cs.RspHead.decode(e,e.uint32());break;case 2:s.token_remain_time=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.UserAction=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.action=0,t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.login_time=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).uint32(e.action),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(18).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(26).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(32).uint32(e.role),e.login_time!=null&&Object.hasOwnProperty.call(e,"login_time")&&r.uint32(40).int64(e.login_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.UserAction;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.action=e.uint32();break;case 2:s.id_name=e.bytes();break;case 3:s.nick_name=e.bytes();break;case 4:s.role=e.uint32();break;case 5:s.login_time=e.int64();break;default:e.skipType(7&u)}}return s},t}(),d.PushUserInfoUpdated=function(){function t(e){if(this.user_list=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id=o.newBuffer([]),t.prototype.server_user_seq=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.user_list=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).bytes(e.room_id),e.server_user_seq!=null&&Object.hasOwnProperty.call(e,"server_user_seq")&&r.uint32(16).int64(e.server_user_seq),e.user_list!=null&&e.user_list.length)for(var i=0;i<e.user_list.length;++i)n.liveroom_cs.UserAction.encode(e.user_list[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushUserInfoUpdated;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.bytes();break;case 2:s.server_user_seq=e.int64();break;case 3:s.user_list&&s.user_list.length||(s.user_list=[]),s.user_list.push(n.liveroom_cs.UserAction.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.PushUserKickout=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.room_id=o.newBuffer([]),t.prototype.session_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.kickout_reason=0,t.prototype.custom_reason=o.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.session_id!=null&&Object.hasOwnProperty.call(e,"session_id")&&r.uint32(24).uint64(e.session_id),e.kickout_reason!=null&&Object.hasOwnProperty.call(e,"kickout_reason")&&r.uint32(32).int32(e.kickout_reason),e.custom_reason!=null&&Object.hasOwnProperty.call(e,"custom_reason")&&r.uint32(42).bytes(e.custom_reason),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushUserKickout;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.room_id=e.bytes();break;case 3:s.session_id=e.uint64();break;case 4:s.kickout_reason=e.int32();break;case 5:s.custom_reason=e.bytes();break;default:e.skipType(7&u)}}return s},t}(),d.PushUserLogReport=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushUserLogReport;e.pos<i;){var u=e.uint32();e.skipType(7&u)}return s},t}(),d.PushUserTokenExpire=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id=o.newBuffer([]),t.prototype.token="",t.prototype.stop_stream=null,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).bytes(e.room_id),e.token!=null&&Object.hasOwnProperty.call(e,"token")&&r.uint32(18).string(e.token),e.stop_stream!=null&&Object.hasOwnProperty.call(e,"stop_stream")&&n.liveroom_cs.StopStream.encode(e.stop_stream,r.uint32(26).fork()).ldelim(),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushUserTokenExpire;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.bytes();break;case 2:s.token=e.string();break;case 3:s.stop_stream=n.liveroom_cs.StopStream.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},t}(),d.StopStream=function(){function t(e){if(this.stream_id_list=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.stream_id_list=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.stream_id_list!=null&&e.stream_id_list.length)for(var i=0;i<e.stream_id_list.length;++i)r.uint32(10).bytes(e.stream_id_list[i]);return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StopStream;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.stream_id_list&&s.stream_id_list.length||(s.stream_id_list=[]),s.stream_id_list.push(e.bytes());break;default:e.skipType(7&u)}}return s},t}(),d.PushStream=function(){function t(e){if(this.stream_info=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id=o.newBuffer([]),t.prototype.stream_seq=0,t.prototype.stream_info=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).bytes(e.room_id),e.stream_seq!=null&&Object.hasOwnProperty.call(e,"stream_seq")&&r.uint32(16).uint32(e.stream_seq),e.stream_info!=null&&e.stream_info.length)for(var i=0;i<e.stream_info.length;++i)n.liveroom_cs.StPushStreamInfo.encode(e.stream_info[i],r.uint32(26).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushStream;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.bytes();break;case 2:s.stream_seq=e.uint32();break;case 3:s.stream_info&&s.stream_info.length||(s.stream_info=[]),s.stream_info.push(n.liveroom_cs.StPushStreamInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StPushStreamInfo=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.stream_id=o.newBuffer([]),t.prototype.stream_sid="",t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.extra_info=o.newBuffer([]),t.prototype.title=o.newBuffer([]),t.prototype.third_define_data=o.newBuffer([]),t.prototype.create_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.req_seq=0,t.prototype.stream_ver=0,t.prototype.stream_attr=o.newBuffer([]),t.prototype.stream_src=0,t.prototype.stream_state=0,t.prototype.stream_type=0,t.prototype.stream_nid=0,t.prototype.close_type=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.stream_id!=null&&Object.hasOwnProperty.call(e,"stream_id")&&r.uint32(10).bytes(e.stream_id),e.stream_sid!=null&&Object.hasOwnProperty.call(e,"stream_sid")&&r.uint32(18).string(e.stream_sid),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(26).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(34).bytes(e.nick_name),e.extra_info!=null&&Object.hasOwnProperty.call(e,"extra_info")&&r.uint32(42).bytes(e.extra_info),e.title!=null&&Object.hasOwnProperty.call(e,"title")&&r.uint32(50).bytes(e.title),e.third_define_data!=null&&Object.hasOwnProperty.call(e,"third_define_data")&&r.uint32(58).bytes(e.third_define_data),e.create_time!=null&&Object.hasOwnProperty.call(e,"create_time")&&r.uint32(64).int64(e.create_time),e.req_seq!=null&&Object.hasOwnProperty.call(e,"req_seq")&&r.uint32(72).uint32(e.req_seq),e.stream_ver!=null&&Object.hasOwnProperty.call(e,"stream_ver")&&r.uint32(80).uint32(e.stream_ver),e.stream_attr!=null&&Object.hasOwnProperty.call(e,"stream_attr")&&r.uint32(90).bytes(e.stream_attr),e.stream_src!=null&&Object.hasOwnProperty.call(e,"stream_src")&&r.uint32(96).uint32(e.stream_src),e.stream_state!=null&&Object.hasOwnProperty.call(e,"stream_state")&&r.uint32(104).uint32(e.stream_state),e.stream_type!=null&&Object.hasOwnProperty.call(e,"stream_type")&&r.uint32(112).uint32(e.stream_type),e.stream_nid!=null&&Object.hasOwnProperty.call(e,"stream_nid")&&r.uint32(120).uint32(e.stream_nid),e.close_type!=null&&Object.hasOwnProperty.call(e,"close_type")&&r.uint32(128).uint32(e.close_type),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StPushStreamInfo;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.stream_id=e.bytes();break;case 2:s.stream_sid=e.string();break;case 3:s.id_name=e.bytes();break;case 4:s.nick_name=e.bytes();break;case 5:s.extra_info=e.bytes();break;case 6:s.title=e.bytes();break;case 7:s.third_define_data=e.bytes();break;case 8:s.create_time=e.int64();break;case 9:s.req_seq=e.uint32();break;case 10:s.stream_ver=e.uint32();break;case 11:s.stream_attr=e.bytes();break;case 12:s.stream_src=e.uint32();break;case 13:s.stream_state=e.uint32();break;case 14:s.stream_type=e.uint32();break;case 15:s.stream_nid=e.uint32();break;case 16:s.close_type=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.PushImChat=function(){function t(e){if(this.msg_data=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.room_id=o.newBuffer([]),t.prototype.server_msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.ret_msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.msg_data=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(10).bytes(e.room_id),e.server_msg_id!=null&&Object.hasOwnProperty.call(e,"server_msg_id")&&r.uint32(16).uint64(e.server_msg_id),e.ret_msg_id!=null&&Object.hasOwnProperty.call(e,"ret_msg_id")&&r.uint32(24).uint64(e.ret_msg_id),e.msg_data!=null&&e.msg_data.length)for(var i=0;i<e.msg_data.length;++i)n.liveroom_cs.StImChatData.encode(e.msg_data[i],r.uint32(34).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushImChat;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.room_id=e.bytes();break;case 2:s.server_msg_id=e.uint64();break;case 3:s.ret_msg_id=e.uint64();break;case 4:s.msg_data&&s.msg_data.length||(s.msg_data=[]),s.msg_data.push(n.liveroom_cs.StImChatData.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StImChatData=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.msg_id=o.Long?o.Long.fromBits(0,0,!0):0,t.prototype.msg_category=0,t.prototype.msg_type=0,t.prototype.msg_priority=0,t.prototype.msg_content=o.newBuffer([]),t.prototype.send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.msg_id!=null&&Object.hasOwnProperty.call(e,"msg_id")&&r.uint32(32).uint64(e.msg_id),e.msg_category!=null&&Object.hasOwnProperty.call(e,"msg_category")&&r.uint32(40).uint32(e.msg_category),e.msg_type!=null&&Object.hasOwnProperty.call(e,"msg_type")&&r.uint32(48).uint32(e.msg_type),e.msg_priority!=null&&Object.hasOwnProperty.call(e,"msg_priority")&&r.uint32(56).uint32(e.msg_priority),e.msg_content!=null&&Object.hasOwnProperty.call(e,"msg_content")&&r.uint32(66).bytes(e.msg_content),e.send_time!=null&&Object.hasOwnProperty.call(e,"send_time")&&r.uint32(72).int64(e.send_time),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StImChatData;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.msg_id=e.uint64();break;case 5:s.msg_category=e.uint32();break;case 6:s.msg_type=e.uint32();break;case 7:s.msg_priority=e.uint32();break;case 8:s.msg_content=e.bytes();break;case 9:s.send_time=e.int64();break;default:e.skipType(7&u)}}return s},t}(),d.PushBigImChat=function(){function t(e){if(this.msg_data=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.app_id=0,t.prototype.room_id=o.newBuffer([]),t.prototype.timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.msg_data=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.app_id!=null&&Object.hasOwnProperty.call(e,"app_id")&&r.uint32(8).uint32(e.app_id),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.timestamp!=null&&Object.hasOwnProperty.call(e,"timestamp")&&r.uint32(24).int64(e.timestamp),e.msg_data!=null&&e.msg_data.length)for(var i=0;i<e.msg_data.length;++i)n.liveroom_cs.StBigImChatData.encode(e.msg_data[i],r.uint32(34).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushBigImChat;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.app_id=e.uint32();break;case 2:s.room_id=e.bytes();break;case 3:s.timestamp=e.int64();break;case 4:s.msg_data&&s.msg_data.length||(s.msg_data=[]),s.msg_data.push(n.liveroom_cs.StBigImChatData.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StBigImChatData=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.id_name=o.newBuffer([]),t.prototype.nick_name=o.newBuffer([]),t.prototype.role=0,t.prototype.bigmsg_id=o.newBuffer([]),t.prototype.msg_category=0,t.prototype.msg_type=0,t.prototype.msg_content=o.newBuffer([]),t.prototype.msg_timestamp=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.id_name!=null&&Object.hasOwnProperty.call(e,"id_name")&&r.uint32(10).bytes(e.id_name),e.nick_name!=null&&Object.hasOwnProperty.call(e,"nick_name")&&r.uint32(18).bytes(e.nick_name),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(24).uint32(e.role),e.bigmsg_id!=null&&Object.hasOwnProperty.call(e,"bigmsg_id")&&r.uint32(34).bytes(e.bigmsg_id),e.msg_category!=null&&Object.hasOwnProperty.call(e,"msg_category")&&r.uint32(40).uint32(e.msg_category),e.msg_type!=null&&Object.hasOwnProperty.call(e,"msg_type")&&r.uint32(48).uint32(e.msg_type),e.msg_content!=null&&Object.hasOwnProperty.call(e,"msg_content")&&r.uint32(58).bytes(e.msg_content),e.msg_timestamp!=null&&Object.hasOwnProperty.call(e,"msg_timestamp")&&r.uint32(64).int64(e.msg_timestamp),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StBigImChatData;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.id_name=e.bytes();break;case 2:s.nick_name=e.bytes();break;case 3:s.role=e.uint32();break;case 4:s.bigmsg_id=e.bytes();break;case 5:s.msg_category=e.uint32();break;case 6:s.msg_type=e.uint32();break;case 7:s.msg_content=e.bytes();break;case 8:s.msg_timestamp=e.int64();break;default:e.skipType(7&u)}}return s},t}(),d.PushTrans=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.app_id=0,t.prototype.room_id=o.newBuffer([]),t.prototype.trans_idname=o.newBuffer([]),t.prototype.trans_nickname=o.newBuffer([]),t.prototype.trans_role=0,t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_data=o.newBuffer([]),t.prototype.trans_seq=0,t.prototype.trans_send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_list_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.app_id!=null&&Object.hasOwnProperty.call(e,"app_id")&&r.uint32(8).uint32(e.app_id),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.trans_idname!=null&&Object.hasOwnProperty.call(e,"trans_idname")&&r.uint32(26).bytes(e.trans_idname),e.trans_nickname!=null&&Object.hasOwnProperty.call(e,"trans_nickname")&&r.uint32(34).bytes(e.trans_nickname),e.trans_role!=null&&Object.hasOwnProperty.call(e,"trans_role")&&r.uint32(40).uint32(e.trans_role),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(50).bytes(e.trans_type),e.trans_data!=null&&Object.hasOwnProperty.call(e,"trans_data")&&r.uint32(58).bytes(e.trans_data),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(64).uint32(e.trans_seq),e.trans_send_time!=null&&Object.hasOwnProperty.call(e,"trans_send_time")&&r.uint32(72).int64(e.trans_send_time),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(82).bytes(e.trans_channel),e.trans_list_seq!=null&&Object.hasOwnProperty.call(e,"trans_list_seq")&&r.uint32(88).uint32(e.trans_list_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushTrans;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.app_id=e.uint32();break;case 2:s.room_id=e.bytes();break;case 3:s.trans_idname=e.bytes();break;case 4:s.trans_nickname=e.bytes();break;case 5:s.trans_role=e.uint32();break;case 6:s.trans_type=e.bytes();break;case 7:s.trans_data=e.bytes();break;case 8:s.trans_seq=e.uint32();break;case 9:s.trans_send_time=e.int64();break;case 10:s.trans_channel=e.bytes();break;case 11:s.trans_list_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d.PushUserTrans=function(){function t(e){if(this.trans_array=[],e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.app_id=0,t.prototype.room_id=o.newBuffer([]),t.prototype.trans_idname=o.newBuffer([]),t.prototype.trans_nickname=o.newBuffer([]),t.prototype.trans_role=0,t.prototype.trans_send_time=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.trans_channel=o.newBuffer([]),t.prototype.trans_array=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,r){if(r||(r=c.create()),e.app_id!=null&&Object.hasOwnProperty.call(e,"app_id")&&r.uint32(8).uint32(e.app_id),e.room_id!=null&&Object.hasOwnProperty.call(e,"room_id")&&r.uint32(18).bytes(e.room_id),e.trans_idname!=null&&Object.hasOwnProperty.call(e,"trans_idname")&&r.uint32(26).bytes(e.trans_idname),e.trans_nickname!=null&&Object.hasOwnProperty.call(e,"trans_nickname")&&r.uint32(34).bytes(e.trans_nickname),e.trans_role!=null&&Object.hasOwnProperty.call(e,"trans_role")&&r.uint32(40).uint32(e.trans_role),e.trans_send_time!=null&&Object.hasOwnProperty.call(e,"trans_send_time")&&r.uint32(72).int64(e.trans_send_time),e.trans_channel!=null&&Object.hasOwnProperty.call(e,"trans_channel")&&r.uint32(82).bytes(e.trans_channel),e.trans_array!=null&&e.trans_array.length)for(var i=0;i<e.trans_array.length;++i)n.liveroom_cs.StTransSimple.encode(e.trans_array[i],r.uint32(90).fork()).ldelim();return r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.PushUserTrans;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.app_id=e.uint32();break;case 2:s.room_id=e.bytes();break;case 3:s.trans_idname=e.bytes();break;case 4:s.trans_nickname=e.bytes();break;case 5:s.trans_role=e.uint32();break;case 9:s.trans_send_time=e.int64();break;case 10:s.trans_channel=e.bytes();break;case 11:s.trans_array&&s.trans_array.length||(s.trans_array=[]),s.trans_array.push(n.liveroom_cs.StTransSimple.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},t}(),d.StTransSimple=function(){function t(e){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.trans_type=o.newBuffer([]),t.prototype.trans_data=o.newBuffer([]),t.prototype.trans_seq=0,t.create=function(e){return new t(e)},t.encode=function(e,r){return r||(r=c.create()),e.trans_type!=null&&Object.hasOwnProperty.call(e,"trans_type")&&r.uint32(10).bytes(e.trans_type),e.trans_data!=null&&Object.hasOwnProperty.call(e,"trans_data")&&r.uint32(18).bytes(e.trans_data),e.trans_seq!=null&&Object.hasOwnProperty.call(e,"trans_seq")&&r.uint32(24).uint32(e.trans_seq),r},t.decode=function(e,r){e instanceof a||(e=a.create(e));for(var i=r===void 0?e.len:e.pos+r,s=new n.liveroom_cs.StTransSimple;e.pos<i;){var u=e.uint32();switch(u>>>3){case 1:s.trans_type=e.bytes();break;case 2:s.trans_data=e.bytes();break;case 3:s.trans_seq=e.uint32();break;default:e.skipType(7&u)}}return s},t}(),d),W.exports=n},,function(W,T,I){var m;W.exports=(m=I(3),I(46),I(21),I(22),I(49),function(){var h=m,_=h.lib.BlockCipher,d=h.algo,l=[],a=[],c=[],o=[],n=[],t=[],e=[],r=[],i=[],s=[];(function(){for(var f=[],E=0;E<256;E++)f[E]=E<128?E<<1:E<<1^283;var y=0,b=0;for(E=0;E<256;E++){var S=b^b<<1^b<<2^b<<3^b<<4;S=S>>>8^255&S^99,l[y]=S,a[S]=y;var k=f[y],O=f[k],g=f[O],v=257*f[S]^16843008*S;c[y]=v<<24|v>>>8,o[y]=v<<16|v>>>16,n[y]=v<<8|v>>>24,t[y]=v,v=16843009*g^65537*O^257*k^16843008*y,e[S]=v<<24|v>>>8,r[S]=v<<16|v>>>16,i[S]=v<<8|v>>>24,s[S]=v,y?(y=k^f[f[f[g^k]]],b^=f[f[b]]):y=b=1}})();var u=[0,1,2,4,8,16,32,64,128,27,54],p=d.AES=_.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var f=this._keyPriorReset=this._key,E=f.words,y=f.sigBytes/4,b=4*((this._nRounds=y+6)+1),S=this._keySchedule=[],k=0;k<b;k++)k<y?S[k]=E[k]:(v=S[k-1],k%y?y>6&&k%y==4&&(v=l[v>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[255&v]):(v=l[(v=v<<8|v>>>24)>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[255&v],v^=u[k/y|0]<<24),S[k]=S[k-y]^v);for(var O=this._invKeySchedule=[],g=0;g<b;g++){if(k=b-g,g%4)var v=S[k];else v=S[k-4];O[g]=g<4||k<=4?v:e[l[v>>>24]]^r[l[v>>>16&255]]^i[l[v>>>8&255]]^s[l[255&v]]}}},encryptBlock:function(f,E){this._doCryptBlock(f,E,this._keySchedule,c,o,n,t,l)},decryptBlock:function(f,E){var y=f[E+1];f[E+1]=f[E+3],f[E+3]=y,this._doCryptBlock(f,E,this._invKeySchedule,e,r,i,s,a),y=f[E+1],f[E+1]=f[E+3],f[E+3]=y},_doCryptBlock:function(f,E,y,b,S,k,O,g){for(var v=this._nRounds,R=f[E]^y[0],L=f[E+1]^y[1],N=f[E+2]^y[2],w=f[E+3]^y[3],B=4,x=1;x<v;x++){var Z=b[R>>>24]^S[L>>>16&255]^k[N>>>8&255]^O[255&w]^y[B++],V=b[L>>>24]^S[N>>>16&255]^k[w>>>8&255]^O[255&R]^y[B++],Y=b[N>>>24]^S[w>>>16&255]^k[R>>>8&255]^O[255&L]^y[B++],te=b[w>>>24]^S[R>>>16&255]^k[L>>>8&255]^O[255&N]^y[B++];R=Z,L=V,N=Y,w=te}Z=(g[R>>>24]<<24|g[L>>>16&255]<<16|g[N>>>8&255]<<8|g[255&w])^y[B++],V=(g[L>>>24]<<24|g[N>>>16&255]<<16|g[w>>>8&255]<<8|g[255&R])^y[B++],Y=(g[N>>>24]<<24|g[w>>>16&255]<<16|g[R>>>8&255]<<8|g[255&L])^y[B++],te=(g[w>>>24]<<24|g[R>>>16&255]<<16|g[L>>>8&255]<<8|g[255&N])^y[B++],f[E]=Z,f[E+1]=V,f[E+2]=Y,f[E+3]=te},keySize:8});h.AES=_._createHelper(p)}(),m.AES)},function(W,T,I){var m;W.exports=(m=I(3),function(h){var _=m,d=_.lib,l=d.WordArray,a=d.Hasher,c=_.algo,o=[];(function(){for(var s=0;s<64;s++)o[s]=4294967296*h.abs(h.sin(s+1))|0})();var n=c.MD5=a.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(s,u){for(var p=0;p<16;p++){var f=u+p,E=s[f];s[f]=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8)}var y=this._hash.words,b=s[u+0],S=s[u+1],k=s[u+2],O=s[u+3],g=s[u+4],v=s[u+5],R=s[u+6],L=s[u+7],N=s[u+8],w=s[u+9],B=s[u+10],x=s[u+11],Z=s[u+12],V=s[u+13],Y=s[u+14],te=s[u+15],F=y[0],K=y[1],J=y[2],oe=y[3];F=t(F,K,J,oe,b,7,o[0]),oe=t(oe,F,K,J,S,12,o[1]),J=t(J,oe,F,K,k,17,o[2]),K=t(K,J,oe,F,O,22,o[3]),F=t(F,K,J,oe,g,7,o[4]),oe=t(oe,F,K,J,v,12,o[5]),J=t(J,oe,F,K,R,17,o[6]),K=t(K,J,oe,F,L,22,o[7]),F=t(F,K,J,oe,N,7,o[8]),oe=t(oe,F,K,J,w,12,o[9]),J=t(J,oe,F,K,B,17,o[10]),K=t(K,J,oe,F,x,22,o[11]),F=t(F,K,J,oe,Z,7,o[12]),oe=t(oe,F,K,J,V,12,o[13]),J=t(J,oe,F,K,Y,17,o[14]),F=e(F,K=t(K,J,oe,F,te,22,o[15]),J,oe,S,5,o[16]),oe=e(oe,F,K,J,R,9,o[17]),J=e(J,oe,F,K,x,14,o[18]),K=e(K,J,oe,F,b,20,o[19]),F=e(F,K,J,oe,v,5,o[20]),oe=e(oe,F,K,J,B,9,o[21]),J=e(J,oe,F,K,te,14,o[22]),K=e(K,J,oe,F,g,20,o[23]),F=e(F,K,J,oe,w,5,o[24]),oe=e(oe,F,K,J,Y,9,o[25]),J=e(J,oe,F,K,O,14,o[26]),K=e(K,J,oe,F,N,20,o[27]),F=e(F,K,J,oe,V,5,o[28]),oe=e(oe,F,K,J,k,9,o[29]),J=e(J,oe,F,K,L,14,o[30]),F=r(F,K=e(K,J,oe,F,Z,20,o[31]),J,oe,v,4,o[32]),oe=r(oe,F,K,J,N,11,o[33]),J=r(J,oe,F,K,x,16,o[34]),K=r(K,J,oe,F,Y,23,o[35]),F=r(F,K,J,oe,S,4,o[36]),oe=r(oe,F,K,J,g,11,o[37]),J=r(J,oe,F,K,L,16,o[38]),K=r(K,J,oe,F,B,23,o[39]),F=r(F,K,J,oe,V,4,o[40]),oe=r(oe,F,K,J,b,11,o[41]),J=r(J,oe,F,K,O,16,o[42]),K=r(K,J,oe,F,R,23,o[43]),F=r(F,K,J,oe,w,4,o[44]),oe=r(oe,F,K,J,Z,11,o[45]),J=r(J,oe,F,K,te,16,o[46]),F=i(F,K=r(K,J,oe,F,k,23,o[47]),J,oe,b,6,o[48]),oe=i(oe,F,K,J,L,10,o[49]),J=i(J,oe,F,K,Y,15,o[50]),K=i(K,J,oe,F,v,21,o[51]),F=i(F,K,J,oe,Z,6,o[52]),oe=i(oe,F,K,J,O,10,o[53]),J=i(J,oe,F,K,B,15,o[54]),K=i(K,J,oe,F,S,21,o[55]),F=i(F,K,J,oe,N,6,o[56]),oe=i(oe,F,K,J,te,10,o[57]),J=i(J,oe,F,K,R,15,o[58]),K=i(K,J,oe,F,V,21,o[59]),F=i(F,K,J,oe,g,6,o[60]),oe=i(oe,F,K,J,x,10,o[61]),J=i(J,oe,F,K,k,15,o[62]),K=i(K,J,oe,F,w,21,o[63]),y[0]=y[0]+F|0,y[1]=y[1]+K|0,y[2]=y[2]+J|0,y[3]=y[3]+oe|0},_doFinalize:function(){var s=this._data,u=s.words,p=8*this._nDataBytes,f=8*s.sigBytes;u[f>>>5]|=128<<24-f%32;var E=h.floor(p/4294967296),y=p;u[15+(f+64>>>9<<4)]=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8),u[14+(f+64>>>9<<4)]=16711935&(y<<8|y>>>24)|4278255360&(y<<24|y>>>8),s.sigBytes=4*(u.length+1),this._process();for(var b=this._hash,S=b.words,k=0;k<4;k++){var O=S[k];S[k]=16711935&(O<<8|O>>>24)|4278255360&(O<<24|O>>>8)}return b},clone:function(){var s=a.clone.call(this);return s._hash=this._hash.clone(),s}});function t(s,u,p,f,E,y,b){var S=s+(u&p|~u&f)+E+b;return(S<<y|S>>>32-y)+u}function e(s,u,p,f,E,y,b){var S=s+(u&f|p&~f)+E+b;return(S<<y|S>>>32-y)+u}function r(s,u,p,f,E,y,b){var S=s+(u^p^f)+E+b;return(S<<y|S>>>32-y)+u}function i(s,u,p,f,E,y,b){var S=s+(p^(u|~f))+E+b;return(S<<y|S>>>32-y)+u}_.MD5=a._createHelper(n),_.HmacMD5=a._createHmacHelper(n)}(Math),m.MD5)},function(W,T,I){var m,h,_,d,l,a,c,o;W.exports=(o=I(3),I(47),I(48),h=(m=o).lib,_=h.Base,d=h.WordArray,l=m.algo,a=l.MD5,c=l.EvpKDF=_.extend({cfg:_.extend({keySize:4,hasher:a,iterations:1}),init:function(n){this.cfg=this.cfg.extend(n)},compute:function(n,t){for(var e,r=this.cfg,i=r.hasher.create(),s=d.create(),u=s.words,p=r.keySize,f=r.iterations;u.length<p;){e&&i.update(e),e=i.update(n).finalize(t),i.reset();for(var E=1;E<f;E++)e=i.finalize(e),i.reset();s.concat(e)}return s.sigBytes=4*p,s}}),m.EvpKDF=function(n,t,e){return c.create(e).compute(n,t)},o.EvpKDF)},function(W,T,I){var m;W.exports=(m=I(3),m.enc.Utf8)},function(W,T,I){"use strict";W.exports=n;var m,h=I(8),_=h.LongBits,d=h.base64,l=h.utf8;function a(p,f,E){this.fn=p,this.len=f,this.next=void 0,this.val=E}function c(){}function o(p){this.head=p.head,this.tail=p.tail,this.len=p.len,this.next=p.states}function n(){this.len=0,this.head=new a(c,0,0),this.tail=this.head,this.states=null}var t=function(){return h.Buffer?function(){return(n.create=function(){return new m})()}:function(){return new n}};function e(p,f,E){f[E]=255&p}function r(p,f){this.len=p,this.next=void 0,this.val=f}function i(p,f,E){for(;p.hi;)f[E++]=127&p.lo|128,p.lo=(p.lo>>>7|p.hi<<25)>>>0,p.hi>>>=7;for(;p.lo>127;)f[E++]=127&p.lo|128,p.lo=p.lo>>>7;f[E++]=p.lo}function s(p,f,E){f[E]=255&p,f[E+1]=p>>>8&255,f[E+2]=p>>>16&255,f[E+3]=p>>>24}n.create=t(),n.alloc=function(p){return new h.Array(p)},h.Array!==Array&&(n.alloc=h.pool(n.alloc,h.Array.prototype.subarray)),n.prototype._push=function(p,f,E){return this.tail=this.tail.next=new a(p,f,E),this.len+=f,this},r.prototype=Object.create(a.prototype),r.prototype.fn=function(p,f,E){for(;p>127;)f[E++]=127&p|128,p>>>=7;f[E]=p},n.prototype.uint32=function(p){return this.len+=(this.tail=this.tail.next=new r((p>>>=0)<128?1:p<16384?2:p<2097152?3:p<268435456?4:5,p)).len,this},n.prototype.int32=function(p){return p<0?this._push(i,10,_.fromNumber(p)):this.uint32(p)},n.prototype.sint32=function(p){return this.uint32((p<<1^p>>31)>>>0)},n.prototype.uint64=function(p){var f=_.from(p);return this._push(i,f.length(),f)},n.prototype.int64=n.prototype.uint64,n.prototype.sint64=function(p){var f=_.from(p).zzEncode();return this._push(i,f.length(),f)},n.prototype.bool=function(p){return this._push(e,1,p?1:0)},n.prototype.fixed32=function(p){return this._push(s,4,p>>>0)},n.prototype.sfixed32=n.prototype.fixed32,n.prototype.fixed64=function(p){var f=_.from(p);return this._push(s,4,f.lo)._push(s,4,f.hi)},n.prototype.sfixed64=n.prototype.fixed64,n.prototype.float=function(p){return this._push(h.float.writeFloatLE,4,p)},n.prototype.double=function(p){return this._push(h.float.writeDoubleLE,8,p)};var u=h.Array.prototype.set?function(p,f,E){f.set(p,E)}:function(p,f,E){for(var y=0;y<p.length;++y)f[E+y]=p[y]};n.prototype.bytes=function(p){var f=p.length>>>0;if(!f)return this._push(e,1,0);if(h.isString(p)){var E=n.alloc(f=d.length(p));d.decode(p,E,0),p=E}return this.uint32(f)._push(u,f,p)},n.prototype.string=function(p){var f=l.length(p);return f?this.uint32(f)._push(l.write,f,p):this._push(e,1,0)},n.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new a(c,0,0),this.len=0,this},n.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(c,0,0),this.len=0),this},n.prototype.ldelim=function(){var p=this.head,f=this.tail,E=this.len;return this.reset().uint32(E),E&&(this.tail.next=p.next,this.tail=f,this.len+=E),this},n.prototype.finish=function(){for(var p=this.head.next,f=this.constructor.alloc(this.len),E=0;p;)p.fn(p.val,f,E),E+=p.len,p=p.next;return f},n._configure=function(p){m=p,n.create=t(),m._configure()}},function(W,T,I){"use strict";W.exports=a;var m,h=I(8),_=h.LongBits,d=h.utf8;function l(i,s){return RangeError("index out of range: "+i.pos+" + "+(s||1)+" > "+i.len)}function a(i){this.buf=i,this.pos=0,this.len=i.length}var c,o=typeof Uint8Array!="undefined"?function(i){if(i instanceof Uint8Array||Array.isArray(i))return new a(i);throw Error("illegal buffer")}:function(i){if(Array.isArray(i))return new a(i);throw Error("illegal buffer")},n=function(){return h.Buffer?function(i){return(a.create=function(s){return h.Buffer.isBuffer(s)?new m(s):o(s)})(i)}:o};function t(){var i=new _(0,0),s=0;if(!(this.len-this.pos>4)){for(;s<3;++s){if(this.pos>=this.len)throw l(this);if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*s)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(127&this.buf[this.pos++])<<7*s)>>>0,i}for(;s<4;++s)if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*s)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(127&this.buf[this.pos])<<28)>>>0,i.hi=(i.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return i;if(s=0,this.len-this.pos>4){for(;s<5;++s)if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*s+3)>>>0,this.buf[this.pos++]<128)return i}else for(;s<5;++s){if(this.pos>=this.len)throw l(this);if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*s+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}function e(i,s){return(i[s-4]|i[s-3]<<8|i[s-2]<<16|i[s-1]<<24)>>>0}function r(){if(this.pos+8>this.len)throw l(this,8);return new _(e(this.buf,this.pos+=4),e(this.buf,this.pos+=4))}a.create=n(),a.prototype._slice=h.Array.prototype.subarray||h.Array.prototype.slice,a.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return c;if((this.pos+=5)>this.len)throw this.pos=this.len,l(this,10);return c}),a.prototype.int32=function(){return 0|this.uint32()},a.prototype.sint32=function(){var i=this.uint32();return i>>>1^-(1&i)|0},a.prototype.bool=function(){return this.uint32()!==0},a.prototype.fixed32=function(){if(this.pos+4>this.len)throw l(this,4);return e(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw l(this,4);return 0|e(this.buf,this.pos+=4)},a.prototype.float=function(){if(this.pos+4>this.len)throw l(this,4);var i=h.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i},a.prototype.double=function(){if(this.pos+8>this.len)throw l(this,4);var i=h.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i},a.prototype.bytes=function(){var i=this.uint32(),s=this.pos,u=this.pos+i;if(u>this.len)throw l(this,i);return this.pos+=i,Array.isArray(this.buf)?this.buf.slice(s,u):s===u?new this.buf.constructor(0):this._slice.call(this.buf,s,u)},a.prototype.string=function(){var i=this.bytes();return d.read(i,0,i.length)},a.prototype.skip=function(i){if(typeof i=="number"){if(this.pos+i>this.len)throw l(this,i);this.pos+=i}else do if(this.pos>=this.len)throw l(this);while(128&this.buf[this.pos++]);return this},a.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=7&this.uint32())!=4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this},a._configure=function(i){m=i,a.create=n(),m._configure();var s=h.Long?"toLong":"toNumber";h.merge(a.prototype,{int64:function(){return t.call(this)[s](!1)},uint64:function(){return t.call(this)[s](!0)},sint64:function(){return t.call(this).zzDecode()[s](!1)},fixed64:function(){return r.call(this)[s](!0)},sfixed64:function(){return r.call(this)[s](!1)}})}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetAgentPCRequest=void 0;var m=I(27),h=I(9),_=I(28),d=I(1),l=I(6),a=[d.BusinessService.SERVICE_WEBRTC_SIGNAL,d.BusinessService.SERVICE_L3_WEBRTC_SIGNAL],c=function(){function o(n,t,e,r,i,s){this.logger=n,this.service=t,this.streamManager=e,this.pcEstablishTimeout=r,this.path=i,this.query=s,this.connectState=d.PcConnectState.DISCONNECT,this.lastConnectState=d.PcConnectState.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.streamManager.createStream(d.StreamType.PC),this.eventManager=new _.EventManager,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}return o.prototype.sendRequest=function(n,t,e){var r=this;if(this.netPcStream.isConnect()){var i=n.payload;a.includes(this.service)&&(i=m.encodeString(n.payload));var s={service_no:this.service,ack:n.ack,payload:i,wss_message_type:l.NET_ACCESS_CONFIG.wssMessageType,wss_path:this.path,wss_raw_query:this.query,zegoconn_version:l.NET_ACCESS_CONFIG.connectVer};this.netPcStream.sendMessage(d.AccessHubMessageType.MSG_TYPE_PC_UPWARD_MESSAGE,s,function(){r.logger.info("zn.napr.sr suc"),e&&e()},function(u){r.logger.error("zn.napr.sr fail"),t&&t(u)}),this.netPcStream.isFirst=!1}else t&&t(h.errorCodeList.SOCKET_CLOSE)},o.prototype.onPushEvent=function(n,t){switch(this.logger.info("zn.napr.ope msgType: "+n),n){case d.AccessHubMessageType.MSG_TYPE_PC_ESTABLISHED:this.pcEstablished(t);break;case d.AccessHubMessageType.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case d.AccessHubMessageType.MSG_TYPE_PC_DOWNWARD_MESSAGE:var e=t.payload;a.includes(this.service)&&(e=m.decodeString(t.payload)),this.eventManager.emit("downLoadMessage",e)}},o.prototype.on=function(n,t){return this.eventManager.addEventHandler(n,t)},o.prototype.off=function(n,t){this.eventManager.removeEventHandler(n,t)},o.prototype.pcEstablished=function(n){this.logger.info("zn.napr.pe call "+JSON.stringify(n)),this.setConnectState(d.PcConnectState.CONNECTED);var t=d.ConnectedType.MANUAL;this.lastConnectState===d.PcConnectState.BROKEN&&this.connectState===d.PcConnectState.CONNECTED&&(t=d.ConnectedType.AUTO),this.eventManager.emit("connected",t),this.eventManager.emit("pcConnectedEvent",{proxy_link_sources:n==null?void 0:n.from}),this.brokenTimer&&clearTimeout(this.brokenTimer)},o.prototype.pcBroken=function(){var n=this;this.logger.info("zn.napr.pb call"),this.setConnectState(d.PcConnectState.BROKEN),this.eventManager.emit("broken"),this.brokenTimer=setTimeout(function(){n.eventManager.emit("disconnected",d.DisconnectedType.TEMP)},1e3*this.pcEstablishTimeout)},o.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},o.prototype._close=function(n,t){if(this.logger.info("zn.napr.cr call "+this.service+" "+this.connectState),this.connectState!==d.PcConnectState.DISCONNECT){this.netPcStream.closeStream(0,""),this.resetBrokenTimer();var e=this.streamManager.getStreamID();this.netPcStream.refresh(e),this.eventManager.emit(n,t)}this.setConnectState(d.PcConnectState.DISCONNECT)},o.prototype.closePc=function(){this._close("broken")},o.prototype.closeRequest=function(){this._close("disconnected",d.DisconnectedType.CLOSE)},o.prototype.setConnectState=function(n){this.connectState!==n&&(this.lastConnectState=this.connectState,this.connectState=n)},o}();T.NetAgentPCRequest=c},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.decodeString=T.encodeString=void 0,T.encodeString=function(m){return Uint8Array.from(Array.from(unescape(encodeURIComponent(m))).map(function(h){return h.charCodeAt(0)}))},T.decodeString=function(m){return decodeURIComponent(escape(String.fromCharCode.apply(String,Array.from(m))))}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.EventManager=void 0;var m=function(){function h(){this.handlerListMap={}}return h.prototype.addEventHandler=function(_,d){if(this.handlerListMap[_]||(this.handlerListMap[_]=[]),typeof d!="function")throw new Error("Params callBack is not a Function");return this.handlerListMap[_]&&this.handlerListMap[_].indexOf(d)==-1&&this.handlerListMap[_].push(d),!0},h.prototype.removeEventHandler=function(_,d){return!!this.handlerListMap[_]&&(this.handlerListMap[_]=d?this.handlerListMap[_].filter(function(l){return l!==d}):[],!0)},h.prototype.emit=function(_){for(var d=[],l=1;l<arguments.length;l++)d[l-1]=arguments[l];this.handlerListMap[_]&&this.handlerListMap[_].forEach(function(a){try{setTimeout(function(){a.apply(void 0,d)},0)}catch(c){console.error("dispatch "+_+" "+c)}})},h}();T.EventManager=m},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetAgentHttpRequest=void 0;var m=I(1),h=I(30),_=I(9),d=I(6),l=function(){function a(c,o,n){this.logger=c,this.service=o,this.streamManager=n,this.netHttpStream=this.streamManager.createStream(m.StreamType.HTTP)}return a.prototype.sendRequest=function(c,o,n,t){var e=this;if(this.netHttpStream.isConnect()){var r={service_no:this.service,ack:c.ack,headers:c.headers,body:h.encodeString(JSON.stringify(c.body)),id_name:c.idName,method_no:c.method_no,stick:c.stick,location:c.location,zegoconn_version:d.NET_ACCESS_CONFIG.connectVer};this.netHttpStream.sendMessage(m.AccessHubMessageType.MSG_TYPE_HTTP_REQUEST,r,function(i){if(i.body){var s=h.decodeString(i.body);i.body=s}e.logger.info("zn.nahr.sr suc "+JSON.stringify(i)),o&&o(i)},function(i){e.logger.error("zn.nahr.sr fail"),n&&n(i)},function(i){e.logger.error("zn.nahr.sr ack"),t&&t(i)}),this.netHttpStream.isFirst=!1}else n&&n(_.errorCodeList.SOCKET_CLOSE)},a}();T.NetAgentHttpRequest=l},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.uuidNum=T.decodeString=T.encodeString=void 0,T.encodeString=function(m){return Uint8Array.from(Array.from(unescape(encodeURIComponent(m))).map(function(h){return h.charCodeAt(0)}))},T.decodeString=function(m){return decodeURIComponent(escape(String.fromCharCode.apply(String,Array.from(m))))},T.uuidNum=function(m,h){var _,d="0123456789".split(""),l=[];if(h=d.length,m)for(_=0;_<m;_++)l[_]=d[0|Math.random()*h];else{var a=void 0;for(l[8]=l[13]=l[18]=l[23]="-",l[14]="4",_=0;_<36;_++)l[_]||(a=0|16*Math.random(),l[_]=d[_==19?3&a|8:a])}return l.join("")}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.HeartBeatHandler=void 0;var m=I(0),h=I(4),_=I(2),d=I(5),l=I(10),a=function(){function c(o,n,t,e,r,i){this.logger=o,this.stateCenter=n,this.dataReport=t,this.service=e,this.liveRoomHandler=r,this.room=i,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return c.prototype.init=function(o){var n,t=this;n=o.body.hearbeat_interval<m.MINIUM_HEARTBEAT_INTERVAL?m.MINIUM_HEARTBEAT_INTERVAL:o.body.hearbeat_interval,this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout(function(){t.start(n)},n),this.initCount++},c.prototype.start=function(o){var n=this;this.logger.info(d.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var t=m.getReportSeq();if(this.dataReport.newReport(t,l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(t,{room_sid:l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(d.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(t,{error:l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(t);if(++this.tryHeartbeatCount>3)return this.logger.error(d.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(t,{error:l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:l.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(t),void this.hbLogout(_.errorCodeList.HEARTBEAT_TIMEOUT);var e=function(i){var s=n.stateCenter.type=="PRIVATE"?i.body&&i.body.code:i.body&&i.body.err_code;if(i.header&&i.body){if(s!==0){var u=h.ClientUtil.decodeServerError(i.body.err_code||i.body.code,i.body.err_message||i.body.message);n.dataReport.addMsgInfo(t,{error:u.code,message:u.message+i.body.err_code})}}else n.dataReport.addMsgInfo(t,{error:i.code>0?i.code:_.errorCodeList.ROOM_INNER_ERROR.code,message:i.msg?i.msg:_.errorCodeList.ROOM_INNER_ERROR});n.dataReport.uploadReport(t),n.handleHeartbeatRsp(i)};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).heartBeat(e,e,this.room),this.heartbeatInterval=o;var r=this.heartbeatInterval;this.initCount>=2?(r=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):r=this.heartbeatInterval,this.heartbeatTimer=setTimeout(function(){n.start(n.heartbeatInterval)},r),this.logger.info(d.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},c.prototype.handleHeartbeatRsp=function(o){return o.body&&o.body.err_code&&o.body.err_code!==0?(this.logger.error(d.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",o.body.err_code),o.body.err_code==m.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(_.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(h.ClientUtil.getServerError(o.body.err_code))):o.header&&o.body?(this.tryHeartbeatCount=0,o.body.hearbeat_interval!==0&&(this.heartbeatInterval=o.body.hearbeat_interval,this.heartbeatInterval<m.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=m.MINIUM_HEARTBEAT_INTERVAL)),this.heartbeatRspNotiFy(o),void this.logger.info(d.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(d.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(o)),void this.hbLogout(o))},c.prototype.heartbeatRspNotiFy=function(o){},c.prototype.hbLogout=function(o){},c.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(d.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},c}();T.HeartBeatHandler=a},function(W,T,I){"use strict";var m=this&&this.__spreadArrays||function(){for(var c=0,o=0,n=arguments.length;o<n;o++)c+=arguments[o].length;var t=Array(c),e=0;for(o=0;o<n;o++)for(var r=arguments[o],i=0,s=r.length;i<s;i++,e++)t[e]=r[i];return t};Object.defineProperty(T,"__esModule",{value:!0}),T.UserHandler=void 0;var h=I(0),_=I(4),d=I(5),l=I(10),a=function(){function c(o,n,t,e,r,i){this.logger=o,this.stateCenter=n,this.dataReport=t,this.service=e,this.liveRoomHandler=r,this.room=i,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap=null,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return c.prototype.loginRsp=function(o,n){this.anchor_info=o.body.anchor_info||this.anchor_info,this.userListInterval=o.body.userlist_interval||this.userListInterval,this.userListMergeInterval=o.body.userlist_merge_timeout||this.userListMergeInterval,o.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",o.body.anchor_info.anchor_id_name,o.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",o.body.anchor_info.anchor_id_name,o.body.anchor_info.anchor_nick_name)),o.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,o.body.online_count),this.logger.info(d.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(n)},c.prototype.patchUserList=function(o){var n=this;o.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(d.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+o.body.server_user_seq),this.userSeqMergeMap||(this.userSeqMergeMap={}),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){n.handleMergeTimeout()},this.userListMergeInterval)),this.minUserSeq=o.body.server_user_seq,o.body.online_count!=null&&o.body.online_count!=0&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,o.body.online_count)},c.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},c.prototype.fetchUserList=function(o){this.userQuerying?this.logger.warn(d.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,o||0),this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},c.prototype.fetchUserListWithPage=function(o,n){var t=this,e=function(i){t.handleFetchUserListRsp(i,n)},r={user_index:o,sort_type:0};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).fetchUserList(r,e,e,this.room)},c.prototype.handleFetchUserListRsp=function(o,n){var t=this;if(o.body&&o.body.err_code!=0)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+o.body.err_code);if(!o.header||!o.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+o);if(this.stateCenter.userStateUpdate){this.userTempList=m(this.userTempList,o.body.user_baseinfos);var e=o.body.ret_user_index;if(e!=o.body.server_user_index)return this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(e+1,n);this.userSeq=o.body.server_user_seq;for(var r=[],i=[],s=0;s<this.userTempList.length;s++){var u={userID:this.userTempList[s].id_name,userName:this.userTempList[s].nick_name,role:this.userTempList[s].role};r.push(u),i.push({idName:this.userTempList[s].id_name,nickName:this.userTempList[s].nick_name,role:this.userTempList[s].role})}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,i),n==h.ENUM_RUN_STATE.login?(this.userList&&_.ClientUtil.mergeUserList(this.logger,this.userList,r,function(p,f){p.length!==0&&t.onUserStateUpdate(t.room.roomID,"ADD",p),f.length!==0&&t.onUserStateUpdate(t.room.roomID,"DELETE",f)}),this.userList=r):(this.userList=r,r.length!==0&&this.onUserStateUpdate(this.room.roomID,"ADD",r)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+r+" count "+r.length)}},c.prototype.handlePushUserStateUpdateMsg=function(o){if(this.logger.info(d.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==o.body.user_list_seq)if(this.userSeq+o.body.user_actions.length===o.body.user_list_seq){this.userSeq=o.body.user_list_seq;var n,t,e=[];if(this.stateCenter.type=="PRIVATE"){n=0,t=1;for(var r=0;r<o.body.user_actions.length;r++){var i={action:o.body.user_actions[r].action,idName:o.body.user_actions[r].user_id,nickName:o.body.user_actions[r].user_name,role:o.body.user_actions[r].role,loginTime:o.body.user_actions[r].login_time};e.push(i)}}else{for(n=1,t=2,r=0;r<o.body.user_actions.length;r++)i={action:o.body.user_actions[r].Action,idName:o.body.user_actions[r].IdName,nickName:o.body.user_actions[r].NickName,role:o.body.user_actions[r].Role,loginTime:o.body.user_actions[r].LoginTime},e.push(i);this.stateCenter.actionListener("_userStateUpdate",o.body.room_id,e)}var s=[],u=[];e.forEach(function(p){p.action==n?s.push({userID:p.idName,userName:p.nickName,role:p.role}):p.action==t&&u.push({userID:p.idName,userName:p.nickName,role:p.role})}),this.userList&&(this.userList=this.userList.concat(s).filter(function(p){return!u.some(function(f){return f.userID==p.userID})})),s.length!==0&&this.onUserStateUpdate(o.body.room_id||o.body.room_pushheader.room_id,"ADD",s),u.length!==0&&this.onUserStateUpdate(o.body.room_id||o.body.room_pushheader.room_id,"DELETE",u),this.logger.info(d.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(o.body.user_list_seq,o.body.user_actions);else this.logger.warn(d.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(d.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},c.prototype.onUserStateUpdate=function(o,n,t){var e=this,r=h.getReportSeq();this.dataReport.newReport(r,l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var i=t.filter(function(s){return s.userID!==e.stateCenter.idName});i.length!=0&&(this.stateCenter.type!=="PRIVATE"&&(i=i.map(function(s){return{userID:s.userID,userName:s.userName}})),this.stateCenter.actionListener("roomUserUpdate",o,n,i),this.dataReport.addMsgInfo(r,{user_update_type:n=="ADD"?l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("added"):l.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("deleted")}),this.dataReport.uploadReport(r))},c.prototype.mergeUserByUserSeq=function(o,n){var t=this;this.userSeqMergeMap||(this.logger.warn(d.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+o),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){t.handleMergeTimeout()},this.userListMergeInterval)),this.userSeqMergeMap[o]=n,this.logger.warn(d.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+o+" userlist "+n.length)},c.prototype.mergeUser=function(o){var n=this;this.logger.info(d.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+o.join(",")),this.userSeq=o[o.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var t={};o.forEach(function(s){n.userSeqMergeMap&&n.userSeqMergeMap[s].forEach(function(u){t[u.IdName]=u})}),this.userSeqMergeMap=null;var e=Object.values(t).map(function(s){return{action:s.Action,idName:s.IdName,nickName:s.NickName,role:s.Role,loginTime:s.LoginTime?String(s.LoginTime):""}});e.sort(function(s,u){return s.loginTime.localeCompare(u.loginTime)});var r=[],i=[];e.forEach(function(s){s.action==1?r.push({userID:s.idName,userName:s.nickName,role:s.role}):s.action==2&&i.push({userID:s.idName,userName:s.nickName,role:s.role})}),this.userList=this.userList&&this.userList.concat(r).filter(function(s){return!i.some(function(u){return u.userID==s.userID})}),r.length!==0&&this.onUserStateUpdate(this.room.roomID,"ADD",r),i.length!==0&&this.onUserStateUpdate(this.room.roomID,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,e)},c.prototype.handleMergeTimeout=function(){var o=this,n=Object.keys(this.userSeqMergeMap).map(function(e){return+e}).sort(function(e,r){return e-r});if(n[n.length-1]-n[0]+1===n.length||n[n.length-1]>=this.minUserSeq)this.mergeUser(n);else{this.userSeqMergeMap=null;var t=this.lastUserQueryTime-Date.now();this.logger.info(d.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+n.join(",")+" wait "+t),t>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout(function(){o.fetchUserList()},t)):this.fetchUserList()}},c.prototype.loginPrivateRsp=function(o){this.logger.info(d.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},c}();T.UserHandler=a},function(W,T,I){"use strict";var m=this&&this.__assign||function(){return(m=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o}).apply(this,arguments)},h=this&&this.__spreadArrays||function(){for(var o=0,n=0,t=arguments.length;n<t;n++)o+=arguments[n].length;var e=Array(o),r=0;for(n=0;n<t;n++)for(var i=arguments[n],s=0,u=i.length;s<u;s++,r++)e[r]=i[s];return e};Object.defineProperty(T,"__esModule",{value:!0}),T.LiveRoomService=void 0;var _=I(0),d=I(34),l=I(5),a=I(2),c=function(){function o(n,t,e){this.stateCenter=n,this.logger=t,this.rtm=e,this.service=new d.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return o.prototype.checkResponse=function(n){return this.stateCenter.roomModulesList.filter(function(t){return t.runState!==_.ENUM_RUN_STATE.logout}).length!=0&&(n.header.appid!==this.stateCenter.appid||n.header.user_id!==this.stateCenter.userid)},o.prototype.handleSendCommandMsgRsp=function(n){var t=this,e=this.service.sendCommandMap[n.header.seq];if(e!=null){var r=e._data;delete this.service.sendCommandMap[n.header.seq],this.service.sendCommandList.remove(e),n.body.err_code===0?setTimeout(function(){r&&r.success!=null&&r.success(n,t.cmdSeq)},0):setTimeout(function(){r&&r.error!=null&&r.error(n,t.cmdSeq)},0)}},o.prototype.onPush=function(){var n=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?n.stateCenter.actionListener("_protobufResponse",t):t.header?(t.body.err_code!==0?t.body.err_message&&n.logger.error(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):n.logger.info(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?n.handleSendCommandMsgRsp(t):n.checkResponse(t)?n.logger.error(l.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(n.logger.info(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!n.responseRouters[t.header.cmd]),n.handleSendCommandMsgRsp(t),n.responseRouters[t.header.cmd]&&n.responseRouters[t.header.cmd](t,n.cmdSeq))):n.logger.error(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},o.prototype.handlePushKickout=function(n){var t,e,r,i;if(((t=n==null?void 0:n.body)===null||t===void 0?void 0:t.protocol)===void 0||((e=n==null?void 0:n.body)===null||e===void 0?void 0:e.protocol)===1)h(this.stateCenter.roomModulesList).forEach(function(p){return p.roomHandler.handlePushKickout(n,!0)});else{var s=(r=n==null?void 0:n.header)===null||r===void 0?void 0:r.room_id,u=this.stateCenter.roomModulesList.find(function(p){return p.roomID==s});if(!u)return void this.logger.error(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify((i=n.header)===null||i===void 0?void 0:i.room_id));u.roomHandler.handlePushKickout(n)}},o.prototype.handlePushCustomMsg=function(n){},o.prototype.handlePushRoomMsg=function(n){},o.prototype.handlePushUserStateUpdateMsg=function(n){var t,e=(t=n==null?void 0:n.header)===null||t===void 0?void 0:t.room_id,r=this.stateCenter.roomModulesList.find(function(i){return i.roomID==e});r?r.userHandler.handlePushUserStateUpdateMsg(n):this.logger.error(l.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(n))},o.prototype.handlePushMergeMsg=function(n){},o.prototype.handlePushTransMsg=function(n){},o.prototype.handleBigImMsgRsp=function(n){},o.prototype.handlePushSignalMsg=function(n){},o.prototype.handlePushTokenExpire=function(n){this.stateCenter.actionListener("_tokenExpired",n)},o.prototype.closeHandler=function(n){this.service.closeHandler(n)},o.prototype.openHandler=function(n){this.service.openHandler(n)},o.prototype.errorHandler=function(n){this.service.errorHandler(n)},o.prototype.getHeader=function(n,t,e,r){return{Protocol:_.ROOMVERSION==="V1"?"req":"req_v2",cmd:n,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:e||"",room_session_id:r||"",biz_version:this.stateCenter.bizVersion||""}},o.prototype.startCheck=function(){this.service.startCheck()},o.prototype.stopCheck=function(){this.service.stopCheck()},o.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},o.prototype.createSocket=function(n){var t=this;this.service.createSocket(n),this.responseRouters=m(m({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)},push_token_expire:function(e){t.handlePushTokenExpire(e)}})},o.prototype.closeSocket=function(){this.service.closeSocket()},o.prototype.sendMessage=function(n,t,e,r,i,s){var u,p,f;if(this.service.isDisConnect())return this.logger.error(l.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),r(a.errorCodeList.SOCKET_CLOSE),0;var E=(s==null?void 0:s.roomID)?s.roomID:(u=this.stateCenter.roomModulesList[0])===null||u===void 0?void 0:u.roomID,y=(s==null?void 0:s.roomSessionID)?s.roomSessionID:(p=this.stateCenter.roomModulesList[0])===null||p===void 0?void 0:p.roomSessionID,b=(s==null?void 0:s.sessionID)?s.sessionID:(f=this.stateCenter.roomModulesList[0])===null||f===void 0?void 0:f.sessionID,S=i||this.getHeader(n,b,E,y);return this.logger.info(l.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:S,body:t})),this.service.sendMessage(S,t,e,r)},o.prototype.on=function(n,t){this.responseRouters[n]=t},o.prototype.login=function(n,t,e){var r=this.getHeader(n.isMulti?"enter":"login",n.sessionID,n.roomID,n.roomSessionID),i={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:n.token,version:this.stateCenter.sdKVersion,room_name:n.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:this.stateCenter.ENV===0?_.E_CLIENT_TYPE.ClientType_Webrtc:_.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:n.thirdToken,user_count_limit:n.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",i,t,e,r)},o.prototype.logout=function(n,t,e){var r=n.isMulti?"quit":"logout",i={reserve:0};return r=="logout"&&(i.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(r,i,t,e,void 0,{sessionID:n.sessionID,roomID:n.roomID,roomSessionID:n.roomSessionID})},o.prototype.heartBeat=function(n,t,e){return this.sendMessage("hb",{reserve:0},n,t,void 0,e)},o.prototype.fetchUserList=function(n,t,e,r){return this.sendMessage("user_list",n,t,e,void 0,r)},o.prototype.fetchUserListV2=function(n,t,e,r){return this.sendMessage("user_list_v2",n,t,e,void 0,r)},o.prototype.fetchReliableMessage=function(n,t,e,r){return this.sendMessage("trans_fetch",n,t,e,void 0,r)},o.prototype.sendReliableMessage=function(n,t,e,r){return this.sendMessage("trans",n,t,e,void 0,r)},o.prototype.sendRoomMsg=function(n,t,e,r){return this.sendMessage("im_chat",n,t,e,void 0,r)},o.prototype.sendCustomCommand=function(n,t,e,r){return this.sendMessage("custommsg",n,t,e,void 0,r)},o.prototype.sendBigRoomMessage=function(n,t,e,r){return this.sendMessage("bigim_chat",n,t,e,void 0,r)},o.prototype.sendRelayMessage=function(n,t,e,r){return this.sendMessage("relay",n,t,e,void 0,r)},o.prototype.sendSignalCmd=function(n,t,e,r){return this.sendMessage("signal",n,t,e,void 0,r)},o.prototype.sendPB=function(n){return this.service.isDisConnect()||this.stateCenter.networkState==_.ENUM_NETWORK_STATE.offline?(this.logger.error(l.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(n)},o}();T.LiveRoomService=c},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoSocketService=void 0;var m=I(0),h=I(2),_=function(){function d(l){this.socket=null,this.sendCommandList=new m.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=l}return d.prototype.createSocket=function(l){this.socket=m.createZegoWebSocket(l,this.ENV%2)},d.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},d.prototype.isDisConnect=function(){return!this.socket||this.socket.readyState!==1},d.prototype.sendMessage=function(l,a,c,o,n){c===void 0&&(c=null),o===void 0&&(o=null),n===void 0&&(n={timeOut:6e3});var t={header:l,body:a},e={data:t,seq:l.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:n.timeOut,success:c,error:o},r=this.sendCommandList.push(e);return this.sendCommandMap[e.seq]=r,this.socket&&this.socket.send(JSON.stringify(t)),l.seq},d.prototype.sendPB=function(l){return this.socket&&this.socket.send(l),!0},d.prototype.checkSendMessageList=function(l){for(var a=l.getFirst();a!=null;)l.remove(a),a._data&&a._data.error&&setTimeout(function(){a&&a._data&&a._data.error&&a._data.error(h.errorCodeList.TIMEOUT,a._data.data.header.seq,a._data.data.body.custom_msg)},0),a=l.getFirst()},d.prototype.checkMessageListTimeout=function(l,a){for(var c=l.getFirst(),o=Date.parse(new Date+""),n=0,t=function(){if(c._data&&c._data.sendTime+c._data.timeOut>o)return"break";if(c._data&&delete a[c._data.data.header.seq],l.remove(c),!(c._data&&c._data.error==null||c._data&&c._data.sendTime+e.sendDataDropTimeout<o)){var r=c&&c._data&&c._data.error,i=c&&c._data&&c._data.seq,s=c&&c._data&&c._data.data.body.custom_msg;setTimeout(function(){r&&r(h.errorCodeList.TIMEOUT,i,s)},0)}if(++n>=e.sendDataCheckOnceCount)return"break";c=l.getFirst()},e=this;c!=null&&t()!=="break";);},d.prototype.startCheck=function(){var l=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){l.startCheck()},this.sendDataCheckInterval)},d.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},d.prototype.openHandler=function(l){var a=this;this.socket&&(this.socket.onopen=function(c){a.socket.binaryType="arraybuffer",a.responseHandler(),l(c)})},d.prototype.responseHandler=function(){var l=this;this.socket&&(this.socket.onmessage=function(a){var c=typeof a.data=="string"?JSON.parse(a.data):a.data;l.onMessage(c)})},d.prototype.closeHandler=function(l){this.socket&&(this.socket.onclose=function(a){l(a)})},d.prototype.errorHandler=function(l){this.socket&&(this.socket.onerror=l)},d.prototype.onMessage=function(l){},d}();T.ZegoSocketService=_},,,,,,,function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BusinessService=T.NetAgentHttpRequest=T.NetAgentPCRequest=T.ZegoConnectionAgent=T.ZegoExpressWebRTM=T.ZegoDataReport=T.ZegoLogger=T.getSeq=T.getReportSeq=T.ZegoExpressWebRTMEngine=void 0;var m=I(42);Object.defineProperty(T,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return m.ZegoExpressWebRTM}});var h=I(94),_=I(0),d=I(17);Object.defineProperty(T,"ZegoConnectionAgent",{enumerable:!0,get:function(){return d.ZegoConnectionAgent}}),Object.defineProperty(T,"NetAgentPCRequest",{enumerable:!0,get:function(){return d.NetAgentPCRequest}}),Object.defineProperty(T,"NetAgentHttpRequest",{enumerable:!0,get:function(){return d.NetAgentHttpRequest}}),Object.defineProperty(T,"BusinessService",{enumerable:!0,get:function(){return d.BusinessService}});var l=function(){function c(o,n,t,e){t===void 0&&(t=0),this.logger=new _.ZegoLogger(t),this.dataReport=new _.ZegoDataReport(this.logger),this.cloudSetting=new h.ZegoSetting,this.zegoWebRTM=new m.ZegoExpressWebRTM(o,n,this.logger,this.dataReport,this.cloudSetting,c.version,t,e)}return c.prototype.enableMultiRoom=function(o){return this.zegoWebRTM.enableMultiRoom(o)},c.prototype.loginRoom=function(o,n,t,e){return this.zegoWebRTM.loginRoom(o,n,t,e)},c.prototype.logoutRoom=function(o){return this.zegoWebRTM.logoutRoom(o)},c.prototype.renewToken=function(o,n){return this.zegoWebRTM.renewToken(o,n)},c.prototype.sendBarrageMessage=function(o,n){return this.zegoWebRTM.sendBarrageMessage(o,n)},c.prototype.sendBroadcastMessage=function(o,n){return this.zegoWebRTM.sendBroadcastMessage(o,n)},c.prototype.sendCustomCommand=function(o,n,t){return this.zegoWebRTM.sendCustomCommand(o,n,t)},c.prototype.setRoomExtraInfo=function(o,n,t){return this.zegoWebRTM.setRoomExtraInfo(o,n,t)},c.prototype.setLogConfig=function(o){return this.zegoWebRTM.setLogConfig(o)},c.prototype.setDebugVerbose=function(o){return this.zegoWebRTM.setDebugVerbose(o)},c.prototype.on=function(o,n){return this.zegoWebRTM.on(o,n)},c.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},c.prototype.off=function(o,n){return this.zegoWebRTM.off(o,n)},c.prototype.loginHall=function(o,n,t){return this.zegoWebRTM.loginHall(o,n,t)},c.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},c.prototype.enterRoom=function(o,n){return this.zegoWebRTM.enterRoom(o,n)},c.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},c.use=function(o){m.ZegoExpressWebRTM.use(o)},c.version=_.PROTO_VERSION,c}();T.ZegoExpressWebRTMEngine=l;var a=I(0);Object.defineProperty(T,"getReportSeq",{enumerable:!0,get:function(){return a.getReportSeq}}),Object.defineProperty(T,"getSeq",{enumerable:!0,get:function(){return a.getSeq}}),Object.defineProperty(T,"ZegoLogger",{enumerable:!0,get:function(){return a.ZegoLogger}}),Object.defineProperty(T,"ZegoDataReport",{enumerable:!0,get:function(){return a.ZegoDataReport}})},function(W,T,I){"use strict";var m=this&&this.__awaiter||function(g,v,R,L){return new(R||(R=Promise))(function(N,w){function B(V){try{Z(L.next(V))}catch(Y){w(Y)}}function x(V){try{Z(L.throw(V))}catch(Y){w(Y)}}function Z(V){var Y;V.done?N(V.value):(Y=V.value,Y instanceof R?Y:new R(function(te){te(Y)})).then(B,x)}Z((L=L.apply(g,v||[])).next())})},h=this&&this.__generator||function(g,v){var R,L,N,w,B={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return w={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function x(Z){return function(V){return function(Y){if(R)throw new TypeError("Generator is already executing.");for(;B;)try{if(R=1,L&&(N=2&Y[0]?L.return:Y[0]?L.throw||((N=L.return)&&N.call(L),0):L.next)&&!(N=N.call(L,Y[1])).done)return N;switch(L=0,N&&(Y=[2&Y[0],N.value]),Y[0]){case 0:case 1:N=Y;break;case 4:return B.label++,{value:Y[1],done:!1};case 5:B.label++,L=Y[1],Y=[0];continue;case 7:Y=B.ops.pop(),B.trys.pop();continue;default:if(N=B.trys,!((N=N.length>0&&N[N.length-1])||Y[0]!==6&&Y[0]!==2)){B=0;continue}if(Y[0]===3&&(!N||Y[1]>N[0]&&Y[1]<N[3])){B.label=Y[1];break}if(Y[0]===6&&B.label<N[1]){B.label=N[1],N=Y;break}if(N&&B.label<N[2]){B.label=N[2],B.ops.push(Y);break}N[2]&&B.ops.pop(),B.trys.pop();continue}Y=v.call(g,B)}catch(te){Y=[6,te],L=0}finally{R=N=0}if(5&Y[0])throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}([Z,V])}}},_=this&&this.__spreadArrays||function(){for(var g=0,v=0,R=arguments.length;v<R;v++)g+=arguments[v].length;var L=Array(g),N=0;for(v=0;v<R;v++)for(var w=arguments[v],B=0,x=w.length;B<x;B++,N++)L[N]=w[B];return L};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoExpressWebRTM=void 0;var d=I(0),l=I(2),a=I(4),c=I(0),o=I(16),n=I(50),t=I(52),e=I(53),r=I(82),i=I(84),s=I(5),u=I(10),p=I(33),f=I(85),E=I(86),y=I(17),b=I(1),S=I(87),k=I(6),O=function(){function g(v,R,L,N,w,B,x,Z){var V=this;this.logger=L,this.dataReport=N,this.cloudSetting=w,this.version=B,this.options=Z,this.stateCenter=new e.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=x,this.getReportSeq=c.getReportSeq,this.getSeq=d.getSeq,this.initCallback();var Y=c.getReportSeq();if(this.dataReport.newReport(Y),(x==0||x==1)&&this.setDebug(R),a.ClientUtil.checkConfigParam(v,R,this.logger)){this.stateCenter.appid=v,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,this.stateCenter.testEnvironment&&(this.stateCenter.mode=y.Mode.MODE_TEST),this.netAgent=new y.ZegoConnectionAgent,this.netAgent.init(this.logger),this.netAgent.setAppInfo({appID:this.stateCenter.appid,env:this.stateCenter.ENV,mode:this.stateCenter.mode}),this.liveRoomHandler=new S.LiveRoomHandler(this.logger,this.stateCenter,this.netAgent,this),this.service=new p.LiveRoomService(this.stateCenter,this.logger,this),this.stateCenter.deviceID=a.ClientUtil.generateUUID(),this.stateCenter.settingConfig=new E.ZegoSettingConfig,this.cloudSetting.setLog(this.logger),this.cloudSetting.init({product:o.CLOUD_SETTING.product,appID:v,urls:o.CLOUD_SETTING.URL,env:x,pollingNotify:function(ae,ee){V.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR," setting file changed "+ae+" "+JSON.stringify(ee)),V.stateCenter.actionListener("_cloudSettingNotify",ae,ee)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment});var te="";x===0?te="rtc":x===1&&(te="xcx"),this.cloudSetting.setEnvVariable("environment",te);var F=this.cloudSetting.getSettingCache(o.INIT),K=this.cloudSetting.getSettingCache(o.ROOM_BASIC);if(Promise.all([F,K]).then(function(ae){var ee=ae==null?void 0:ae[0];V.stateCenter.settingConfig.setSetting(ee==null?void 0:ee.setting);var se=V.stateCenter.settingConfig.getSetting("unify");if(se){var de=se.enable,ge=se.sdk_conn_ver;de&&ge>=y.NET_ACCESS_CONFIG.connectVer?V.stateCenter.useNetAgent=!0:V.stateCenter.useNetAgent=!1}V.stateCenter.useNetAgent&&(V.createNetAgent(),V.getStoreAppConfig());var me=V.stateCenter.settingConfig.getSetting("remote_log_level",!0);me&&(V.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  setting remote_log_level "+me),V.logger.setRemoteLogLevel(me));var le=ae==null?void 0:ae[1];V.stateCenter.settingConfig.setSetting(le==null?void 0:le.setting);var Te=c.getReportSeq();V.dataReport.newReport(Te,u.ZegoRTMLogEvent.kZegoTaskCloudSettingCache.event),V.dataReport.addMsgInfo(Te,{files:[{name:o.INIT,content:ee==null?void 0:ee.setting,versions:ee==null?void 0:ee.versions},{name:o.ROOM_BASIC,content:le==null?void 0:le.setting,versions:le==null?void 0:le.versions}]}),V.dataReport.uploadReport(Te)}).catch(function(ae){V.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  initConfig "+JSON.stringify(ae))}),typeof R=="string"?(this.stateCenter.server=R,this.stateCenter.serverBak=R):Array.isArray(R)&&R.length>0&&(this.stateCenter.server=R[0],this.stateCenter.serverBak=R[1]||R[0]),x==0||x==2)this.bindWindowListener(),this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?d.ENUM_NETWORK_STATE.online:d.ENUM_NETWORK_STATE.offline:d.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(Y,{system_info:u.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(x==1||x==3){this.bindWxListener();try{var J=wx.getSystemInfoSync(),oe={brand:J.brand,model:J.model,system:J.system,platform:J.platform,version:J.version,SDKVersion:J.SDKVersion};this.dataReport.addMsgInfo(Y,{system_info:oe})}catch(ae){this.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(Y,u.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(Y,u.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(g.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),g.prototype.initCallback=function(){this.proxyRes=a.ClientUtil.proxyRes,this.actionSuccessCallback=a.ClientUtil.actionSuccessCallback,this.actionErrorCallback=a.ClientUtil.actionErrorCallback,this.getServerError=a.ClientUtil.getServerError,this.generateRandumNumber=a.ClientUtil.generateRandumNumber,this.unregisterCallback=a.ClientUtil.unregisterCallback,this.logReportCallback=a.ClientUtil.logReportCallback,this.registerCallback=a.ClientUtil.registerCallback},g.prototype.getStoreAppConfig=function(){this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GETSTOREAPPCONFIG+" call");var v=localStorage.getItem(k.APP_CONFIG_KEY+"_"+this.getAppID()+"_"+(this.stateCenter.mode||y.NET_ACCESS_CONFIG.modeNo));if(v)try{var R=a.ClientUtil.decryptStores(v,o.STORE_SECRET);R?(this.stateCenter.appConfig=JSON.parse(R),this.stateCenter.actionListener("_appConfigRsp"),this.handleLogUpload()):localStorage.removeItem(k.APP_CONFIG_KEY+"_"+this.getAppID()+"_"+(this.stateCenter.mode||y.NET_ACCESS_CONFIG.modeNo))}catch(L){this.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GETSTOREAPPCONFIG+" "+JSON.stringify(L))}else this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GETSTOREAPPCONFIG+" no store config")},g.prototype.createNetAgent=function(){var v,R,L,N,w=this;this.netAgent.on("disconnected",function(x){w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" netAgent disconnect")}),this.netAgent.on("connected",function(){w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" netAgent connect"),w.fetchAppConfig(),w.stateCenter.roomModulesList.forEach(function(x){x.roomTryHandler&&w.netAgent.isConnect()&&x.roomTryHandler.active(!0)})}),this.netAgent.on("broken",function(x){w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" netAgent broken"),x===b.BrokenType.CLOSE&&w.stateCenter.roomModulesList.forEach(function(Z){Z.resetSessionInfo()})}),this.netAgent.on("dispatchEvent",function(x,Z,V){if(w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" dispatch"),Z==="start"){var Y=c.getReportSeq();w.dataReport.newReport(Y,u.ZegoRTMLogEvent.kZegoConnDispatch.event),w.stateCenter.requestList[x]=Y}else if(Z==="end"){var te=w.stateCenter.requestList[x];if(te){var F="";F=(V==null?void 0:V.reason)?V.reason:w.dispatchServers?"UpdateDispatchResult":"NoDispatchResult",w.dataReport.addMsgInfo(te,{server_list:u.ZegoRTMLogEvent.kZegoConnDispatch.server_list(V.domains),trigger_reason:u.ZegoRTMLogEvent.kZegoConnDispatch.trigger_reason(F)}),w.dataReport.uploadReport(te)}}}),this.netAgent.on("connectedEvent",function(x,Z,V){if(w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" connect"),Z==="start"){var Y=c.getReportSeq();w.dataReport.newReport(Y,u.ZegoRTMLogEvent.kZegoConnConnect.event),w.stateCenter.requestList[x]=Y}else if(Z==="end"){var te=w.stateCenter.requestList[x];te&&(w.dataReport.addMsgInfo(te,{server_list:u.ZegoRTMLogEvent.kZegoConnConnect.server_list(V.servers),request_count:V.count,connect_id:V.connectid}),w.dataReport.uploadReport(te))}}),this.netAgent.on("requestEvent",function(x,Z,V){if(w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" request"),Z==="start"){var Y=c.getReportSeq();w.dataReport.newReport(Y,u.ZegoRTMLogEvent.kZegoRequest.event),w.stateCenter.requestList[x]=Y}else if(Z==="end"){var te=w.stateCenter.requestList[x];te&&(w.dataReport.addMsgInfo(te,{na_req_location:u.ZegoRTMLogEvent.kZegoRequest.na_req_location(V.na_req_location),http_code:V.status_code}),w.dataReport.uploadReport(te))}}),this.netAgent.on("disConnectedEvent",function(x){var Z=x.duration,V=x.server,Y=x.connectid;w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CREATENETAGENT+" disconnect");var te=c.getReportSeq();w.dataReport.newReport(te,u.ZegoRTMLogEvent.kZegoConnDisConnect.event),w.dataReport.addMsgInfo(te,{server:u.ZegoRTMLogEvent.kZegoConnDisConnect.server(V),connect_duration:Z,connect_id:Y}),w.dataReport.uploadReport(te)}),(v=this.liveRoomHandler.liveroomRequest)===null||v===void 0||v.on("pcConnectedEvent",function(x){var Z=c.getReportSeq();w.dataReport.newReport(Z,u.ZegoRTMLogEvent.kZegoSDKProxyConnect.event),w.dataReport.addMsgInfo(Z,{recv_time:new Date().getTime(),proxy_link_sources:x.proxy_link_sources}),w.dataReport.uploadReport(Z)});var B=(((R=this.options)===null||R===void 0?void 0:R.accessDomains)&&((L=this.options)===null||L===void 0?void 0:L.accessDomains.length)>0?(N=this.options)===null||N===void 0?void 0:N.accessDomains:y.NET_ACCESS_CONFIG.domains).map(function(x){return"wss://"+x+"/accesshub"});this.netAgent.setNetAgentDefaultServers(B),this.dispatchServers=this.getDispatchUrl(),this.netAgent.setDispatchConnectServers(this.dispatchServers)},g.prototype.getDispatchUrl=function(){var v=localStorage.getItem(k.NET_ACCESS_SERVERS+"_"+this.stateCenter.appid+"_"+(this.stateCenter.mode||y.NET_ACCESS_CONFIG.modeNo));if(!v)return[];var R=a.ClientUtil.decryptStores(v,o.STORE_SECRET);if(R)try{return JSON.parse(R)}catch(L){return[]}return[]},g.prototype.bindWindowListener=function(){var v=this,R=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),L=a.ClientUtil.getBrowser(),N=R?"pagehide":L==="Firefox"?"beforeunload":"unload";window.addEventListener(N,function(){v.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+N),v.stateCenter.type==="PUBLIC"?v.logoutRoom():v.leaveRoom(),v.logoutRoom()}),window.addEventListener("offline",function(){v.netOffLineHandle()}),window.addEventListener("online",function(){v.netOnLineHandle()})},g.prototype.bindWxListener=function(){var v=this;wx.onNetworkStatusChange(function(R){R.isConnected?v.netOnLineHandle():v.netOffLineHandle()})},g.prototype.retryRoom=function(){var v=this;this.stateCenter.roomModulesList.forEach(function(R){R.roomTryHandler&&v.netAgent.isConnect()&&(R.resetSessionInfo(),R.roomTryHandler.active(!0))})},g.prototype.netOnLineHandle=function(){var v=this;this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is online"),this.stateCenter.networkState=d.ENUM_NETWORK_STATE.online,this.stateCenter.useNetAgent||this.stateCenter.roomModulesList.forEach(function(R){R.roomTryHandler&&v.service.isDisConnect()?R.roomTryHandler.active():R.roomTryHandler&&(R.roomTryHandler.stopMaxTime(),R.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))})},g.prototype.netOffLineHandle=function(){this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=d.ENUM_NETWORK_STATE.offline,this.stateCenter.useNetAgent||this.stateCenter.roomModulesList.forEach(function(v){v.roomTryHandler&&(v.roomTryHandler.invalid(),v.roomTryHandler.onactive=function(R,L){v.roomHandler.disconnectedHandle(L)},v.roomTryHandler.startMaxTime(),v.roomHandler.roomStateHandle("CONNECTING",l.errorCodeList.NETWORK_BROKEN))})},g.prototype.setLogConfig=function(v){this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var R=c.getReportSeq();if(this.dataReport.newReport(R),v.logLevel&&["debug","info","warn","error","report","disable"].includes(v.logLevel)&&(this.logger.setLogLevel(v.logLevel),this.dataReport.addMsgInfo(R,{log_level:u.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(v.logLevel)})),v.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(v.remoteLogLevel)&&this.dataReport.addMsgInfo(R,{remote_log_level:u.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(v.remoteLogLevel)}),typeof v.logURL=="string"&&(v.logURL.startsWith("wss://")||v.logURL.startsWith("https://")))this.logger.setLogServer(v.logURL),this.dataReport.addMsgInfo(R,{log_url:u.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(v.logURL)}),this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(v.logURL)return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(R,u.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},g.prototype.setDebugVerbose=function(v){var R=c.getReportSeq();this.dataReport.newReport(R),typeof v=="boolean"&&(this.stateCenter.debug=v,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(R,{debug:u.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(v?"true":"false")})),this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},g.prototype.setDebug=function(v){typeof v=="string"&&v.indexOf("wss")>-1?this.stateCenter.debug=a.ClientUtil.isTestEnv(v):Array.isArray(v)&&v.length>0&&v.every(function(R){return typeof R=="string"&&R.indexOf("wss")>-1})?this.stateCenter.debug=a.ClientUtil.isTestEnv(v[0]):this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},g.prototype.renewToken=function(v,R){var L,N,w=this,B=c.getReportSeq();if(this.dataReport.newReport(B),R!==void 0&&(typeof R!="string"||R==""))return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var x=this.getRoomModules(R)||this.stateCenter.roomModulesList[0];if(!x)return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(B,{error:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(B,u.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1;if(typeof v=="string"&&x.roomTryHandler){if(v===x.roomTryHandler.token)this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token has not changed");else{if(this.stateCenter.configRoomAuth){var Z=function(Y){var te,F;(te=x.roomTryHandler)===null||te===void 0||te.renewLocalToken(v,(F=Y==null?void 0:Y.body)===null||F===void 0?void 0:F.token_remain_time),w.stateCenter.configCheckToken=!0,w.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(Y))},V=function(Y){var te,F,K=(te=Y==null?void 0:Y.body)===null||te===void 0?void 0:te.err_code;K&&K===1000002014||K===2014?(w.stateCenter.configCheckToken=!1,(F=x.roomTryHandler)===null||F===void 0||F.renewLocalToken(v),w.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(Y))):w.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(Y))};this.stateCenter.useNetAgent?(L=this.liveRoomHandler)===null||L===void 0||L.renewToken({token:v},Z,V,x):this.service.sendMessage("renew_token",{token:v},Z,V,void 0,{sessionID:x.sessionID,roomID:R,roomSessionID:x.roomSessionID})}else(N=x.roomTryHandler)===null||N===void 0||N.renewLocalToken(v);this.cloudSetting.setToken(v)}return this.dataReport.uploadReport(B,u.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0}return typeof v!="string"||x.roomTryHandler?(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(B,{error:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(B,u.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(B,{error:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:u.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(B,u.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},g.prototype.setCloudSettingURLs=function(v){var R=this;this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS+" call "),Array.isArray(v)&&v.length>0&&v.every(function(L){return typeof L=="string"&&L.indexOf("http")>-1})&&this.cloudSetting.init({product:o.CLOUD_SETTING.product,appID:this.stateCenter.appid,urls:v,env:this.stateCenter.ENV,pollingNotify:function(L,N){R.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS," setting file changed "+L+" "+JSON.stringify(N)),R.stateCenter.actionListener("_cloudSettingNotify",L,N)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment})},g.prototype.loginRoom=function(v,R,L,N){var w=this;return this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" call by user "+(L==null?void 0:L.userID)+" "+v),new Promise(function(B,x){return m(w,void 0,void 0,function(){var Z,V,Y,te,F,K,J=this;return h(this,function(oe){switch(oe.label){case 0:return this.stateCenter.ENV!==1?[3,2]:[4,new Promise(function(ae){wx.getNetworkType({success:function(ee){J.stateCenter.networkState=ee.networkType==="none"?d.ENUM_NETWORK_STATE.offline:d.ENUM_NETWORK_STATE.online,ae()},fail:function(ee){J.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(ee)),J.stateCenter.networkState=d.ENUM_NETWORK_STATE.online,ae()}})})];case 1:oe.sent(),oe.label=2;case 2:return Z=this.loginReport(B,x,R,N),V=Z.interResolve,Y=Z.interReject,!(N=N||{}).maxMemberCount&&(N.maxMemberCount=0),(te=t.checkParams({roomID:{order:0,value:v,rules:[{name:t.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:t.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:t.RULE_PARAM_NAME.MAX_LENGTH_128,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:t.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:R,rules:[{name:t.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:t.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:L,rules:[{name:t.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:t.RULE_PARAM_NAME.TYPE_OBJECT,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:L.userID,rules:[{name:t.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:t.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:t.RULE_PARAM_NAME.MAX_LENGTH_100,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:t.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:L.userName,rules:[{name:t.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:t.RULE_PARAM_NAME.MAX_LENGTH_256,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:N,rules:[]},"config.maxMemberCount":{order:6,value:N.maxMemberCount,rules:[{name:t.RULE_PARAM_NAME.TYPE_INTEGER,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==t.RULE_SUCCESS?(Y(te.error,te.extMsg),[2]):(this.netAgent&&(this.stateCenter.idName=L.userID,this.netAgent.setUserInfo(L.userID),this.stateCenter.actionListener("_roomLogin",v,R),this.netAgent.isConnect()&&this.fetchAppConfig(R)),this.cloudSetting.setUserID(L.userID),this.cloudSetting.setToken(R),this.cloudSetting.activePolling(),this.stateCenter.onListener("roomLoginResponse",function(ae){J.stateCenter.settingFetched||(J.getCloudSetting(),J.stateCenter.actionListener("_settingCanFetch"),J.stateCenter.settingFetched=!0)}),(F=this.getRoomModules(v))?(Y(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(F=new r.LiveRoomModules(v,this.stateCenter,this.logger,this.dataReport,this.service,this,this.liveRoomHandler),this.stateCenter.roomModulesList.length>0&&this.stateCenter.isMultiRoom==1?F.isMulti=!0:_(this.stateCenter.roomModulesList).forEach(function(ae){return ae.roomHandler.logout()}),this.stateCenter.roomModulesList.push(F),F.roomTryHandler||(F.roomTryHandler=new n.RetryRoomHandler(this.logger,this.stateCenter,F)),K=this.stateCenter.settingConfig.getSetting("room_server",!0),Array.isArray(K)&&K.length>0&&(this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting room_server "+K),this.stateCenter.server=K[0],this.stateCenter.serverBak=K[1]||K[0]),F.roomTryHandler.init(this.stateCenter.roomRetryTime),F.roomTryHandler.initRoom(F.roomHandler,v,R,L,this.stateCenter.server,this.stateCenter.serverBak,N),F.roomTryHandler.setLoginRoomCallback(V,Y),this.stateCenter.setMultiRoom=!0,this.stateCenter.useNetAgent&&!this.netAgent.isConnect()?(this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," us is not connected"),this.netAgent.connectUa(),[2]):(F.roomTryHandler.active(!0),[2])))}})})})},g.prototype.handleLogUpload=function(){var v=this.stateCenter.appConfig.app_config.domain;if(v){this.stateCenter.logDomain="weblogger"+this.stateCenter.appid+"-api."+v;var R="";R=this.stateCenter.ENV===0?"wss://"+this.stateCenter.logDomain+"/log":"https://"+this.stateCenter.logDomain+"/httplog",this.logger.setLogServer(R)}},g.prototype.fetchAppConfig=function(v){return m(this,void 0,void 0,function(){var R,L,N,w,B,x,Z,V,Y,te,F,K;return h(this,function(J){switch(J.label){case 0:if(this.stateCenter.appConfigFetched)return this.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_FETCH_APP_CONFIG+" config fetched"),[2];if(!this.getUserID())return this.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_FETCH_APP_CONFIG+" user not exist"),[2];if(R="",v)R=v;else{if(!(this.stateCenter.roomModulesList.length>0))return this.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_FETCH_APP_CONFIG+" token not exist"),[2];R=this.getToken()}L=c.getReportSeq(),this.dataReport.newReport(L,u.ZegoRTMLogEvent.kZegoSDKConfigInit.event),J.label=1;case 1:return J.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",R,5e3)];case 2:return N=J.sent(),w=N.code,B=N.data,this.dataReport.addMsgInfo(L,{trigger_reason:"refresh"}),this.dataReport.uploadReport(L),this.stateCenter.appConfigFetched=!0,this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" initConfig code:"+w+" data: "+JSON.stringify(B)),x=B.app_config,Z=B.media_config,V=Z.publish_config,Y=Z.play_config,this.stateCenter.appConfig={app_config:x,media_config:{publish_config:V,play_config:Y}},te=JSON.stringify(this.stateCenter.appConfig),F=a.ClientUtil.encryptStores(te,o.STORE_SECRET),localStorage.setItem(k.APP_CONFIG_KEY+"_"+this.getAppID()+"_"+(this.stateCenter.mode||y.NET_ACCESS_CONFIG.modeNo),F),this.stateCenter.appConfig||(this.stateCenter.actionListener("_appConfigRsp"),this.handleLogUpload()),[3,4];case 3:return K=J.sent(),this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" fail "+JSON.stringify(K)),this.dataReport.addMsgInfo(L,{trigger_reason:"refresh"}),this.dataReport.uploadReport(L),(K==null?void 0:K.code)===20012&&this.stateCenter.roomModulesList.forEach(function(oe){oe.roomTryHandler&&oe.roomTryHandler.loginFail(l.errorCodeList.APPID_INVALID)}),[3,4];case 4:return[2]}})})},g.prototype.getCloudSetting=function(){var v=this;this.cloudSetting.fetchMultiSetting([o.INIT,o.ROOM_BASIC]).then(function(R){var L;v.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(R)),v.stateCenter.settingConfig.setSetting((L=R==null?void 0:R[o.INIT])===null||L===void 0?void 0:L.setting,["remote_log_level"]);var N=v.stateCenter.settingConfig.getSetting("remote_log_level",!0);N&&(v.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+"  setting remote_log_level "+N),v.logger.setRemoteLogLevel(N))}).catch(function(R){v.logger.warn(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(R))}),this.stateCenter.onListener("_cloudSettingNotify",function(R,L){var N=c.getReportSeq();v.dataReport.newReport(N,u.ZegoRTMLogEvent.kZegoTaskCloudSettingRefresh.event);var w=v.cloudSetting.getEnvVariables();if(v.dataReport.addMsgInfo(N,{params:w,files:[{name:R,content:L.setting,versions:L.versions}]}),v.dataReport.uploadReport(N),R===o.INIT){v.stateCenter.settingConfig.setSetting(L==null?void 0:L.setting,["remote_log_level"]);var B=v.stateCenter.settingConfig.getSetting("remote_log_level");B&&(v.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting remote_log_level "+B),v.logger.setRemoteLogLevel(B))}})},g.prototype.cloudReportNotify=function(v,R,L){if(R==="request_start"){var N=c.getReportSeq();this.dataReport.newReport(N,u.ZegoRTMLogEvent.kZegoTaskCloudSettingRequest.event),this.stateCenter.settingConfig.requestList[v]=N}else if(R==="request_end"){var w=this.stateCenter.settingConfig.requestList[v];w&&(this.dataReport.addMsgInfo(w,{request_detail:L==null?void 0:L.reportData,files:L==null?void 0:L.files,error:L==null?void 0:L.code,request_params:L==null?void 0:L.params}),this.dataReport.uploadReport(w))}},g.prototype.loginReport=function(v,R,L,N){var w=this;this.stateCenter.reportSeqList.login!==0&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,a.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var B=c.getReportSeq();this.stateCenter.reportSeqList.login=B,this.dataReport.newReport(B,u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event);var x=this.cloudSetting.getEnvVariable("deviceid");return this.dataReport.addMsgInfo(B,{deviceid:x,use_na:this.stateCenter.useNetAgent?1:0}),typeof L=="string"&&this.dataReport.addMsgInfo(B,{token:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(L),isMulti:this.stateCenter.isMultiRoom}),N&&(N.userUpdate&&typeof N.userUpdate=="boolean"&&this.dataReport.addMsgInfo(B,{user_update:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(N.userUpdate+"")}),N.maxMemberCount&&typeof N.maxMemberCount=="number"&&this.dataReport.addMsgInfo(B,{max_member_count:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(N.maxMemberCount+"")})),a.ClientUtil.logReportCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,B,this.stateCenter.reportList),{interResolve:function(Z){w.dataReport.uploadReport(B),w.stateCenter.reportSeqList.login=0,a.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,w.stateCenter.reportList),v(Z)},interReject:function(Z,V){var Y,te;V===void 0&&(V=""),Z.code<2e9&&Z.code>1e9||Z.code<1e6?(Y=a.ClientUtil.decodeServerError(Z.code,Z.msg),te=a.ClientUtil.getLiveRoomError(Z.code,w.stateCenter.useNetAgent)):Y={code:Z.code,message:Z.msg},Y&&w.dataReport.addMsgInfo(B,{error:Y.code,message:Y.message+V}),w.dataReport.uploadReport(B),w.stateCenter.reportSeqList.login=0,a.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,w.stateCenter.reportList),te&&l.errorCodeList[te]&&(Z.code=l.errorCodeList[te].code),Z.code&&Z.msg&&V!==""?R({code:Z.code,msg:Z.msg+V}):R(Z)}}},g.prototype.logoutRoom=function(v){this.logger.info(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" call by user "+v);var R=c.getReportSeq();if(this.dataReport.newReport(R),this.dataReport.addMsgInfo(R,{roomid:v,isMulti:this.stateCenter.isMultiRoom}),v===void 0)_(this.stateCenter.roomModulesList).forEach(function(N){return N.roomHandler.logout(!0)}),this.cloudSetting.uninit();else{if(typeof v!="string"||v=="")return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(R,{error:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var L=this.getRoomModules(v);L?(L.roomHandler.logout(),this.stateCenter.roomModulesList.length===0&&this.cloudSetting.uninit(),this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(R,{error:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(R,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},g.prototype.loginHall=function(v,R,L){var N=this;return new Promise(function(w,B){return m(N,void 0,void 0,function(){return h(this,function(x){return[2]})})})},g.prototype.loginHallReport=function(v,R,L,N){},g.prototype.logoutHall=function(){},g.prototype.enterRoom=function(v,R){return new Promise(function(L,N){console.error(d.MODULE_TIPS.MESSAGE),N()})},g.prototype.leaveRoom=function(){return new Promise(function(v,R){console.error(d.MODULE_TIPS.MESSAGE),R()})},g.prototype.sendCustomCommand=function(v,R,L){return new Promise(function(N,w){console.error(d.MODULE_TIPS.MESSAGE),w()})},g.prototype._sendCustomCommand=function(v,R,L){return new Promise(function(N,w){console.error(d.MODULE_TIPS.MESSAGE),w()})},g.prototype.sendBroadcastMessage=function(v,R){return new Promise(function(L,N){console.error(d.MODULE_TIPS.MESSAGE),N()})},g.prototype._sendBroadcastMessage=function(v,R,L,N){return L===void 0&&(L=1),N===void 0&&(N=1),new Promise(function(w,B){console.error(d.MODULE_TIPS.MESSAGE),B()})},g.prototype.setRoomExtraInfo=function(v,R,L){return new Promise(function(N,w){console.error(d.MODULE_TIPS.MESSAGE),w()})},g.prototype._setRoomExtraInfo=function(v,R,L){return new Promise(function(N,w){console.error(d.MODULE_TIPS.MESSAGE),w()})},g.prototype.sendBarrageMessage=function(v,R){return new Promise(function(L,N){console.error(d.MODULE_TIPS.MESSAGE),N()})},g.prototype._sendBarrageMessage=function(v,R,L,N){return L===void 0&&(L=1),N===void 0&&(N=1),new Promise(function(w,B){console.error(d.MODULE_TIPS.MESSAGE),B()})},g.prototype.sendRelayMessage=function(v,R,L,N,w){console.error(d.MODULE_TIPS.MESSAGE)},g.prototype.requestJoinLive=function(v,R,L,N,w){return console.error(d.MODULE_TIPS.MESSAGE),!1},g.prototype.inviteJoinLive=function(v,R,L,N,w){return console.error(d.MODULE_TIPS.MESSAGE),!1},g.prototype.endJoinLive=function(v,R,L,N){return console.error(d.MODULE_TIPS.MESSAGE),!1},g.prototype.respondJoinLive=function(v,R,L,N,w){return console.error(d.MODULE_TIPS.MESSAGE),!1},g.prototype.getVersion=function(){return this.version},g.prototype.setSdkBizVersion=function(v){typeof v=="string"&&v!==""&&(this.stateCenter.bizVersion=v)},g.prototype.on=function(v,R){return this.stateCenter.listenerList[v]?typeof R!="function"?(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(this.stateCenter.listenerList[v].indexOf(R)==-1&&this.stateCenter.listenerList[v].push(R),!0):(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+v+" no found"),!1)},g.prototype.off=function(v,R){if(!this.stateCenter.listenerList[v])return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var L=this.stateCenter.listenerList[v];return R?L.splice(L.indexOf(R),1):this.stateCenter.listenerList[v]=[],!0},g.prototype._on=function(v,R){return this.stateCenter.listenerList[v]?typeof R!="function"?(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(this.stateCenter.listenerList[v].indexOf(R)==-1&&this.stateCenter.listenerList[v].push(R),!0):(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+v+" no found"),!1)},g.prototype._off=function(v,R){if(!this.stateCenter.listenerList[v])return this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var L=this.stateCenter.listenerList[v];return R?L.splice(L.indexOf(R),1):this.stateCenter.listenerList[v]=[],!0},g.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},g.prototype.isLogin=function(v){var R=this.getRoomModules(v)||this.stateCenter.roomModulesList[0];return!!R&&R.isLogin()},g.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},g.prototype.getAppID=function(){return this.stateCenter.appid},g.prototype.getUserID=function(){return this.stateCenter.idName},g.prototype.getUseNetAgent=function(){return this.stateCenter.useNetAgent},g.prototype.getToken=function(v){return(this.getRoomModules(v)||this.stateCenter.roomModulesList[0]).token},g.prototype.setRoomCreateFlag=function(v){this.stateCenter.roomCreateFlag=v},g.prototype.setRole=function(v){this.stateCenter.role=v},g.prototype.getSessionId=function(v){var R=this.getRoomModules(v)||this.stateCenter.roomModulesList[0];return R?R.sessionID:"0"},g.prototype.getRoomSessionID=function(v){var R=this.getRoomModules(v)||this.stateCenter.roomModulesList[0];return R?R.roomSessionID:"0"},g.prototype.getAppConfig=function(){return this.stateCenter.appConfig},g.prototype.setAccess=function(v){this.stateCenter.useNetAgent=v,this.netAgent.stateCenter.useNetAgent=v},g.prototype.enableMultiRoom=function(v){var R=c.getReportSeq();return this.dataReport.newReport(R,u.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(R,{isMulti:v}),typeof v!="boolean"?(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(R,void 0,u.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(R,void 0,u.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(R),this.stateCenter.isMultiRoom=v,this.stateCenter.setMultiRoom=!0,!0)},g.prototype.getRoomModules=function(v){return this.stateCenter.roomModulesList.find(function(R){return R.roomID==v})},g.use=function(v){switch(v.type){case"message":v.install(g,r.LiveRoomModules,p.LiveRoomService,S.LiveRoomHandler,i.LiveRoomModules,f.LiveRoomPrivateService);break;case"live":v.install(g,r.LiveRoomModules,p.LiveRoomService,S.LiveRoomHandler);break;case"privates":v.install(g,i.LiveRoomModules,f.LiveRoomPrivateService)}},g.prototype.resetRoomTokenTimer=function(v,R){var L=this.getRoomModules(v)||this.stateCenter.roomModulesList[0];L&&R&&R>0&&L.roomHandler.resetTokenTimer(1e3*R-this.stateCenter.local_time_deviation)},g.prototype.isDisConnect=function(){return this.stateCenter.useNetAgent?this.liveRoomHandler.isDisConnect():this.service.isDisConnect()},g.prototype.sendMessage=function(v,R,L,N){(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendMessage(v,R,L,N)},g.prototype.setProtoFormat=function(v){if(v===void 0&&(v="json"),!["json","pb"].includes(v))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=v},g.prototype.setSdkLoginRelateService=function(v){Array.isArray(v)&&v.every(function(R){return typeof R=="string"})&&(this.stateCenter.relateService=v)},g.prototype.sendMessageByService=function(v,R,L,N,w,B){return this.service.sendMessage(v,R,L,N,w,B)},g.prototype.getHeader=function(v){var R=this.stateCenter.roomModulesList[0];if(R&&R.isLogin()){var L=R.roomID,N=R.sessionID,w=R.roomSessionID;return this.service.getHeader(v,N,L,w)}this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},g.prototype.sendPB=function(v){return v instanceof Uint8Array?this.service.sendPB(v):(this.logger.error(s.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},g.prototype.onPushBizChannel=function(v){v&&this.service.on("push_biz_channel",v)},g.prototype.getRoomID=function(){return this.stateCenter.roomid},g.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},g.prototype.isUseNetAgent=function(){return this.stateCenter.useNetAgent},g.prototype.getReqHead=function(v){var R;return R=typeof v=="string"&&v!==""&&this.getRoomModules(v)||this.stateCenter.roomModulesList[0],this.liveRoomHandler.getReqHead(R)},g.prototype.sendSwitchMessage=function(v,R){return typeof v=="string"&&R?this.liveRoomHandler.sendMessage(v,R,void 0,void 0,void 0,!1):-1},g.prototype.onSwitchMessage=function(v){v&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=v)},g}();T.ZegoExpressWebRTM=O},function(W,T,I){W.exports=function(m){var h={};function _(d){if(h[d])return h[d].exports;var l=h[d]={i:d,l:!1,exports:{}};return m[d].call(l.exports,l,l.exports,_),l.l=!0,l.exports}return _.m=m,_.c=h,_.d=function(d,l,a){_.o(d,l)||Object.defineProperty(d,l,{enumerable:!0,get:a})},_.r=function(d){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},_.t=function(d,l){if(1&l&&(d=_(d)),8&l||4&l&&typeof d=="object"&&d&&d.__esModule)return d;var a=Object.create(null);if(_.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:d}),2&l&&typeof d!="string")for(var c in d)_.d(a,c,function(o){return d[o]}.bind(null,c));return a},_.n=function(d){var l=d&&d.__esModule?function(){return d.default}:function(){return d};return _.d(l,"a",l),l},_.o=function(d,l){return Object.prototype.hasOwnProperty.call(d,l)},_.p="",_(_.s=3)}([function(m,h,_){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.E_CLIENT_TYPE=h.ENUM_LOG_LEVEL=h.ENUM_REMOTE_TYPE=h.ZEGO_ENV=h.ZEGO_BROWSER_TYPE=void 0,function(d){d[d.IE=0]="IE",d[d.FIREFOX=1]="FIREFOX",d[d.CHROME=2]="CHROME",d[d.SAFARI=3]="SAFARI",d[d.OPERA=4]="OPERA",d[d.WEIXIN=5]="WEIXIN",d[d.WEIXINMINI=6]="WEIXINMINI",d[d.UNKOWN=7]="UNKOWN"}(h.ZEGO_BROWSER_TYPE||(h.ZEGO_BROWSER_TYPE={})),function(d){d[d.BROWSER=0]="BROWSER",d[d.WEIXINMINI=1]="WEIXINMINI"}(h.ZEGO_ENV||(h.ZEGO_ENV={})),function(d){d[d.DISABLE=0]="DISABLE",d[d.WEBSOCKET=1]="WEBSOCKET",d[d.HTTPS=2]="HTTPS"}(h.ENUM_REMOTE_TYPE||(h.ENUM_REMOTE_TYPE={})),h.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(d){d[d.ClientType_None=0]="ClientType_None",d[d.ClientType_H5=1]="ClientType_H5",d[d.ClientType_SmallPragram=2]="ClientType_SmallPragram",d[d.ClientType_Webrtc=3]="ClientType_Webrtc"}(h.E_CLIENT_TYPE||(h.E_CLIENT_TYPE={}))},function(m,h,_){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.LoggerStateCenter=void 0;var d=function(){function l(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return l.getInstance=function(){return l.instance||(l.instance=new l,l.instance.init()),l.instance},l.prototype.init=function(){},Object.defineProperty(l.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(a){this._testEnvironment=a},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"ENV",{get:function(){return this._ENV},set:function(a){this._ENV=a},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"debug",{get:function(){return this._debug},set:function(a){this._debug=a},enumerable:!1,configurable:!0}),l.instance=new l,l}();h.LoggerStateCenter=d},function(m,h,_){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createZegoWebSocket=h.ZegoWeiXinMiniWebSocket=void 0;var d=_(0),l=function(){function a(c,o){this.url=c,this.readyState=3,this._websocket=wx.connectSocket({url:c}),this.init()}return a.prototype.init=function(){var c=this;this._websocket&&(this.readyState=0,this._websocket.onOpen(function(o){c.readyState=c._websocket.readyState,typeof c.onopen=="function"&&(c.onopen(o),c._websocket.onClose(function(n){c.readyState=c._websocket.readyState,typeof c.onclose=="function"&&c.onclose(n)}),c._websocket.onMessage(function(n){typeof c.onmessage=="function"&&c.onmessage(n)}))}),this._websocket.onError(function(o){c.readyState=c._websocket.readyState,typeof c.onerror=="function"&&c.onerror(o)}))},a.prototype.onopen=function(c){},a.prototype.onerror=function(c){},a.prototype.onclose=function(c){},a.prototype.onmessage=function(c){},a.prototype.send=function(c){this._websocket&&this._websocket.send({data:c})},a.prototype.close=function(){this._websocket&&this._websocket.close()},a}();h.ZegoWeiXinMiniWebSocket=l,h.createZegoWebSocket=function(a,c){return c%2===d.ZEGO_ENV.BROWSER?new WebSocket(a):new l(a)}},function(m,h,_){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.LoggerStateCenter=h.createZegoWebSocket=h.ZegoDataReport=h.ZegoLogger=void 0;var d=_(1);Object.defineProperty(h,"LoggerStateCenter",{enumerable:!0,get:function(){return d.LoggerStateCenter}});var l=_(2);Object.defineProperty(h,"createZegoWebSocket",{enumerable:!0,get:function(){return l.createZegoWebSocket}});var a=_(4);Object.defineProperty(h,"ZegoDataReport",{enumerable:!0,get:function(){return a.ZegoDataReport}});var c=_(5);Object.defineProperty(h,"ZegoLogger",{enumerable:!0,get:function(){return c.ZegoLogger}})},function(m,h,_){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(a){for(var c,o=1,n=arguments.length;o<n;o++)for(var t in c=arguments[o])Object.prototype.hasOwnProperty.call(c,t)&&(a[t]=c[t]);return a}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.ZegoDataReport=void 0;var l=function(){function a(c){this.dataStatistics={},this.logger=c}return a.prototype.newReport=function(c,o){this.dataStatistics[c]={event_time:Date.now(),time_consumed:0,seq:c,error:0,message:"success",event:o,events:[]}},a.prototype.addMsgExt=function(c,o){this.dataStatistics[c]?this.dataStatistics[c].msg_ext=o:console.warn(c+" not exist")},a.prototype.addMsgInfo=function(c,o){this.dataStatistics[c]?Object.assign(this.dataStatistics[c],o):console.warn(c+" not exist")},a.prototype.eventStart=function(c,o){this.dataStatistics[c]?this.dataStatistics[c].events!=null?this.dataStatistics[c].events.push({event:o,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},a.prototype.eventEnd=function(c,o,n){if(this.dataStatistics[c]){var t=this.dataStatistics[c].events;if(t&&t.length!==0){for(var e=t.length-1;e>=0;e--)if(t[e].event==o&&t[e].time_consumed==0){t[e].time_consumed=Date.now()-t[e].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},a.prototype.eventEndWithMsg=function(c,o,n){if(this.dataStatistics[c]){var t=this.dataStatistics[c].events;if(t){for(var e=t.length-1;e>=0;e--)if(t[e].event==o&&t[e].time_consumed==0){t[e].time_consumed=Date.now()-t[e].event_time,t[e].msg_ext==null&&(t[e].msg_ext={}),t[e].msg_ext=d({},n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},a.prototype.eventEndWithMsgInfo=function(c,o,n){if(this.dataStatistics[c]){var t=this.dataStatistics[c].events;if(t){for(var e=t.length-1;e>=0;e--)if(t[e].event==o&&t[e].time_consumed==0){t[e].time_consumed=Date.now()-t[e].event_time,Object.assign(t[e],n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},a.prototype.addEventInfo=function(c,o,n,t){if(this.dataStatistics[c]){var e=this.dataStatistics[c].events;if(e!=null){for(var r=e.length-1;r>=0;r--)if(e[r].event==o&&e[r].time_consumed!=null){e[r].msg_ext==null?e[r].msg_ext={}:e[r].msg_ext&&(e[r].msg_ext[n]=t);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},a.prototype.addEventMsg=function(c,o,n,t){if(this.dataStatistics[c]){var e=this.dataStatistics[c].events;if(e!=null){for(var r=e.length-1;r>=0;r--)if(e[r].event==o){e[r][n]=t;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},a.prototype.addEvent=function(c,o,n){this.dataStatistics[c]?this.dataStatistics[c].events&&(n?this.dataStatistics[c].events.push({event:o,event_time:Date.now(),msg_ext:n}):this.dataStatistics[c].events.push({event:o,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},a.prototype.uploadReport=function(c,o,n,t){var e=this.dataStatistics[c];e!=null&&(o&&(e.event=o),e.time_consumed=Date.now()-e.event_time,n&&this.addMsgInfo(c,{error:n.code,message:n.message||n.msg+" "+(t||"")}),this.logger.report(e),delete this.dataStatistics[c])},a}();h.ZegoDataReport=l},function(m,h,_){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.ZegoLogger=void 0;var l=_(0),a=_(2),c=_(1),o=_(6),n=function(){function t(e){this.logLevel=l.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=c.LoggerStateCenter.getInstance(),this.env=e}return t.prototype.setLogLevel=function(e){var r=l.ENUM_LOG_LEVEL[e];return r!==void 0&&(this.logLevel=r,!0)},t.prototype.setRemoteLogLevel=function(e){var r=l.ENUM_LOG_LEVEL[e];return r!==void 0&&(this.logRemoteLevel=r,!0)},t.prototype.setSessionInfo=function(e,r,i,s,u,p){this.appid=e,this.roomid=r,this.sessionid=i,this.userid=s,this.userName=u,this.version=p},t.prototype.report=function(e){var r=this.logReportParamList(l.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=l.ENUM_LOG_LEVEL.REPORT&&console.debug(r),this.RemoteLog(l.ENUM_LOG_LEVEL.REPORT,r,!0)},t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=this.logParamList(l.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=l.ENUM_LOG_LEVEL.DEBUG&&console.debug(i),this.log(l.ENUM_LOG_LEVEL.DEBUG,i)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=this.logParamList(l.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=l.ENUM_LOG_LEVEL.INFO&&console.info(i),this.log(l.ENUM_LOG_LEVEL.INFO,i)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=this.logParamList(l.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=l.ENUM_LOG_LEVEL.WARN&&console.warn(i),this.log(l.ENUM_LOG_LEVEL.WARN,i)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=this.logParamList(l.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=l.ENUM_LOG_LEVEL.ERROR&&(console.error(i),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(l.ENUM_LOG_LEVEL.ERROR,i)},t.prototype.log=function(e,r){this.logRemoteLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,r)},t.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=l.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=l.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=l.ENUM_REMOTE_TYPE.DISABLE,!0}catch(r){return this.error(JSON.stringify(r)),!1}},t.prototype.stopLogServer=function(){this.logType==l.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==l.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=l.ENUM_REMOTE_TYPE.DISABLE},t.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},t.prototype.openHttpsLogServer=function(e){var r=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){r.SendHttpsLog()},this.logUploadInterval)))},t.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},t.prototype.RemoteLog=function(e,r,i){if(i===void 0&&(i=!1),this.url!=""){if(this.logType==l.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,r);else if(this.logType==l.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,r,i);else if(this.logLevel!==l.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(r);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()}},t.prototype.RemoteWebSocketLog=function(e,r){if(typeof r=="string"&&r.length>4e3)console.info("log over maximum, ignore");else if(this.websocket==null||this.websocket.readyState==2||this.websocket.readyState==3){var i=this.url;this.url="",this.setLogServer(i),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(r)}else if(this.websocket.readyState==0)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(r);else if(this.websocket.readyState==1)if(this.logCacheSend.length>0){for(var s="",u=0;u<this.logCacheSend.length;u++){(s+this.logCacheSend[u]).length>4e3&&(this.websocket.send(s),s="");var p=JSON.parse(this.logCacheSend[u]);p=d(d({},p),{userid:p.userid||this.userid,roomid:p.roomid||this.roomid,userName:p.roomid||this.userName}),s=s+JSON.stringify(p)+`
`}r=s+r,this.logCacheSend=[],this.websocket.send(r)}else this.websocket.send(r);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(r)},t.prototype.RemoteHttpsLog=function(e,r,i){this.logCacheSend.push(r),(this.logCacheSend.length>=this.logCacheMax||i===!0)&&this.SendHttpsLog()},t.prototype.logParamList=function(e,r){var i=o.getCurrentTime(),s=[r.substr(0,r.indexOf(" "))||r,r.substr(r.indexOf(" ")+1,4500)||r],u={time:i,level:e,action:s[0],content:s[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(u)},t.prototype.logReportParamList=function(e,r){var i=o.getCurrentTime();return r=d(d({},r),{time:i,level:e,console:this.env%2===l.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+r.event_time+"_"+r.seq}),JSON.stringify(r)},t.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=a.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];console.warn("onclose   websocket error:",r)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];console.warn("open log websocket error:",r)}}},t.prototype.SendHttpsLog=function(){this.logCacheSend.length!=0&&(this.env%2===l.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},t.prototype.SendHttpsLogWeb=function(){var e=this,r=this.logCacheSend.join(`
`),i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==4)if(i.status==200){if(i.responseText.length==0)return;try{var s=JSON.parse(i.responseText).interval;typeof s=="number"&&e.logUploadInterval!==s&&(e.timeInterval=s,e.openHttpsLogServer(e.url))}catch(u){console.log("send result failed "+u)}}else console.log("send failed "+i.status)},i.open("POST",this.url,!0),this.env==0?i.send(r):this.env==2&&(i.setRequestHeader("content-type","application/json"),i.send(JSON.stringify({user_id:this.userid,log:r}))),this.logCacheSend=[]},t.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach(function(s){Array.isArray(s)&&s.forEach(function(u,p){var f=JSON.parse(u);f&&JSON.parse(u).userid==""?(f.userid=e.userid,f.id_name=e.userid,s[p]=JSON.stringify(f)):e.existUserID=!0})});var r=this.logCacheSend.join(`
`),i=this.env==1?r:JSON.stringify({user_id:this.userid,log:r});wx.request({url:this.url,data:i,method:"POST",success:function(s){if(s.data.length!=0){var u=s&&s.data&&s.data.interval;typeof u=="number"&&e.logUploadInterval!==u&&(e.timeInterval=u,e.openHttpsLogServer(e.url))}},fail:function(s){console.log("send failed "+s.statusCode)}}),this.logCacheSend=[]},t}();h.ZegoLogger=n},function(m,h,_){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getCurrentTime=h.getCurrentEnv=h.getBrowser=void 0;var d=_(0);h.getBrowser=function(){var a=window.navigator.userAgent,c=window.ActiveXObject!=null&&a.indexOf("MSIE")!=-1,o=a.indexOf("Firefox")!=-1,n=window.opr!=null,t=a.indexOf("Chrome")&&window.chrome,e=a.indexOf("Safari")!=-1&&a.indexOf("Version")!=-1,r=a.toLowerCase().match(/MicroMessenger/i)&&a.toLowerCase().match(/MicroMessenger/i)[0]==="micromessenger";return c?d.ZEGO_BROWSER_TYPE.IE:o?d.ZEGO_BROWSER_TYPE.FIREFOX:n?d.ZEGO_BROWSER_TYPE.OPERA:t?d.ZEGO_BROWSER_TYPE.CHROME:e?d.ZEGO_BROWSER_TYPE.SAFARI:r?d.ZEGO_BROWSER_TYPE.WEIXIN:d.ZEGO_BROWSER_TYPE.UNKOWN},h.getCurrentEnv=function(){var a=window.navigator.userAgent;return new Promise(function(c){a.indexOf("MicroMessage")==-1?c(d.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv(function(o){o.miniprogram})})};var l=["00","01","02","03","04","05","06","07","08","09"];h.getCurrentTime=function(){var a=new Date;return[a.getFullYear()+"/",(l[a.getMonth()+1]||a.getMonth()+1)+"/",(l[a.getDate()]||a.getDate())+" ",(l[a.getHours()]||a.getHours())+":",(l[a.getMinutes()]||a.getMinutes())+":",l[a.getSeconds()]||a.getSeconds(),"."+a.getTime()%1e3].join("")}}])},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Base64=void 0;var m=function(){function h(){}return h.base64encode=function(_){var d,l,a,c,o,n;for(a=_.length,l=0,d="";l<a;){if(c=255&_.charCodeAt(l++),l==a){d+=h.base64EncodeChars.charAt(c>>2),d+=h.base64EncodeChars.charAt((3&c)<<4),d+="==";break}if(o=_.charCodeAt(l++),l==a){d+=h.base64EncodeChars.charAt(c>>2),d+=h.base64EncodeChars.charAt((3&c)<<4|(240&o)>>4),d+=h.base64EncodeChars.charAt((15&o)<<2),d+="=";break}n=_.charCodeAt(l++),d+=h.base64EncodeChars.charAt(c>>2),d+=h.base64EncodeChars.charAt((3&c)<<4|(240&o)>>4),d+=h.base64EncodeChars.charAt((15&o)<<2|(192&n)>>6),d+=h.base64EncodeChars.charAt(63&n)}return d},h.base64decode=function(_){var d,l,a,c,o,n,t;for(n=_.length,o=0,t="";o<n;){do d=h.base64DecodeChars[255&_.charCodeAt(o++)];while(o<n&&d==-1);if(d==-1)break;do l=h.base64DecodeChars[255&_.charCodeAt(o++)];while(o<n&&l==-1);if(l==-1)break;t+=String.fromCharCode(d<<2|(48&l)>>4);do{if((a=255&_.charCodeAt(o++))==61)return t;a=h.base64DecodeChars[a]}while(o<n&&a==-1);if(a==-1)break;t+=String.fromCharCode((15&l)<<4|(60&a)>>2);do{if((c=255&_.charCodeAt(o++))==61)return t;c=h.base64DecodeChars[c]}while(o<n&&c==-1);if(c==-1)break;t+=String.fromCharCode((3&a)<<6|c)}return t},h.utf16to8=function(_){var d,l,a,c;for(d="",a=_.length,l=0;l<a;l++)(c=_.charCodeAt(l))>=1&&c<=127?d+=_.charAt(l):c>2047?(d+=String.fromCharCode(224|c>>12&15),d+=String.fromCharCode(128|c>>6&63),d+=String.fromCharCode(128|c>>0&63)):(d+=String.fromCharCode(192|c>>6&31),d+=String.fromCharCode(128|c>>0&63));return d},h.utf8to16=function(_){var d,l,a,c,o,n;for(d="",a=_.length,l=0;l<a;)switch((c=_.charCodeAt(l++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=_.charAt(l-1);break;case 12:case 13:o=_.charCodeAt(l++),d+=String.fromCharCode((31&c)<<6|63&o);break;case 14:o=_.charCodeAt(l++),n=_.charCodeAt(l++),d+=String.fromCharCode((15&c)<<12|(63&o)<<6|(63&n)<<0)}return d},h.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],h}();T.Base64=m},function(W,T){},function(W,T,I){var m,h,_;W.exports=(_=I(3),h=(m=_).lib.WordArray,m.enc.Base64={stringify:function(d){var l=d.words,a=d.sigBytes,c=this._map;d.clamp();for(var o=[],n=0;n<a;n+=3)for(var t=(l[n>>>2]>>>24-n%4*8&255)<<16|(l[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|l[n+2>>>2]>>>24-(n+2)%4*8&255,e=0;e<4&&n+.75*e<a;e++)o.push(c.charAt(t>>>6*(3-e)&63));var r=c.charAt(64);if(r)for(;o.length%4;)o.push(r);return o.join("")},parse:function(d){var l=d.length,a=this._map,c=this._reverseMap;if(!c){c=this._reverseMap=[];for(var o=0;o<a.length;o++)c[a.charCodeAt(o)]=o}var n=a.charAt(64);if(n){var t=d.indexOf(n);t!==-1&&(l=t)}return function(e,r,i){for(var s=[],u=0,p=0;p<r;p++)if(p%4){var f=i[e.charCodeAt(p-1)]<<p%4*2,E=i[e.charCodeAt(p)]>>>6-p%4*2,y=f|E;s[u>>>2]|=y<<24-u%4*8,u++}return h.create(s,u)}(d,l,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},_.enc.Base64)},function(W,T,I){var m,h,_,d,l,a,c,o;W.exports=(o=I(3),h=(m=o).lib,_=h.WordArray,d=h.Hasher,l=m.algo,a=[],c=l.SHA1=d.extend({_doReset:function(){this._hash=new _.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(n,t){for(var e=this._hash.words,r=e[0],i=e[1],s=e[2],u=e[3],p=e[4],f=0;f<80;f++){if(f<16)a[f]=0|n[t+f];else{var E=a[f-3]^a[f-8]^a[f-14]^a[f-16];a[f]=E<<1|E>>>31}var y=(r<<5|r>>>27)+p+a[f];y+=f<20?1518500249+(i&s|~i&u):f<40?1859775393+(i^s^u):f<60?(i&s|i&u|s&u)-1894007588:(i^s^u)-899497514,p=u,u=s,s=i<<30|i>>>2,i=r,r=y}e[0]=e[0]+r|0,e[1]=e[1]+i|0,e[2]=e[2]+s|0,e[3]=e[3]+u|0,e[4]=e[4]+p|0},_doFinalize:function(){var n=this._data,t=n.words,e=8*this._nDataBytes,r=8*n.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(e/4294967296),t[15+(r+64>>>9<<4)]=e,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var n=d.clone.call(this);return n._hash=this._hash.clone(),n}}),m.SHA1=d._createHelper(c),m.HmacSHA1=d._createHmacHelper(c),o.SHA1)},function(W,T,I){var m,h,_,d;W.exports=(m=I(3),_=(h=m).lib.Base,d=h.enc.Utf8,void(h.algo.HMAC=_.extend({init:function(l,a){l=this._hasher=new l.init,typeof a=="string"&&(a=d.parse(a));var c=l.blockSize,o=4*c;a.sigBytes>o&&(a=l.finalize(a)),a.clamp();for(var n=this._oKey=a.clone(),t=this._iKey=a.clone(),e=n.words,r=t.words,i=0;i<c;i++)e[i]^=1549556828,r[i]^=909522486;n.sigBytes=t.sigBytes=o,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var a=this._hasher,c=a.finalize(l);return a.reset(),a.finalize(this._oKey.clone().concat(c))}})))},function(W,T,I){var m,h,_,d,l,a,c,o,n,t,e,r,i,s,u,p,f,E,y;W.exports=(m=I(3),I(22),void(m.lib.Cipher||(h=m,_=h.lib,d=_.Base,l=_.WordArray,a=_.BufferedBlockAlgorithm,c=h.enc,c.Utf8,o=c.Base64,n=h.algo.EvpKDF,t=_.Cipher=a.extend({cfg:d.extend(),createEncryptor:function(b,S){return this.create(this._ENC_XFORM_MODE,b,S)},createDecryptor:function(b,S){return this.create(this._DEC_XFORM_MODE,b,S)},init:function(b,S,k){this.cfg=this.cfg.extend(k),this._xformMode=b,this._key=S,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(b){return this._append(b),this._process()},finalize:function(b){return b&&this._append(b),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function b(S){return typeof S=="string"?y:f}return function(S){return{encrypt:function(k,O,g){return b(O).encrypt(S,k,O,g)},decrypt:function(k,O,g){return b(O).decrypt(S,k,O,g)}}}}()}),_.StreamCipher=t.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),e=h.mode={},r=_.BlockCipherMode=d.extend({createEncryptor:function(b,S){return this.Encryptor.create(b,S)},createDecryptor:function(b,S){return this.Decryptor.create(b,S)},init:function(b,S){this._cipher=b,this._iv=S}}),i=e.CBC=function(){var b=r.extend();function S(k,O,g){var v,R=this._iv;R?(v=R,this._iv=void 0):v=this._prevBlock;for(var L=0;L<g;L++)k[O+L]^=v[L]}return b.Encryptor=b.extend({processBlock:function(k,O){var g=this._cipher,v=g.blockSize;S.call(this,k,O,v),g.encryptBlock(k,O),this._prevBlock=k.slice(O,O+v)}}),b.Decryptor=b.extend({processBlock:function(k,O){var g=this._cipher,v=g.blockSize,R=k.slice(O,O+v);g.decryptBlock(k,O),S.call(this,k,O,v),this._prevBlock=R}}),b}(),s=(h.pad={}).Pkcs7={pad:function(b,S){for(var k=4*S,O=k-b.sigBytes%k,g=O<<24|O<<16|O<<8|O,v=[],R=0;R<O;R+=4)v.push(g);var L=l.create(v,O);b.concat(L)},unpad:function(b){var S=255&b.words[b.sigBytes-1>>>2];b.sigBytes-=S}},_.BlockCipher=t.extend({cfg:t.cfg.extend({mode:i,padding:s}),reset:function(){var b;t.reset.call(this);var S=this.cfg,k=S.iv,O=S.mode;this._xformMode==this._ENC_XFORM_MODE?b=O.createEncryptor:(b=O.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==b?this._mode.init(this,k&&k.words):(this._mode=b.call(O,this,k&&k.words),this._mode.__creator=b)},_doProcessBlock:function(b,S){this._mode.processBlock(b,S)},_doFinalize:function(){var b,S=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(S.pad(this._data,this.blockSize),b=this._process(!0)):(b=this._process(!0),S.unpad(b)),b},blockSize:4}),u=_.CipherParams=d.extend({init:function(b){this.mixIn(b)},toString:function(b){return(b||this.formatter).stringify(this)}}),p=(h.format={}).OpenSSL={stringify:function(b){var S=b.ciphertext,k=b.salt;return(k?l.create([1398893684,1701076831]).concat(k).concat(S):S).toString(o)},parse:function(b){var S,k=o.parse(b),O=k.words;return O[0]==1398893684&&O[1]==1701076831&&(S=l.create(O.slice(2,4)),O.splice(0,4),k.sigBytes-=16),u.create({ciphertext:k,salt:S})}},f=_.SerializableCipher=d.extend({cfg:d.extend({format:p}),encrypt:function(b,S,k,O){O=this.cfg.extend(O);var g=b.createEncryptor(k,O),v=g.finalize(S),R=g.cfg;return u.create({ciphertext:v,key:k,iv:R.iv,algorithm:b,mode:R.mode,padding:R.padding,blockSize:b.blockSize,formatter:O.format})},decrypt:function(b,S,k,O){return O=this.cfg.extend(O),S=this._parse(S,O.format),b.createDecryptor(k,O).finalize(S.ciphertext)},_parse:function(b,S){return typeof b=="string"?S.parse(b,this):b}}),E=(h.kdf={}).OpenSSL={execute:function(b,S,k,O){O||(O=l.random(8));var g=n.create({keySize:S+k}).compute(b,O),v=l.create(g.words.slice(S),4*k);return g.sigBytes=4*S,u.create({key:g,iv:v,salt:O})}},y=_.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:E}),encrypt:function(b,S,k,O){var g=(O=this.cfg.extend(O)).kdf.execute(k,b.keySize,b.ivSize);O.iv=g.iv;var v=f.encrypt.call(this,b,S,g.key,O);return v.mixIn(g),v},decrypt:function(b,S,k,O){O=this.cfg.extend(O),S=this._parse(S,O.format);var g=O.kdf.execute(k,b.keySize,b.ivSize,S.salt);return O.iv=g.iv,f.decrypt.call(this,b,S,g.key,O)}}))))},function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(n,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])})(n,t)},function(n,t){function e(){this.constructor=n}m(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(T,"__esModule",{value:!0}),T.RetryRoomHandler=void 0;var _=I(51),d=I(0),l=I(5),a=I(2),c=I(4),o=function(n){function t(e,r,i){var s=n.call(this,e,r)||this;return s.logger=e,s.stateCenter=r,s.room=i,s.loginRoomCallback={},s}return h(t,n),t.prototype.renewLocalToken=function(e,r){this.token=e,this.room.token=this.token;var i=new Date().getTime(),s=void 0;r&&typeof r=="number"?s=1e3*r:["03","04"].includes(e.substring(0,2))&&(s=1e3*c.ClientUtil.decodeTokenExpire(e.substring(2))-i),s&&this.roomHandler.resetTokenTimer(s-this.stateCenter.local_time_deviation),this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,r,i,s,u,p,f){this.roomHandler=e,this.roomID=r,this.renewLocalToken(i),this.user=s,this.server=u,this.serverBak=p||u,this.config=f},t.prototype.active=function(e){var r=this;if(this.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(d.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.isDisConnect())this.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=d.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(this.retryActiveCount==1)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var i=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=i>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:i}this.retryTimer=setTimeout(function(){r.roomHandler.login(r.retryActiveCount%2==1?r.server:r.serverBak,r.roomID,r.token,r.user,r.config,function(s){r.handleLoginFinish(s)},function(s,u){r.handleLoginFinish(!1,s,u)}),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++},e?0:1e3*this.retryActiveInterval)}else this.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.info(l.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,a.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(a.errorCodeList.LOGIN_TIMEOUT),e.roomHandler.disconnectedHandle(a.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail=void 0)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,r){},t.prototype.handleError=function(e,r){if(this.RETRY_MAX_TIME<3)return!1;if(r){var i=void 0,s=void 0,u=void 0;this.stateCenter.useNetAgent?(i=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128"],s=["40001","40100"],u=["201002","30019"]):(i=["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"],s=["1100040001","1100040100"]);var p=e.code+"";return this.stateCenter.useNetAgent&&(e.code>=40001&&e.code<=40100||e.code>=50200&&e.code<=50299||(u==null?void 0:u.includes(p)))?(this.room.resetSessionInfo(),!0):!i.includes(p)&&(!!s.includes(p)||this.room.lastRunState==d.ENUM_RUN_STATE.login&&(this.room.sessionID="0",this.invalid(),!0))}return!0},t.prototype.setLoginRoomCallback=function(e,r){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=r},t.prototype.loginFail=function(e){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,e),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(e),this.roomHandler.disconnectedHandle(e),this.loginRoomCallback.fail=void 0)},t.prototype.handleLoginFinish=function(e,r,i){r?this.handleError(r,i)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,r),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(r),this.roomHandler.disconnectedHandle(r),this.loginRoomCallback.fail=void 0)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.loginRoomCallback.fail=void 0))},t}(_.TryHandler);T.RetryRoomHandler=o},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.TryHandler=void 0;var m=function(){function h(_,d){this.logger=_,this.stateCenter=d,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return h.prototype.init=function(_,d,l,a){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,typeof _=="number"&&_<3600&&(this.RETRY_MAX_TIME=_),typeof d=="number"&&(this.RETRY_START_TIME_INTERVAL=d),typeof l=="number"&&(this.RETRY_CONTINUE_COUNT=l),typeof a=="number"&&(this.RETRY_MAX_TIME_INTERVAL=a)},h.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},h}();T.TryHandler=m},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.checkParams=T.RULE_SUCCESS=T.RULE_PARAM_NAME=void 0;var m,h=I(4);(function(d){d.NOT_EMPTY="NOT_EMPTY",d.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",d.TYPE_STRING="TYPE_STRING",d.TYPE_INTEGER="TYPE_INTEGER",d.TYPE_OBJECT="TYPE_OBJECT",d.MAX_LENGTH_10="MAX_LENGTH_10",d.MAX_LENGTH_64="MAX_LENGTH_64",d.MAX_LENGTH_100="MAX_LENGTH_100",d.MAX_LENGTH_128="MAX_LENGTH_128",d.MAX_LENGTH_256="MAX_LENGTH_256",d.MAX_LENGTH_1024="MAX_LENGTH_1024"})(m=T.RULE_PARAM_NAME||(T.RULE_PARAM_NAME={})),T.RULE_SUCCESS={error:{code:0,msg:"suc"}};var _={NOT_EMPTY:function(d,l,a,c,o){return l===void 0||l===""||l===null?(c.error(a+" "+d+" is empty"),o):T.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(d,l,a,c,o){return h.ClientUtil.checkIllegalCharacters(l)?T.RULE_SUCCESS:(c.error(a+" "+d+" contains illegal characters"),o)},TYPE_STRING:function(d,l,a,c,o){return typeof l!="string"?(c.error(a+" "+d+" must be string"),o):T.RULE_SUCCESS},TYPE_INTEGER:function(d,l,a,c,o){return h.ClientUtil.checkInteger(l,!1)?T.RULE_SUCCESS:(c.error(a+" "+d+"  must be integer number"),o)},TYPE_OBJECT:function(d,l,a,c,o){return l&&typeof l=="object"?T.RULE_SUCCESS:(c.error(a+" "+d+"  must be object"),o)},MAX_LENGTH_10:function(d,l,a,c,o){return l.length>10?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS},MAX_LENGTH_64:function(d,l,a,c,o){return l.length>64?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS},MAX_LENGTH_100:function(d,l,a,c,o){return l.length>100?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS},MAX_LENGTH_128:function(d,l,a,c,o){return l.length>128?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS},MAX_LENGTH_256:function(d,l,a,c,o){return l.length>256?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS},MAX_LENGTH_1024:function(d,l,a,c,o){return l.length>1024?(c.error(a+" "+d+" is too long"),o):T.RULE_SUCCESS}};T.checkParams=function(d,l){var a=[],c={};for(var o in d)c[d[o].order]=d[o],d[o].key=o;for(var n in c)a.push(c[n]);for(var t=0;t<a.length;t++)for(var e=a[t].rules,r=0;r<e.length;r++){var i={key:a[t].key,value:a[t].value,action:l.action,logger:l.logger},s=i.key,u=i.value,p=i.action,f=i.logger,E=e[r].name?""+e[r].name:"";if((u===void 0&&E===m.NOT_EMPTY||u!==void 0)&&_[E]){var y=_[E](s,u,p,f,e[r]);if(y!=T.RULE_SUCCESS)return y}}return T.RULE_SUCCESS}},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StateCenter=void 0;var m=I(0),h=I(5),_=I(10),d=I(17),l=function(){function a(c,o){this.logger=c,this.dataReport=o,this._debug=!1,this.appConfigFetched=!1,this.requestList={},this.mode=d.Mode.MODE_ONLINE,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=m.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}return Object.defineProperty(a.prototype,"debug",{get:function(){return this._debug},set:function(c){this._debug=c,m.LoggerStateCenter.getInstance().debug=c},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(c){this._testEnvironment=c,m.LoggerStateCenter.getInstance().testEnvironment=c},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ENV",{get:function(){return this._env},set:function(c){this._env=c,m.LoggerStateCenter.getInstance().ENV=c},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),a.prototype.getRequestId=function(){return this.idName+"-"+m.getSeq()},a.prototype.actionListener=function(c){for(var o=this,n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];if(this.listenerList[c]){var e=m.getReportSeq();this.dataReport.newReport(e,_.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(e,{listener:c,params:n}),this.dataReport.uploadReport(e)}this.listenerList[c]&&this.listenerList[c].forEach(function(r){try{r.apply(void 0,n)}catch(i){o.logger.error(h.ZEGO_RTM_ACTION.STATE_ACTION+" ",c," ",JSON.stringify(i))}})},a.prototype.onListener=function(c,o){return this.listenerList[c]?typeof o!="function"?(this.logger.error(h.ZEGO_RTM_ACTION.ON_LISTENER+" listener callBack must be funciton"),!1):(this.listenerList[c].indexOf(o)==-1&&this.listenerList[c].push(o),!0):(this.logger.error(h.ZEGO_RTM_ACTION.ON_LISTENER+" event "+c+" no found"),!1)},Object.defineProperty(a.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(c){this._sdkVersion=c},enumerable:!1,configurable:!0}),a}();T.StateCenter=l},function(W,T,I){"use strict";var m=this&&this.__spreadArrays||function(){for(var b=0,S=0,k=arguments.length;S<k;S++)b+=arguments[S].length;var O=Array(b),g=0;for(S=0;S<k;S++)for(var v=arguments[S],R=0,L=v.length;R<L;R++,g++)O[g]=v[R];return O};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoConnectionAgent=void 0;var h=I(0),_=I(1),d=I(55),l=I(71),a=I(74),c=I(75),o=I(76),n=I(77),t=I(6),e=I(79),r=I(28),i=I(80),s=I(9),u=I(4),p=I(16),f=I(81),E=I(30),y=function(){function b(){var S=this;this.linkCheckTimer=null,this.connectServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.onConnectedEvent=function(k){S.getConfig();var O=S.reportSeq++;S.eventManager.emit("dispatchEvent",O,"start"),S.dispatch().then(function(g){var v=g.servers,R=g.domains;S.eventManager.emit("dispatchEvent",O,"end",{domains:R}),v.length>0&&S.zegoLink.createSocket(v)}).catch(function(g){}),S.eventManager.emit("connected"),S.connectedTime=new Date().getTime(),S.connectid=E.uuidNum(16),S.eventManager.emit("connectedEvent",S.connectSeq,"end",{servers:k,count:k.length,connectid:S.connectid})},this.onConnectingEvent=function(){S.logger.info("zn.zca.oce call")},this.onDisConnectedEvent=function(k){S.disConnect(),S.netAgentPCRequestMgr.updateConnectState(_.PcConnectState.BROKEN)},this.onPushEvent=function(k,O,g){switch(O){case _.AccessHubMessageType.MSG_TYPE_REDIRECT:S.redirect(g);break;case _.AccessHubMessageType.MSG_TYPE_CLOSE_CONNECTION:S.connectClosed(g);break;case _.AccessHubMessageType.MSG_TYPE_PC_BROKEN:case _.AccessHubMessageType.MSG_TYPE_PC_ESTABLISHED:case _.AccessHubMessageType.MSG_TYPE_PC_DOWNWARD_MESSAGE:S.streamManager.onPushEvent(k,O,g);break;case _.AccessHubMessageType.MSG_TYPE_PUSH_APPCONFIG:S.businessRequestMgr.decodeConfigMessage(g.data)}}}return b.prototype.init=function(S){this.logger=S,this.protobuf=new d.AccessHubProtoBuf,this.stateCenter=new f.StateCenter,this.checkLinkMsg(),this.inited=!0},b.prototype.unInit=function(S){this.inited=!1},b.prototype.setAppInfo=function(S){this.stateCenter.appInfo=S,this.stateCenter.networkState=navigator?navigator.onLine?_.ENUM_NETWORK_STATE.online:_.ENUM_NETWORK_STATE.offline:_.ENUM_NETWORK_STATE.online,S.env===0?this.bindWindowListener():S.env===1&&this.bindWxListener(),this.zegoLink=new l.ZegoWssLink(S.appID,S.env,this.protobuf,this.logger,this.stateCenter),this.zegoLink.initEvent(this.onConnectedEvent,this.onDisConnectedEvent,this.onConnectingEvent,this.onPushEvent),this.streamManager=new n.StreamManager(this.zegoLink),this.businessRequestMgr=new a.NetAgentBusinessRequestMgr(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.netHeartBeatHandler=new c.NetHeartBeatHandler(this.streamManager,this.logger),this.netAgentPCRequestMgr=new o.NetAgentPCRequestMgr(this.streamManager,this.logger),this.netAgentHttpRequestMgr=new e.NetAgentHttpRequestMgr(this.streamManager,this.logger),this.eventManager=new r.EventManager,this.heartBeatHandler()},b.prototype.setUserInfo=function(S){this.stateCenter.userId=S},b.prototype.setNetAgentDefaultServers=function(S){this.connectServers=m(S)},b.prototype.setDispatchConnectServers=function(S){this.connect(S)},b.prototype.startHttpRequest=function(S,k,O,g){var v=this,R=this.reportSeq++;this.eventManager.emit("requestEvent",R,"start"),this.netAgentHttpRequestMgr.getRequest(S.service).sendRequest(S,function(L){v.eventManager.emit("requestEvent",R,"end",{na_req_location:location,status_code:L.status_code}),k&&k(L)},function(L){v.eventManager.emit("requestEvent",R,"end",{na_req_location:location}),O&&O(L)},g)},b.prototype.getAppConfigByAgent=function(S,k,O){return this.getAppConfig(S,this.stateCenter.userId,k)},b.prototype.getPCRequest=function(S,k,O){var g=this,v=this.netAgentPCRequestMgr.getRequest(S,k,O);return v.on("disconnected",function(R){g.logger.warn("zn.zca.gpr "+S+" disconnect "+R),R===_.DisconnectedType.TEMP&&(g.disConnect(),g.connectStart())}),v},b.prototype.connectUa=function(){this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.connectStart(!1,!0))},b.prototype.isConnect=function(){return this.zegoLink&&this.zegoLink.isConnect()},b.prototype.on=function(S,k){return this.logger.info("zn.zca.o.0 "+S),this.eventManager.addEventHandler(S,k)},b.prototype.off=function(S,k){this.logger.info("zn.zca.o.1 "+S),this.eventManager.removeEventHandler(S,k)},b.prototype.heartBeatHandler=function(){var S=this;this.netHeartBeatHandler.netHbLogout=function(k){S.retryLinkHandler&&([s.errorCodeList.NET_HB_TIMEOUT.code].includes(k.code)?(S.retryLinkHandler.startMaxTime(),S.disConnect(),S.connectStart()):(S.retryLinkHandler.stopMaxTime(),S.retryLinkHandler.invalid(),S.eventManager.emit("disconnected")))}},b.prototype.bindWindowListener=function(){var S=this;window.addEventListener("offline",function(){S.netOffLineHandle()}),window.addEventListener("online",function(){S.netOnLineHandle()})},b.prototype.bindWxListener=function(){var S=this;wx.onNetworkStatusChange(function(k){k.isConnected?S.netOnLineHandle():S.netOffLineHandle()})},b.prototype.netOnLineHandle=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=_.ENUM_NETWORK_STATE.online,this.stateCenter.useNetAgent&&this.netOnLineHandler()},b.prototype.netOffLineHandle=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=_.ENUM_NETWORK_STATE.offline,this.stateCenter.useNetAgent&&this.netOffLineHandler()},b.prototype.checkLinkMsg=function(){var S=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var k=Date.now()-this.zegoLink.updatedMsgTime;if(k>9e4)return this.logger.info("zn.zca.clm interval: "+k),void this.resetNetAgent()}else console.warn("checkLinkMsg");this.linkCheckTimer&&clearTimeout(this.linkCheckTimer),this.linkCheckTimer=setTimeout(function(){S.checkLinkMsg()},5e3)}},b.prototype.connect=function(S){var k=this;S.length>0&&(this.connectServers=m(S)),this.zegoLink.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new i.NetRetryLinkHandler(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(O,g){g===s.errorCodeList.NET_SOCKET_TIMEOUT&&(k.eventManager.emit("disconnected",g),k.netAgentPCRequestMgr.updateConnectState(_.PcConnectState.DISCONNECT,_.DisconnectedType.TIMEOUT,g))},this.connectStart(!1,!0)},b.prototype.resetNetAgent=function(){this.netHeartBeatHandler.reset(),this.zegoLink.destroySocket()},b.prototype.getConfig=function(){var S=this,k=function(O){O.code===0?(S.logger.info("zn.zca.gc suc "+JSON.stringify(O)),S.getConfigSuccess(O)):S.logger.info("zn.zca.gc fail")};this.businessRequestMgr.getConfig(k,k)},b.prototype.getConfigSuccess=function(S){this.netHeartBeatHandler.init(S),this.netAgentPCRequestMgr.setEstablishTimeout(S.data.pc_establish_timeout)},b.prototype.dispatch=function(){var S=this;return new Promise(function(k,O){S.businessRequestMgr.dispatchURL(function(g){var v=g.data.wss_groups;S.logger.info("zn.nab.du wss_groups: "+JSON.stringify(v));var R=S.handleWssGroups(v);k({servers:R,domains:v})},function(g){O(g)})})},b.prototype.handleWssGroups=function(S){var k;if(Array.isArray(S)&&S.length>0){var O=S.map(function(v){return t.NET_ACCESS_CONFIG.scheme+"://"+v.host+"/"+t.NET_ACCESS_CONFIG.location}),g=u.ClientUtil.encryptStores(JSON.stringify(O),p.STORE_SECRET);return localStorage.setItem(t.NET_ACCESS_SERVERS+"_"+this.stateCenter.appInfo.appID+"_"+(((k=this.stateCenter.appInfo)===null||k===void 0?void 0:k.mode)||t.NET_ACCESS_CONFIG.modeNo),g),O}return[]},b.prototype.getAppConfig=function(S,k,O){var g=this;return new Promise(function(v,R){typeof k=="string"&&typeof O=="string"?g.businessRequestMgr.getAppConfig(S,k,O).then(function(L){v(L)}).catch(function(L){if(g.logger.error("zn.zca.gac "+JSON.stringify(L)),_.externalErrorList.indexOf(L.code)>-1)return g.getAppConfigFailCount=0,void R(L);g.getAppConfigFailCount++,L.code===20008&&g.getAppConfigFailCount<3?g.getAppConfig(S,k,O).then(function(N){return v(N)}).catch(function(N){return R(N)}):(g.getAppConfigFailCount=0,R(L))}):g.logger.error("zn.zca.gac userID or token must be string")})},b.prototype.reportDisConnectEvent=function(){var S=new Date().getTime()-this.connectedTime;this.eventManager.emit("disConnectedEvent",{duration:S,server:this.zegoLink.connectServer})},b.prototype.redirect=function(S){this.logger.info("zn.zca.rd "+JSON.stringify(S.wss_groups));var k=this.handleWssGroups(S.wss_groups);k&&Array.isArray(k)&&k.length>0?(this.disConnect(),this.zegoLink.createSocket(k),this.connectStart(!1,!0)):this.logger.warn("zn.zca.rd wss_groups null")},b.prototype.connectClosed=function(S){var k=this;switch(this.logger.info("zn.zca.cc "+S.reason+" "+S.msg+" "+S.action),S.action){case _.ConnectionClosedAction.ACTION_DISPATCH:var O=this.reportSeq++;this.eventManager.emit("dispatchEvent",O,"start"),this.dispatch().then(function(g){var v=g.servers,R=g.domains;k.eventManager.emit("dispatchEvent",O,"end",{domains:R,reason:"ConnectClosed"}),Array.isArray(v)&&v.length>0&&(k.disConnect(),k.zegoLink.createSocket(v),k.connectStart(!1,!0))}).catch(function(g){k.logger.info("zn.zca.cc dispatch fail")});break;case _.ConnectionClosedAction.ACTION_RETRY:this.disConnect(),this.connectStart(!1);break;case _.ConnectionClosedAction.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",_.BrokenType.CLOSE),this.connectStart();break;case _.ConnectionClosedAction.ACTION_ABORT:case _.ConnectionClosedAction.ACTION_RESERVED:}},b.prototype.netOnLineHandler=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.connectStart())},b.prototype.netOffLineHandler=function(){this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(h.ENUM_CONNECT_STATE.disconnect))},b.prototype.connectStart=function(S,k){this.retryLinkHandler.active(S,k)&&this.reportConnectEvent()},b.prototype.reportConnectEvent=function(){var S=this.reportSeq++;this.connectSeq=S,this.eventManager.emit("connectedEvent",S,"start")},b.prototype.disConnect=function(){this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),this.reportDisConnectEvent()},b.prototype.testConnect=function(){this.startHttpRequest({service:_.BusinessService.SERVICE_ClOUD_SETTING,headers:[],body:{appid:3349318446,biztype:0,deviceid:"27a315ae-ff78-4ded-8581-8b7b7afe6f2e",files:["init","room"],id_name:"sample1647345322471",mode:"online",param:{},product:"Web_SDK",timestamp:1647345362932,token:"eyJ2ZXIiOjEsImhhc2giOiIwOGQxMDYzMzQ0M2EzNjk1ZmE4YTg2ZDNmZGRlNGNiNyIsIm5vbmNlIjoiYWEyZDFmMDJmOGRiYjBlM2Q1YjY5NzA3NzMzOGYyODIiLCJleHBpcmVkIjoxNjQ5OTM3MzI2fQ=="},idName:"sample1647345322471",ack:!0,method_no:_.Method.METHOD_POST,location:"/cloud-setting/get"},function(S){console.warn("suc",S)},function(S){console.warn("err",S)},function(S){console.warn("suc",S)})},b}();T.ZegoConnectionAgent=y},function(W,T,I){"use strict";var m=this&&this.__assign||function(){return(m=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++)for(var u in r=arguments[i])Object.prototype.hasOwnProperty.call(r,u)&&(e[u]=r[u]);return e}).apply(this,arguments)},h=this&&this.__createBinding||(Object.create?function(e,r,i,s){s===void 0&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return r[i]}})}:function(e,r,i,s){s===void 0&&(s=i),e[s]=r[i]}),_=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i in e)i!=="default"&&Object.prototype.hasOwnProperty.call(e,i)&&h(r,e,i);return _(r,e),r},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0}),T.AccessHubProtoBuf=void 0;var a=l(I(12)),c=d(I(7)),o=I(1),n=l(I(70));c.util.Long=a.default,c.configure();var t=function(){function e(){var r;this.protoInstance=n.default,this.protoMap=((r={})[o.AccessHubMessageType.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],r[o.AccessHubMessageType.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],r[o.AccessHubMessageType.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],r[o.AccessHubMessageType.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],r[o.AccessHubMessageType.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],r[o.AccessHubMessageType.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],r[o.AccessHubMessageType.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],r[o.AccessHubMessageType.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],r[o.AccessHubMessageType.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HBResponse"],r[o.AccessHubMessageType.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],r[o.AccessHubMessageType.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],r[o.AccessHubMessageType.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],r[o.AccessHubMessageType.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],r[o.AccessHubMessageType.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],r[o.AccessHubMessageType.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],r[o.AccessHubMessageType.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],r[o.AccessHubMessageType.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],r[o.AccessHubMessageType.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],r[o.AccessHubMessageType.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],r[o.AccessHubMessageType.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],r[o.AccessHubMessageType.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],r)}return e.prototype.encodeRequest=function(r,i,s){var u=this.protoMap[r],p=u[0],f=u[1],E=this.encode(this.protoInstance[p][f],i),y=E.length,b=new Uint8Array(13+y);return b[0]=175,b[1]=0,b[2]=r>>8,b[3]=r-(b[2]<<8),b.set(new Uint8Array(Int32Array.from([y]).buffer).reverse(),4),b.set(new Uint8Array(Int32Array.from([s]).buffer).reverse(),8),b[12]=0,b.set(E,13),b},e.prototype.decodeResponse=function(r){var i=(r[2]<<8)+r[3],s=new DataView(r.buffer).getUint32(8),u=r.slice(13);try{var p=this.protoMap[i],f=p[0],E=p[1];return[s,i,this.decode(this.protoInstance[f][E],u)]}catch(y){return[s,i,{code:1}]}},e.prototype.decodeConfigMessage=function(r){return this.decode(this.protoInstance.proto_initconfig.InitConfig,r)},e.prototype.encode=function(r,i){return r.encode(new r(i)).finish()},e.prototype.decode=function(r,i){return m({},r.decode(i))},e}();T.AccessHubProtoBuf=t},function(W,T,I){"use strict";var m=T;function h(){m.util._configure(),m.Writer._configure(m.BufferWriter),m.Reader._configure(m.BufferReader)}m.build="minimal",m.Writer=I(24),m.BufferWriter=I(65),m.Reader=I(25),m.BufferReader=I(66),m.util=I(8),m.rpc=I(67),m.roots=I(69),m.configure=h,h()},function(W,T,I){"use strict";W.exports=function(m,h){for(var _=new Array(arguments.length-1),d=0,l=2,a=!0;l<arguments.length;)_[d++]=arguments[l++];return new Promise(function(c,o){_[d]=function(n){if(a)if(a=!1,n)o(n);else{for(var t=new Array(arguments.length-1),e=0;e<t.length;)t[e++]=arguments[e];c.apply(null,t)}};try{m.apply(h||null,_)}catch(n){a&&(a=!1,o(n))}})}},function(W,T,I){"use strict";var m=T;m.length=function(l){var a=l.length;if(!a)return 0;for(var c=0;--a%4>1&&l.charAt(a)==="=";)++c;return Math.ceil(3*l.length)/4-c};for(var h=new Array(64),_=new Array(123),d=0;d<64;)_[h[d]=d<26?d+65:d<52?d+71:d<62?d-4:d-59|43]=d++;m.encode=function(l,a,c){for(var o,n=null,t=[],e=0,r=0;a<c;){var i=l[a++];switch(r){case 0:t[e++]=h[i>>2],o=(3&i)<<4,r=1;break;case 1:t[e++]=h[o|i>>4],o=(15&i)<<2,r=2;break;case 2:t[e++]=h[o|i>>6],t[e++]=h[63&i],r=0}e>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,t)),e=0)}return r&&(t[e++]=h[o],t[e++]=61,r===1&&(t[e++]=61)),n?(e&&n.push(String.fromCharCode.apply(String,t.slice(0,e))),n.join("")):String.fromCharCode.apply(String,t.slice(0,e))},m.decode=function(l,a,c){for(var o,n=c,t=0,e=0;e<l.length;){var r=l.charCodeAt(e++);if(r===61&&t>1)break;if((r=_[r])===void 0)throw Error("invalid encoding");switch(t){case 0:o=r,t=1;break;case 1:a[c++]=o<<2|(48&r)>>4,o=r,t=2;break;case 2:a[c++]=(15&o)<<4|(60&r)>>2,o=r,t=3;break;case 3:a[c++]=(3&o)<<6|r,t=0}}if(t===1)throw Error("invalid encoding");return c-n},m.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}},function(W,T,I){"use strict";function m(){this._listeners={}}W.exports=m,m.prototype.on=function(h,_,d){return(this._listeners[h]||(this._listeners[h]=[])).push({fn:_,ctx:d||this}),this},m.prototype.off=function(h,_){if(h===void 0)this._listeners={};else if(_===void 0)this._listeners[h]=[];else for(var d=this._listeners[h],l=0;l<d.length;)d[l].fn===_?d.splice(l,1):++l;return this},m.prototype.emit=function(h){var _=this._listeners[h];if(_){for(var d=[],l=1;l<arguments.length;)d.push(arguments[l++]);for(l=0;l<_.length;)_[l].fn.apply(_[l++].ctx,d)}return this}},function(W,T,I){"use strict";function m(a){return typeof Float32Array!="undefined"?function(){var c=new Float32Array([-0]),o=new Uint8Array(c.buffer),n=o[3]===128;function t(s,u,p){c[0]=s,u[p]=o[0],u[p+1]=o[1],u[p+2]=o[2],u[p+3]=o[3]}function e(s,u,p){c[0]=s,u[p]=o[3],u[p+1]=o[2],u[p+2]=o[1],u[p+3]=o[0]}function r(s,u){return o[0]=s[u],o[1]=s[u+1],o[2]=s[u+2],o[3]=s[u+3],c[0]}function i(s,u){return o[3]=s[u],o[2]=s[u+1],o[1]=s[u+2],o[0]=s[u+3],c[0]}a.writeFloatLE=n?t:e,a.writeFloatBE=n?e:t,a.readFloatLE=n?r:i,a.readFloatBE=n?i:r}():function(){function c(n,t,e,r){var i=t<0?1:0;if(i&&(t=-t),t===0)n(1/t>0?0:2147483648,e,r);else if(isNaN(t))n(2143289344,e,r);else if(t>34028234663852886e22)n((i<<31|2139095040)>>>0,e,r);else if(t<11754943508222875e-54)n((i<<31|Math.round(t/1401298464324817e-60))>>>0,e,r);else{var s=Math.floor(Math.log(t)/Math.LN2);n((i<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,e,r)}}function o(n,t,e){var r=n(t,e),i=2*(r>>31)+1,s=r>>>23&255,u=8388607&r;return s===255?u?NaN:i*(1/0):s===0?1401298464324817e-60*i*u:i*Math.pow(2,s-150)*(u+8388608)}a.writeFloatLE=c.bind(null,h),a.writeFloatBE=c.bind(null,_),a.readFloatLE=o.bind(null,d),a.readFloatBE=o.bind(null,l)}(),typeof Float64Array!="undefined"?function(){var c=new Float64Array([-0]),o=new Uint8Array(c.buffer),n=o[7]===128;function t(s,u,p){c[0]=s,u[p]=o[0],u[p+1]=o[1],u[p+2]=o[2],u[p+3]=o[3],u[p+4]=o[4],u[p+5]=o[5],u[p+6]=o[6],u[p+7]=o[7]}function e(s,u,p){c[0]=s,u[p]=o[7],u[p+1]=o[6],u[p+2]=o[5],u[p+3]=o[4],u[p+4]=o[3],u[p+5]=o[2],u[p+6]=o[1],u[p+7]=o[0]}function r(s,u){return o[0]=s[u],o[1]=s[u+1],o[2]=s[u+2],o[3]=s[u+3],o[4]=s[u+4],o[5]=s[u+5],o[6]=s[u+6],o[7]=s[u+7],c[0]}function i(s,u){return o[7]=s[u],o[6]=s[u+1],o[5]=s[u+2],o[4]=s[u+3],o[3]=s[u+4],o[2]=s[u+5],o[1]=s[u+6],o[0]=s[u+7],c[0]}a.writeDoubleLE=n?t:e,a.writeDoubleBE=n?e:t,a.readDoubleLE=n?r:i,a.readDoubleBE=n?i:r}():function(){function c(n,t,e,r,i,s){var u=r<0?1:0;if(u&&(r=-r),r===0)n(0,i,s+t),n(1/r>0?0:2147483648,i,s+e);else if(isNaN(r))n(0,i,s+t),n(2146959360,i,s+e);else if(r>17976931348623157e292)n(0,i,s+t),n((u<<31|2146435072)>>>0,i,s+e);else{var p;if(r<22250738585072014e-324)n((p=r/5e-324)>>>0,i,s+t),n((u<<31|p/4294967296)>>>0,i,s+e);else{var f=Math.floor(Math.log(r)/Math.LN2);f===1024&&(f=1023),n(4503599627370496*(p=r*Math.pow(2,-f))>>>0,i,s+t),n((u<<31|f+1023<<20|1048576*p&1048575)>>>0,i,s+e)}}}function o(n,t,e,r,i){var s=n(r,i+t),u=n(r,i+e),p=2*(u>>31)+1,f=u>>>20&2047,E=4294967296*(1048575&u)+s;return f===2047?E?NaN:p*(1/0):f===0?5e-324*p*E:p*Math.pow(2,f-1075)*(E+4503599627370496)}a.writeDoubleLE=c.bind(null,h,0,4),a.writeDoubleBE=c.bind(null,_,4,0),a.readDoubleLE=o.bind(null,d,0,4),a.readDoubleBE=o.bind(null,l,4,0)}(),a}function h(a,c,o){c[o]=255&a,c[o+1]=a>>>8&255,c[o+2]=a>>>16&255,c[o+3]=a>>>24}function _(a,c,o){c[o]=a>>>24,c[o+1]=a>>>16&255,c[o+2]=a>>>8&255,c[o+3]=255&a}function d(a,c){return(a[c]|a[c+1]<<8|a[c+2]<<16|a[c+3]<<24)>>>0}function l(a,c){return(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])>>>0}W.exports=m(m)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(W){}return null}module.exports=inquire},function(W,T,I){"use strict";var m=T;m.length=function(h){for(var _=0,d=0,l=0;l<h.length;++l)(d=h.charCodeAt(l))<128?_+=1:d<2048?_+=2:(64512&d)==55296&&(64512&h.charCodeAt(l+1))==56320?(++l,_+=4):_+=3;return _},m.read=function(h,_,d){if(d-_<1)return"";for(var l,a=null,c=[],o=0;_<d;)(l=h[_++])<128?c[o++]=l:l>191&&l<224?c[o++]=(31&l)<<6|63&h[_++]:l>239&&l<365?(l=((7&l)<<18|(63&h[_++])<<12|(63&h[_++])<<6|63&h[_++])-65536,c[o++]=55296+(l>>10),c[o++]=56320+(1023&l)):c[o++]=(15&l)<<12|(63&h[_++])<<6|63&h[_++],o>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,c)),o=0);return a?(o&&a.push(String.fromCharCode.apply(String,c.slice(0,o))),a.join("")):String.fromCharCode.apply(String,c.slice(0,o))},m.write=function(h,_,d){for(var l,a,c=d,o=0;o<h.length;++o)(l=h.charCodeAt(o))<128?_[d++]=l:l<2048?(_[d++]=l>>6|192,_[d++]=63&l|128):(64512&l)==55296&&(64512&(a=h.charCodeAt(o+1)))==56320?(l=65536+((1023&l)<<10)+(1023&a),++o,_[d++]=l>>18|240,_[d++]=l>>12&63|128,_[d++]=l>>6&63|128,_[d++]=63&l|128):(_[d++]=l>>12|224,_[d++]=l>>6&63|128,_[d++]=63&l|128);return d-c}},function(W,T,I){"use strict";W.exports=function(m,h,_){var d=_||8192,l=d>>>1,a=null,c=d;return function(o){if(o<1||o>l)return m(o);c+o>d&&(a=m(d),c=0);var n=h.call(a,c,c+=o);return 7&c&&(c=1+(7|c)),n}}},function(W,T,I){"use strict";W.exports=h;var m=I(8);function h(a,c){this.lo=a>>>0,this.hi=c>>>0}var _=h.zero=new h(0,0);_.toNumber=function(){return 0},_.zzEncode=_.zzDecode=function(){return this},_.length=function(){return 1};var d=h.zeroHash="\0\0\0\0\0\0\0\0";h.fromNumber=function(a){if(a===0)return _;var c=a<0;c&&(a=-a);var o=a>>>0,n=(a-o)/4294967296>>>0;return c&&(n=~n>>>0,o=~o>>>0,++o>4294967295&&(o=0,++n>4294967295&&(n=0))),new h(o,n)},h.from=function(a){if(typeof a=="number")return h.fromNumber(a);if(m.isString(a)){if(!m.Long)return h.fromNumber(parseInt(a,10));a=m.Long.fromString(a)}return a.low||a.high?new h(a.low>>>0,a.high>>>0):_},h.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var c=1+~this.lo>>>0,o=~this.hi>>>0;return c||(o=o+1>>>0),-(c+4294967296*o)}return this.lo+4294967296*this.hi},h.prototype.toLong=function(a){return m.Long?new m.Long(0|this.lo,0|this.hi,Boolean(a)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(a)}};var l=String.prototype.charCodeAt;h.fromHash=function(a){return a===d?_:new h((l.call(a,0)|l.call(a,1)<<8|l.call(a,2)<<16|l.call(a,3)<<24)>>>0,(l.call(a,4)|l.call(a,5)<<8|l.call(a,6)<<16|l.call(a,7)<<24)>>>0)},h.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},h.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},h.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},h.prototype.length=function(){var a=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,o=this.hi>>>24;return o===0?c===0?a<16384?a<128?1:2:a<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:o<128?9:10}},function(W,T,I){"use strict";W.exports=_;var m=I(24);(_.prototype=Object.create(m.prototype)).constructor=_;var h=I(8);function _(){m.call(this)}function d(l,a,c){l.length<40?h.utf8.write(l,a,c):a.utf8Write?a.utf8Write(l,c):a.write(l,c)}_._configure=function(){_.alloc=h._Buffer_allocUnsafe,_.writeBytesBuffer=h.Buffer&&h.Buffer.prototype instanceof Uint8Array&&h.Buffer.prototype.set.name==="set"?function(l,a,c){a.set(l,c)}:function(l,a,c){if(l.copy)l.copy(a,c,0,l.length);else for(var o=0;o<l.length;)a[c++]=l[o++]}},_.prototype.bytes=function(l){h.isString(l)&&(l=h._Buffer_from(l,"base64"));var a=l.length>>>0;return this.uint32(a),a&&this._push(_.writeBytesBuffer,a,l),this},_.prototype.string=function(l){var a=h.Buffer.byteLength(l);return this.uint32(a),a&&this._push(d,a,l),this},_._configure()},function(W,T,I){"use strict";W.exports=_;var m=I(25);(_.prototype=Object.create(m.prototype)).constructor=_;var h=I(8);function _(d){m.call(this,d)}_._configure=function(){h.Buffer&&(_.prototype._slice=h.Buffer.prototype.slice)},_.prototype.string=function(){var d=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+d,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+d,this.len))},_._configure()},function(W,T,I){"use strict";T.Service=I(68)},function(W,T,I){"use strict";W.exports=h;var m=I(8);function h(_,d,l){if(typeof _!="function")throw TypeError("rpcImpl must be a function");m.EventEmitter.call(this),this.rpcImpl=_,this.requestDelimited=Boolean(d),this.responseDelimited=Boolean(l)}(h.prototype=Object.create(m.EventEmitter.prototype)).constructor=h,h.prototype.rpcCall=function _(d,l,a,c,o){if(!c)throw TypeError("request must be specified");var n=this;if(!o)return m.asPromise(_,n,d,l,a,c);if(n.rpcImpl)try{return n.rpcImpl(d,l[n.requestDelimited?"encodeDelimited":"encode"](c).finish(),function(t,e){if(t)return n.emit("error",t,d),o(t);if(e!==null){if(!(e instanceof a))try{e=a[n.responseDelimited?"decodeDelimited":"decode"](e)}catch(r){return n.emit("error",r,d),o(r)}return n.emit("data",e,d),o(null,e)}n.end(!0)})}catch(t){return n.emit("error",t,d),void setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},h.prototype.end=function(_){return this.rpcImpl&&(_||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(W,T,I){"use strict";W.exports={}},function(W,T,I){"use strict";I.r(T),I.d(T,"proto_accesshub",function(){return a}),I.d(T,"proto_initconfig",function(){return c}),I.d(T,"default",function(){return l});var m=I(7);const h=m.Reader,_=m.Writer,d=m.util,l=m.roots.default||(m.roots.default={}),a=l.proto_accesshub=(()=>{const o={};return o.MessageType=function(){const n={},t=Object.create(n);return t[n[0]="MSG_TYPE_EMPTY"]=0,t[n[1]="MSG_TYPE_CONNECTION_CLOSED"]=1,t[n[2]="MSG_TYPE_STREAM_CLOSED"]=2,t[n[3]="MSG_TYPE_CLOSE_CONNECTION"]=3,t[n[4]="MSG_TYPE_HTTP_REQUEST"]=4,t[n[5]="MSG_TYPE_HTTP_RESPONSE"]=5,t[n[6]="MSG_TYPE_HTTP_REQUEST_DROPED"]=6,t[n[7]="MSG_TYPE_PROXY_CONNECT"]=7,t[n[8]="MSG_TYPE_PROXY_CONNECTED"]=8,t[n[9]="MSG_TYPE_PROXY_CONNECTION_CLOSED"]=9,t[n[10]="MSG_TYPE_PROXY_SEND_DATA"]=10,t[n[11]="MSG_TYPE_PROXY_RECV_DATA"]=11,t[n[12]="MSG_TYPE_HB_REQUEST"]=12,t[n[13]="MSG_TYPE_HB_RESPONSE"]=13,t[n[14]="MSG_TYPE_GET_CONFIG_REQUEST"]=14,t[n[15]="MSG_TYPE_GET_CONFIG_RESPONSE"]=15,t[n[16]="MSG_TYPE_HTTP_REQUEST_ACK"]=16,t[n[17]="MSG_TYPE_PC_UPWARD_MESSAGE"]=17,t[n[18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK"]=18,t[n[19]="MSG_TYPE_PC_ESTABLISHED"]=19,t[n[20]="MSG_TYPE_PC_BROKEN"]=20,t[n[21]="MSG_TYPE_PC_DOWNWARD_MESSAGE"]=21,t[n[22]="MSG_TYPE_REDIRECT"]=22,t[n[23]="MSG_TYPE_GET_APPCONFIG_REQUEST"]=23,t[n[24]="MSG_TYPE_GET_APPCONFIG_RESPONSE"]=24,t[n[25]="MSG_TYPE_PUSH_APPCONFIG"]=25,t[n[26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST"]=26,t[n[27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE"]=27,t[n[28]="MSG_TYPE_GET_IM_CONFIG_REQUEST"]=28,t[n[29]="MSG_TYPE_GET_IM_CONFIG_RESPONSE"]=29,t[n[30]="MSG_TYPE_PUSH_EXCEPTION"]=30,t[n[50]="MSG_TYPE_UA_DISPATCH_REQUEST"]=50,t[n[51]="MSG_TYPE_UA_DISPATCH_RESPONSE"]=51,t[n[52]="MSG_TYPE_UA_ECHO_REQUEST"]=52,t[n[53]="MSG_TYPE_UA_ECHO_RESPONSE"]=53,t[n[100]="MSG_TYPE_NODE_REGISTER_REQUEST"]=100,t[n[101]="MSG_TYPE_NODE_REGISTER_RESPONSE"]=101,t[n[102]="MSG_TYPE_NODE_HB_REQUEST"]=102,t[n[103]="MSG_TYPE_NODE_HB_RESPONSE"]=103,t}(),o.ErrorCode=function(){const n={},t=Object.create(n);return t[n[0]="OK"]=0,t[n[1e4]="DISPATCH_NO_AVAILABLE_NODE"]=1e4,t[n[10001]="DISPATCH_INTERNAL_ERROR"]=10001,t[n[10002]="DISPATCH_INVALID_FRAME"]=10002,t[n[10003]="DISPATCH_UNMARSHAL"]=10003,t[n[10004]="DISPATCH_MSGTYPE"]=10004,t[n[10005]="DISPATCH_MARSHAL"]=10005,t[n[10006]="DISPATCH_TOO_FREQUENTLY"]=10006,t[n[2e4]="ACCESSHUB_INVALID_FRAME"]=2e4,t[n[20001]="ACCESSHUB_NEED_ENCRYPT"]=20001,t[n[20002]="ACCESSHUB_DECRYPT"]=20002,t[n[20003]="ACCESSHUB_MSGTYPE"]=20003,t[n[20004]="ACCESSHUB_UNMARSHAL"]=20004,t[n[20005]="ACCESSHUB_TIMEOUT"]=20005,t[n[20006]="ACCESSHUB_CONNECT"]=20006,t[n[20007]="ACCESSHUB_BROKEN"]=20007,t[n[20008]="ACCESSHUB_INTERNAL_ERROR"]=20008,t[n[20009]="ACCESSHUB_MARSHAL"]=20009,t[n[20010]="ACCESSHUB_UNSUPPORTED_SERVICE"]=20010,t[n[20011]="ACCESSHUB_TOO_FREQUENTLY"]=20011,t[n[20012]="ACCESSHUB_INVALID_APPID"]=20012,t[n[20013]="ACCESSHUB_HB_TIMEOUT"]=20013,t[n[20014]="ACCESSHUB_INVALID_SIGNATURE"]=20014,t[n[20015]="ACCESSHUB_AUTH_FAILED"]=20015,t[n[3e4]="ACCESSHUB_GET_STREAM_FAILED"]=3e4,t[n[30001]="ACCESSHUB_GET_CONN_FAILED"]=30001,t[n[30002]="ACCESSHUB_DO_HTTP_REQUEST_FAILED"]=30002,t[n[30003]="ACCESSHUB_UNMARSHAL_HB_FAILED"]=30003,t[n[30004]="ACCESSHUB_DO_BACKEND_DISPATCH_FAILED"]=30004,t}(),o.Mode=function(){const n={},t=Object.create(n);return t[n[0]="Mode_UNSET"]=0,t[n[1]="MODE_ONLINE"]=1,t[n[2]="MODE_TEST"]=2,t[n[3]="MODE_ALPHA"]=3,t}(),o.Service=function(){const n={},t=Object.create(n);return t[n[0]="SERVICE_UNSET"]=0,t[n[1]="SERVICE_MEDIAGW"]=1,t[n[2]="SERVICE_LIVEROOM"]=2,t[n[3]="SERVICE_MIX"]=3,t[n[4]="SERVICE_ZEUS"]=4,t[n[5]="SERVICE_ZPUSH"]=5,t[n[6]="SERVICE_L3"]=6,t[n[7]="SERVICE_TALKLINE"]=7,t[n[8]="SERVICE_EDUSUITE"]=8,t[n[9]="SERVICE_ZIM"]=9,t[n[10]="SERVICE_ClOUD_SETTING"]=10,t[n[11]="SERVICE_ZEUSHB"]=11,t[n[12]="SERVICE_USER_LOGIC"]=12,t[n[13]="SERVICE_UNIFYDISPATCH"]=13,t[n[14]="SERVICE_QUALITY"]=14,t[n[15]="SERVICE_SECURITY"]=15,t[n[16]="SERVICE_KTVCPR"]=16,t[n[17]="SERVICE_SWITCH4LIVEROOM"]=17,t[n[18]="SERVICE_WEBRTC_SIGNAL"]=18,t[n[19]="SERVICE_L3_WEBRTC_SIGNAL"]=19,t[n[20]="SERVICE_VIDEOCPR"]=20,t[n[21]="SERVICE_CDN"]=21,t[n[22]="SERVICE_CLOUDRECORD"]=22,t[n[23]="SERVICE_INNER_ECHO"]=23,t[n[24]="SERVICE_OUTER_ECHO"]=24,t[n[25]="SERVICE_LOCALHOST_ECHO"]=25,t[n[26]="SERVICE_ECHO"]=26,t[n[27]="SERVICE_DOCSERVICE"]=27,t[n[28]="SERVICE_AUTHSVR"]=28,t}(),o.Method=function(){const n={},t=Object.create(n);return t[n[0]="METHOD_UNSET"]=0,t[n[1]="METHOD_GET"]=1,t[n[2]="METHOD_POST"]=2,t}(),o.SdkType=function(){const n={},t=Object.create(n);return t[n[0]="SDK_TYPE_UNSET"]=0,t[n[1]="SDK_TYPE_QUIC_MTCP_NATIVE"]=1,t[n[2]="SDK_TYPE_WSS_NATIVE"]=2,t[n[3]="SDK_TYPE_WSS_WEB"]=3,t}(),o.ZegoconnRunEnv=function(){const n={},t=Object.create(n);return t[n[0]="ZEGOCONN_RUN_ENV_UNSET"]=0,t[n[1]="ZEGOCONN_RUN_ENV_BROWSER"]=1,t[n[2]="ZEGOCONN_RUN_ENV_APPLET"]=2,t}(),o.ConnectionClosed=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.code=0,n.prototype.msg="",n.encode=function(t,e){return e||(e=_.create()),t.code!=null&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).int32(t.code),t.msg!=null&&Object.hasOwnProperty.call(t,"msg")&&e.uint32(18).string(t.msg),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.ConnectionClosed;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.code=t.int32();break;case 2:i.msg=t.string();break;default:t.skipType(7&s)}}return i},n}(),o.StreamClosed=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.code=0,n.prototype.msg="",n.encode=function(t,e){return e||(e=_.create()),t.code!=null&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).int32(t.code),t.msg!=null&&Object.hasOwnProperty.call(t,"msg")&&e.uint32(18).string(t.msg),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.StreamClosed;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.code=t.int32();break;case 2:i.msg=t.string();break;default:t.skipType(7&s)}}return i},n}(),o.CloseConnection=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.reason=0,n.prototype.msg="",n.prototype.action=0,n.encode=function(t,e){return e||(e=_.create()),t.reason!=null&&Object.hasOwnProperty.call(t,"reason")&&e.uint32(8).int32(t.reason),t.msg!=null&&Object.hasOwnProperty.call(t,"msg")&&e.uint32(18).string(t.msg),t.action!=null&&Object.hasOwnProperty.call(t,"action")&&e.uint32(24).int32(t.action),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.CloseConnection;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.reason=t.int32();break;case 2:i.msg=t.string();break;case 3:i.action=t.int32();break;default:t.skipType(7&s)}}return i},n.Action=function(){const t={},e=Object.create(t);return e[t[0]="ACTION_RESERVED"]=0,e[t[1]="ACTION_DISPATCH"]=1,e[t[2]="ACTION_RETRY"]=2,e[t[3]="ACTION_NEXT_NODE"]=3,e[t[4]="ACTION_ABORT"]=4,e[t[5]="ACTION_NEXT_GROUP"]=5,e}(),n}(),o.HTTPRequest=function(){function n(t){if(this.headers=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.appid=0,n.prototype.biz_type=0,n.prototype.mode="",n.prototype.id_name="",n.prototype.reqid="",n.prototype.stick="",n.prototype.service="",n.prototype.location="",n.prototype.method="",n.prototype.headers=d.emptyArray,n.prototype.body=d.newBuffer([]),n.prototype.ack=!1,n.prototype.mode_no=0,n.prototype.service_no=0,n.prototype.method_no=0,n.prototype.sdk_type=0,n.prototype.zegoconn_run_env=0,n.prototype.zegoconn_version=0,n.encode=function(t,e){if(e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.appid!=null&&Object.hasOwnProperty.call(t,"appid")&&e.uint32(16).uint32(t.appid),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(24).uint32(t.biz_type),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&e.uint32(34).string(t.mode),t.id_name!=null&&Object.hasOwnProperty.call(t,"id_name")&&e.uint32(42).string(t.id_name),t.reqid!=null&&Object.hasOwnProperty.call(t,"reqid")&&e.uint32(50).string(t.reqid),t.stick!=null&&Object.hasOwnProperty.call(t,"stick")&&e.uint32(58).string(t.stick),t.service!=null&&Object.hasOwnProperty.call(t,"service")&&e.uint32(66).string(t.service),t.location!=null&&Object.hasOwnProperty.call(t,"location")&&e.uint32(74).string(t.location),t.method!=null&&Object.hasOwnProperty.call(t,"method")&&e.uint32(82).string(t.method),t.headers!=null&&t.headers.length)for(let r=0;r<t.headers.length;++r)l.proto_accesshub.HTTPRequest.HTTPHeader.encode(t.headers[r],e.uint32(90).fork()).ldelim();return t.body!=null&&Object.hasOwnProperty.call(t,"body")&&e.uint32(98).bytes(t.body),t.ack!=null&&Object.hasOwnProperty.call(t,"ack")&&e.uint32(104).bool(t.ack),t.mode_no!=null&&Object.hasOwnProperty.call(t,"mode_no")&&e.uint32(112).int32(t.mode_no),t.service_no!=null&&Object.hasOwnProperty.call(t,"service_no")&&e.uint32(120).int32(t.service_no),t.method_no!=null&&Object.hasOwnProperty.call(t,"method_no")&&e.uint32(128).int32(t.method_no),t.sdk_type!=null&&Object.hasOwnProperty.call(t,"sdk_type")&&e.uint32(136).int32(t.sdk_type),t.zegoconn_run_env!=null&&Object.hasOwnProperty.call(t,"zegoconn_run_env")&&e.uint32(144).int32(t.zegoconn_run_env),t.zegoconn_version!=null&&Object.hasOwnProperty.call(t,"zegoconn_version")&&e.uint32(152).uint32(t.zegoconn_version),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HTTPRequest;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.appid=t.uint32();break;case 3:i.biz_type=t.uint32();break;case 4:i.mode=t.string();break;case 5:i.id_name=t.string();break;case 6:i.reqid=t.string();break;case 7:i.stick=t.string();break;case 8:i.service=t.string();break;case 9:i.location=t.string();break;case 10:i.method=t.string();break;case 11:i.headers&&i.headers.length||(i.headers=[]),i.headers.push(l.proto_accesshub.HTTPRequest.HTTPHeader.decode(t,t.uint32()));break;case 12:i.body=t.bytes();break;case 13:i.ack=t.bool();break;case 14:i.mode_no=t.int32();break;case 15:i.service_no=t.int32();break;case 16:i.method_no=t.int32();break;case 17:i.sdk_type=t.int32();break;case 18:i.zegoconn_run_env=t.int32();break;case 19:i.zegoconn_version=t.uint32();break;default:t.skipType(7&s)}}return i},n.HTTPHeader=function(){function t(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}return t.prototype.name="",t.prototype.val="",t.encode=function(e,r){return r||(r=_.create()),e.name!=null&&Object.hasOwnProperty.call(e,"name")&&r.uint32(10).string(e.name),e.val!=null&&Object.hasOwnProperty.call(e,"val")&&r.uint32(18).string(e.val),r},t.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_accesshub.HTTPRequest.HTTPHeader;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.name=e.string();break;case 2:s.val=e.string();break;default:e.skipType(7&u)}}return s},t}(),n}(),o.HTTPResponse=function(){function n(t){if(this.headers=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.headers=d.emptyArray,n.prototype.status_code=0,n.prototype.body=d.newBuffer([]),n.encode=function(t,e){if(e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.headers!=null&&t.headers.length)for(let r=0;r<t.headers.length;++r)l.proto_accesshub.HTTPRequest.HTTPHeader.encode(t.headers[r],e.uint32(18).fork()).ldelim();return t.status_code!=null&&Object.hasOwnProperty.call(t,"status_code")&&e.uint32(24).int32(t.status_code),t.body!=null&&Object.hasOwnProperty.call(t,"body")&&e.uint32(34).bytes(t.body),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HTTPResponse;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.headers&&i.headers.length||(i.headers=[]),i.headers.push(l.proto_accesshub.HTTPRequest.HTTPHeader.decode(t,t.uint32()));break;case 3:i.status_code=t.int32();break;case 4:i.body=t.bytes();break;default:t.skipType(7&s)}}return i},n}(),o.HTTPRequestAck=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HTTPRequestAck;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;default:t.skipType(7&s)}}return i},n}(),o.HTTPRequestDroped=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.reason=0,n.prototype.msg="",n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.reason!=null&&Object.hasOwnProperty.call(t,"reason")&&e.uint32(16).int32(t.reason),t.msg!=null&&Object.hasOwnProperty.call(t,"msg")&&e.uint32(26).string(t.msg),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HTTPRequestDroped;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.reason=t.int32();break;case 3:i.msg=t.string();break;default:t.skipType(7&s)}}return i},n}(),o.HBRequest=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.ts=d.Long?d.Long.fromBits(0,0,!1):0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.ts!=null&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).int64(t.ts),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HBRequest;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.ts=t.int64();break;default:t.skipType(7&s)}}return i},n}(),o.HBResponse=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.ts=d.Long?d.Long.fromBits(0,0,!1):0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.ts!=null&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).int64(t.ts),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.HBResponse;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.ts=t.int64();break;default:t.skipType(7&s)}}return i},n}(),o.GetConfigRequest=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.appid=0,n.prototype.biz_type=0,n.prototype.mode="",n.prototype.id_name="",n.prototype.reqid="",n.prototype.zegoconn_version=0,n.prototype.sdk_type=0,n.prototype.zegoconn_run_env=0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.appid!=null&&Object.hasOwnProperty.call(t,"appid")&&e.uint32(16).uint32(t.appid),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(24).uint32(t.biz_type),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&e.uint32(34).string(t.mode),t.id_name!=null&&Object.hasOwnProperty.call(t,"id_name")&&e.uint32(42).string(t.id_name),t.reqid!=null&&Object.hasOwnProperty.call(t,"reqid")&&e.uint32(50).string(t.reqid),t.zegoconn_version!=null&&Object.hasOwnProperty.call(t,"zegoconn_version")&&e.uint32(56).uint32(t.zegoconn_version),t.sdk_type!=null&&Object.hasOwnProperty.call(t,"sdk_type")&&e.uint32(64).int32(t.sdk_type),t.zegoconn_run_env!=null&&Object.hasOwnProperty.call(t,"zegoconn_run_env")&&e.uint32(72).int32(t.zegoconn_run_env),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetConfigRequest;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.appid=t.uint32();break;case 3:i.biz_type=t.uint32();break;case 4:i.mode=t.string();break;case 5:i.id_name=t.string();break;case 6:i.reqid=t.string();break;case 7:i.zegoconn_version=t.uint32();break;case 8:i.sdk_type=t.int32();break;case 9:i.zegoconn_run_env=t.int32();break;default:t.skipType(7&s)}}return i},n}(),o.GetConfigResponseData=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.quic_hb_interval=0,n.prototype.quic_hb_timeout=0,n.prototype.logic_hb_interval=0,n.prototype.logic_hb_timeout=0,n.prototype.pc_establish_timeout=0,n.prototype.sdk_link_detect_interval=0,n.prototype.sdk_link_detect_duration=0,n.prototype.client_outer_ip="",n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.quic_hb_interval!=null&&Object.hasOwnProperty.call(t,"quic_hb_interval")&&e.uint32(16).uint32(t.quic_hb_interval),t.quic_hb_timeout!=null&&Object.hasOwnProperty.call(t,"quic_hb_timeout")&&e.uint32(24).uint32(t.quic_hb_timeout),t.logic_hb_interval!=null&&Object.hasOwnProperty.call(t,"logic_hb_interval")&&e.uint32(32).uint32(t.logic_hb_interval),t.logic_hb_timeout!=null&&Object.hasOwnProperty.call(t,"logic_hb_timeout")&&e.uint32(40).uint32(t.logic_hb_timeout),t.pc_establish_timeout!=null&&Object.hasOwnProperty.call(t,"pc_establish_timeout")&&e.uint32(48).uint32(t.pc_establish_timeout),t.sdk_link_detect_interval!=null&&Object.hasOwnProperty.call(t,"sdk_link_detect_interval")&&e.uint32(56).uint32(t.sdk_link_detect_interval),t.sdk_link_detect_duration!=null&&Object.hasOwnProperty.call(t,"sdk_link_detect_duration")&&e.uint32(64).uint32(t.sdk_link_detect_duration),t.client_outer_ip!=null&&Object.hasOwnProperty.call(t,"client_outer_ip")&&e.uint32(74).string(t.client_outer_ip),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetConfigResponseData;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.quic_hb_interval=t.uint32();break;case 3:i.quic_hb_timeout=t.uint32();break;case 4:i.logic_hb_interval=t.uint32();break;case 5:i.logic_hb_timeout=t.uint32();break;case 6:i.pc_establish_timeout=t.uint32();break;case 7:i.sdk_link_detect_interval=t.uint32();break;case 8:i.sdk_link_detect_duration=t.uint32();break;case 9:i.client_outer_ip=t.string();break;default:t.skipType(7&s)}}return i},n}(),o.GetConfigResponse=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.code=0,n.prototype.message="",n.prototype.data=null,n.encode=function(t,e){return e||(e=_.create()),t.code!=null&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).int32(t.code),t.message!=null&&Object.hasOwnProperty.call(t,"message")&&e.uint32(18).string(t.message),t.data!=null&&Object.hasOwnProperty.call(t,"data")&&l.proto_accesshub.GetConfigResponseData.encode(t.data,e.uint32(26).fork()).ldelim(),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetConfigResponse;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.code=t.int32();break;case 2:i.message=t.string();break;case 3:i.data=l.proto_accesshub.GetConfigResponseData.decode(t,t.uint32());break;default:t.skipType(7&s)}}return i},n}(),o.PCUpwardMessage=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.appid=0,n.prototype.biz_type=0,n.prototype.mode_no=0,n.prototype.id_name="",n.prototype.service_no=0,n.prototype.ack=!1,n.prototype.payload=d.newBuffer([]),n.prototype.sdk_type=0,n.prototype.wss_message_type=0,n.prototype.wss_path="",n.prototype.wss_raw_query="",n.prototype.zegoconn_version=0,n.prototype.zegoconn_run_env=0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.appid!=null&&Object.hasOwnProperty.call(t,"appid")&&e.uint32(16).uint32(t.appid),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(24).uint32(t.biz_type),t.mode_no!=null&&Object.hasOwnProperty.call(t,"mode_no")&&e.uint32(32).int32(t.mode_no),t.id_name!=null&&Object.hasOwnProperty.call(t,"id_name")&&e.uint32(42).string(t.id_name),t.service_no!=null&&Object.hasOwnProperty.call(t,"service_no")&&e.uint32(48).int32(t.service_no),t.ack!=null&&Object.hasOwnProperty.call(t,"ack")&&e.uint32(56).bool(t.ack),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(66).bytes(t.payload),t.sdk_type!=null&&Object.hasOwnProperty.call(t,"sdk_type")&&e.uint32(72).int32(t.sdk_type),t.wss_message_type!=null&&Object.hasOwnProperty.call(t,"wss_message_type")&&e.uint32(80).uint32(t.wss_message_type),t.wss_path!=null&&Object.hasOwnProperty.call(t,"wss_path")&&e.uint32(90).string(t.wss_path),t.wss_raw_query!=null&&Object.hasOwnProperty.call(t,"wss_raw_query")&&e.uint32(98).string(t.wss_raw_query),t.zegoconn_version!=null&&Object.hasOwnProperty.call(t,"zegoconn_version")&&e.uint32(104).uint32(t.zegoconn_version),t.zegoconn_run_env!=null&&Object.hasOwnProperty.call(t,"zegoconn_run_env")&&e.uint32(112).int32(t.zegoconn_run_env),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PCUpwardMessage;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.appid=t.uint32();break;case 3:i.biz_type=t.uint32();break;case 4:i.mode_no=t.int32();break;case 5:i.id_name=t.string();break;case 6:i.service_no=t.int32();break;case 7:i.ack=t.bool();break;case 8:i.payload=t.bytes();break;case 9:i.sdk_type=t.int32();break;case 10:i.wss_message_type=t.uint32();break;case 11:i.wss_path=t.string();break;case 12:i.wss_raw_query=t.string();break;case 13:i.zegoconn_version=t.uint32();break;case 14:i.zegoconn_run_env=t.int32();break;default:t.skipType(7&s)}}return i},n}(),o.PCUpwardMessageAck=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PCUpwardMessageAck;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;default:t.skipType(7&s)}}return i},n}(),o.PCEstablished=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.elapse=0,n.prototype.from=0,n.encode=function(t,e){return e||(e=_.create()),t.elapse!=null&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(8).uint32(t.elapse),t.from!=null&&Object.hasOwnProperty.call(t,"from")&&e.uint32(16).uint32(t.from),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PCEstablished;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.elapse=t.uint32();break;case 2:i.from=t.uint32();break;default:t.skipType(7&s)}}return i},n}(),o.PCBroken=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.encode=function(t,e){return e||(e=_.create()),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PCBroken;for(;t.pos<r;){let s=t.uint32();t.skipType(7&s)}return i},n}(),o.PCDownwardMessage=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.payload=d.newBuffer([]),n.prototype.wss_message_type=0,n.encode=function(t,e){return e||(e=_.create()),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(10).bytes(t.payload),t.wss_message_type!=null&&Object.hasOwnProperty.call(t,"wss_message_type")&&e.uint32(16).uint32(t.wss_message_type),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PCDownwardMessage;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.payload=t.bytes();break;case 2:i.wss_message_type=t.uint32();break;default:t.skipType(7&s)}}return i},n}(),o.Redirect=function(){function n(t){if(this.groups=[],this.opt_ports=[],this.wss_groups=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.rand="",n.prototype.secret="",n.prototype.groups=d.emptyArray,n.prototype.opt_ports=d.emptyArray,n.prototype.wss_groups=d.emptyArray,n.encode=function(t,e){if(e||(e=_.create()),t.rand!=null&&Object.hasOwnProperty.call(t,"rand")&&e.uint32(10).string(t.rand),t.secret!=null&&Object.hasOwnProperty.call(t,"secret")&&e.uint32(18).string(t.secret),t.groups!=null&&t.groups.length)for(let r=0;r<t.groups.length;++r)l.proto_accesshub.AccesshubDispatchGroup.encode(t.groups[r],e.uint32(26).fork()).ldelim();if(t.opt_ports!=null&&t.opt_ports.length)for(let r=0;r<t.opt_ports.length;++r)e.uint32(32).uint32(t.opt_ports[r]);if(t.wss_groups!=null&&t.wss_groups.length)for(let r=0;r<t.wss_groups.length;++r)l.proto_accesshub.WssAccesshubDispatchGroup.encode(t.wss_groups[r],e.uint32(42).fork()).ldelim();return e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.Redirect;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.rand=t.string();break;case 2:i.secret=t.string();break;case 3:i.groups&&i.groups.length||(i.groups=[]),i.groups.push(l.proto_accesshub.AccesshubDispatchGroup.decode(t,t.uint32()));break;case 4:if(i.opt_ports&&i.opt_ports.length||(i.opt_ports=[]),(7&s)==2){let u=t.uint32()+t.pos;for(;t.pos<u;)i.opt_ports.push(t.uint32())}else i.opt_ports.push(t.uint32());break;case 5:i.wss_groups&&i.wss_groups.length||(i.wss_groups=[]),i.wss_groups.push(l.proto_accesshub.WssAccesshubDispatchGroup.decode(t,t.uint32()));break;default:t.skipType(7&s)}}return i},n}(),o.GetAppConfigRequest=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.appid=0,n.prototype.biz_type=0,n.prototype.mode_no=0,n.prototype.id_name="",n.prototype.config_key="",n.prototype.ts=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.signature=d.newBuffer([]),n.prototype.lite_sign="",n.prototype.token="",n.prototype.sdk_type=0,n.prototype.zegoconn_version=0,n.prototype.zegoconn_run_env=0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.appid!=null&&Object.hasOwnProperty.call(t,"appid")&&e.uint32(16).uint32(t.appid),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(24).uint32(t.biz_type),t.mode_no!=null&&Object.hasOwnProperty.call(t,"mode_no")&&e.uint32(32).int32(t.mode_no),t.id_name!=null&&Object.hasOwnProperty.call(t,"id_name")&&e.uint32(42).string(t.id_name),t.config_key!=null&&Object.hasOwnProperty.call(t,"config_key")&&e.uint32(50).string(t.config_key),t.ts!=null&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(56).uint64(t.ts),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&e.uint32(66).bytes(t.signature),t.lite_sign!=null&&Object.hasOwnProperty.call(t,"lite_sign")&&e.uint32(74).string(t.lite_sign),t.token!=null&&Object.hasOwnProperty.call(t,"token")&&e.uint32(82).string(t.token),t.sdk_type!=null&&Object.hasOwnProperty.call(t,"sdk_type")&&e.uint32(88).int32(t.sdk_type),t.zegoconn_version!=null&&Object.hasOwnProperty.call(t,"zegoconn_version")&&e.uint32(96).uint32(t.zegoconn_version),t.zegoconn_run_env!=null&&Object.hasOwnProperty.call(t,"zegoconn_run_env")&&e.uint32(104).int32(t.zegoconn_run_env),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetAppConfigRequest;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.appid=t.uint32();break;case 3:i.biz_type=t.uint32();break;case 4:i.mode_no=t.int32();break;case 5:i.id_name=t.string();break;case 6:i.config_key=t.string();break;case 7:i.ts=t.uint64();break;case 8:i.signature=t.bytes();break;case 9:i.lite_sign=t.string();break;case 10:i.token=t.string();break;case 11:i.sdk_type=t.int32();break;case 12:i.zegoconn_version=t.uint32();break;case 13:i.zegoconn_run_env=t.int32();break;default:t.skipType(7&s)}}return i},n}(),o.GetAppConfigResponseData=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.data=d.newBuffer([]),n.prototype.ts=d.Long?d.Long.fromBits(0,0,!0):0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.data!=null&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),t.ts!=null&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(24).uint64(t.ts),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetAppConfigResponseData;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.data=t.bytes();break;case 3:i.ts=t.uint64();break;default:t.skipType(7&s)}}return i},n}(),o.GetAppConfigResponse=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.code=0,n.prototype.message="",n.prototype.data=null,n.encode=function(t,e){return e||(e=_.create()),t.code!=null&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).int32(t.code),t.message!=null&&Object.hasOwnProperty.call(t,"message")&&e.uint32(18).string(t.message),t.data!=null&&Object.hasOwnProperty.call(t,"data")&&l.proto_accesshub.GetAppConfigResponseData.encode(t.data,e.uint32(26).fork()).ldelim(),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.GetAppConfigResponse;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.code=t.int32();break;case 2:i.message=t.string();break;case 3:i.data=l.proto_accesshub.GetAppConfigResponseData.decode(t,t.uint32());break;default:t.skipType(7&s)}}return i},n}(),o.PushAppConfig=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.config_key="",n.prototype.data=d.newBuffer([]),n.encode=function(t,e){return e||(e=_.create()),t.config_key!=null&&Object.hasOwnProperty.call(t,"config_key")&&e.uint32(10).string(t.config_key),t.data!=null&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PushAppConfig;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.config_key=t.string();break;case 2:i.data=t.bytes();break;default:t.skipType(7&s)}}return i},n}(),o.AccesshubDispatchRequest=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.appid=0,n.prototype.biz_type=0,n.prototype.mode_no=0,n.prototype.id_name="",n.prototype.sdk_type=0,n.prototype.zegoconn_version=0,n.prototype.zegoconn_run_env=0,n.encode=function(t,e){return e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.appid!=null&&Object.hasOwnProperty.call(t,"appid")&&e.uint32(16).uint32(t.appid),t.biz_type!=null&&Object.hasOwnProperty.call(t,"biz_type")&&e.uint32(24).uint32(t.biz_type),t.mode_no!=null&&Object.hasOwnProperty.call(t,"mode_no")&&e.uint32(32).int32(t.mode_no),t.id_name!=null&&Object.hasOwnProperty.call(t,"id_name")&&e.uint32(42).string(t.id_name),t.sdk_type!=null&&Object.hasOwnProperty.call(t,"sdk_type")&&e.uint32(48).int32(t.sdk_type),t.zegoconn_version!=null&&Object.hasOwnProperty.call(t,"zegoconn_version")&&e.uint32(56).uint32(t.zegoconn_version),t.zegoconn_run_env!=null&&Object.hasOwnProperty.call(t,"zegoconn_run_env")&&e.uint32(64).int32(t.zegoconn_run_env),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.AccesshubDispatchRequest;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.appid=t.uint32();break;case 3:i.biz_type=t.uint32();break;case 4:i.mode_no=t.int32();break;case 5:i.id_name=t.string();break;case 6:i.sdk_type=t.int32();break;case 7:i.zegoconn_version=t.uint32();break;case 8:i.zegoconn_run_env=t.int32();break;default:t.skipType(7&s)}}return i},n}(),o.AccesshubDispatchGroup=function(){function n(t){if(this.quic_nodes=[],this.mtcp_nodes=[],this.wss_nodes=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.group="",n.prototype.quic_nodes=d.emptyArray,n.prototype.mtcp_nodes=d.emptyArray,n.prototype.wss_nodes=d.emptyArray,n.encode=function(t,e){if(e||(e=_.create()),t.group!=null&&Object.hasOwnProperty.call(t,"group")&&e.uint32(10).string(t.group),t.quic_nodes!=null&&t.quic_nodes.length)for(let r=0;r<t.quic_nodes.length;++r)e.uint32(18).string(t.quic_nodes[r]);if(t.mtcp_nodes!=null&&t.mtcp_nodes.length)for(let r=0;r<t.mtcp_nodes.length;++r)e.uint32(26).string(t.mtcp_nodes[r]);if(t.wss_nodes!=null&&t.wss_nodes.length)for(let r=0;r<t.wss_nodes.length;++r)e.uint32(34).string(t.wss_nodes[r]);return e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.AccesshubDispatchGroup;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.group=t.string();break;case 2:i.quic_nodes&&i.quic_nodes.length||(i.quic_nodes=[]),i.quic_nodes.push(t.string());break;case 3:i.mtcp_nodes&&i.mtcp_nodes.length||(i.mtcp_nodes=[]),i.mtcp_nodes.push(t.string());break;case 4:i.wss_nodes&&i.wss_nodes.length||(i.wss_nodes=[]),i.wss_nodes.push(t.string());break;default:t.skipType(7&s)}}return i},n}(),o.WssAccesshubDispatchGroup=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.group="",n.prototype.host="",n.encode=function(t,e){return e||(e=_.create()),t.group!=null&&Object.hasOwnProperty.call(t,"group")&&e.uint32(10).string(t.group),t.host!=null&&Object.hasOwnProperty.call(t,"host")&&e.uint32(18).string(t.host),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.WssAccesshubDispatchGroup;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.group=t.string();break;case 2:i.host=t.string();break;default:t.skipType(7&s)}}return i},n}(),o.AccesshubDispatchResponseData=function(){function n(t){if(this.groups=[],this.opt_ports=[],this.wss_groups=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.prototype.rand="",n.prototype.secret="",n.prototype.groups=d.emptyArray,n.prototype.opt_ports=d.emptyArray,n.prototype.wss_groups=d.emptyArray,n.encode=function(t,e){if(e||(e=_.create()),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(8).uint64(t.txid),t.rand!=null&&Object.hasOwnProperty.call(t,"rand")&&e.uint32(18).string(t.rand),t.secret!=null&&Object.hasOwnProperty.call(t,"secret")&&e.uint32(26).string(t.secret),t.groups!=null&&t.groups.length)for(let r=0;r<t.groups.length;++r)l.proto_accesshub.AccesshubDispatchGroup.encode(t.groups[r],e.uint32(34).fork()).ldelim();if(t.opt_ports!=null&&t.opt_ports.length)for(let r=0;r<t.opt_ports.length;++r)e.uint32(40).uint32(t.opt_ports[r]);if(t.wss_groups!=null&&t.wss_groups.length)for(let r=0;r<t.wss_groups.length;++r)l.proto_accesshub.WssAccesshubDispatchGroup.encode(t.wss_groups[r],e.uint32(50).fork()).ldelim();return e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.AccesshubDispatchResponseData;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.txid=t.uint64();break;case 2:i.rand=t.string();break;case 3:i.secret=t.string();break;case 4:i.groups&&i.groups.length||(i.groups=[]),i.groups.push(l.proto_accesshub.AccesshubDispatchGroup.decode(t,t.uint32()));break;case 5:if(i.opt_ports&&i.opt_ports.length||(i.opt_ports=[]),(7&s)==2){let u=t.uint32()+t.pos;for(;t.pos<u;)i.opt_ports.push(t.uint32())}else i.opt_ports.push(t.uint32());break;case 6:i.wss_groups&&i.wss_groups.length||(i.wss_groups=[]),i.wss_groups.push(l.proto_accesshub.WssAccesshubDispatchGroup.decode(t,t.uint32()));break;default:t.skipType(7&s)}}return i},n}(),o.AccesshubDispatchResponse=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.code=0,n.prototype.message="",n.prototype.data=null,n.encode=function(t,e){return e||(e=_.create()),t.code!=null&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).int32(t.code),t.message!=null&&Object.hasOwnProperty.call(t,"message")&&e.uint32(18).string(t.message),t.data!=null&&Object.hasOwnProperty.call(t,"data")&&l.proto_accesshub.AccesshubDispatchResponseData.encode(t.data,e.uint32(26).fork()).ldelim(),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.AccesshubDispatchResponse;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.code=t.int32();break;case 2:i.message=t.string();break;case 3:i.data=l.proto_accesshub.AccesshubDispatchResponseData.decode(t,t.uint32());break;default:t.skipType(7&s)}}return i},n}(),o.PushException=function(){function n(t){if(t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.reason=0,n.prototype.msg="",n.prototype.txid=d.Long?d.Long.fromBits(0,0,!0):0,n.encode=function(t,e){return e||(e=_.create()),t.reason!=null&&Object.hasOwnProperty.call(t,"reason")&&e.uint32(8).int32(t.reason),t.msg!=null&&Object.hasOwnProperty.call(t,"msg")&&e.uint32(18).string(t.msg),t.txid!=null&&Object.hasOwnProperty.call(t,"txid")&&e.uint32(24).uint64(t.txid),e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_accesshub.PushException;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.reason=t.int32();break;case 2:i.msg=t.string();break;case 3:i.txid=t.uint64();break;default:t.skipType(7&s)}}return i},n}(),o})(),c=l.proto_initconfig=(()=>{const o={};return o.ProtoVersion=function(){const n={},t=Object.create(n);return t[n[0]="RPOTO_V000000"]=0,t[n[65536]="RPOTO_V010000"]=65536,t}(),o.ResourceType=function(){const n={},t=Object.create(n);return t[n[0]="CDN"]=0,t[n[1]="RTC"]=1,t[n[2]="L3"]=2,t}(),o.ProtocolType=function(){const n={},t=Object.create(n);return t[n[0]="UDP"]=0,t[n[1]="RTMP"]=1,t[n[2]="FLV"]=2,t[n[3]="HLS"]=3,t[n[4]="WEBRTC"]=4,t}(),o.ResolveType=function(){const n={},t=Object.create(n);return t[n[0]="LOCAL_DNS"]=0,t[n[1]="DISPATCH"]=1,t}(),o.AppConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.test_id=null,n.prototype.domain=null,n.prototype.flexible_domain=null,n.prototype.replace_flexible_domain=null,Object.defineProperty(n.prototype,"_test_id",{get:d.oneOfGetter(t=["test_id"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_domain",{get:d.oneOfGetter(t=["domain"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_flexible_domain",{get:d.oneOfGetter(t=["flexible_domain"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_replace_flexible_domain",{get:d.oneOfGetter(t=["replace_flexible_domain"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.test_id!=null&&Object.hasOwnProperty.call(e,"test_id")&&r.uint32(8).int32(e.test_id),e.domain!=null&&Object.hasOwnProperty.call(e,"domain")&&r.uint32(18).string(e.domain),e.flexible_domain!=null&&Object.hasOwnProperty.call(e,"flexible_domain")&&r.uint32(26).string(e.flexible_domain),e.replace_flexible_domain!=null&&Object.hasOwnProperty.call(e,"replace_flexible_domain")&&r.uint32(34).string(e.replace_flexible_domain),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.AppConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.test_id=e.int32();break;case 2:s.domain=e.string();break;case 3:s.flexible_domain=e.string();break;case 4:s.replace_flexible_domain=e.string();break;default:e.skipType(7&u)}}return s},n}(),o.RoomConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.license_url=null,Object.defineProperty(n.prototype,"_license_url",{get:d.oneOfGetter(t=["license_url"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.license_url!=null&&Object.hasOwnProperty.call(e,"license_url")&&r.uint32(10).string(e.license_url),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.RoomConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.license_url=e.string();break;default:e.skipType(7&u)}}return s},n}(),o.VEConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.audio_session_protect=null,Object.defineProperty(n.prototype,"_audio_session_protect",{get:d.oneOfGetter(t=["audio_session_protect"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.audio_session_protect!=null&&Object.hasOwnProperty.call(e,"audio_session_protect")&&r.uint32(8).int32(e.audio_session_protect),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.VEConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.audio_session_protect=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.SpeedlogConfig=function(){function n(e){if(this.disable_report_pull=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.report_count=null,n.prototype.report_retry_interval=null,n.prototype.push_quality_sample_count=null,n.prototype.pull_quality_sample_count=null,n.prototype.hardware_report_cycle=null,n.prototype.room_user_max_count=null,n.prototype.room_stream_max_count=null,n.prototype.charge_info_report_cycle=null,n.prototype.charge_info_report_mode=null,n.prototype.disable_report_pull=d.emptyArray,n.prototype.report_max_bytes=null,Object.defineProperty(n.prototype,"_report_count",{get:d.oneOfGetter(t=["report_count"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_report_retry_interval",{get:d.oneOfGetter(t=["report_retry_interval"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_push_quality_sample_count",{get:d.oneOfGetter(t=["push_quality_sample_count"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_pull_quality_sample_count",{get:d.oneOfGetter(t=["pull_quality_sample_count"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_hardware_report_cycle",{get:d.oneOfGetter(t=["hardware_report_cycle"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_room_user_max_count",{get:d.oneOfGetter(t=["room_user_max_count"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_room_stream_max_count",{get:d.oneOfGetter(t=["room_stream_max_count"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_charge_info_report_cycle",{get:d.oneOfGetter(t=["charge_info_report_cycle"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_charge_info_report_mode",{get:d.oneOfGetter(t=["charge_info_report_mode"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_report_max_bytes",{get:d.oneOfGetter(t=["report_max_bytes"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.report_count!=null&&Object.hasOwnProperty.call(e,"report_count")&&r.uint32(8).int32(e.report_count),e.report_retry_interval!=null&&Object.hasOwnProperty.call(e,"report_retry_interval")&&r.uint32(16).int32(e.report_retry_interval),e.push_quality_sample_count!=null&&Object.hasOwnProperty.call(e,"push_quality_sample_count")&&r.uint32(24).int32(e.push_quality_sample_count),e.pull_quality_sample_count!=null&&Object.hasOwnProperty.call(e,"pull_quality_sample_count")&&r.uint32(32).int32(e.pull_quality_sample_count),e.hardware_report_cycle!=null&&Object.hasOwnProperty.call(e,"hardware_report_cycle")&&r.uint32(40).int32(e.hardware_report_cycle),e.room_user_max_count!=null&&Object.hasOwnProperty.call(e,"room_user_max_count")&&r.uint32(48).int32(e.room_user_max_count),e.room_stream_max_count!=null&&Object.hasOwnProperty.call(e,"room_stream_max_count")&&r.uint32(56).int32(e.room_stream_max_count),e.charge_info_report_cycle!=null&&Object.hasOwnProperty.call(e,"charge_info_report_cycle")&&r.uint32(64).int32(e.charge_info_report_cycle),e.charge_info_report_mode!=null&&Object.hasOwnProperty.call(e,"charge_info_report_mode")&&r.uint32(72).int32(e.charge_info_report_mode),e.disable_report_pull!=null&&e.disable_report_pull.length){r.uint32(82).fork();for(let i=0;i<e.disable_report_pull.length;++i)r.int32(e.disable_report_pull[i]);r.ldelim()}return e.report_max_bytes!=null&&Object.hasOwnProperty.call(e,"report_max_bytes")&&r.uint32(88).int32(e.report_max_bytes),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.SpeedlogConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.report_count=e.int32();break;case 2:s.report_retry_interval=e.int32();break;case 3:s.push_quality_sample_count=e.int32();break;case 4:s.pull_quality_sample_count=e.int32();break;case 5:s.hardware_report_cycle=e.int32();break;case 6:s.room_user_max_count=e.int32();break;case 7:s.room_stream_max_count=e.int32();break;case 8:s.charge_info_report_cycle=e.int32();break;case 9:s.charge_info_report_mode=e.int32();break;case 10:if(s.disable_report_pull&&s.disable_report_pull.length||(s.disable_report_pull=[]),(7&u)==2){let p=e.uint32()+e.pos;for(;e.pos<p;)s.disable_report_pull.push(e.int32())}else s.disable_report_pull.push(e.int32());break;case 11:s.report_max_bytes=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.MediaServiceProtocolInfo=function(){function n(e){if(this.cdn_quic_version=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.config_id=null,n.prototype.protocol=null,n.prototype.url_template=null,n.prototype.resolve_type=null,n.prototype.push_cdn_authentication=null,n.prototype.cdn_quic_version=d.emptyArray,Object.defineProperty(n.prototype,"_config_id",{get:d.oneOfGetter(t=["config_id"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_protocol",{get:d.oneOfGetter(t=["protocol"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_url_template",{get:d.oneOfGetter(t=["url_template"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_resolve_type",{get:d.oneOfGetter(t=["resolve_type"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_push_cdn_authentication",{get:d.oneOfGetter(t=["push_cdn_authentication"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.config_id!=null&&Object.hasOwnProperty.call(e,"config_id")&&r.uint32(10).string(e.config_id),e.protocol!=null&&Object.hasOwnProperty.call(e,"protocol")&&r.uint32(16).int32(e.protocol),e.url_template!=null&&Object.hasOwnProperty.call(e,"url_template")&&r.uint32(26).string(e.url_template),e.resolve_type!=null&&Object.hasOwnProperty.call(e,"resolve_type")&&r.uint32(32).int32(e.resolve_type),e.push_cdn_authentication!=null&&Object.hasOwnProperty.call(e,"push_cdn_authentication")&&r.uint32(40).int32(e.push_cdn_authentication),e.cdn_quic_version!=null&&e.cdn_quic_version.length){r.uint32(50).fork();for(let i=0;i<e.cdn_quic_version.length;++i)r.int32(e.cdn_quic_version[i]);r.ldelim()}return r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaServiceProtocolInfo;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.config_id=e.string();break;case 2:s.protocol=e.int32();break;case 3:s.url_template=e.string();break;case 4:s.resolve_type=e.int32();break;case 5:s.push_cdn_authentication=e.int32();break;case 6:if(s.cdn_quic_version&&s.cdn_quic_version.length||(s.cdn_quic_version=[]),(7&u)==2){let p=e.uint32()+e.pos;for(;e.pos<p;)s.cdn_quic_version.push(e.int32())}else s.cdn_quic_version.push(e.int32());break;default:e.skipType(7&u)}}return s},n}(),o.MediaResourceInfo=function(){function n(e){if(this.service_info=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.resource_type=null,n.prototype.service_info=d.emptyArray,Object.defineProperty(n.prototype,"_resource_type",{get:d.oneOfGetter(t=["resource_type"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.resource_type!=null&&Object.hasOwnProperty.call(e,"resource_type")&&r.uint32(8).int32(e.resource_type),e.service_info!=null&&e.service_info.length)for(let i=0;i<e.service_info.length;++i)l.proto_initconfig.MediaServiceProtocolInfo.encode(e.service_info[i],r.uint32(18).fork()).ldelim();return r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaResourceInfo;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.resource_type=e.int32();break;case 2:s.service_info&&s.service_info.length||(s.service_info=[]),s.service_info.push(l.proto_initconfig.MediaServiceProtocolInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},n}(),o.TrafficControl=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.enable_traffic_control=null,n.prototype.traffic_properties=null,Object.defineProperty(n.prototype,"_enable_traffic_control",{get:d.oneOfGetter(t=["enable_traffic_control"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_traffic_properties",{get:d.oneOfGetter(t=["traffic_properties"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.enable_traffic_control!=null&&Object.hasOwnProperty.call(e,"enable_traffic_control")&&r.uint32(8).int32(e.enable_traffic_control),e.traffic_properties!=null&&Object.hasOwnProperty.call(e,"traffic_properties")&&r.uint32(16).int32(e.traffic_properties),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.TrafficControl;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.enable_traffic_control=e.int32();break;case 2:s.traffic_properties=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.SupplementFrameControl=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.enable=null,n.prototype.threshold=null,n.prototype.probability=null,Object.defineProperty(n.prototype,"_enable",{get:d.oneOfGetter(t=["enable"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_threshold",{get:d.oneOfGetter(t=["threshold"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_probability",{get:d.oneOfGetter(t=["probability"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.enable!=null&&Object.hasOwnProperty.call(e,"enable")&&r.uint32(8).int32(e.enable),e.threshold!=null&&Object.hasOwnProperty.call(e,"threshold")&&r.uint32(16).int32(e.threshold),e.probability!=null&&Object.hasOwnProperty.call(e,"probability")&&r.uint32(24).int32(e.probability),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.SupplementFrameControl;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.enable=e.int32();break;case 2:s.threshold=e.int32();break;case 3:s.probability=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.VideoParam=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.video_width=null,n.prototype.video_height=null,n.prototype.video_codec_id=null,n.prototype.video_bitrate=null,Object.defineProperty(n.prototype,"_video_width",{get:d.oneOfGetter(t=["video_width"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_video_height",{get:d.oneOfGetter(t=["video_height"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_video_codec_id",{get:d.oneOfGetter(t=["video_codec_id"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_video_bitrate",{get:d.oneOfGetter(t=["video_bitrate"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.video_width!=null&&Object.hasOwnProperty.call(e,"video_width")&&r.uint32(8).int32(e.video_width),e.video_height!=null&&Object.hasOwnProperty.call(e,"video_height")&&r.uint32(16).int32(e.video_height),e.video_codec_id!=null&&Object.hasOwnProperty.call(e,"video_codec_id")&&r.uint32(24).int32(e.video_codec_id),e.video_bitrate!=null&&Object.hasOwnProperty.call(e,"video_bitrate")&&r.uint32(32).int32(e.video_bitrate),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.VideoParam;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.video_width=e.int32();break;case 2:s.video_height=e.int32();break;case 3:s.video_codec_id=e.int32();break;case 4:s.video_bitrate=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.PushConfig=function(){function n(e){if(this.video_param=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.channel_idx=null,n.prototype.mode=null,n.prototype.traffic_control=null,n.prototype.resolution_rate=null,n.prototype.video_param=d.emptyArray,Object.defineProperty(n.prototype,"_channel_idx",{get:d.oneOfGetter(t=["channel_idx"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_mode",{get:d.oneOfGetter(t=["mode"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_traffic_control",{get:d.oneOfGetter(t=["traffic_control"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_resolution_rate",{get:d.oneOfGetter(t=["resolution_rate"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.channel_idx!=null&&Object.hasOwnProperty.call(e,"channel_idx")&&r.uint32(8).int32(e.channel_idx),e.mode!=null&&Object.hasOwnProperty.call(e,"mode")&&r.uint32(16).int32(e.mode),e.traffic_control!=null&&Object.hasOwnProperty.call(e,"traffic_control")&&l.proto_initconfig.TrafficControl.encode(e.traffic_control,r.uint32(42).fork()).ldelim(),e.resolution_rate!=null&&Object.hasOwnProperty.call(e,"resolution_rate")&&r.uint32(48).int32(e.resolution_rate),e.video_param!=null&&e.video_param.length)for(let i=0;i<e.video_param.length;++i)l.proto_initconfig.VideoParam.encode(e.video_param[i],r.uint32(58).fork()).ldelim();return r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.PushConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.channel_idx=e.int32();break;case 2:s.mode=e.int32();break;case 5:s.traffic_control=l.proto_initconfig.TrafficControl.decode(e,e.uint32());break;case 6:s.resolution_rate=e.int32();break;case 7:s.video_param&&s.video_param.length||(s.video_param=[]),s.video_param.push(l.proto_initconfig.VideoParam.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},n}(),o.MediaPublishConfig=function(){function n(e){if(this.resource_info=[],this.push_config=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.push_type=null,n.prototype.resource_info=d.emptyArray,n.prototype.push_config=d.emptyArray,Object.defineProperty(n.prototype,"_push_type",{get:d.oneOfGetter(t=["push_type"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.push_type!=null&&Object.hasOwnProperty.call(e,"push_type")&&r.uint32(8).int32(e.push_type),e.resource_info!=null&&e.resource_info.length)for(let i=0;i<e.resource_info.length;++i)l.proto_initconfig.MediaResourceInfo.encode(e.resource_info[i],r.uint32(18).fork()).ldelim();if(e.push_config!=null&&e.push_config.length)for(let i=0;i<e.push_config.length;++i)l.proto_initconfig.PushConfig.encode(e.push_config[i],r.uint32(26).fork()).ldelim();return r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaPublishConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.push_type=e.int32();break;case 2:s.resource_info&&s.resource_info.length||(s.resource_info=[]),s.resource_info.push(l.proto_initconfig.MediaResourceInfo.decode(e,e.uint32()));break;case 3:s.push_config&&s.push_config.length||(s.push_config=[]),s.push_config.push(l.proto_initconfig.PushConfig.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},n}(),o.TranscodingConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.video_codec_h264=null,Object.defineProperty(n.prototype,"_video_codec_h264",{get:d.oneOfGetter(t=["video_codec_h264"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.video_codec_h264!=null&&Object.hasOwnProperty.call(e,"video_codec_h264")&&r.uint32(10).string(e.video_codec_h264),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.TranscodingConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.video_codec_h264=e.string();break;default:e.skipType(7&u)}}return s},n}(),o.MediaPlayConfig=function(){function n(e){if(this.resource_order=[],this.resource_info=[],this.play_order_protocol_type=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.pull_type=null,n.prototype.l3_play_buffer_ms=null,n.prototype.allow_playing_specific_url=null,n.prototype.resource_order=d.emptyArray,n.prototype.resource_info=d.emptyArray,n.prototype.play_order_protocol_type=d.emptyArray,n.prototype.jitter_buffer_flag=null,n.prototype.min_jitter_buffer=null,n.prototype.max_jitter_buffer=null,n.prototype.supplement_frame_control=null,n.prototype.open_l3_play_resource_prefer=null,n.prototype.switch_to_l3_after_online=null,n.prototype.transcoding=null,Object.defineProperty(n.prototype,"_pull_type",{get:d.oneOfGetter(t=["pull_type"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_l3_play_buffer_ms",{get:d.oneOfGetter(t=["l3_play_buffer_ms"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_allow_playing_specific_url",{get:d.oneOfGetter(t=["allow_playing_specific_url"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_jitter_buffer_flag",{get:d.oneOfGetter(t=["jitter_buffer_flag"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_min_jitter_buffer",{get:d.oneOfGetter(t=["min_jitter_buffer"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_max_jitter_buffer",{get:d.oneOfGetter(t=["max_jitter_buffer"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_supplement_frame_control",{get:d.oneOfGetter(t=["supplement_frame_control"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_open_l3_play_resource_prefer",{get:d.oneOfGetter(t=["open_l3_play_resource_prefer"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_switch_to_l3_after_online",{get:d.oneOfGetter(t=["switch_to_l3_after_online"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_transcoding",{get:d.oneOfGetter(t=["transcoding"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.pull_type!=null&&Object.hasOwnProperty.call(e,"pull_type")&&r.uint32(8).int32(e.pull_type),e.l3_play_buffer_ms!=null&&Object.hasOwnProperty.call(e,"l3_play_buffer_ms")&&r.uint32(16).int32(e.l3_play_buffer_ms),e.allow_playing_specific_url!=null&&Object.hasOwnProperty.call(e,"allow_playing_specific_url")&&r.uint32(24).int32(e.allow_playing_specific_url),e.resource_order!=null&&e.resource_order.length){r.uint32(34).fork();for(let i=0;i<e.resource_order.length;++i)r.int32(e.resource_order[i]);r.ldelim()}if(e.resource_info!=null&&e.resource_info.length)for(let i=0;i<e.resource_info.length;++i)l.proto_initconfig.MediaResourceInfo.encode(e.resource_info[i],r.uint32(42).fork()).ldelim();if(e.play_order_protocol_type!=null&&e.play_order_protocol_type.length){r.uint32(50).fork();for(let i=0;i<e.play_order_protocol_type.length;++i)r.int32(e.play_order_protocol_type[i]);r.ldelim()}return e.jitter_buffer_flag!=null&&Object.hasOwnProperty.call(e,"jitter_buffer_flag")&&r.uint32(80).int32(e.jitter_buffer_flag),e.min_jitter_buffer!=null&&Object.hasOwnProperty.call(e,"min_jitter_buffer")&&r.uint32(88).int32(e.min_jitter_buffer),e.max_jitter_buffer!=null&&Object.hasOwnProperty.call(e,"max_jitter_buffer")&&r.uint32(96).int32(e.max_jitter_buffer),e.supplement_frame_control!=null&&Object.hasOwnProperty.call(e,"supplement_frame_control")&&l.proto_initconfig.SupplementFrameControl.encode(e.supplement_frame_control,r.uint32(106).fork()).ldelim(),e.open_l3_play_resource_prefer!=null&&Object.hasOwnProperty.call(e,"open_l3_play_resource_prefer")&&r.uint32(112).int32(e.open_l3_play_resource_prefer),e.switch_to_l3_after_online!=null&&Object.hasOwnProperty.call(e,"switch_to_l3_after_online")&&r.uint32(120).int32(e.switch_to_l3_after_online),e.transcoding!=null&&Object.hasOwnProperty.call(e,"transcoding")&&l.proto_initconfig.TranscodingConfig.encode(e.transcoding,r.uint32(130).fork()).ldelim(),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaPlayConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.pull_type=e.int32();break;case 2:s.l3_play_buffer_ms=e.int32();break;case 3:s.allow_playing_specific_url=e.int32();break;case 4:if(s.resource_order&&s.resource_order.length||(s.resource_order=[]),(7&u)==2){let p=e.uint32()+e.pos;for(;e.pos<p;)s.resource_order.push(e.int32())}else s.resource_order.push(e.int32());break;case 5:s.resource_info&&s.resource_info.length||(s.resource_info=[]),s.resource_info.push(l.proto_initconfig.MediaResourceInfo.decode(e,e.uint32()));break;case 6:if(s.play_order_protocol_type&&s.play_order_protocol_type.length||(s.play_order_protocol_type=[]),(7&u)==2){let p=e.uint32()+e.pos;for(;e.pos<p;)s.play_order_protocol_type.push(e.int32())}else s.play_order_protocol_type.push(e.int32());break;case 10:s.jitter_buffer_flag=e.int32();break;case 11:s.min_jitter_buffer=e.int32();break;case 12:s.max_jitter_buffer=e.int32();break;case 13:s.supplement_frame_control=l.proto_initconfig.SupplementFrameControl.decode(e,e.uint32());break;case 14:s.open_l3_play_resource_prefer=e.int32();break;case 15:s.switch_to_l3_after_online=e.int32();break;case 16:s.transcoding=l.proto_initconfig.TranscodingConfig.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},n}(),o.MediaDispatchProtocolInfo=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.protocol=null,n.prototype.url_template=null,n.prototype.reusable=null,Object.defineProperty(n.prototype,"_protocol",{get:d.oneOfGetter(t=["protocol"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_url_template",{get:d.oneOfGetter(t=["url_template"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_reusable",{get:d.oneOfGetter(t=["reusable"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.protocol!=null&&Object.hasOwnProperty.call(e,"protocol")&&r.uint32(8).int32(e.protocol),e.url_template!=null&&Object.hasOwnProperty.call(e,"url_template")&&r.uint32(18).string(e.url_template),e.reusable!=null&&Object.hasOwnProperty.call(e,"reusable")&&r.uint32(24).int32(e.reusable),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaDispatchProtocolInfo;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.protocol=e.int32();break;case 2:s.url_template=e.string();break;case 3:s.reusable=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.MediaDispatchResourceInfo=function(){function n(e){if(this.dispatch_protocol_info=[],e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.resource_type=null,n.prototype.dispatch_protocol_info=d.emptyArray,Object.defineProperty(n.prototype,"_resource_type",{get:d.oneOfGetter(t=["resource_type"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){if(r||(r=_.create()),e.resource_type!=null&&Object.hasOwnProperty.call(e,"resource_type")&&r.uint32(8).int32(e.resource_type),e.dispatch_protocol_info!=null&&e.dispatch_protocol_info.length)for(let i=0;i<e.dispatch_protocol_info.length;++i)l.proto_initconfig.MediaDispatchProtocolInfo.encode(e.dispatch_protocol_info[i],r.uint32(18).fork()).ldelim();return r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaDispatchResourceInfo;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.resource_type=e.int32();break;case 2:s.dispatch_protocol_info&&s.dispatch_protocol_info.length||(s.dispatch_protocol_info=[]),s.dispatch_protocol_info.push(l.proto_initconfig.MediaDispatchProtocolInfo.decode(e,e.uint32()));break;default:e.skipType(7&u)}}return s},n}(),o.MediaDispatchConfig=function(){function n(t){if(this.dispatch_resource_info=[],t)for(let e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return n.prototype.dispatch_resource_info=d.emptyArray,n.encode=function(t,e){if(e||(e=_.create()),t.dispatch_resource_info!=null&&t.dispatch_resource_info.length)for(let r=0;r<t.dispatch_resource_info.length;++r)l.proto_initconfig.MediaDispatchResourceInfo.encode(t.dispatch_resource_info[r],e.uint32(10).fork()).ldelim();return e},n.decode=function(t,e){t instanceof h||(t=h.create(t));let r=e===void 0?t.len:t.pos+e,i=new l.proto_initconfig.MediaDispatchConfig;for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:i.dispatch_resource_info&&i.dispatch_resource_info.length||(i.dispatch_resource_info=[]),i.dispatch_resource_info.push(l.proto_initconfig.MediaDispatchResourceInfo.decode(t,t.uint32()));break;default:t.skipType(7&s)}}return i},n}(),o.MediaServiceUrlList=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.base_url=null,n.prototype.push_status_url=null,Object.defineProperty(n.prototype,"_base_url",{get:d.oneOfGetter(t=["base_url"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_push_status_url",{get:d.oneOfGetter(t=["push_status_url"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.base_url!=null&&Object.hasOwnProperty.call(e,"base_url")&&r.uint32(10).string(e.base_url),e.push_status_url!=null&&Object.hasOwnProperty.call(e,"push_status_url")&&r.uint32(18).string(e.push_status_url),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaServiceUrlList;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.base_url=e.string();break;case 2:s.push_status_url=e.string();break;default:e.skipType(7&u)}}return s},n}(),o.ZeusMediaConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.push_dispatch_type=null,n.prototype.pull_dispatch_type=null,n.prototype.open_auth=null,n.prototype.send_anchor_login_after_push_cdn=null,Object.defineProperty(n.prototype,"_push_dispatch_type",{get:d.oneOfGetter(t=["push_dispatch_type"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_pull_dispatch_type",{get:d.oneOfGetter(t=["pull_dispatch_type"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_open_auth",{get:d.oneOfGetter(t=["open_auth"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_send_anchor_login_after_push_cdn",{get:d.oneOfGetter(t=["send_anchor_login_after_push_cdn"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.push_dispatch_type!=null&&Object.hasOwnProperty.call(e,"push_dispatch_type")&&r.uint32(8).int32(e.push_dispatch_type),e.pull_dispatch_type!=null&&Object.hasOwnProperty.call(e,"pull_dispatch_type")&&r.uint32(16).int32(e.pull_dispatch_type),e.open_auth!=null&&Object.hasOwnProperty.call(e,"open_auth")&&r.uint32(24).int32(e.open_auth),e.send_anchor_login_after_push_cdn!=null&&Object.hasOwnProperty.call(e,"send_anchor_login_after_push_cdn")&&r.uint32(32).int32(e.send_anchor_login_after_push_cdn),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.ZeusMediaConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.push_dispatch_type=e.int32();break;case 2:s.pull_dispatch_type=e.int32();break;case 3:s.open_auth=e.int32();break;case 4:s.send_anchor_login_after_push_cdn=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o.MediaConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.play_config=null,n.prototype.publish_config=null,n.prototype.dispatch_config=null,n.prototype.service_url_list=null,n.prototype.zeus_config=null,Object.defineProperty(n.prototype,"_play_config",{get:d.oneOfGetter(t=["play_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_publish_config",{get:d.oneOfGetter(t=["publish_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_dispatch_config",{get:d.oneOfGetter(t=["dispatch_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_service_url_list",{get:d.oneOfGetter(t=["service_url_list"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_zeus_config",{get:d.oneOfGetter(t=["zeus_config"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.play_config!=null&&Object.hasOwnProperty.call(e,"play_config")&&l.proto_initconfig.MediaPlayConfig.encode(e.play_config,r.uint32(10).fork()).ldelim(),e.publish_config!=null&&Object.hasOwnProperty.call(e,"publish_config")&&l.proto_initconfig.MediaPublishConfig.encode(e.publish_config,r.uint32(18).fork()).ldelim(),e.dispatch_config!=null&&Object.hasOwnProperty.call(e,"dispatch_config")&&l.proto_initconfig.MediaDispatchConfig.encode(e.dispatch_config,r.uint32(26).fork()).ldelim(),e.service_url_list!=null&&Object.hasOwnProperty.call(e,"service_url_list")&&l.proto_initconfig.MediaServiceUrlList.encode(e.service_url_list,r.uint32(34).fork()).ldelim(),e.zeus_config!=null&&Object.hasOwnProperty.call(e,"zeus_config")&&l.proto_initconfig.ZeusMediaConfig.encode(e.zeus_config,r.uint32(42).fork()).ldelim(),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.MediaConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.play_config=l.proto_initconfig.MediaPlayConfig.decode(e,e.uint32());break;case 2:s.publish_config=l.proto_initconfig.MediaPublishConfig.decode(e,e.uint32());break;case 3:s.dispatch_config=l.proto_initconfig.MediaDispatchConfig.decode(e,e.uint32());break;case 4:s.service_url_list=l.proto_initconfig.MediaServiceUrlList.decode(e,e.uint32());break;case 5:s.zeus_config=l.proto_initconfig.ZeusMediaConfig.decode(e,e.uint32());break;default:e.skipType(7&u)}}return s},n}(),o.InitConfig=function(){function n(e){if(e)for(let r=Object.keys(e),i=0;i<r.length;++i)e[r[i]]!=null&&(this[r[i]]=e[r[i]])}let t;return n.prototype.app_config=null,n.prototype.room_config=null,n.prototype.ve_config=null,n.prototype.speedlog_config=null,n.prototype.media_config=null,n.prototype.proto_version=null,Object.defineProperty(n.prototype,"_app_config",{get:d.oneOfGetter(t=["app_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_room_config",{get:d.oneOfGetter(t=["room_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_ve_config",{get:d.oneOfGetter(t=["ve_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_speedlog_config",{get:d.oneOfGetter(t=["speedlog_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_media_config",{get:d.oneOfGetter(t=["media_config"]),set:d.oneOfSetter(t)}),Object.defineProperty(n.prototype,"_proto_version",{get:d.oneOfGetter(t=["proto_version"]),set:d.oneOfSetter(t)}),n.encode=function(e,r){return r||(r=_.create()),e.app_config!=null&&Object.hasOwnProperty.call(e,"app_config")&&l.proto_initconfig.AppConfig.encode(e.app_config,r.uint32(10).fork()).ldelim(),e.room_config!=null&&Object.hasOwnProperty.call(e,"room_config")&&l.proto_initconfig.RoomConfig.encode(e.room_config,r.uint32(18).fork()).ldelim(),e.ve_config!=null&&Object.hasOwnProperty.call(e,"ve_config")&&l.proto_initconfig.VEConfig.encode(e.ve_config,r.uint32(26).fork()).ldelim(),e.speedlog_config!=null&&Object.hasOwnProperty.call(e,"speedlog_config")&&l.proto_initconfig.SpeedlogConfig.encode(e.speedlog_config,r.uint32(34).fork()).ldelim(),e.media_config!=null&&Object.hasOwnProperty.call(e,"media_config")&&l.proto_initconfig.MediaConfig.encode(e.media_config,r.uint32(42).fork()).ldelim(),e.proto_version!=null&&Object.hasOwnProperty.call(e,"proto_version")&&r.uint32(48).int32(e.proto_version),r},n.decode=function(e,r){e instanceof h||(e=h.create(e));let i=r===void 0?e.len:e.pos+r,s=new l.proto_initconfig.InitConfig;for(;e.pos<i;){let u=e.uint32();switch(u>>>3){case 1:s.app_config=l.proto_initconfig.AppConfig.decode(e,e.uint32());break;case 2:s.room_config=l.proto_initconfig.RoomConfig.decode(e,e.uint32());break;case 3:s.ve_config=l.proto_initconfig.VEConfig.decode(e,e.uint32());break;case 4:s.speedlog_config=l.proto_initconfig.SpeedlogConfig.decode(e,e.uint32());break;case 5:s.media_config=l.proto_initconfig.MediaConfig.decode(e,e.uint32());break;case 6:s.proto_version=e.int32();break;default:e.skipType(7&u)}}return s},n}(),o})()},function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(r,i){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,u){s.__proto__=u}||function(s,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(s[p]=u[p])})(r,i)},function(r,i){function s(){this.constructor=r}m(r,i),r.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}),_=this&&this.__assign||function(){return(_=Object.assign||function(r){for(var i,s=1,u=arguments.length;s<u;s++)for(var p in i=arguments[s])Object.prototype.hasOwnProperty.call(i,p)&&(r[p]=i[p]);return r}).apply(this,arguments)},d=this&&this.__spreadArrays||function(){for(var r=0,i=0,s=arguments.length;i<s;i++)r+=arguments[i].length;var u=Array(r),p=0;for(i=0;i<s;i++)for(var f=arguments[i],E=0,y=f.length;E<y;E++,p++)u[p]=f[E];return u};Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoWssLink=void 0;var l=I(0),a=I(1),c=I(72),o=I(73),n=I(9),t=I(6),e=function(r){function i(s,u,p,f,E){var y=r.call(this)||this;return y.appID=s,y.env=u,y.protobuf=p,y.logger=f,y.stateCenter=E,y.socketService=new o.NetSocketService(y.env),y.urlIndex=0,y.updatedMsgTime=0,y.unUpdateMsgTimeTypes=[a.AccessHubMessageType.MSG_TYPE_HB_REQUEST,a.AccessHubMessageType.MSG_TYPE_HB_RESPONSE,a.AccessHubMessageType.MSG_TYPE_GET_CONFIG_REQUEST,a.AccessHubMessageType.MSG_TYPE_GET_CONFIG_RESPONSE],y.netLinkState=l.ENUM_CONNECT_STATE.disconnect,y.sendCommandList=new l.LinkedList,y.sendCommandMap={},y.sendDataCheckOnceCount=100,y.sendDataDropTimeout=1e4,y.sendDataCheckInterval=2e3,y.timeout=5e3,y.connectInterval=1e4,y.connectTimer=null,y.connectRsp={},y.unlogTypes=[12,13],y.tryServers=[],y.updatedMsgTime=Date.now(),y}return h(i,r),i.prototype.initEvent=function(s,u,p,f){this.onConnectedEvent=s,this.onDisConnectedEvent=u,this.onConnectingEvent=p,this.onPushEvent=f},i.prototype.createSocket=function(s){this.servers=s,this.urlIndex=0},i.prototype.destroySocket=function(){this.logger.info("zn.wl.ds.0 call"),this.socketService.closeSocket(),this.netLinkState=l.ENUM_CONNECT_STATE.disconnect,this.resetConnect()},i.prototype.refreshServers=function(s){this.servers=d(s,this.servers)},i.prototype.connectSocket=function(s,u,p){var f=this;if(s===void 0&&(s=!0),this.logger.info("zn.wl.cs.0 call"),this.connectRsp.suc=u,this.connectRsp.fail=p,this.stateCenter.networkState!==a.ENUM_NETWORK_STATE.online)return!1;s&&(this.urlIndex=(this.urlIndex+1)%this.servers.length);var E=this.servers[this.urlIndex];return this.connectServer=E,this.logger.info("zn.wl.cs.0 server "+E),this.tryServers.push(E),this.closeSocket(),this.netLinkState=l.ENUM_CONNECT_STATE.connecting,this.socketService.createSocket(E),this.onConnectingEvent&&this.onConnectingEvent(!0),this.bindSocketEvent(),this.connectTimer=setTimeout(function(){f.logger.info("zn.wl.cs.0 timeout"),f.connectRsp.fail&&f.connectRsp.fail()},this.connectInterval),!0},i.prototype.bindSocketEvent=function(){var s=this;this.openHandler(function(){s.logger.info("zn.wl.bse open"),s.resetConnect(),s.connectRsp.suc&&s.connectRsp.suc(),s.onConnectedEvent&&s.onConnectedEvent(s.tryServers),s.netLinkState=l.ENUM_CONNECT_STATE.connected}),this.closeHandler(function(u){s.logger.warn("zn.wl.bse close "+JSON.stringify(u)),s.resetConnect(),s.connectRsp.fail&&s.connectRsp.fail(),s.onDisConnectedEvent&&s.onDisConnectedEvent(!0),s.netLinkState=l.ENUM_CONNECT_STATE.disconnect}),this.errorHandler(function(u){s.logger.warn("zn.wl.bse error "+JSON.stringify(u)),s.resetConnect(),s.connectRsp.fail&&s.connectRsp.fail(),s.onDisConnectedEvent&&s.onDisConnectedEvent(!0),s.netLinkState=l.ENUM_CONNECT_STATE.disconnect}),this.onMessage()},i.prototype.closeSocket=function(){this.logger.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=l.ENUM_CONNECT_STATE.disconnect},i.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null)},i.prototype.isConnect=function(){return this.netLinkState===l.ENUM_CONNECT_STATE.connected},i.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},i.prototype.setState=function(s){this.netLinkState=s},i.prototype.closeHandler=function(s){this.socketService.closeHandler(s)},i.prototype.openHandler=function(s){this.socketService.openHandler(s)},i.prototype.errorHandler=function(s){this.socketService.errorHandler(s)},i.prototype.updateMsgTime=function(){this.updatedMsgTime=Date.now()},i.prototype.sendMessage=function(s,u,p,f,E,y,b){var S;f===void 0&&(f=!0),E===void 0&&(E=null),y===void 0&&(y=null),b===void 0&&(b=null),this.txid++;var k={appid:this.appID,biz_type:0,mode_no:((S=this.stateCenter.appInfo)===null||S===void 0?void 0:S.mode)||t.NET_ACCESS_CONFIG.modeNo,id_name:this.stateCenter.userId,sdk_type:t.NET_ACCESS_CONFIG.sdkType,zegoconn_run_env:this.env===0?a.ZegoconnRunEnv.ZEGOCONN_RUN_ENV_BROWSER:a.ZegoconnRunEnv.ZEGOCONN_RUN_ENV_APPLET},O=_(_({txid:this.txid},k),p),g={data:O,txid:this.txid,sendTime:Date.now(),timeOut:this.timeout,ack:p.ack,success:E,error:y,ackFunc:b},v=this.sendCommandList.push(g);this.sendCommandMap[this.txid]=v,this.unUpdateMsgTimeTypes.includes(s)||(this.updatedMsgTime=Date.now()),this.unlogTypes.indexOf(s)===-1&&this.logger.info("zn.wl.sm type: "+s+"-"+a.typeMap[s]+" streamID: "+u+" txid: "+this.txid);var R=this.protobuf.encodeRequest(s,O,u);this.socketService.sendMessage(R)},i.prototype.onMessage=function(){var s=this;this.socketService.onMessage=function(u){var p,f,E,y=new Uint8Array(u),b=s.protobuf.decodeResponse(y),S=b[0],k=b[1],O=b[2];s.unUpdateMsgTimeTypes.includes(k)||(s.updatedMsgTime=Date.now()),s.unlogTypes.indexOf(k)===-1&&s.logger.info("zn.wl.om streamID: "+S+", msgType: "+k+"-"+a.typeMap[k]),((O==null?void 0:O.txid)||((p=O==null?void 0:O.data)===null||p===void 0?void 0:p.txid))&&s.isRspMsg((O==null?void 0:O.txid)||((f=O==null?void 0:O.data)===null||f===void 0?void 0:f.txid))?s.handleSendCommandMsgRsp(S,k,(O==null?void 0:O.txid)||((E=O==null?void 0:O.data)===null||E===void 0?void 0:E.txid),O):s.onPushEvent(S,k,O)}},i.prototype.isRspMsg=function(s){return this.sendCommandMap[s]!==void 0},i.prototype.startCheck=function(){var s=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){s.startCheck()},this.sendDataCheckInterval)},i.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},i.prototype.checkMessageListTimeout=function(s,u){for(var p=s.getFirst(),f=Date.now(),E=0;!(p==null||p._data&&p._data.sendTime+p._data.timeOut>f||(p._data&&delete u[p._data.data.txid],s.remove(p),p._data&&p._data.error==null||p._data&&p._data.sendTime+this.sendDataDropTimeout<f||setTimeout(function(){p&&p._data&&p._data.error&&p._data.error({},p._data.data.txid,n.errorCodeList.TIMEOUT)},0),++E>=this.sendDataCheckOnceCount));)p=s.getFirst()},i.prototype.checkSendMessageList=function(s){for(var u=s.getFirst();u!=null;)s.remove(u),u._data&&u._data.error&&setTimeout(function(){u&&u._data&&u._data.error&&u._data.error({},u._data.data.txid,n.errorCodeList.TIMEOUT)},0),u=s.getFirst()},i.prototype.handleSendCommandMsgRsp=function(s,u,p,f){var E=this.sendCommandMap[p];if(E!=null){var y=E._data;(y==null?void 0:y.ack)||(delete this.sendCommandMap[p],this.sendCommandList.remove(E)),f.code&&f.code!==0?y&&y.error!=null&&y.error(f,p):u===a.AccessHubMessageType.MSG_TYPE_PUSH_EXCEPTION?(f.code=f.reason,f.message=f.msg,y&&y.error!=null&&y.error(f,p)):u===a.AccessHubMessageType.MSG_TYPE_HTTP_REQUEST_ACK?y&&y.ackFunc!=null&&y.ackFunc(f,p):y&&y.success!=null&&y.success(f,p)}},i}(c.ZegoLink);T.ZegoWssLink=e},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoLink=void 0;var m=function(){function h(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}return h.prototype.createSocket=function(_){},h.prototype.setState=function(_){},h.prototype.initEvent=function(_,d,l,a){},h.prototype.sendMessage=function(_,d,l,a,c,o,n){a===void 0&&(a=!0),c===void 0&&(c=null),o===void 0&&(o=null),n===void 0&&(n=null)},h}();T.ZegoLink=m},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetSocketService=void 0;var m=I(0),h=function(){function _(d){this.socket=null,this.ENV=d}return _.prototype.createSocket=function(d){this.socket=m.createZegoWebSocket(d,this.ENV%2)},_.prototype.openHandler=function(d){var l=this;this.socket&&(this.socket.onopen=function(a){l.socket.binaryType="arraybuffer",l.responseHandler(),d(a)})},_.prototype.responseHandler=function(){var d=this;this.socket&&(this.socket.onmessage=function(l){var a=typeof l.data=="string"?JSON.parse(l.data):l.data;d.onMessage(a)})},_.prototype.onMessage=function(d){},_.prototype.closeHandler=function(d){this.socket&&(this.socket.onclose=function(l){d(l)})},_.prototype.errorHandler=function(d){this.socket&&(this.socket.onerror=d)},_.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},_.prototype.isDisConnect=function(){return!this.socket||this.socket.readyState!==1},_.prototype.sendMessage=function(d){this.isDisConnect()||this.socket&&(this.ENV%2==1||this.socket.send(d))},_}();T.NetSocketService=h},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetAgentBusinessRequestMgr=void 0;var m=I(1),h=I(6),_=function(){function d(l,a,c,o){this.streamManager=l,this.protobuf=a,this.logger=c,this.stateCenter=o}return d.prototype.getConfig=function(l,a){this.logger.info("zn.nab.gc call"),this.streamManager.createStream(m.StreamType.OTHER).sendMessage(m.AccessHubMessageType.MSG_TYPE_GET_CONFIG_REQUEST,{zegoconn_version:h.NET_ACCESS_CONFIG.connectVer},l,a)},d.prototype.dispatchURL=function(l,a){var c=this;this.logger.info("zn.nab.du call"),this.streamManager.createStream(m.StreamType.OTHER).sendMessage(m.AccessHubMessageType.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST,{},function(o){c.logger.info("zn.nab.du suc "),l&&l(o)},function(o){c.logger.info("zn.nab.du fail"),a&&a(o)})},d.prototype.getAppConfig=function(l,a,c){var o=this;return new Promise(function(n,t){var e;o.logger.info("zn.nab.gac call");var r={id_name:a,config_key:l,token:c,mode_no:((e=o.stateCenter.appInfo)===null||e===void 0?void 0:e.mode)||h.NET_ACCESS_CONFIG.modeNo},i=function(s){if(s.code===0){o.logger.info("zn.nab.gac suc");var u=o.decodeConfigMessage(s.data.data);n({code:0,data:u})}else o.logger.error("zn.nab.gac fail "+s.code),t({code:s.code})};o.streamManager.createStream(m.StreamType.OTHER).sendMessage(m.AccessHubMessageType.MSG_TYPE_GET_APPCONFIG_REQUEST,r,i,i)})},d.prototype.decodeConfigMessage=function(l){return this.protobuf.decodeConfigMessage(l)},d}();T.NetAgentBusinessRequestMgr=_},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetHeartBeatHandler=void 0;var m=I(9),h=I(1),_=function(){function d(l,a){this.streamManager=l,this.logger=a,this.hbTimer=null,this.hbInterval=5,this.hbTimeout=10,this.hbTimeoutMaxCount=0,this.tryHbCount=0}return d.prototype.init=function(l){var a=this;this.logger.info("zn.nhb.ii call"),this.hbStream||(this.hbStream=this.streamManager.createStream(h.StreamType.OTHER)),l.data.logic_hb_interval>=1&&l.data.logic_hb_interval<=10&&(this.hbInterval=l.data.logic_hb_interval),l.data.logic_hb_timeout>=3&&l.data.logic_hb_timeout<=30&&(this.hbTimeout=l.data.logic_hb_timeout),this.hbTimeoutMaxCount=this.hbTimeout/this.hbInterval,this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout(function(){a.start()},1e3*this.hbInterval)},d.prototype.start=function(){var l=this;if(this.logger.debug("zn.nhb.s call"),this.tryHbCount++>this.hbTimeoutMaxCount)return this.logger.error("zn.nhb.s come to try limit"),this.reset(),void this.netHbLogout(m.errorCodeList.NET_HB_TIMEOUT);var a=new Date().getTime(),c=function(){l.logger.debug("zn.nhb.s hb callback "+(new Date().getTime()-a)),l.tryHbCount=0},o={ts:Date.now()};this.hbStream.sendMessage(h.AccessHubMessageType.MSG_TYPE_HB_REQUEST,o,c,c),this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout(function(){l.start()},1e3*this.hbInterval)},d.prototype.netHbLogout=function(l){},d.prototype.reset=function(){this.hbTimer&&(clearTimeout(this.hbTimer),this.hbTimer=null),this.tryHbCount=0},d}();T.NetHeartBeatHandler=_},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetAgentPCRequestMgr=void 0;var m=I(1),h=I(6),_=I(26),d=function(){function l(a,c){this.streamManager=a,this.logger=c,this.pcStreamRequests=[],this.pcEstablishTimeout=h.NET_ACCESS_CONFIG.pcEstablishTimeout}return l.prototype.getRequest=function(a,c,o){var n=new _.NetAgentPCRequest(this.logger,a,this.streamManager,this.pcEstablishTimeout,c||"",o||"");return this.pcStreamRequests.push(n),n},l.prototype.updateConnectState=function(a,c,o){this.pcStreamRequests.forEach(function(n){a===m.PcConnectState.BROKEN?n.eventManager.emit("broken"):a===m.PcConnectState.DISCONNECT&&n.eventManager.emit("disconnected",c,o)})},l.prototype.closePCs=function(){this.pcStreamRequests.forEach(function(a){a.closePc()})},l.prototype.setEstablishTimeout=function(a){this.pcEstablishTimeout=a},l}();T.NetAgentPCRequestMgr=d},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StreamManager=void 0;var m=I(1),h=I(78),_=function(){function d(l){this.zegoLink=l,this.streamID=0,this.httpStreams=[],this.pcStreams=[]}return d.prototype.createStream=function(l){if(l===m.StreamType.HTTP)return this.getStream(l,this.httpStreams);if(l===m.StreamType.PC){var a=new h.ZegoLinkStream(l,this.streamID++,this.zegoLink);return this.pcStreams.push(a),a}return a=new h.ZegoLinkStream(l,this.streamID++,this.zegoLink)},d.prototype.getStream=function(l,a){var c=a.find(function(o){return o.isFree===!0});return c?(c.isFree=!1,c.isFirst=!1,c):new h.ZegoLinkStream(l,this.streamID++,this.zegoLink)},d.prototype.onPushEvent=function(l,a,c){var o=this.pcStreams.find(function(n){return n.StreamID===l});o&&o.onPushEvent(a,c)},d.prototype.getStreamID=function(){return this.streamID++},d}();T.StreamManager=_},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoLinkStream=void 0;var m=I(1),h=function(){function _(d,l,a){this.type=d,this.streamID=l,this.zegoLink=a,this.isFree=!1,this.isFirst=!0}return Object.defineProperty(_.prototype,"StreamID",{get:function(){return this.streamID},enumerable:!1,configurable:!0}),_.prototype.refresh=function(d){this.streamID=d},_.prototype.sendMessage=function(d,l,a,c,o){var n=this;a===void 0&&(a=null),c===void 0&&(c=null),o===void 0&&(o=null),this.zegoLink.sendMessage(d,this.streamID,l,this.isFirst,function(t){n.type===m.StreamType.HTTP&&(n.isFree=!0),a&&a(t)},function(t){n.type===m.StreamType.HTTP&&(n.isFree=!0),c&&c(t)},o)},_.prototype.onPushEvent=function(d,l){},_.prototype.closeStream=function(d,l){this.zegoLink.sendMessage(m.AccessHubMessageType.MSG_TYPE_STREAM_CLOSED,this.streamID,{code:d,msg:l})},_.prototype.isConnect=function(){return this.zegoLink.isConnect()},_}();T.ZegoLinkStream=h},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetAgentHttpRequestMgr=void 0;var m=I(29),h=function(){function _(d,l){this.streamManager=d,this.logger=l}return _.prototype.getRequest=function(d){return new m.NetAgentHttpRequest(this.logger,d,this.streamManager)},_}();T.NetAgentHttpRequestMgr=h},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.NetRetryLinkHandler=void 0;var m=I(0),h=I(9),_=function(){function d(l,a){this.logger=l,this.stateCenter=a,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1,this.RETRY_MAX_TIME=90}return d.prototype.initLink=function(l){this.link=l},d.prototype.startMaxTime=function(){var l=this;this.maxTimer||(this.maxTimer=setTimeout(function(){l.logger.warn("zn.rlh.sm over max time "+l.RETRY_MAX_TIME+"s, stop retry"),l.isOverTime=!0,l.link.resetConnect(),l.stopMaxTime(),l.invalid(),l.onactive(!1,h.errorCodeList.NET_SOCKET_TIMEOUT)},1e3*this.RETRY_MAX_TIME))},d.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},d.prototype.active=function(l,a){var c=this;if(this.logger.info("zn.rlh.at call "+l+" "+a),this.stateCenter.networkState==m.ENUM_NETWORK_STATE.offline)return this.logger.info("zn.rlh.at network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zn.rlh.at has actived, ignore"),!1;if(this.isOverTime)return this.logger.info("zn.rlh.at retry over time, stop retry"),!1;if(this.retryActiveCount==1)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}return this.logger.info("zn.rlh.at interval "+this.retryActiveInterval),this.retryTimer=setTimeout(function(){c.link.destroySocket(),c.link.connectSocket(l,function(){c.logger.info("zn.rlh.at suc"),c.stopMaxTime(),c.invalid(),c.onactive(!0)},function(){c.logger.info("zn.rlh.at fail"),!c.maxTimer&&c.startMaxTime(),c.active(!0)}),c.retryTimer&&clearTimeout(c.retryTimer),c.retryTimer=null,c.retryActiveCount++},a?0:1e3*this.retryActiveInterval),!0},d.prototype.onactive=function(){for(var l=[],a=0;a<arguments.length;a++)l[a]=arguments[a]},d.prototype.init=function(l,a,c,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,typeof l=="number"&&l<3600&&(this.RETRY_MAX_TIME=l),typeof a=="number"&&(this.RETRY_START_TIME_INTERVAL=a),typeof c=="number"&&(this.RETRY_CONTINUE_COUNT=c),typeof o=="number"&&(this.RETRY_MAX_TIME_INTERVAL=o)},d.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},d}();T.NetRetryLinkHandler=_},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StateCenter=void 0;var m=I(1),h=function(){this.networkState=m.ENUM_NETWORK_STATE.offline,this.useNetAgent=!0};T.StateCenter=h},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.LiveRoomModules=void 0;var m=I(0),h=I(31),_=I(83),d=I(32),l=I(4),a=I(2),c=function(){function o(n,t,e,r,i,s,u){this.roomID=n,this.stateCenter=t,this.logger=e,this.dataReport=r,this.service=i,this.rtm=s,this.liveRoomHandler=u,this.runState=m.ENUM_RUN_STATE.logout,this.lastRunState=m.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.maxMemberCount=0,this.lvKey="",this.roomName="",this.roomHandler=new _.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this,u),this.heartBeatHandler=new h.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this),this.userHandler=new d.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this),this.initMessageHandler(),this.initLiveHandler(),this.init()}return o.prototype.initMessageHandler=function(){},o.prototype.initLiveHandler=function(){},o.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},o.prototype.bindHeatBeatHandler=function(){var n=this;this.heartBeatHandler.hbLogout=function(t){n.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){n.messageHandler&&n.messageHandler.loginRsp(t),n.userHandler.patchUserList(t),n.HBResponse(t)}},o.prototype.bindRoomHandler=function(){var n=this;this.roomHandler.loginSuccessCallBack=function(t,e){n.heartBeatHandler.init(e),n.stateCenter.useNetAgent?n.liveRoomHandler.startCheck():n.service.startCheck(),n.userHandler.loginRsp(e,t),n.messageHandler&&n.messageHandler.loginRsp(e),n.isMulti||n.handleMultiRoom(),n.roomLoginResponse(e)},this.roomHandler.resetRoomCallBack=function(){n.heartBeatHandler.resetHeartbeat(),n.liveHandler&&n.liveHandler.resetLiveHandler(),n.messageHandler&&n.messageHandler.resetMessageInfo(),n.stateCenter.useNetAgent&&n.liveRoomHandler&&n.liveRoomHandler.stopCheck(),n.userHandler.resetUserHandler(),n.roomTryHandler&&(n.roomTryHandler.invalid(),n.roomTryHandler.stopMaxTime(),n.roomTryHandler=void 0)}},o.prototype.bindUserHandler=function(){},o.prototype.bindMessageHandler=function(){},o.prototype.bindLiveHandler=function(){},o.prototype.HBResponse=function(n){this.stateCenter.actionListener("HBResponse",n)},o.prototype.roomLoginResponse=function(n){this.stateCenter.actionListener("roomLoginResponse",n)},o.prototype.handleMultiRoom=function(){var n=this;this.stateCenter.roomModulesList.forEach(function(t){t.runState!==m.ENUM_RUN_STATE.login&&t.roomTryHandler&&t.isMulti==1&&(t.roomTryHandler.onactive=function(e,r){if(r&&r.code!==0){if(r.code!==0){var i=l.ClientUtil.getLiveRoomError(r.code,n.stateCenter.useNetAgent);i&&a.errorCodeList[i]&&(r=a.errorCodeList[i])}t.roomHandler.roomStateHandle("DISCONNECTED",r,r.msg)}else t.roomHandler.roomStateHandle("CONNECTED",r)},t.roomTryHandler.startMaxTime(),t.roomTryHandler.active())})},o.prototype.isLogin=function(){return this.runState===m.ENUM_RUN_STATE.login},o.prototype.isDisConnect=function(){return this.stateCenter.useNetAgent?this.liveRoomHandler.isDisConnect():this.service.isDisConnect()},o.prototype.resetSessionInfo=function(){var n;this.logger.info("zm.lrm.rsi call"),this.sessionID="0",this.roomSessionID="0",(n=this.liveRoomHandler)===null||n===void 0||n.reset()},o}();T.LiveRoomModules=c},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RoomHandler=void 0;var m=I(0),h=I(4),_=I(5),d=I(2),l=I(10),a=function(){function c(o,n,t,e,r,i){this.logger=o,this.stateCenter=n,this.dataReport=t,this.service=e,this.room=r,this.liveRoomHandler=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}return c.prototype.resetTokenTimer=function(o){var n=this;o=(o=(o-=3e4)<0?0:o)>2147483648?2147483648:o,this.logger.info(_.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+o),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout(function(){n.stateCenter.actionListener("tokenWillExpire",n.room.roomID),n.stateCenter.actionListener("roomTokenWillExpire",n.room.roomID)},o)},c.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},c.prototype.setRunState=function(o){this.room.runState!==o&&(this.room.lastRunState=this.room.runState,this.room.runState=o)},c.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},c.prototype.resetRoom=function(o){var n,t=this;if(this.logger.info(_.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!o&&(this.room.isMulti=!0),this.resetTryLogin(),this.room.sessionID!=="0"&&this.room.runState!==m.ENUM_RUN_STATE.logout&&!this.room.isDisConnect()){var e=function(i){t.handleLogoutRsp(i,!t.room.isMulti)};(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).logout(this.room,e,e)}this.setRunState(m.ENUM_RUN_STATE.logout),this.room.sessionID="0",this.room.roomSessionID="0",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.stateCenter.useNetAgent?(n=this.liveRoomHandler)===null||n===void 0||n.reset():this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter(function(i){return i!==t.room});var r=this.stateCenter.roomModulesList[0];r&&(r.isMulti=!1,r.runState!==m.ENUM_RUN_STATE.login&&r.roomTryHandler&&(r.roomTryHandler.startMaxTime(),r.roomTryHandler.active())),this.logger.info(_.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},c.prototype.resetRoomCallBack=function(){},c.prototype.loginSuccessCallBack=function(o,n){},c.prototype.handlePushKickout=function(o,n,t){var e=this;if(this.logger.info(_.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(o)),t||this.room.sessionID===o.header.session_id||this.room.sessionID===o.body.session_id){var r=m.getReportSeq();this.dataReport.newReport(r,l.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(r,{user_id:l.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var i=h.ClientUtil.getKickoutError(o.body.reason||o.body.kickout_reason,this.stateCenter.useNetAgent);this.dataReport.addMsgInfo(r,{error:i.code,message:i.message}),this.dataReport.uploadReport(r);var s=this.room.roomTryHandler;if(s)if(s.onactive=function(f,E){e.disconnectedHandle(E),e.stateCenter.actionListener("_kickout",E)},o.body.need_relogin&&o.body.need_relogin==1)this.room.sessionID="0",s.startMaxTime(),s.active();else{this.setRunState(m.ENUM_RUN_STATE.logout),this.resetRoom(n);var u={};if(o&&o.body.custom_reason)u.custom_kickout_message=o.body.custom_reason;else if(i.name&&d.errorCodeList[i.name]){var p=o.body.reason||o.body.kickout_reason;u.custom_kickout_message=d.errorCodeList[i.name].msg+"; kickout reason: "+p}i.name&&d.errorCodeList[i.name]?this.disconnectedHandle(d.errorCodeList[i.name],JSON.stringify(u)):this.disconnectedHandle(d.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(u)),this.stateCenter.actionListener("_kickout",{code:d.errorCodeList.MANUAL_KICKOUT.code,msg:d.errorCodeList.MANUAL_KICKOUT.msg+o.body.reason||o.body.kickout_reason})}else this.logger.info(_.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")}else this.logger.info(_.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" session id wrong, ignore")},c.prototype.handleHbLogout=function(o){var n=this,t=this.room.roomTryHandler;t&&(t.onactive=function(e,r){n.disconnectedHandle(r)},[d.errorCodeList.HEARTBEAT_TIMEOUT,d.errorCodeList.SOCKET_CLOSE,d.errorCodeList.TIMEOUT].includes(o)||[105,152,2001].includes(o==null?void 0:o.code)||o.msg.endsWith("1000002001")||o.msg.endsWith("1000000152")||o.msg.endsWith("1000000105")?(t.startMaxTime(),this.stateCenter.useNetAgent&&this.room.resetSessionInfo(),t.active()):(t.stopMaxTime(),t.invalid(),this.resetRoom(),this.disconnectedHandle(o)))},c.prototype.onDisconnect=function(o){var n=this;if(this.logger.error(_.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+o.msg),typeof o.code=="string"&&o.code==="Error.Network")this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if(typeof o.code=="number"){var t=void 0;(t=o.code<2e9&&o.code>1e9||o.code<1e6?h.ClientUtil.decodeServerError(o.code,o.msg):{code:o.code,message:o.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:t.code,message:t.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,h.ClientUtil.unregisterCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var e=this.room.roomTryHandler;e?(e.onactive=function(r,i){i&&i.code!==0?n.roomStateHandle("DISCONNECTED",i):n.roomStateHandle("CONNECTED",i)},e.startMaxTime(),e.active()):this.logger.error(_.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},c.prototype.onConnecting=function(o){this.roomStateHandle("CONNECTING",o)},c.prototype.disconnectedHandle=function(o,n){o&&o.code!==0?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",o,n)):this.roomStateHandle("CONNECTED",o,n)},c.prototype.roomStateHandle=function(o,n,t){this.logger.info(_.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+o+" "+JSON.stringify(n)),this.room.lastRoomState=this.room.roomState,this.room.roomState=o,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,o,n?n.code:0,t),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,o,n?n.code:0,t))},c.prototype.login=function(o,n,t,e,r,i,s){if(this.logger.info(_.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:"+n+" "+t),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,n,"",e.userID,"",this.stateCenter.sdKVersion),r&&(r.userUpdate&&typeof r.userUpdate=="boolean"&&(this.stateCenter.userStateUpdate=r.userUpdate),r.maxMemberCount&&typeof r.maxMemberCount=="number"&&(this.room.maxMemberCount=r.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(_.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void s(d.errorCodeList.INIT);if(this.room.runState!==m.ENUM_RUN_STATE.trylogin&&this.setRunState(m.ENUM_RUN_STATE.trylogin),this.room.roomID=n,this.room.token=t,this.room.thirdToken=t,this.stateCenter.idName=e.userID,this.stateCenter.nickName=e.userName||e.userID,this.loginCallback.success=i,this.loginCallback.fail=s,this.stateCenter.reportSeqList.login===0){var u=m.getReportSeq();this.stateCenter.reportSeqList.relogin=u,this.dataReport.newReport(u,l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(u,{server:o}),h.ClientUtil.logReportCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,u,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(o),this.logger.info(_.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},c.prototype.tryLogin=function(o){var n,t=this;if(this.room.runState===m.ENUM_RUN_STATE.trylogin){var e=this.stateCenter.reportSeqList.login!==0?l.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.stateCenter.useNetAgent){if(this.room.isMulti&&this.room.isDisConnect())return void this.logger.warn(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" liveroom is not connected");var r=function(i,s){t.handleLoginRsp(i,s)};((n=this.liveRoomHandler)===null||n===void 0?void 0:n.isUaConnect())?this.liveRoomHandler.login(this.room,r,r):(this.tryLoginTimer=setTimeout(function(){t.logger.info(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(l.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)},this.tryLoginInterval),this.logger.warn(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" ua is not connected"))}else{if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&(this.tryLoginCount>1&&h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(m.REPORT_ACTION.eventEnd,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(m.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(m.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),o)),this.service.createSocket(o),this.service.openHandler(function(){t.openHandler()}),this.service.closeHandler(function(i){t.logger.error(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(i.code?i.code:i)),t.service.closeSocket(),t.closeHandler(i)}),this.service.errorHandler(function(i){t.logger.error(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(i.code?i.code:i)),t.service.closeSocket(),t.closeHandler(i)})}catch(i){this.logger.error(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(i))}else this.logger.info(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(e,this.stateCenter.reportList)(m.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),r=function(i,s){t.handleLoginRsp(i,s)},this.service.login(this.room,r,r);this.tryLoginTimer=setTimeout(function(){t.logger.info(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(l.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)},this.tryLoginInterval),this.logger.info(_.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}}else this.logger.error("zb.rh.tl state error")},c.prototype.openHandler=function(){var o=this;this.logger.info(_.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var n=this.stateCenter.reportSeqList.login!==0?l.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;h.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)(m.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),h.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)(m.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var t=function(e,r){o.handleLoginRsp(e,r)};this.service.login(this.room,t,t)},c.prototype.handleLoginRsp=function(o,n){this.logger.info(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" seq: "+n+" "+JSON.stringify(o));var t=this.stateCenter.reportSeqList.login!==0?l.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(h.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(m.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===m.ENUM_RUN_STATE.trylogin)if(o.header&&o.body){if(o.header.seq!==n&&this.room.isMulti==0)return void this.logger.error(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",n+"",",recv=",o.header.seq);o.body.err_code!==0?(this.logger.error(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",o.body.err_code),this.handleLoginFail(o)):(this.logger.info(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(o))}else this.logger.error(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(o)),this.handleLoginFail(o);else this.logger.error(_.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},c.prototype.handleLoginFail=function(o){this.resetTryLogin();var n=l.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;o.header&&o.body?n=h.ClientUtil.getServerError(o.body.err_code):o.code&&o.msg&&(n=o),this.loginCallback.fail&&this.loginCallback.fail(n,!0)},c.prototype.handleLoginSuccess=function(o){var n,t={},e=this.room.lastRunState;this.setRunState(m.ENUM_RUN_STATE.login),this.stateCenter.userid=o.body.user_id,this.room.sessionID=o.body.session_id,this.room.roomSessionID=o.body.room_session_id,this.room.lvKey=o.body.lv_key;var r=(n=o==null?void 0:o.body)===null||n===void 0?void 0:n.token_remain_time;if(this.stateCenter.configRoomAuth=r>0,o.body.ret_timestamp&&["03","04"].includes(this.room.token.substring(0,2))){var i=new Date().getTime(),s=i-o.body.ret_timestamp;this.stateCenter.local_time_deviation=s<5e3?0:s;var u=r>0?1e3*r:1e3*h.ClientUtil.decodeTokenExpire(this.room.token.substring(2))-i;this.resetTokenTimer(u-this.stateCenter.local_time_deviation)}if(!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),!this.stateCenter.useNetAgent){if(o.body.config_info){var p=this.stateCenter.settingConfig.getSetting("remote_log_level",!0)||o.body.config_info.log_level;this.logger.setRemoteLogLevel(p),t.log_level=p,o.body.config_info.log_url==""||this.logger.url||(this.logger.setLogServer(o.body.config_info.log_url),t.log_url=o.body.config_info.log_url)}o.body.cluster_env&&o.body.cluster_env===1&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0))}var f=this.stateCenter.reportSeqList.login!==0?l.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:l.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;h.ClientUtil.actionSuccessCallback(f,this.stateCenter.reportList)&&h.ClientUtil.actionSuccessCallback(f,this.stateCenter.reportList)(m.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,l.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(e,o),this.loginCallback.success&&this.loginCallback.success(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},c.prototype.closeHandler=function(o){this.logger.error(_.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(o.code?o.code:o)),this.room.runState!==m.ENUM_RUN_STATE.logout?this.room.runState===m.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(o.code==1006?l.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:o)):this.room.runState===m.ENUM_RUN_STATE.login&&(this.logger.info(_.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(l.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(_.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},c.prototype.logout=function(o){this.logger.info(_.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==m.ENUM_RUN_STATE.logout?(this.resetRoom(o),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(_.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},c.prototype.handleLogoutRsp=function(o,n){var t;this.logger.info(_.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",o.body&&o.body.err_code?o.body.err_code:"-1"),this.stateCenter.useNetAgent&&n&&((t=this.liveRoomHandler)===null||t===void 0||t.closeRequest())},c}();T.RoomHandler=a},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.LiveRoomModules=void 0;var m=I(0),h=I(31),_=I(32),d=function(){function l(a,c,o,n,t){this.stateCenter=a,this.logger=c,this.dataReport=o,this.service=n,this.rtm=t,this.roomID="",this._dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=m.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=m.ENUM_RUN_STATE.logout,this.runRoomState=m.ENUM_RUN_STATE.logout,this.lastRunRoomState=m.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.initHandler(),this.heartBeatHandler=new h.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,void 0,this),this.userHandler=new _.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,void 0,this),this.initMessageHandler(),this.init()}return l.prototype.initMessageHandler=function(){},l.prototype.initHandler=function(){},l.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindMessageHandler(),this.bindLiveHandler()},l.prototype.bindSocketHandler=function(){var a=this;this.service.handlePushUserStateUpdateMsg=function(c){a.userHandler.handlePushUserStateUpdateMsg(c)}},l.prototype.bindHeatBeatHandler=function(){var a=this;this.heartBeatHandler.hbLogout=function(c){},this.heartBeatHandler.heartbeatRspNotiFy=function(c){a.HBResponse(c)}},l.prototype.bindHallHandler=function(){},l.prototype.bindUserHandler=function(){},l.prototype.bindMessageHandler=function(){},l.prototype.bindLiveHandler=function(){},l.prototype.bindRoomHandler=function(){},l.prototype.handleHbLogout=function(a){},l.prototype.HBResponse=function(a){this.stateCenter.actionListener("HBResponse",a)},l.prototype.roomLoginResponse=function(a){this.stateCenter.actionListener("roomLoginResponse",a)},l.prototype.isLogin=function(){return this.hallRunState===m.ENUM_RUN_STATE.login},l}();T.LiveRoomModules=d},function(W,T,I){"use strict";var m,h=this&&this.__extends||(m=function(a,c){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(o[t]=n[t])})(a,c)},function(a,c){function o(){this.constructor=a}m(a,c),a.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)});Object.defineProperty(T,"__esModule",{value:!0}),T.LiveRoomPrivateService=void 0;var _=I(34),d=I(0),l=function(a){function c(o,n,t){var e=a.call(this,o,n,t)||this;return e.stateCenter=o,e.logger=n,e.service=new _.ZegoSocketService(e.stateCenter.ENV),e.cmdSeq=0,e.responseRouters={},e}return h(c,a),c.prototype.checkResponse=function(o){return o.header.app_id!==this.stateCenter.appid||o.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==d.ENUM_RUN_STATE.login},c.prototype.handleHallKickout=function(o){},c.prototype.handlePushKickout=function(o){},c.prototype.handlePushCustomMsg=function(o){},c.prototype.handlePushRoomMsg=function(o){},c.prototype.handlePushUserStateUpdateMsg=function(o){},c.prototype.handlePushMergeMsg=function(o){},c.prototype.handlePushTransMsg=function(o){},c.prototype.handleBigImMsgRsp=function(o){},c.prototype.handlePushSignalMsg=function(o){},c.prototype.closeHandler=function(o){this.service.closeHandler(o)},c.prototype.openHandler=function(o){this.service.openHandler(o)},c.prototype.errorHandler=function(o){this.service.errorHandler(o)},c.prototype.getHeader=function(o){return{cmd:o,seq:++this.cmdSeq,timestamp:Math.ceil(new Date().getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},c.prototype.startCheck=function(){this.service.startCheck()},c.prototype.stopCheck=function(){this.service.stopCheck()},c.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},c.prototype.closeSocket=function(){this.service.closeSocket()},c.prototype.on=function(o,n){this.responseRouters[o]=n},c}(I(33).LiveRoomService);T.LiveRoomPrivateService=l},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ZegoSettingConfig=void 0;var m=function(){function h(){this.defaultSetting={remote_log_level:"info"},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return h.getInstance=function(){return h.instance||(h.instance=new h),h.instance},h.prototype.setSetting=function(_,d){var l=Array.isArray(d)&&d.length>0;for(var a in _)if(typeof _[a].ctrlmode=="number"&&[1,2].includes(_[a].ctrlmode))this.setting[a]=_[a],this.setting[a+"_ctrlmode"]=_[a].ctrlmode;else for(var c in _[a])if(!c.endsWith("_ctrlmode")){if(l&&d.indexOf(c)==-1)continue;var o=_[a][c+"_ctrlmode"];o===1||o===2?this.setting[c]=_[a][c]:this.defaultSetting[c]&&(this.setting[c]=this.defaultSetting[c]),typeof o=="number"&&(this.setting[c+"_ctrlmode"]=_[a][c+"_ctrlmode"])}},h.prototype.getSetting=function(_,d){return d===void 0&&(d=!1),d?this.setting[_+"_ctrlmode"]==2?this.setting[_]:void 0:this.setting[_]},h}();T.ZegoSettingConfig=m},function(W,T,I){"use strict";var m=this&&this.__assign||function(){return(m=Object.assign||function(O){for(var g,v=1,R=arguments.length;v<R;v++)for(var L in g=arguments[v])Object.prototype.hasOwnProperty.call(g,L)&&(O[L]=g[L]);return O}).apply(this,arguments)},h=this&&this.__spreadArrays||function(){for(var O=0,g=0,v=arguments.length;g<v;g++)O+=arguments[g].length;var R=Array(O),L=0;for(g=0;g<v;g++)for(var N=arguments[g],w=0,B=N.length;w<B;w++,L++)R[L]=N[w];return R},_=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(T,"__esModule",{value:!0}),T.LiveRoomHandler=T.LIVEROOM_STATE=void 0;var d,l=I(0),a=I(18),c=_(I(18)),o=I(18),n=I(2),t=I(88),e=I(1),r=I(27),i=I(93),s=_(I(12)),u=I(4),p=I(16),f=I(5),E=1001,y=1002,b=1003,S=1004;(function(O){O[O.disconnected=0]="disconnected",O[O.broken=1]="broken",O[O.connected=2]="connected"})(d=T.LIVEROOM_STATE||(T.LIVEROOM_STATE={}));var k=function(){function O(g,v,R,L){var N=this;this.logger=g,this.stateCenter=v,this.ua=R,this.rtm=L,this.seq=0,this.controls=new Uint8Array(1),this.flags=new Uint8Array(1),this.sendCommandList=new l.LinkedList,this.sendCommandMap={},this.isEncrypt=!1,this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.protoInstance=c.default,this.swPushCmdList=["/sw/push","/sw/merge_push","/sw/push_kickout","/sw/push_redirect"],this.onSwitchCmdList=["/lr/login_room_rsp","/lr/logout_room_rsp","/sw/push_kickout","/sw/push","/sw/merge_push"],this.unEncryptCmdList=["/lr/login_room","/lr/login_room_rsp"],this.whiteboardPushCmdList=["/edu/push/set_room","/edu/push/set_user","/edu/push/joinlive","/edu/push/set_mod","/edu/push/draw_graphics","/edu/push/clear_graphics","/edu/push/draw_page_graphics","/edu/push/clear_page_graphics","/edu/push/clear_user_graphic_list","/edu/push/qaa","/edu/push/set_user_auth","/edu/push/set_room_auth"],this.state=d.disconnected,this.unStructCmdList=["/lr/push/joinlive_request","/lr/push/joinlive_result","/lr/push/joinlive_invite","/lr/push/joinlive_stop"],this.joinLiveMap={"/lr/push/joinlive_request":11001,"/lr/push/joinlive_result":11002,"/lr/push/joinlive_invite":11003,"/lr/push/joinlive_stop":11004},this.reloginToken="",this.crypto=new t.Crypto,this.liveroomRequest=this.ua.getPCRequest(e.BusinessService.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=s.default.fromInt(0),this.liveroomRequest.on("connected",function(w){N.handleConnected(w)}),this.liveroomRequest.on("broken",function(){N.handleBroken()}),this.liveroomRequest.on("disconnected",function(w,B){N.handleDisconnected(w,B)}),this.liveroomRequest.on("downLoadMessage",function(w){N.handlePush(w)})}return Object.defineProperty(O.prototype,"nickName",{get:function(){return r.encodeString(this.stateCenter.nickName)},enumerable:!1,configurable:!0}),O.prototype.isDisConnect=function(){return this.state!==d.connected},O.prototype.getHeader=function(g){var v={cmd:g,seq:++this.seq,timestamp:new Date().getTime(),session_id:this.switchSessionID,controls:this.controls,flags:this.flags},R=a.proto_switch.Header.create(v),L=a.proto_switch.Header.encode(R).finish();return[v.seq,L]},O.prototype.isUaConnect=function(){return this.ua.isConnect()},O.prototype.sendMessage=function(g,v,R,L,N,w){var B,x=this;if(N===void 0&&(N={timeout:6e3}),w===void 0&&(w=!0),this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" call"),g!=="/lr/login_room"&&this.state!==d.connected)return this.logger.warn(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" state "+this.state),-1;var Z=this.getHeader(g),V=Z[1],Y=v;!this.unEncryptCmdList.includes(g)&&this.isEncrypt&&(Y=this.crypto.encrypt(v));var te=this.getHead(V.length,Y.length),F=new Uint8Array(Array.from(te).concat(Array.from(V)).concat(Array.from(Y)));if(w){var K={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:N.timeout,success:R,error:function(ae,ee){var se,de,ge;x.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" seq: "+ee+" "+JSON.stringify(ae)),((se=ae==null?void 0:ae.header)===null||se===void 0?void 0:se.cmd)!=="/lr/login_room_rsp"&&[1002,105].indexOf((de=ae==null?void 0:ae.body)===null||de===void 0?void 0:de.err_code)>-1?x.rtm.retryRoom():([207,208].indexOf((ge=ae==null?void 0:ae.body)===null||ge===void 0?void 0:ge.err_code),L&&L(ae,ee))}},J=this.sendCommandList.push(K);this.sendCommandMap[K.seq]=J}this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" seq: "+Z[0]+" cmd: "+g);var oe=g==="/lr/login_room";return(B=this.liveroomRequest)===null||B===void 0||B.sendRequest({payload:F,ack:oe},function(ae){x.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" fail")},function(){x.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDMESSAGE+" ack")}),Z[0]},O.prototype.getHead=function(g,v){var R=new Uint8Array(7);return R[0]=33,R[1]=g>>8,R[2]=g-(R[1]<<8),R.set(new Uint8Array(Int32Array.from([v]).buffer).reverse(),3),R},O.prototype.handlePush=function(g){if(g[0]===33){var v=(g[1]<<8)+g[2],R=a.proto_switch.Header.decode(g.slice(7,7+v)),L=g.slice(7+v),N=L;if(!this.unEncryptCmdList.includes(R.cmd)&&this.isEncrypt&&(N=this.crypto.decrypt(L)),!i.LiveroomProMap[R.cmd])return this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEPUSH+" cmd is not rtc"),void this.onSwitchMessage(R,N);var w=this.decodeResponseBody(R,N);if(this.swPushCmdList.includes(R.cmd))this.handleSwitchPush(R,w);else{this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEPUSH+" down "+JSON.stringify(this.transBuf(w)));var B={header:this.transHeader(R),body:this.transRsp(w)};this.handleSendCommandMsgRsp(B)}}},O.prototype.handleSwitchPush=function(g,v){if(g.cmd==="/sw/push"){var R=(Z=this.transRsp(v.head)).room_id;if(!this.stateCenter.roomModulesList.find(function(F){return F.roomID==R}))return void this.logger.warn(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLESWITCHPUSH+" room no found ignore ");var L=void 0,N={header:Z,body:L=this.unStructCmdList.includes(v.head.sub_cmd)?{signal_msg:r.decodeString(v.msg_body),sub_cmd:this.joinLiveMap[v.head.sub_cmd]}:v.head.sub_cmd==="/lr/push/signal_custom"?{custommsg:r.decodeString(v.msg_body)}:i.LiveroomProMap[v.head.sub_cmd]?this.transRsp(this.decode(o.liveroom_cs[i.LiveroomProMap[v.head.sub_cmd]],v.msg_body)):{}};if(this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLESWITCHPUSH+" push "+JSON.stringify(this.transBuf(N))),this.whiteboardPushCmdList.includes(v.head.sub_cmd))this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLESWITCHPUSH+" white "),this.onSwitchMessage(g,v);else switch(v.head.sub_cmd){case"/lr/push/user_updated":this.handlePushUserStateUpdateMsg(N);break;case"/lr/push/user_kickout":this.handlePushKickout(N,!1);break;case"/lr/push/trans":this.handlePushTransMsg(N);break;case"/lr/push/im_chat":this.handlePushRoomMsg(N);break;case"/lr/push/signal_custom":this.handlePushCustomMsg(N);break;case"/lr/push/stream_add":case"/lr/push/stream_delete":case"/lr/push/stream_update":this.handlePushStreamMsg(N);break;case"/lr/push/joinlive_request":case"/lr/push/joinlive_result":case"/lr/push/joinlive_invite":case"/lr/push/joinlive_stop":this.handlePushSignalMsg(N);break;case"/lr/push/user_token_expire":this.handlePushTokenExpire(N)}if(v.head.qos_flag==1){var w={code:0,message:"",sub_cmd:v.head.sub_cmd,msg_id:v.head.msg_id,server_send_time:v.head.send_time},B=a.proto_switch.PushRsp.create(w),x=a.proto_switch.PushRsp.encode(B).finish();this.sendMessage("/sw/push_rsp",x,void 0,void 0)}}else if(g.cmd==="/sw/merge_push"){var Z,V=(Z=this.transRsp(v.head)).room_id;if(!this.stateCenter.roomModulesList.find(function(F){return F.roomID==V}))return void this.logger.warn(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLESWITCHPUSH+" room no found ignore ");var Y=[];v.messages.forEach(function(F){var K;Y.push({sub_cmd:F.sub_cmd,sub_seq:F.sub_seq,msg_id:F.msg_id}),F.sub_cmd==="/lr/push/bigim_chat"&&(K=o.liveroom_cs.PushBigImChat.decode(F.msg_body),F.msg_body=K)});var te={header:(L=this.transRsp(v)).head,body:L};delete te.body.head,this.handlePushMergeMsg(te),v.head.qos_flag==1&&(w={messages:Y},B=a.proto_switch.CmdMergePushRsp.create(w),x=a.proto_switch.CmdMergePushRsp.encode(B).finish(),this.sendMessage("/sw/merge_push_rsp",x,void 0,void 0))}else g.cmd==="/sw/push_kickout"&&(L={reason:v.reason>900?v.reason-900:v.reason,msg:v.message,need_relogin:v.need_relogin!==void 0?v.need_relogin:0},this.handlePushKickout({header:g,body:L},!0))},O.prototype.handlePushTokenExpire=function(g){var v,R,L,N,w=(R=(v=g==null?void 0:g.body)===null||v===void 0?void 0:v.stop_stream)===null||R===void 0?void 0:R.stream_id_list.map(function(B){return r.decodeString(B)});(N=(L=g==null?void 0:g.body)===null||L===void 0?void 0:L.stop_stream)===null||N===void 0||(N.stream_id_list=w),this.stateCenter.actionListener("_tokenExpired",g)},O.prototype.handlePushKickout=function(g,v){var R,L;if(v)h(this.stateCenter.roomModulesList).forEach(function(B){B.roomHandler.handlePushKickout(g,!0,!0)});else{var N=(R=g==null?void 0:g.header)===null||R===void 0?void 0:R.room_id,w=this.stateCenter.roomModulesList.find(function(B){return B.roomID==N});if(this.longToStringNumber(g.body,["session_id"],"toString"),!w)return void this.logger.error(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_PUSHKICKOUT+" room no found ignore "+JSON.stringify((L=g.header)===null||L===void 0?void 0:L.room_id));w.roomHandler.handlePushKickout(g)}},O.prototype.handlePushStreamMsg=function(g){},O.prototype.handlePushSignalMsg=function(g){},O.prototype.handlePushMergeMsg=function(g){},O.prototype.handlePushCustomMsg=function(g){},O.prototype.handlePushRoomMsg=function(g){},O.prototype.handlePushTransMsg=function(g){},O.prototype.onSwitchMessage=function(g,v){},O.prototype.decodeResponseBody=function(g,v){var R=this.onSwitchCmdList.includes(g.cmd)?"proto_switch":"liveroom_cs";return this.decode(this.protoInstance[R][i.LiveroomProMap[g.cmd]],v)},O.prototype.handlePushUserStateUpdateMsg=function(g){var v,R=(v=g==null?void 0:g.header)===null||v===void 0?void 0:v.room_id,L=this.stateCenter.roomModulesList.find(function(w){return w.roomID==R});if(L){var N={body:{user_actions:g.body.user_list.map(function(w){return{Action:w.action,IdName:w.id_name,NickName:w.nick_name,Role:w.role,LoginTime:w.login_time.toString()}}),user_list_seq:g.body.server_user_seq.toNumber(),room_id:g.body.room_id}};L.userHandler.handlePushUserStateUpdateMsg(N)}else this.logger.error(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_PUSHUSERUPDATE+" room no found ignore "+JSON.stringify(g))},O.prototype.login=function(g,v,R){var L=this;this.state==d.disconnected&&(this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_LOGIN+" state disconnect"),this.closeRequest());var N=new Date().getTime()+"";if(g.isMulti){var w={req_head:this.getReqHead(g),switch_session_id:this.switchSessionID,nick_name:this.nickName,role:this.stateCenter.role,net_type:u.ClientUtil.getNetTypeNum(),config:{room_create_flag:this.stateCenter.roomCreateFlag,user_state_flag:this.stateCenter.userStateUpdate?1:0},lv_key:g.lvKey,third_token:r.encodeString(g.token),user_count_limit:g.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",conn_type:2,room_name:r.encodeString(g.roomName)},B=m(m({},w),{room_name:g.roomName,third_token:g.token});this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_LOGIN+" enter "+JSON.stringify(B));var x=o.liveroom_cs.EnterReq.create(w),Z=o.liveroom_cs.EnterReq.encode(x).finish();this.sendMessage("/lr/room/enter",Z,function(Y,te){L.longToStringNumber(Y.body,["user_session_id","room_session_id","ret_timestamp"],"toString"),L.transKeysName(Y.body,[["user_session_id","session_id"],["hb_interval","hearbeat_interval"]]),L.keysExist(Y.body,["token_remain_time","stream_seq"]),v&&v(Y,te)},function(Y,te){R&&R(Y,te)})}else{var V={app_id:this.stateCenter.appid,id_name:r.encodeString(this.stateCenter.idName),device_id:this.stateCenter.deviceID,term_type:this.stateCenter.ENV%2==0?l.TermType.TT_WEB:l.TermType.TT_MINIPROGRAM,net_type:u.ClientUtil.getNetTypeNum(),sdk_ver:parseInt(this.rtm.version.replace(/\./g,"")),proto_ver:p.PROTO_VER,nick_name:this.nickName,client_stamp:r.encodeString(N),crypt_version:p.CRYPT_VERSION,k1_sign:this.crypto.generateK1Sign(),relogin_token:this.switchSessionID.notEquals(s.default.fromInt(0))?r.encodeString(this.reloginToken):"",role:this.stateCenter.role,liveroom_session_id:s.default.fromString(g.roomSessionID),room_id:r.encodeString(g.roomID),room_name:r.encodeString(g.roomName),biz_type:p.BIZ_TYPE,room_create_flag:this.stateCenter.roomCreateFlag,user_state_flag:this.stateCenter.userStateUpdate?1:0,lv_key:g.lvKey,third_token:r.encodeString(g.token),user_count_limit:g.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",biz_version:this.stateCenter.bizVersion||"",login_logic:this.stateCenter.isMultiRoom?3:1,sdk_conn_type:p.SDK_CONN_TYPE};B=m(m({},V),{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,client_stamp:N,k1_sign:void 0,relogin_token:this.reloginToken,liveroom_session_id:g.roomSessionID,room_id:g.roomID,room_name:g.roomName,third_token:g.token}),this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_LOGIN+" login "+JSON.stringify(B)),this.k1SignLogoutBuffer=this.crypto.md5Bytes(V.k1_sign),x=a.proto_switch.LoginRoomReq.create(V),Z=a.proto_switch.LoginRoomReq.encode(x).finish(),this.sendMessage("/lr/login_room",Z,function(Y,te){L.switchSessionID=Y.header.session_id,L.reloginToken=Y.body.relogin_token,L.crypto.decryptK2Sign(Y.body.k2_sign),Y.body.crypt_option===1?L.isEncrypt=!1:Y.body.crypt_option===void 0&&(L.isEncrypt=!0),L.longToStringNumber(Y.body,["liveroom_session_id","room_session_id","ret_timestamp"],"toString"),delete Y.body.heartbeat_interval,delete Y.body.heartbeat_timeout,L.transKeysName(Y.body,[["liveroom_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"]]),L.keysExist(Y.body,["token_remain_time","stream_seq"]),v&&v(Y,te)},function(Y,te){R&&R(Y,te)})}},O.prototype.transKeysName=function(g,v){v.forEach(function(R){g[R[1]]=g[R[0]],delete g[R[0]]})},O.prototype.keysExist=function(g,v){v.forEach(function(R){g[R]===void 0&&(g[R]=0)})},O.prototype.longToStringNumber=function(g,v,R){v.forEach(function(L){s.default.isLong(g[L])&&(g[L]=g[L][R]())})},O.prototype.logout=function(g,v,R){if(g.isMulti){var L={req_head:this.getReqHead(g),switch_session_id:this.switchSessionID,nick_name:this.nickName,role:this.stateCenter.role,config_list:{room_create_flag:this.stateCenter.roomCreateFlag,user_state_flag:this.stateCenter.userStateUpdate?1:0}},N=this.transBuf(L);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_LOGOUT+" quit "+JSON.stringify(N));var w=o.liveroom_cs.QuitReq.create(L),B=o.liveroom_cs.QuitReq.encode(w).finish();return this.sendMessage("/lr/room/quit",B,v,R)}return L={logout_code:0,logout_check:this.crypto.md5Bytes(r.encodeString(g.token)),liveroom_session_id:s.default.fromString(g.sessionID),room_id:r.encodeString(g.roomID),role:this.stateCenter.role,nickname:this.nickName,logout_logic:this.stateCenter.isMultiRoom?3:1},N=this.transBuf(L),this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_LOGOUT+" logout "+JSON.stringify(N)),w=a.proto_switch.LogoutRoomReq.create(L),B=a.proto_switch.LogoutRoomReq.encode(w).finish(),this.sendMessage("/lr/logout_room",B,v,R)},O.prototype.checkSendMessageList=function(g){for(var v=g.getFirst();v!=null;)g.remove(v),v._data&&v._data.error&&setTimeout(function(){v&&v._data&&v._data.error&&v._data.error(n.errorCodeList.TIMEOUT,v._data.seq)},0),v=g.getFirst()},O.prototype.checkMessageListTimeout=function(g,v){for(var R=g.getFirst(),L=Date.parse(new Date+""),N=0,w=function(){if(R._data&&R._data.sendTime+R._data.timeout>L)return"break";if(R._data&&delete v[R._data.seq],g.remove(R),!(R._data&&R._data.error==null||R._data&&R._data.sendTime+B.sendDataDropTimeout<L)){var x=R&&R._data&&R._data.error,Z=R&&R._data&&R._data.seq;setTimeout(function(){x&&x(n.errorCodeList.TIMEOUT,Z)},0)}if(++N>=B.sendDataCheckOnceCount)return"break";R=g.getFirst()},B=this;R!=null&&w()!=="break";);},O.prototype.startCheck=function(){var g=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){g.startCheck()},this.sendDataCheckInterval)},O.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},O.prototype.handleSendCommandMsgRsp=function(g){var v=this,R=this.sendCommandMap[g.header.seq];if(R!=null){var L=R._data;delete this.sendCommandMap[g.header.seq],this.sendCommandList.remove(R),g.body.err_code===0?setTimeout(function(){L&&L.success!=null&&L.success(g,v.seq)},0):setTimeout(function(){L&&L.error!=null&&L.error(g,v.seq)},0)}},O.prototype.getReqHead=function(g){return{room_id:g.roomID,user_session_id:s.default.fromString(g.sessionID),room_session_id:s.default.fromString(g.roomSessionID)}},O.prototype.heartBeat=function(g,v,R){var L=this,N={req_head:this.getReqHead(R),role:this.stateCenter.role,lv_key:R.lvKey},w=o.liveroom_cs.HbReq.create(N),B=o.liveroom_cs.HbReq.encode(w).finish();this.sendMessage("/lr/room/hb",B,function(x){L.transKeysName(x.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"]]),x.body.server_user_seq=x.body.user_seq.toNumber(),L.longToStringNumber(x.body,["dati_time_window"],"toNumber"),g&&g(x)},v)},O.prototype.fetchUserList=function(g,v,R,L){var N=this,w=this.getReqHead(L),B=m({req_head:w},g),x=this.transBuf(B);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_FETCH_USER_LIST+" "+JSON.stringify(x));var Z=o.liveroom_cs.UserlistReq.create(B),V=o.liveroom_cs.UserlistReq.encode(Z).finish();return this.sendMessage("/lr/userlist/userlist",V,function(Y,te){N.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_FETCH_USER_LIST+" suc "+te),N.transKeysName(Y.body,[["user_basic_list","user_baseinfos"]]),N.longToStringNumber(Y.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),v&&v(Y,te)},R)},O.prototype.sendRoomMsg=function(g,v,R,L){var N=this,w={req_head:this.getReqHead(L),msg_category:g.msg_category,msg_priority:g.msg_priority,msg_type:g.msg_type,msg_content:r.encodeString(g.msg_content)},B=this.transBuf(w);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDROOMMSG+" "+JSON.stringify(B));var x=o.liveroom_cs.ImChatReq.create(w),Z=o.liveroom_cs.ImChatReq.encode(x).finish();return this.sendMessage("/lr/im/chat",Z,function(V){N.longToStringNumber(V.body,["msg_id"],"toNumber"),v&&v(V)},R)},O.prototype.sendReliableMessage=function(g,v,R,L){var N={req_head:this.getReqHead(L),role:this.stateCenter.role,nick_name:this.nickName,trans_type:r.encodeString(g.trans_type),trans_data:r.encodeString(g.trans_data),trans_local_seq:g.trans_local_seq,trans_channel:r.encodeString(g.trans_channel)},w=this.transBuf(N);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDRELIABLEMESSAGE+" "+JSON.stringify(w));var B=o.liveroom_cs.TransReq.create(N),x=o.liveroom_cs.TransReq.encode(B).finish();return this.sendMessage("/lr/trans/trans",x,v,R)},O.prototype.fetchReliableMessage=function(g,v,R,L){var N=this.getReqHead(L),w=g.fetch_array.map(function(Y){return{trans_type:r.encodeString(Y.trans_type),trans_local_seq:Y.trans_seq}}),B={req_head:N,trans_channel:r.encodeString(g.trans_channel),fetch_array:w},x=this.transBuf(B);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_FETCHRELIABLEMESSAGE+" "+JSON.stringify(x));var Z=o.liveroom_cs.TransFetchReq.create(B),V=o.liveroom_cs.TransFetchReq.encode(Z).finish();return this.sendMessage("/lr/trans/transfetch",V,v,R)},O.prototype.sendCustomCommand=function(g,v,R,L){var N=this,w=this.getReqHead(L),B=g.dest_id_name.map(function(te){return{id_name:r.encodeString(te)}}),x=m({req_head:w,dst_userlist:B,push_message:r.encodeString(g.custom_msg)},g),Z=this.transBuf(x);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDCUSTOMCOMMAND+" "+JSON.stringify(Z));var V=o.liveroom_cs.SignalLiveReq.create(x),Y=o.liveroom_cs.SignalLiveReq.encode(V).finish();return this.sendMessage("/lr/signal/livescustom",Y,function(te){v&&v(N.transRsp(te))},function(te){R&&R(N.transRspHead(te.rsp_head))})},O.prototype.sendBigRoomMessage=function(g,v,R,L){var N=this.getReqHead(L),w=g.msgs.map(function(Y){return{msg_category:Y.msg_category,msg_type:Y.msg_type,msg_timestamp:s.default.fromNumber(Date.now()),msg_content:r.encodeString(Y.msg_content),bigmsg_client_id:r.encodeString(Y.bigmsg_client_id)}}),B={req_head:N,nick_name:this.nickName,role:this.stateCenter.role,msgs:w},x=this.transBuf(B);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDBIGROOMMESSAGE+" "+JSON.stringify(x));var Z=o.liveroom_cs.BigimChatReq.create(B),V=o.liveroom_cs.BigimChatReq.encode(Z).finish();return this.sendMessage("/lr/bigim/chat",V,v,R)},O.prototype.sendRelayMessage=function(g,v,R,L){var N={req_head:this.getReqHead(L),nick_name:this.nickName,role:this.stateCenter.role,relay_type:r.encodeString(g.relay_type),relay_data:r.encodeString(g.relay_data)},w=o.liveroom_cs.RelayReq.create(N),B=o.liveroom_cs.RelayReq.encode(w).finish();return this.sendMessage("/lr/relay",B,v,R)},O.prototype.sendSignalCmd=function(g,v,R,L){var N="",w="";switch(g.sub_cmd){case b:N="/lr/signal/liveinvite",w="SignalLiveInviteReq";break;case E:N="/lr/signal/liverequest",w="SignalLiveReq";break;case y:N="/lr/signal/liverresult",w="SignalLiveResultReq";break;case S:N="/lr/signal/livestop",w="SignalLiveStopReq"}var B=this.getReqHead(L),x=g.dest_id_name.map(function(F){return{id_name:r.encodeString(F)}}),Z={req_head:B,push_message:r.encodeString(g.signal_msg),dst_userlist:x},V=this.transBuf(Z);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSIGNALCMD+" "+JSON.stringify(V));var Y=o.liveroom_cs[w].create(Z),te=o.liveroom_cs[w].encode(Y).finish();return o.liveroom_cs[w].decode(te),this.sendMessage(N,te,v,R)},O.prototype.sendStreamUpdate=function(g,v,R,L){var N,w=this;try{N=JSON.parse(g.stream_msg)}catch(K){}var B,x,Z="";this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSTREAMUPDATE+" "+JSON.stringify(g));var V=this.stateCenter.roomModulesList.find(function(K){return K.roomID==L.roomID});if(V){switch(g.sub_cmd){case 2001:Z="/lr/stream/add",B="StreamAddReq",x={req_head:this.getReqHead(V),stream_id:r.encodeString(N.stream_id),extra_info:r.encodeString(N.extra_info),client_req_seq:this.seq+1,login_mode:1,third_token:r.encodeString(g.third_token||"")};break;case 2002:Z="/lr/stream/delete",B="StreamDeleteReq",x={req_head:this.getReqHead(V),stream_id:r.encodeString(N.stream_id),stream_sid:N.stream_sid,client_req_seq:this.seq+1};break;case 2003:Z="/lr/stream/update",B="StreamUpdateReq",x={req_head:this.getReqHead(V),stream_id:r.encodeString(N.stream_id),stream_sid:N.stream_sid,client_req_seq:this.seq+1,extra_info:r.encodeString(N.extra_info)}}var Y=this.transBuf(x);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSTREAMUPDATE+" "+JSON.stringify(Y));var te=o.liveroom_cs[B].create(x),F=o.liveroom_cs[B].encode(te).finish();this.sendMessage(Z,F,function(K){w.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSTREAMUPDATE+" suc "+Z+" "+JSON.stringify(K)),K.header.room_id=V.roomID,v&&v(K)},function(K){w.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSTREAMUPDATE+" fail "+Z+" "+JSON.stringify(K)),R&&R(K)})}else this.logger.error(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_SENDSTREAMUPDATE+" room no found ignore ")},O.prototype.getStreamList=function(g,v,R,L){var N,w=this.stateCenter.roomModulesList.find(function(V){return V.roomID==L.roomID});if(w){N={req_head:this.getReqHead(w)};var B=this.transBuf(N);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_GETSTREAMLIST+" "+JSON.stringify(B));var x=o.liveroom_cs.StreamListReq.create(N),Z=o.liveroom_cs.StreamListReq.encode(x).finish();this.sendMessage("/lr/stream/list",Z,function(V){v&&v(V)},function(V){R&&R(V)})}else this.logger.error(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_GETSTREAMLIST+" room no found ignore "+L.roomID)},O.prototype.transBuf=function(g){var v=this,R={};return Object.keys(g).forEach(function(L){["logout_check","k2_sign","k1_sign"].includes(L)?R[L]=g[L]:v.transReqBytes(R,g,L)}),R},O.prototype.transReqBytes=function(g,v,R){var L=this;if(s.default.isLong(v[R]))g[R]=v[R].toString();else if(Object.prototype.toString.call(v[R])==="[object Object]")g[R]={},Object.keys(v[R]).forEach(function(B){return L.transReqBytes(g[R],v[R],B)});else if(Object.prototype.toString.call(v[R])==="[object Array]"&&Object.prototype.toString.call(v[R][0])==="[object Object]"){g[R]=[];for(var N=function(B){var x={};Object.keys(v[R][B]).forEach(function(Z){L.transReqBytes(x,v[R][B],Z)}),g[R].push(x)},w=0;w<v[R].length;w++)N(w)}else Object.prototype.toString.call(v[R])==="[object Uint8Array]"?g[R]=r.decodeString(v[R]):g[R]=v[R]},O.prototype.transHeader=function(g){return g.timestamp=s.default.isLong(g.timestamp)?g.timestamp.toString():g.timestamp,g},O.prototype.transRsp=function(g){var v=this,R=g&&g.rsp_head?this.transRspHead(g.rsp_head):{},L=m(m({},g),R);delete L.rsp_head;var N={};return Object.keys(L).forEach(function(w){w==="k2_sign"?N[w]=L[w]:v.transBytes(N,L,w)}),N},O.prototype.transBytes=function(g,v,R){var L=this;if(s.default.isLong(v[R]))g[R]=v[R];else if(Object.prototype.toString.call(v[R])==="[object Object]")g[R]={},Object.keys(v[R]).forEach(function(B){return L.transBytes(g[R],v[R],B)});else if(Object.prototype.toString.call(v[R])==="[object Array]"&&Object.prototype.toString.call(v[R][0])==="[object Object]"){g[R]=[];for(var N=function(B){var x={};Object.keys(v[R][B]).forEach(function(Z){L.transBytes(x,v[R][B],Z)}),g[R].push(x)},w=0;w<v[R].length;w++)N(w)}else Object.prototype.toString.call(v[R])==="[object Uint8Array]"?g[R]=r.decodeString(v[R]):g[R]=v[R]},O.prototype.transRspHead=function(g){return g?{err_code:g.code||0,err_message:g.message}:{}},O.prototype.decode=function(g,v){return m({},g.decode(v))},O.prototype.handleDisconnected=function(g,v){var R=this;this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEDISCONNECTED+" call"),this.state=d.disconnected,g===e.DisconnectedType.TIMEOUT&&this.stateCenter.roomModulesList.forEach(function(L){L.roomTryHandler&&(R.ua.isConnect()?(R.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEDISCONNECTED+" ua is connect"),L.roomTryHandler.active()):(R.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEDISCONNECTED+" ua is disconnect"),R.ua.connectUa()))})},O.prototype.handleBroken=function(){this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLEBROKEN+" call"),this.state=d.broken,this.stateCenter.roomModulesList.forEach(function(g){g.roomTryHandler&&(g.roomTryHandler.invalid(),g.roomTryHandler.onactive=function(v,R){g.roomHandler.disconnectedHandle(R)},g.roomTryHandler.startMaxTime(),g.roomHandler.roomStateHandle("CONNECTING",n.errorCodeList.NETWORK_BROKEN))})},O.prototype.handleConnected=function(g){var v=this;this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_HANDLECONNECTED+" call "+g),this.state=d.connected,g===e.ConnectedType.AUTO?this.stateCenter.roomModulesList.forEach(function(R){R.roomTryHandler&&v.ua.isConnect()&&R.roomTryHandler.active()}):this.stateCenter.roomModulesList.forEach(function(R){R.roomTryHandler&&(R.roomTryHandler.stopMaxTime(),R.roomTryHandler.invalid())})},O.prototype.renewToken=function(g,v,R,L){var N=this,w={req_head:this.getReqHead(L),token:g.token},B=o.liveroom_cs.RenewTokenReq.create(w),x=o.liveroom_cs.RenewTokenReq.encode(B).finish(),Z=this.transBuf(w);this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_RENEW_TOKEN+" "+JSON.stringify(Z)),this.sendMessage("/lr/token/renew_token",x,function(V,Y){N.keysExist(V.body,["token_remain_time"]),v&&v(V,Y)},R)},O.prototype.reset=function(){this.logger.info(f.ZEGO_RTM_ACTION.LIVEROOMHANDLER_RESET+" call "),this.state=d.disconnected,this.switchSessionID=s.default.fromInt(0),this.sendDataCheckTimer&&clearTimeout(this.sendDataCheckTimer)},O.prototype.closeRequest=function(){var g;(g=this.liveroomRequest)===null||g===void 0||g.closeRequest()},O.prototype.resetSessionInfo=function(){this.switchSessionID=s.default.fromInt(0)},O}();T.LiveRoomHandler=k},function(W,T,I){"use strict";var m=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(T,"__esModule",{value:!0}),T.Crypto=void 0;var h=I(89),_=m(I(20)),d=m(I(90)),l=m(I(23)),a=m(I(91)),c=m(I(21)),o=m(I(92)),n=function(){function t(){}return Object.defineProperty(t.prototype,"publicKey",{get:function(){return`-----BEGIN PUBLIC KEY-----
        MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxtEM51skf+Bg29Mdb+WN
        IkgbGDZ/wOP4MTntlut65WpPpXOkg2m9EKscmzfE6kUNLYnYV77fZGFSjr+Wkmoz
        VK1lJ3seswBNyP6X5LUszkf1WoeEyBbfegTf3XkHEeWJ5BlD9syurlA2Fh+cTaNO
        RNlAGBZO7SdgTHPYAcHu0fAnJZwCZ9+ZZkVnjyTBqQckovMttKqvtoUKcp7NgGve
        w0OJxFKwIITu1keGdZ+yN9wBul4qJfTy8otOcwGL4bnoABMhCNvJc3xA70BuaaF0
        fvhxA8diV/2W+qg+LAzdqajLaNciuDHIY5Y+z5kZI1eBa3J3aqUASse4YzzTYv48
        7wIDAQAB
        -----END PUBLIC KEY-----`},enumerable:!1,configurable:!0}),t.prototype.encrypt=function(e){var r=_.default.encrypt(this.uint8Array2WordArray(e),this.key2,{iv:this.iv2}).toString();return h.Base64.toUint8Array(r)},t.prototype.decrypt=function(e){return this.wordArray2Uint8Array(_.default.decrypt(h.Base64.fromUint8Array(e),this.key2,{iv:this.iv2}))},t.prototype.generateK1Sign=function(){var e=this.generateNonce();this.key1=l.default.parse(e),this.iv1=d.default.parse(c.default(e).toString().toLowerCase());var r=new o.default;r.setPublicKey(this.publicKey);var i=r.getKey().encrypt(e);return this.wordArray2Uint8Array(d.default.parse(i))},t.prototype.decryptK2Sign=function(e){try{this.key2=_.default.decrypt(h.Base64.fromUint8Array(e),this.key1,{iv:this.iv1}),this.iv2=c.default(this.key2)}catch(r){}},t.prototype.generateNonce=function(){var e=Math.random().toString().substr(2,16);return e.length<16&&(e+=e.substr(0,16-e.length)),e},t.prototype.md5=function(e){return c.default(e).toString()},t.prototype.md5Bytes=function(e){return this.wordArray2Uint8Array(c.default(this.uint8Array2WordArray(e)))},t.prototype.wordArray2Uint8Array=function(e){for(var r=e.words,i=e.sigBytes,s=new Uint8Array(i),u=0;u<i;u++){var p=r[u>>>2]>>>24-u%4*8&255;s[u]=p}return s},t.prototype.uint8Array2WordArray=function(e){for(var r=e.length,i=[],s=0;s<r;s++)i[s>>>2]|=(255&e[s])<<24-s%4*8;return a.default.create(i,r)},t}();T.Crypto=n},function(W,T,I){"use strict";I.r(T),I.d(T,"version",function(){return m}),I.d(T,"VERSION",function(){return h}),I.d(T,"atob",function(){return w}),I.d(T,"atobPolyfill",function(){return N}),I.d(T,"btoa",function(){return p}),I.d(T,"btoaPolyfill",function(){return u}),I.d(T,"fromBase64",function(){return Y}),I.d(T,"toBase64",function(){return O}),I.d(T,"utob",function(){return S}),I.d(T,"encode",function(){return O}),I.d(T,"encodeURI",function(){return g}),I.d(T,"encodeURL",function(){return g}),I.d(T,"btou",function(){return L}),I.d(T,"decode",function(){return Y}),I.d(T,"isValid",function(){return te}),I.d(T,"fromUint8Array",function(){return E}),I.d(T,"toUint8Array",function(){return x}),I.d(T,"extendString",function(){return K}),I.d(T,"extendUint8Array",function(){return J}),I.d(T,"extendBuiltins",function(){return oe}),I.d(T,"Base64",function(){return ae});const m="3.6.0",h=m,_=typeof atob=="function",d=typeof btoa=="function",l=typeof Buffer=="function",a=typeof TextDecoder=="function"?new TextDecoder:void 0,c=typeof TextEncoder=="function"?new TextEncoder:void 0,o=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],n=(ee=>{let se={};return ee.forEach((de,ge)=>se[de]=ge),se})(o),t=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,e=String.fromCharCode.bind(String),r=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(ee,se=de=>de)=>new Uint8Array(Array.prototype.slice.call(ee,0).map(se)),i=ee=>ee.replace(/[+\/]/g,se=>se=="+"?"-":"_").replace(/=+$/m,""),s=ee=>ee.replace(/[^A-Za-z0-9\+\/]/g,""),u=ee=>{let se,de,ge,me,le="";const Te=ee.length%3;for(let Re=0;Re<ee.length;){if((de=ee.charCodeAt(Re++))>255||(ge=ee.charCodeAt(Re++))>255||(me=ee.charCodeAt(Re++))>255)throw new TypeError("invalid character found");se=de<<16|ge<<8|me,le+=o[se>>18&63]+o[se>>12&63]+o[se>>6&63]+o[63&se]}return Te?le.slice(0,Te-3)+"===".substring(Te):le},p=d?ee=>btoa(ee):l?ee=>Buffer.from(ee,"binary").toString("base64"):u,f=l?ee=>Buffer.from(ee).toString("base64"):ee=>{let se=[];for(let de=0,ge=ee.length;de<ge;de+=4096)se.push(e.apply(null,ee.subarray(de,de+4096)));return p(se.join(""))},E=(ee,se=!1)=>se?i(f(ee)):f(ee),y=ee=>{if(ee.length<2)return(se=ee.charCodeAt(0))<128?ee:se<2048?e(192|se>>>6)+e(128|63&se):e(224|se>>>12&15)+e(128|se>>>6&63)+e(128|63&se);var se=65536+1024*(ee.charCodeAt(0)-55296)+(ee.charCodeAt(1)-56320);return e(240|se>>>18&7)+e(128|se>>>12&63)+e(128|se>>>6&63)+e(128|63&se)},b=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,S=ee=>ee.replace(b,y),k=l?ee=>Buffer.from(ee,"utf8").toString("base64"):c?ee=>f(c.encode(ee)):ee=>p(S(ee)),O=(ee,se=!1)=>se?i(k(ee)):k(ee),g=ee=>O(ee,!0),v=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,R=ee=>{switch(ee.length){case 4:var se=((7&ee.charCodeAt(0))<<18|(63&ee.charCodeAt(1))<<12|(63&ee.charCodeAt(2))<<6|63&ee.charCodeAt(3))-65536;return e(55296+(se>>>10))+e(56320+(1023&se));case 3:return e((15&ee.charCodeAt(0))<<12|(63&ee.charCodeAt(1))<<6|63&ee.charCodeAt(2));default:return e((31&ee.charCodeAt(0))<<6|63&ee.charCodeAt(1))}},L=ee=>ee.replace(v,R),N=ee=>{if(ee=ee.replace(/\s+/g,""),!t.test(ee))throw new TypeError("malformed base64.");ee+="==".slice(2-(3&ee.length));let se,de,ge,me="";for(let le=0;le<ee.length;)se=n[ee.charAt(le++)]<<18|n[ee.charAt(le++)]<<12|(de=n[ee.charAt(le++)])<<6|(ge=n[ee.charAt(le++)]),me+=de===64?e(se>>16&255):ge===64?e(se>>16&255,se>>8&255):e(se>>16&255,se>>8&255,255&se);return me},w=_?ee=>atob(s(ee)):l?ee=>Buffer.from(ee,"base64").toString("binary"):N,B=l?ee=>r(Buffer.from(ee,"base64")):ee=>r(w(ee),se=>se.charCodeAt(0)),x=ee=>B(V(ee)),Z=l?ee=>Buffer.from(ee,"base64").toString("utf8"):a?ee=>a.decode(B(ee)):ee=>L(w(ee)),V=ee=>s(ee.replace(/[-_]/g,se=>se=="-"?"+":"/")),Y=ee=>Z(V(ee)),te=ee=>{if(typeof ee!="string")return!1;const se=ee.replace(/\s+/g,"").replace(/=+$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(se)||!/[^\s0-9a-zA-Z\-_]/.test(se)},F=ee=>({value:ee,enumerable:!1,writable:!0,configurable:!0}),K=function(){const ee=(se,de)=>Object.defineProperty(String.prototype,se,F(de));ee("fromBase64",function(){return Y(this)}),ee("toBase64",function(se){return O(this,se)}),ee("toBase64URI",function(){return O(this,!0)}),ee("toBase64URL",function(){return O(this,!0)}),ee("toUint8Array",function(){return x(this)})},J=function(){const ee=(se,de)=>Object.defineProperty(Uint8Array.prototype,se,F(de));ee("toBase64",function(se){return E(this,se)}),ee("toBase64URI",function(){return E(this,!0)}),ee("toBase64URL",function(){return E(this,!0)})},oe=()=>{K(),J()},ae={version:m,VERSION:h,atob:w,atobPolyfill:N,btoa:p,btoaPolyfill:u,fromBase64:Y,toBase64:O,encode:O,encodeURI:g,encodeURL:g,utob:S,btou:L,decode:Y,isValid:te,fromUint8Array:E,toUint8Array:x,extendString:K,extendUint8Array:J,extendBuiltins:oe}},function(W,T,I){var m;W.exports=(m=I(3),m.enc.Hex)},function(W,T,I){var m;W.exports=(m=I(3),function(){if(typeof ArrayBuffer=="function"){var h=m.lib.WordArray,_=h.init;(h.init=function(d){if(d instanceof ArrayBuffer&&(d=new Uint8Array(d)),(d instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&d instanceof Uint8ClampedArray||d instanceof Int16Array||d instanceof Uint16Array||d instanceof Int32Array||d instanceof Uint32Array||d instanceof Float32Array||d instanceof Float64Array)&&(d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength)),d instanceof Uint8Array){for(var l=d.byteLength,a=[],c=0;c<l;c++)a[c>>>2]|=d[c]<<24-c%4*8;_.call(this,a,l)}else _.apply(this,arguments)}).prototype=h}}(),m.lib.WordArray)},function(W,T,I){"use strict";I.r(T);var m=[,(d,l,a)=>{function c(M){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(M)}function o(M,C){return M&C}function n(M,C){return M|C}function t(M,C){return M^C}function e(M,C){return M&~C}function r(M){if(M==0)return-1;var C=0;return(65535&M)==0&&(M>>=16,C+=16),(255&M)==0&&(M>>=8,C+=8),(15&M)==0&&(M>>=4,C+=4),(3&M)==0&&(M>>=2,C+=2),(1&M)==0&&++C,C}function i(M){for(var C=0;M!=0;)M&=M-1,++C;return C}a.d(l,{default:()=>X});var s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function p(M){var C,P,A="";for(C=0;C+3<=M.length;C+=3)P=parseInt(M.substring(C,C+3),16),A+=u.charAt(P>>6)+u.charAt(63&P);for(C+1==M.length?(P=parseInt(M.substring(C,C+1),16),A+=u.charAt(P<<2)):C+2==M.length&&(P=parseInt(M.substring(C,C+2),16),A+=u.charAt(P>>2)+u.charAt((3&P)<<4));(3&A.length)>0;)A+="=";return A}function f(M){var C,P="",A=0,D=0;for(C=0;C<M.length&&M.charAt(C)!="=";++C){var U=u.indexOf(M.charAt(C));U<0||(A==0?(P+=c(U>>2),D=3&U,A=1):A==1?(P+=c(D<<2|U>>4),D=15&U,A=2):A==2?(P+=c(D),P+=c(U>>2),D=3&U,A=3):(P+=c(D<<2|U>>4),P+=c(15&U),A=0))}return A==1&&(P+=c(D<<2)),P}var E,y={decode:function(M){var C;if(E===void 0){var P=`= \f
\r	\xA0\u2028\u2029`;for(E=Object.create(null),C=0;C<64;++C)E["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(C)]=C;for(E["-"]=62,E._=63,C=0;C<P.length;++C)E[P.charAt(C)]=-1}var A=[],D=0,U=0;for(C=0;C<M.length;++C){var H=M.charAt(C);if(H=="=")break;if((H=E[H])!=-1){if(H===void 0)throw new Error("Illegal character at offset "+C);D|=H,++U>=4?(A[A.length]=D>>16,A[A.length]=D>>8&255,A[A.length]=255&D,D=0,U=0):D<<=6}}switch(U){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:A[A.length]=D>>10;break;case 3:A[A.length]=D>>16,A[A.length]=D>>8&255}return A},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(M){var C=y.re.exec(M);if(C)if(C[1])M=C[1];else{if(!C[2])throw new Error("RegExp out of sync");M=C[2]}return y.decode(M)}},b=1e13,S=function(){function M(C){this.buf=[+C||0]}return M.prototype.mulAdd=function(C,P){var A,D,U=this.buf,H=U.length;for(A=0;A<H;++A)(D=U[A]*C+P)<b?P=0:D-=(P=0|D/b)*b,U[A]=D;P>0&&(U[A]=P)},M.prototype.sub=function(C){var P,A,D=this.buf,U=D.length;for(P=0;P<U;++P)(A=D[P]-C)<0?(A+=b,C=1):C=0,D[P]=A;for(;D[D.length-1]===0;)D.pop()},M.prototype.toString=function(C){if((C||10)!=10)throw new Error("only base 10 is supported");for(var P=this.buf,A=P[P.length-1].toString(),D=P.length-2;D>=0;--D)A+=(b+P[D]).toString().substring(1);return A},M.prototype.valueOf=function(){for(var C=this.buf,P=0,A=C.length-1;A>=0;--A)P=P*b+C[A];return P},M.prototype.simplify=function(){var C=this.buf;return C.length==1?C[0]:this},M}(),k=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,O=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function g(M,C){return M.length>C&&(M=M.substring(0,C)+"\u2026"),M}var v,R=function(){function M(C,P){this.hexDigits="0123456789ABCDEF",C instanceof M?(this.enc=C.enc,this.pos=C.pos):(this.enc=C,this.pos=P)}return M.prototype.get=function(C){if(C===void 0&&(C=this.pos++),C>=this.enc.length)throw new Error("Requesting byte offset "+C+" on a stream of length "+this.enc.length);return typeof this.enc=="string"?this.enc.charCodeAt(C):this.enc[C]},M.prototype.hexByte=function(C){return this.hexDigits.charAt(C>>4&15)+this.hexDigits.charAt(15&C)},M.prototype.hexDump=function(C,P,A){for(var D="",U=C;U<P;++U)if(D+=this.hexByte(this.get(U)),A!==!0)switch(15&U){case 7:D+="  ";break;case 15:D+=`
`;break;default:D+=" "}return D},M.prototype.isASCII=function(C,P){for(var A=C;A<P;++A){var D=this.get(A);if(D<32||D>176)return!1}return!0},M.prototype.parseStringISO=function(C,P){for(var A="",D=C;D<P;++D)A+=String.fromCharCode(this.get(D));return A},M.prototype.parseStringUTF=function(C,P){for(var A="",D=C;D<P;){var U=this.get(D++);A+=U<128?String.fromCharCode(U):U>191&&U<224?String.fromCharCode((31&U)<<6|63&this.get(D++)):String.fromCharCode((15&U)<<12|(63&this.get(D++))<<6|63&this.get(D++))}return A},M.prototype.parseStringBMP=function(C,P){for(var A,D,U="",H=C;H<P;)A=this.get(H++),D=this.get(H++),U+=String.fromCharCode(A<<8|D);return U},M.prototype.parseTime=function(C,P,A){var D=this.parseStringISO(C,P),U=(A?k:O).exec(D);return U?(A&&(U[1]=+U[1],U[1]+=+U[1]<70?2e3:1900),D=U[1]+"-"+U[2]+"-"+U[3]+" "+U[4],U[5]&&(D+=":"+U[5],U[6]&&(D+=":"+U[6],U[7]&&(D+="."+U[7]))),U[8]&&(D+=" UTC",U[8]!="Z"&&(D+=U[8],U[9]&&(D+=":"+U[9]))),D):"Unrecognized time: "+D},M.prototype.parseInteger=function(C,P){for(var A,D=this.get(C),U=D>127,H=U?255:0,j="";D==H&&++C<P;)D=this.get(C);if((A=P-C)==0)return U?-1:0;if(A>4){for(j=D,A<<=3;(128&(+j^H))==0;)j=+j<<1,--A;j="("+A+` bit)
`}U&&(D-=256);for(var Q=new S(D),ne=C+1;ne<P;++ne)Q.mulAdd(256,this.get(ne));return j+Q.toString()},M.prototype.parseBitString=function(C,P,A){for(var D=this.get(C),U="("+((P-C-1<<3)-D)+` bit)
`,H="",j=C+1;j<P;++j){for(var Q=this.get(j),ne=j==P-1?D:0,ie=7;ie>=ne;--ie)H+=Q>>ie&1?"1":"0";if(H.length>A)return U+g(H,A)}return U+H},M.prototype.parseOctetString=function(C,P,A){if(this.isASCII(C,P))return g(this.parseStringISO(C,P),A);var D=P-C,U="("+D+` byte)
`;D>(A/=2)&&(P=C+A);for(var H=C;H<P;++H)U+=this.hexByte(this.get(H));return D>A&&(U+="\u2026"),U},M.prototype.parseOID=function(C,P,A){for(var D="",U=new S,H=0,j=C;j<P;++j){var Q=this.get(j);if(U.mulAdd(128,127&Q),H+=7,!(128&Q)){if(D==="")if((U=U.simplify())instanceof S)U.sub(80),D="2."+U.toString();else{var ne=U<80?U<40?0:1:2;D=ne+"."+(U-40*ne)}else D+="."+U.toString();if(D.length>A)return g(D,A);U=new S,H=0}}return H>0&&(D+=".incomplete"),D},M}(),L=function(){function M(C,P,A,D,U){if(!(D instanceof N))throw new Error("Invalid tag value.");this.stream=C,this.header=P,this.length=A,this.tag=D,this.sub=U}return M.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},M.prototype.content=function(C){if(this.tag===void 0)return null;C===void 0&&(C=1/0);var P=this.posContent(),A=Math.abs(this.length);if(!this.tag.isUniversal())return this.sub!==null?"("+this.sub.length+" elem)":this.stream.parseOctetString(P,P+A,C);switch(this.tag.tagNumber){case 1:return this.stream.get(P)===0?"false":"true";case 2:return this.stream.parseInteger(P,P+A);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(P,P+A,C);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(P,P+A,C);case 6:return this.stream.parseOID(P,P+A,C);case 16:case 17:return this.sub!==null?"("+this.sub.length+" elem)":"(no elem)";case 12:return g(this.stream.parseStringUTF(P,P+A),C);case 18:case 19:case 20:case 21:case 22:case 26:return g(this.stream.parseStringISO(P,P+A),C);case 30:return g(this.stream.parseStringBMP(P,P+A),C);case 23:case 24:return this.stream.parseTime(P,P+A,this.tag.tagNumber==23)}return null},M.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(this.sub===null?"null":this.sub.length)+"]"},M.prototype.toPrettyString=function(C){C===void 0&&(C="");var P=C+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(P+="+"),P+=this.length,this.tag.tagConstructed?P+=" (constructed)":!this.tag.isUniversal()||this.tag.tagNumber!=3&&this.tag.tagNumber!=4||this.sub===null||(P+=" (encapsulates)"),P+=`
`,this.sub!==null){C+="  ";for(var A=0,D=this.sub.length;A<D;++A)P+=this.sub[A].toPrettyString(C)}return P},M.prototype.posStart=function(){return this.stream.pos},M.prototype.posContent=function(){return this.stream.pos+this.header},M.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},M.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},M.decodeLength=function(C){var P=C.get(),A=127&P;if(A==P)return A;if(A>6)throw new Error("Length over 48 bits not supported at position "+(C.pos-1));if(A===0)return null;P=0;for(var D=0;D<A;++D)P=256*P+C.get();return P},M.prototype.getHexStringValue=function(){var C=this.toHexString(),P=2*this.header,A=2*this.length;return C.substr(P,A)},M.decode=function(C){var P;P=C instanceof R?C:new R(C,0);var A=new R(P),D=new N(P),U=M.decodeLength(P),H=P.pos,j=H-A.pos,Q=null,ne=function(){var ce=[];if(U!==null){for(var ue=H+U;P.pos<ue;)ce[ce.length]=M.decode(P);if(P.pos!=ue)throw new Error("Content size is not correct for container starting at offset "+H)}else try{for(;;){var ye=M.decode(P);if(ye.tag.isEOC())break;ce[ce.length]=ye}U=H-P.pos}catch(Ee){throw new Error("Exception while decoding undefined length content: "+Ee)}return ce};if(D.tagConstructed)Q=ne();else if(D.isUniversal()&&(D.tagNumber==3||D.tagNumber==4))try{if(D.tagNumber==3&&P.get()!=0)throw new Error("BIT STRINGs with unused bits cannot encapsulate.");Q=ne();for(var ie=0;ie<Q.length;++ie)if(Q[ie].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(ce){Q=null}if(Q===null){if(U===null)throw new Error("We can't skip over an invalid tag with undefined length at offset "+H);P.pos=H+Math.abs(U)}return new M(A,j,U,D,Q)},M}(),N=function(){function M(C){var P=C.get();if(this.tagClass=P>>6,this.tagConstructed=(32&P)!=0,this.tagNumber=31&P,this.tagNumber==31){var A=new S;do P=C.get(),A.mulAdd(128,127&P);while(128&P);this.tagNumber=A.simplify()}}return M.prototype.isUniversal=function(){return this.tagClass===0},M.prototype.isEOC=function(){return this.tagClass===0&&this.tagNumber===0},M}(),w=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],B=(1<<26)/w[w.length-1],x=function(){function M(C,P,A){C!=null&&(typeof C=="number"?this.fromNumber(C,P,A):P==null&&typeof C!="string"?this.fromString(C,256):this.fromString(C,P))}return M.prototype.toString=function(C){if(this.s<0)return"-"+this.negate().toString(C);var P;if(C==16)P=4;else if(C==8)P=3;else if(C==2)P=1;else if(C==32)P=5;else{if(C!=4)return this.toRadix(C);P=2}var A,D=(1<<P)-1,U=!1,H="",j=this.t,Q=this.DB-j*this.DB%P;if(j-- >0)for(Q<this.DB&&(A=this[j]>>Q)>0&&(U=!0,H=c(A));j>=0;)Q<P?(A=(this[j]&(1<<Q)-1)<<P-Q,A|=this[--j]>>(Q+=this.DB-P)):(A=this[j]>>(Q-=P)&D,Q<=0&&(Q+=this.DB,--j)),A>0&&(U=!0),U&&(H+=c(A));return U?H:"0"},M.prototype.negate=function(){var C=F();return M.ZERO.subTo(this,C),C},M.prototype.abs=function(){return this.s<0?this.negate():this},M.prototype.compareTo=function(C){var P=this.s-C.s;if(P!=0)return P;var A=this.t;if((P=A-C.t)!=0)return this.s<0?-P:P;for(;--A>=0;)if((P=this[A]-C[A])!=0)return P;return 0},M.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+ge(this[this.t-1]^this.s&this.DM)},M.prototype.mod=function(C){var P=F();return this.abs().divRemTo(C,null,P),this.s<0&&P.compareTo(M.ZERO)>0&&C.subTo(P,P),P},M.prototype.modPowInt=function(C,P){var A;return A=C<256||P.isEven()?new V(P):new Y(P),this.exp(C,A)},M.prototype.clone=function(){var C=F();return this.copyTo(C),C},M.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},M.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},M.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},M.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},M.prototype.toByteArray=function(){var C=this.t,P=[];P[0]=this.s;var A,D=this.DB-C*this.DB%8,U=0;if(C-- >0)for(D<this.DB&&(A=this[C]>>D)!=(this.s&this.DM)>>D&&(P[U++]=A|this.s<<this.DB-D);C>=0;)D<8?(A=(this[C]&(1<<D)-1)<<8-D,A|=this[--C]>>(D+=this.DB-8)):(A=this[C]>>(D-=8)&255,D<=0&&(D+=this.DB,--C)),(128&A)!=0&&(A|=-256),U==0&&(128&this.s)!=(128&A)&&++U,(U>0||A!=this.s)&&(P[U++]=A);return P},M.prototype.equals=function(C){return this.compareTo(C)==0},M.prototype.min=function(C){return this.compareTo(C)<0?this:C},M.prototype.max=function(C){return this.compareTo(C)>0?this:C},M.prototype.and=function(C){var P=F();return this.bitwiseTo(C,o,P),P},M.prototype.or=function(C){var P=F();return this.bitwiseTo(C,n,P),P},M.prototype.xor=function(C){var P=F();return this.bitwiseTo(C,t,P),P},M.prototype.andNot=function(C){var P=F();return this.bitwiseTo(C,e,P),P},M.prototype.not=function(){for(var C=F(),P=0;P<this.t;++P)C[P]=this.DM&~this[P];return C.t=this.t,C.s=~this.s,C},M.prototype.shiftLeft=function(C){var P=F();return C<0?this.rShiftTo(-C,P):this.lShiftTo(C,P),P},M.prototype.shiftRight=function(C){var P=F();return C<0?this.lShiftTo(-C,P):this.rShiftTo(C,P),P},M.prototype.getLowestSetBit=function(){for(var C=0;C<this.t;++C)if(this[C]!=0)return C*this.DB+r(this[C]);return this.s<0?this.t*this.DB:-1},M.prototype.bitCount=function(){for(var C=0,P=this.s&this.DM,A=0;A<this.t;++A)C+=i(this[A]^P);return C},M.prototype.testBit=function(C){var P=Math.floor(C/this.DB);return P>=this.t?this.s!=0:(this[P]&1<<C%this.DB)!=0},M.prototype.setBit=function(C){return this.changeBit(C,n)},M.prototype.clearBit=function(C){return this.changeBit(C,e)},M.prototype.flipBit=function(C){return this.changeBit(C,t)},M.prototype.add=function(C){var P=F();return this.addTo(C,P),P},M.prototype.subtract=function(C){var P=F();return this.subTo(C,P),P},M.prototype.multiply=function(C){var P=F();return this.multiplyTo(C,P),P},M.prototype.divide=function(C){var P=F();return this.divRemTo(C,P,null),P},M.prototype.remainder=function(C){var P=F();return this.divRemTo(C,null,P),P},M.prototype.divideAndRemainder=function(C){var P=F(),A=F();return this.divRemTo(C,P,A),[P,A]},M.prototype.modPow=function(C,P){var A,D,U=C.bitLength(),H=de(1);if(U<=0)return H;A=U<18?1:U<48?3:U<144?4:U<768?5:6,D=U<8?new V(P):P.isEven()?new te(P):new Y(P);var j=[],Q=3,ne=A-1,ie=(1<<A)-1;if(j[1]=D.convert(this),A>1){var ce=F();for(D.sqrTo(j[1],ce);Q<=ie;)j[Q]=F(),D.mulTo(ce,j[Q-2],j[Q]),Q+=2}var ue,ye,Ee=C.t-1,ve=!0,be=F();for(U=ge(C[Ee])-1;Ee>=0;){for(U>=ne?ue=C[Ee]>>U-ne&ie:(ue=(C[Ee]&(1<<U+1)-1)<<ne-U,Ee>0&&(ue|=C[Ee-1]>>this.DB+U-ne)),Q=A;(1&ue)==0;)ue>>=1,--Q;if((U-=Q)<0&&(U+=this.DB,--Ee),ve)j[ue].copyTo(H),ve=!1;else{for(;Q>1;)D.sqrTo(H,be),D.sqrTo(be,H),Q-=2;Q>0?D.sqrTo(H,be):(ye=H,H=be,be=ye),D.mulTo(be,j[ue],H)}for(;Ee>=0&&(C[Ee]&1<<U)==0;)D.sqrTo(H,be),ye=H,H=be,be=ye,--U<0&&(U=this.DB-1,--Ee)}return D.revert(H)},M.prototype.modInverse=function(C){var P=C.isEven();if(this.isEven()&&P||C.signum()==0)return M.ZERO;for(var A=C.clone(),D=this.clone(),U=de(1),H=de(0),j=de(0),Q=de(1);A.signum()!=0;){for(;A.isEven();)A.rShiftTo(1,A),P?(U.isEven()&&H.isEven()||(U.addTo(this,U),H.subTo(C,H)),U.rShiftTo(1,U)):H.isEven()||H.subTo(C,H),H.rShiftTo(1,H);for(;D.isEven();)D.rShiftTo(1,D),P?(j.isEven()&&Q.isEven()||(j.addTo(this,j),Q.subTo(C,Q)),j.rShiftTo(1,j)):Q.isEven()||Q.subTo(C,Q),Q.rShiftTo(1,Q);A.compareTo(D)>=0?(A.subTo(D,A),P&&U.subTo(j,U),H.subTo(Q,H)):(D.subTo(A,D),P&&j.subTo(U,j),Q.subTo(H,Q))}return D.compareTo(M.ONE)!=0?M.ZERO:Q.compareTo(C)>=0?Q.subtract(C):Q.signum()<0?(Q.addTo(C,Q),Q.signum()<0?Q.add(C):Q):Q},M.prototype.pow=function(C){return this.exp(C,new Z)},M.prototype.gcd=function(C){var P=this.s<0?this.negate():this.clone(),A=C.s<0?C.negate():C.clone();if(P.compareTo(A)<0){var D=P;P=A,A=D}var U=P.getLowestSetBit(),H=A.getLowestSetBit();if(H<0)return P;for(U<H&&(H=U),H>0&&(P.rShiftTo(H,P),A.rShiftTo(H,A));P.signum()>0;)(U=P.getLowestSetBit())>0&&P.rShiftTo(U,P),(U=A.getLowestSetBit())>0&&A.rShiftTo(U,A),P.compareTo(A)>=0?(P.subTo(A,P),P.rShiftTo(1,P)):(A.subTo(P,A),A.rShiftTo(1,A));return H>0&&A.lShiftTo(H,A),A},M.prototype.isProbablePrime=function(C){var P,A=this.abs();if(A.t==1&&A[0]<=w[w.length-1]){for(P=0;P<w.length;++P)if(A[0]==w[P])return!0;return!1}if(A.isEven())return!1;for(P=1;P<w.length;){for(var D=w[P],U=P+1;U<w.length&&D<B;)D*=w[U++];for(D=A.modInt(D);P<U;)if(D%w[P++]==0)return!1}return A.millerRabin(C)},M.prototype.copyTo=function(C){for(var P=this.t-1;P>=0;--P)C[P]=this[P];C.t=this.t,C.s=this.s},M.prototype.fromInt=function(C){this.t=1,this.s=C<0?-1:0,C>0?this[0]=C:C<-1?this[0]=C+this.DV:this.t=0},M.prototype.fromString=function(C,P){var A;if(P==16)A=4;else if(P==8)A=3;else if(P==256)A=8;else if(P==2)A=1;else if(P==32)A=5;else{if(P!=4)return void this.fromRadix(C,P);A=2}this.t=0,this.s=0;for(var D=C.length,U=!1,H=0;--D>=0;){var j=A==8?255&+C[D]:se(C,D);j<0?C.charAt(D)=="-"&&(U=!0):(U=!1,H==0?this[this.t++]=j:H+A>this.DB?(this[this.t-1]|=(j&(1<<this.DB-H)-1)<<H,this[this.t++]=j>>this.DB-H):this[this.t-1]|=j<<H,(H+=A)>=this.DB&&(H-=this.DB))}A==8&&(128&+C[0])!=0&&(this.s=-1,H>0&&(this[this.t-1]|=(1<<this.DB-H)-1<<H)),this.clamp(),U&&M.ZERO.subTo(this,this)},M.prototype.clamp=function(){for(var C=this.s&this.DM;this.t>0&&this[this.t-1]==C;)--this.t},M.prototype.dlShiftTo=function(C,P){var A;for(A=this.t-1;A>=0;--A)P[A+C]=this[A];for(A=C-1;A>=0;--A)P[A]=0;P.t=this.t+C,P.s=this.s},M.prototype.drShiftTo=function(C,P){for(var A=C;A<this.t;++A)P[A-C]=this[A];P.t=Math.max(this.t-C,0),P.s=this.s},M.prototype.lShiftTo=function(C,P){for(var A=C%this.DB,D=this.DB-A,U=(1<<D)-1,H=Math.floor(C/this.DB),j=this.s<<A&this.DM,Q=this.t-1;Q>=0;--Q)P[Q+H+1]=this[Q]>>D|j,j=(this[Q]&U)<<A;for(Q=H-1;Q>=0;--Q)P[Q]=0;P[H]=j,P.t=this.t+H+1,P.s=this.s,P.clamp()},M.prototype.rShiftTo=function(C,P){P.s=this.s;var A=Math.floor(C/this.DB);if(A>=this.t)P.t=0;else{var D=C%this.DB,U=this.DB-D,H=(1<<D)-1;P[0]=this[A]>>D;for(var j=A+1;j<this.t;++j)P[j-A-1]|=(this[j]&H)<<U,P[j-A]=this[j]>>D;D>0&&(P[this.t-A-1]|=(this.s&H)<<U),P.t=this.t-A,P.clamp()}},M.prototype.subTo=function(C,P){for(var A=0,D=0,U=Math.min(C.t,this.t);A<U;)D+=this[A]-C[A],P[A++]=D&this.DM,D>>=this.DB;if(C.t<this.t){for(D-=C.s;A<this.t;)D+=this[A],P[A++]=D&this.DM,D>>=this.DB;D+=this.s}else{for(D+=this.s;A<C.t;)D-=C[A],P[A++]=D&this.DM,D>>=this.DB;D-=C.s}P.s=D<0?-1:0,D<-1?P[A++]=this.DV+D:D>0&&(P[A++]=D),P.t=A,P.clamp()},M.prototype.multiplyTo=function(C,P){var A=this.abs(),D=C.abs(),U=A.t;for(P.t=U+D.t;--U>=0;)P[U]=0;for(U=0;U<D.t;++U)P[U+A.t]=A.am(0,D[U],P,U,0,A.t);P.s=0,P.clamp(),this.s!=C.s&&M.ZERO.subTo(P,P)},M.prototype.squareTo=function(C){for(var P=this.abs(),A=C.t=2*P.t;--A>=0;)C[A]=0;for(A=0;A<P.t-1;++A){var D=P.am(A,P[A],C,2*A,0,1);(C[A+P.t]+=P.am(A+1,2*P[A],C,2*A+1,D,P.t-A-1))>=P.DV&&(C[A+P.t]-=P.DV,C[A+P.t+1]=1)}C.t>0&&(C[C.t-1]+=P.am(A,P[A],C,2*A,0,1)),C.s=0,C.clamp()},M.prototype.divRemTo=function(C,P,A){var D=C.abs();if(!(D.t<=0)){var U=this.abs();if(U.t<D.t)return P!=null&&P.fromInt(0),void(A!=null&&this.copyTo(A));A==null&&(A=F());var H=F(),j=this.s,Q=C.s,ne=this.DB-ge(D[D.t-1]);ne>0?(D.lShiftTo(ne,H),U.lShiftTo(ne,A)):(D.copyTo(H),U.copyTo(A));var ie=H.t,ce=H[ie-1];if(ce!=0){var ue=ce*(1<<this.F1)+(ie>1?H[ie-2]>>this.F2:0),ye=this.FV/ue,Ee=(1<<this.F1)/ue,ve=1<<this.F2,be=A.t,Le=be-ie,Ce=P==null?F():P;for(H.dlShiftTo(Le,Ce),A.compareTo(Ce)>=0&&(A[A.t++]=1,A.subTo(Ce,A)),M.ONE.dlShiftTo(ie,Ce),Ce.subTo(H,H);H.t<ie;)H[H.t++]=0;for(;--Le>=0;){var Ie=A[--be]==ce?this.DM:Math.floor(A[be]*ye+(A[be-1]+ve)*Ee);if((A[be]+=H.am(0,Ie,A,Le,0,ie))<Ie)for(H.dlShiftTo(Le,Ce),A.subTo(Ce,A);A[be]<--Ie;)A.subTo(Ce,A)}P!=null&&(A.drShiftTo(ie,P),j!=Q&&M.ZERO.subTo(P,P)),A.t=ie,A.clamp(),ne>0&&A.rShiftTo(ne,A),j<0&&M.ZERO.subTo(A,A)}}},M.prototype.invDigit=function(){if(this.t<1)return 0;var C=this[0];if((1&C)==0)return 0;var P=3&C;return(P=(P=(P=(P=P*(2-(15&C)*P)&15)*(2-(255&C)*P)&255)*(2-((65535&C)*P&65535))&65535)*(2-C*P%this.DV)%this.DV)>0?this.DV-P:-P},M.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},M.prototype.exp=function(C,P){if(C>4294967295||C<1)return M.ONE;var A=F(),D=F(),U=P.convert(this),H=ge(C)-1;for(U.copyTo(A);--H>=0;)if(P.sqrTo(A,D),(C&1<<H)>0)P.mulTo(D,U,A);else{var j=A;A=D,D=j}return P.revert(A)},M.prototype.chunkSize=function(C){return Math.floor(Math.LN2*this.DB/Math.log(C))},M.prototype.toRadix=function(C){if(C==null&&(C=10),this.signum()==0||C<2||C>36)return"0";var P=this.chunkSize(C),A=Math.pow(C,P),D=de(A),U=F(),H=F(),j="";for(this.divRemTo(D,U,H);U.signum()>0;)j=(A+H.intValue()).toString(C).substr(1)+j,U.divRemTo(D,U,H);return H.intValue().toString(C)+j},M.prototype.fromRadix=function(C,P){this.fromInt(0),P==null&&(P=10);for(var A=this.chunkSize(P),D=Math.pow(P,A),U=!1,H=0,j=0,Q=0;Q<C.length;++Q){var ne=se(C,Q);ne<0?C.charAt(Q)=="-"&&this.signum()==0&&(U=!0):(j=P*j+ne,++H>=A&&(this.dMultiply(D),this.dAddOffset(j,0),H=0,j=0))}H>0&&(this.dMultiply(Math.pow(P,H)),this.dAddOffset(j,0)),U&&M.ZERO.subTo(this,this)},M.prototype.fromNumber=function(C,P,A){if(typeof P=="number")if(C<2)this.fromInt(1);else for(this.fromNumber(C,A),this.testBit(C-1)||this.bitwiseTo(M.ONE.shiftLeft(C-1),n,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(P);)this.dAddOffset(2,0),this.bitLength()>C&&this.subTo(M.ONE.shiftLeft(C-1),this);else{var D=[],U=7&C;D.length=1+(C>>3),P.nextBytes(D),U>0?D[0]&=(1<<U)-1:D[0]=0,this.fromString(D,256)}},M.prototype.bitwiseTo=function(C,P,A){var D,U,H=Math.min(C.t,this.t);for(D=0;D<H;++D)A[D]=P(this[D],C[D]);if(C.t<this.t){for(U=C.s&this.DM,D=H;D<this.t;++D)A[D]=P(this[D],U);A.t=this.t}else{for(U=this.s&this.DM,D=H;D<C.t;++D)A[D]=P(U,C[D]);A.t=C.t}A.s=P(this.s,C.s),A.clamp()},M.prototype.changeBit=function(C,P){var A=M.ONE.shiftLeft(C);return this.bitwiseTo(A,P,A),A},M.prototype.addTo=function(C,P){for(var A=0,D=0,U=Math.min(C.t,this.t);A<U;)D+=this[A]+C[A],P[A++]=D&this.DM,D>>=this.DB;if(C.t<this.t){for(D+=C.s;A<this.t;)D+=this[A],P[A++]=D&this.DM,D>>=this.DB;D+=this.s}else{for(D+=this.s;A<C.t;)D+=C[A],P[A++]=D&this.DM,D>>=this.DB;D+=C.s}P.s=D<0?-1:0,D>0?P[A++]=D:D<-1&&(P[A++]=this.DV+D),P.t=A,P.clamp()},M.prototype.dMultiply=function(C){this[this.t]=this.am(0,C-1,this,0,0,this.t),++this.t,this.clamp()},M.prototype.dAddOffset=function(C,P){if(C!=0){for(;this.t<=P;)this[this.t++]=0;for(this[P]+=C;this[P]>=this.DV;)this[P]-=this.DV,++P>=this.t&&(this[this.t++]=0),++this[P]}},M.prototype.multiplyLowerTo=function(C,P,A){var D=Math.min(this.t+C.t,P);for(A.s=0,A.t=D;D>0;)A[--D]=0;for(var U=A.t-this.t;D<U;++D)A[D+this.t]=this.am(0,C[D],A,D,0,this.t);for(U=Math.min(C.t,P);D<U;++D)this.am(0,C[D],A,D,0,P-D);A.clamp()},M.prototype.multiplyUpperTo=function(C,P,A){--P;var D=A.t=this.t+C.t-P;for(A.s=0;--D>=0;)A[D]=0;for(D=Math.max(P-this.t,0);D<C.t;++D)A[this.t+D-P]=this.am(P-D,C[D],A,0,0,this.t+D-P);A.clamp(),A.drShiftTo(1,A)},M.prototype.modInt=function(C){if(C<=0)return 0;var P=this.DV%C,A=this.s<0?C-1:0;if(this.t>0)if(P==0)A=this[0]%C;else for(var D=this.t-1;D>=0;--D)A=(P*A+this[D])%C;return A},M.prototype.millerRabin=function(C){var P=this.subtract(M.ONE),A=P.getLowestSetBit();if(A<=0)return!1;var D=P.shiftRight(A);(C=C+1>>1)>w.length&&(C=w.length);for(var U=F(),H=0;H<C;++H){U.fromInt(w[Math.floor(Math.random()*w.length)]);var j=U.modPow(D,this);if(j.compareTo(M.ONE)!=0&&j.compareTo(P)!=0){for(var Q=1;Q++<A&&j.compareTo(P)!=0;)if((j=j.modPowInt(2,this)).compareTo(M.ONE)==0)return!1;if(j.compareTo(P)!=0)return!1}}return!0},M.prototype.square=function(){var C=F();return this.squareTo(C),C},M.prototype.gcda=function(C,P){var A=this.s<0?this.negate():this.clone(),D=C.s<0?C.negate():C.clone();if(A.compareTo(D)<0){var U=A;A=D,D=U}var H=A.getLowestSetBit(),j=D.getLowestSetBit();if(j<0)P(A);else{H<j&&(j=H),j>0&&(A.rShiftTo(j,A),D.rShiftTo(j,D));var Q=function(){(H=A.getLowestSetBit())>0&&A.rShiftTo(H,A),(H=D.getLowestSetBit())>0&&D.rShiftTo(H,D),A.compareTo(D)>=0?(A.subTo(D,A),A.rShiftTo(1,A)):(D.subTo(A,D),D.rShiftTo(1,D)),A.signum()>0?setTimeout(Q,0):(j>0&&D.lShiftTo(j,D),setTimeout(function(){P(D)},0))};setTimeout(Q,10)}},M.prototype.fromNumberAsync=function(C,P,A,D){if(typeof P=="number")if(C<2)this.fromInt(1);else{this.fromNumber(C,A),this.testBit(C-1)||this.bitwiseTo(M.ONE.shiftLeft(C-1),n,this),this.isEven()&&this.dAddOffset(1,0);var U=this,H=function(){U.dAddOffset(2,0),U.bitLength()>C&&U.subTo(M.ONE.shiftLeft(C-1),U),U.isProbablePrime(P)?setTimeout(function(){D()},0):setTimeout(H,0)};setTimeout(H,0)}else{var j=[],Q=7&C;j.length=1+(C>>3),P.nextBytes(j),Q>0?j[0]&=(1<<Q)-1:j[0]=0,this.fromString(j,256)}},M}(),Z=function(){function M(){}return M.prototype.convert=function(C){return C},M.prototype.revert=function(C){return C},M.prototype.mulTo=function(C,P,A){C.multiplyTo(P,A)},M.prototype.sqrTo=function(C,P){C.squareTo(P)},M}(),V=function(){function M(C){this.m=C}return M.prototype.convert=function(C){return C.s<0||C.compareTo(this.m)>=0?C.mod(this.m):C},M.prototype.revert=function(C){return C},M.prototype.reduce=function(C){C.divRemTo(this.m,null,C)},M.prototype.mulTo=function(C,P,A){C.multiplyTo(P,A),this.reduce(A)},M.prototype.sqrTo=function(C,P){C.squareTo(P),this.reduce(P)},M}(),Y=function(){function M(C){this.m=C,this.mp=C.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<C.DB-15)-1,this.mt2=2*C.t}return M.prototype.convert=function(C){var P=F();return C.abs().dlShiftTo(this.m.t,P),P.divRemTo(this.m,null,P),C.s<0&&P.compareTo(x.ZERO)>0&&this.m.subTo(P,P),P},M.prototype.revert=function(C){var P=F();return C.copyTo(P),this.reduce(P),P},M.prototype.reduce=function(C){for(;C.t<=this.mt2;)C[C.t++]=0;for(var P=0;P<this.m.t;++P){var A=32767&C[P],D=A*this.mpl+((A*this.mph+(C[P]>>15)*this.mpl&this.um)<<15)&C.DM;for(C[A=P+this.m.t]+=this.m.am(0,D,C,P,0,this.m.t);C[A]>=C.DV;)C[A]-=C.DV,C[++A]++}C.clamp(),C.drShiftTo(this.m.t,C),C.compareTo(this.m)>=0&&C.subTo(this.m,C)},M.prototype.mulTo=function(C,P,A){C.multiplyTo(P,A),this.reduce(A)},M.prototype.sqrTo=function(C,P){C.squareTo(P),this.reduce(P)},M}(),te=function(){function M(C){this.m=C,this.r2=F(),this.q3=F(),x.ONE.dlShiftTo(2*C.t,this.r2),this.mu=this.r2.divide(C)}return M.prototype.convert=function(C){if(C.s<0||C.t>2*this.m.t)return C.mod(this.m);if(C.compareTo(this.m)<0)return C;var P=F();return C.copyTo(P),this.reduce(P),P},M.prototype.revert=function(C){return C},M.prototype.reduce=function(C){for(C.drShiftTo(this.m.t-1,this.r2),C.t>this.m.t+1&&(C.t=this.m.t+1,C.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);C.compareTo(this.r2)<0;)C.dAddOffset(1,this.m.t+1);for(C.subTo(this.r2,C);C.compareTo(this.m)>=0;)C.subTo(this.m,C)},M.prototype.mulTo=function(C,P,A){C.multiplyTo(P,A),this.reduce(A)},M.prototype.sqrTo=function(C,P){C.squareTo(P),this.reduce(P)},M}();function F(){return new x(null)}function K(M,C){return new x(M,C)}var J=typeof navigator!="undefined";J&&navigator.appName=="Microsoft Internet Explorer"?(x.prototype.am=function(M,C,P,A,D,U){for(var H=32767&C,j=C>>15;--U>=0;){var Q=32767&this[M],ne=this[M++]>>15,ie=j*Q+ne*H;D=((Q=H*Q+((32767&ie)<<15)+P[A]+(1073741823&D))>>>30)+(ie>>>15)+j*ne+(D>>>30),P[A++]=1073741823&Q}return D},v=30):J&&navigator.appName!="Netscape"?(x.prototype.am=function(M,C,P,A,D,U){for(;--U>=0;){var H=C*this[M++]+P[A]+D;D=Math.floor(H/67108864),P[A++]=67108863&H}return D},v=26):(x.prototype.am=function(M,C,P,A,D,U){for(var H=16383&C,j=C>>14;--U>=0;){var Q=16383&this[M],ne=this[M++]>>14,ie=j*Q+ne*H;D=((Q=H*Q+((16383&ie)<<14)+P[A]+D)>>28)+(ie>>14)+j*ne,P[A++]=268435455&Q}return D},v=28),x.prototype.DB=v,x.prototype.DM=(1<<v)-1,x.prototype.DV=1<<v,x.prototype.FV=Math.pow(2,52),x.prototype.F1=52-v,x.prototype.F2=2*v-52;var oe,ae,ee=[];for(oe="0".charCodeAt(0),ae=0;ae<=9;++ae)ee[oe++]=ae;for(oe="a".charCodeAt(0),ae=10;ae<36;++ae)ee[oe++]=ae;for(oe="A".charCodeAt(0),ae=10;ae<36;++ae)ee[oe++]=ae;function se(M,C){var P=ee[M.charCodeAt(C)];return P==null?-1:P}function de(M){var C=F();return C.fromInt(M),C}function ge(M){var C,P=1;return(C=M>>>16)!=0&&(M=C,P+=16),(C=M>>8)!=0&&(M=C,P+=8),(C=M>>4)!=0&&(M=C,P+=4),(C=M>>2)!=0&&(M=C,P+=2),(C=M>>1)!=0&&(M=C,P+=1),P}x.ZERO=de(0),x.ONE=de(1);var me,le,Te=function(){function M(){this.i=0,this.j=0,this.S=[]}return M.prototype.init=function(C){var P,A,D;for(P=0;P<256;++P)this.S[P]=P;for(A=0,P=0;P<256;++P)A=A+this.S[P]+C[P%C.length]&255,D=this.S[P],this.S[P]=this.S[A],this.S[A]=D;this.i=0,this.j=0},M.prototype.next=function(){var C;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,C=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=C,this.S[C+this.S[this.i]&255]},M}(),Re=null;if(Re==null){Re=[],le=0;var pe=void 0;if(typeof window!="undefined"&&window.crypto&&window.crypto.getRandomValues){var ke=new Uint32Array(256);for(window.crypto.getRandomValues(ke),pe=0;pe<ke.length;++pe)Re[le++]=255&ke[pe]}}function $(){if(me==null){for(me=new Te;le<256;){var M=Math.floor(65536*Math.random());Re[le++]=255&M}for(me.init(Re),le=0;le<Re.length;++le)Re[le]=0;le=0}return me.next()}var Se=function(){function M(){}return M.prototype.nextBytes=function(C){for(var P=0;P<C.length;++P)C[P]=$()},M}(),Oe=function(){function M(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return M.prototype.doPublic=function(C){return C.modPowInt(this.e,this.n)},M.prototype.doPrivate=function(C){if(this.p==null||this.q==null)return C.modPow(this.d,this.n);for(var P=C.mod(this.p).modPow(this.dmp1,this.p),A=C.mod(this.q).modPow(this.dmq1,this.q);P.compareTo(A)<0;)P=P.add(this.p);return P.subtract(A).multiply(this.coeff).mod(this.p).multiply(this.q).add(A)},M.prototype.setPublic=function(C,P){C!=null&&P!=null&&C.length>0&&P.length>0?(this.n=K(C,16),this.e=parseInt(P,16)):console.error("Invalid RSA public key")},M.prototype.encrypt=function(C){var P=this.n.bitLength()+7>>3,A=function(Q,ne){if(ne<Q.length+11)return console.error("Message too long for RSA"),null;for(var ie=[],ce=Q.length-1;ce>=0&&ne>0;){var ue=Q.charCodeAt(ce--);ue<128?ie[--ne]=ue:ue>127&&ue<2048?(ie[--ne]=63&ue|128,ie[--ne]=ue>>6|192):(ie[--ne]=63&ue|128,ie[--ne]=ue>>6&63|128,ie[--ne]=ue>>12|224)}ie[--ne]=0;for(var ye=new Se,Ee=[];ne>2;){for(Ee[0]=0;Ee[0]==0;)ye.nextBytes(Ee);ie[--ne]=Ee[0]}return ie[--ne]=2,ie[--ne]=0,new x(ie)}(C,P);if(A==null)return null;var D=this.doPublic(A);if(D==null)return null;for(var U=D.toString(16),H=U.length,j=0;j<2*P-H;j++)U="0"+U;return U},M.prototype.setPrivate=function(C,P,A){C!=null&&P!=null&&C.length>0&&P.length>0?(this.n=K(C,16),this.e=parseInt(P,16),this.d=K(A,16)):console.error("Invalid RSA private key")},M.prototype.setPrivateEx=function(C,P,A,D,U,H,j,Q){C!=null&&P!=null&&C.length>0&&P.length>0?(this.n=K(C,16),this.e=parseInt(P,16),this.d=K(A,16),this.p=K(D,16),this.q=K(U,16),this.dmp1=K(H,16),this.dmq1=K(j,16),this.coeff=K(Q,16)):console.error("Invalid RSA private key")},M.prototype.generate=function(C,P){var A=new Se,D=C>>1;this.e=parseInt(P,16);for(var U=new x(P,16);;){for(;this.p=new x(C-D,1,A),this.p.subtract(x.ONE).gcd(U).compareTo(x.ONE)!=0||!this.p.isProbablePrime(10););for(;this.q=new x(D,1,A),this.q.subtract(x.ONE).gcd(U).compareTo(x.ONE)!=0||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var H=this.p;this.p=this.q,this.q=H}var j=this.p.subtract(x.ONE),Q=this.q.subtract(x.ONE),ne=j.multiply(Q);if(ne.gcd(U).compareTo(x.ONE)==0){this.n=this.p.multiply(this.q),this.d=U.modInverse(ne),this.dmp1=this.d.mod(j),this.dmq1=this.d.mod(Q),this.coeff=this.q.modInverse(this.p);break}}},M.prototype.decrypt=function(C){var P=K(C,16),A=this.doPrivate(P);return A==null?null:function(D,U){for(var H=D.toByteArray(),j=0;j<H.length&&H[j]==0;)++j;if(H.length-j!=U-1||H[j]!=2)return null;for(++j;H[j]!=0;)if(++j>=H.length)return null;for(var Q="";++j<H.length;){var ne=255&H[j];ne<128?Q+=String.fromCharCode(ne):ne>191&&ne<224?(Q+=String.fromCharCode((31&ne)<<6|63&H[j+1]),++j):(Q+=String.fromCharCode((15&ne)<<12|(63&H[j+1])<<6|63&H[j+2]),j+=2)}return Q}(A,this.n.bitLength()+7>>3)},M.prototype.generateAsync=function(C,P,A){var D=new Se,U=C>>1;this.e=parseInt(P,16);var H=new x(P,16),j=this,Q=function(){var ne=function(){if(j.p.compareTo(j.q)<=0){var ue=j.p;j.p=j.q,j.q=ue}var ye=j.p.subtract(x.ONE),Ee=j.q.subtract(x.ONE),ve=ye.multiply(Ee);ve.gcd(H).compareTo(x.ONE)==0?(j.n=j.p.multiply(j.q),j.d=H.modInverse(ve),j.dmp1=j.d.mod(ye),j.dmq1=j.d.mod(Ee),j.coeff=j.q.modInverse(j.p),setTimeout(function(){A()},0)):setTimeout(Q,0)},ie=function(){j.q=F(),j.q.fromNumberAsync(U,1,D,function(){j.q.subtract(x.ONE).gcda(H,function(ue){ue.compareTo(x.ONE)==0&&j.q.isProbablePrime(10)?setTimeout(ne,0):setTimeout(ie,0)})})},ce=function(){j.p=F(),j.p.fromNumberAsync(C-U,1,D,function(){j.p.subtract(x.ONE).gcda(H,function(ue){ue.compareTo(x.ONE)==0&&j.p.isProbablePrime(10)?setTimeout(ie,0):setTimeout(ce,0)})})};setTimeout(ce,0)};setTimeout(Q,0)},M.prototype.sign=function(C,P,A){var D=function(j,Q){if(Q<j.length+22)return console.error("Message too long for RSA"),null;for(var ne=Q-j.length-6,ie="",ce=0;ce<ne;ce+=2)ie+="ff";return K("0001"+ie+"00"+j,16)}((_e[A]||"")+P(C).toString(),this.n.bitLength()/4);if(D==null)return null;var U=this.doPrivate(D);if(U==null)return null;var H=U.toString(16);return(1&H.length)==0?H:"0"+H},M.prototype.verify=function(C,P,A){var D=K(P,16),U=this.doPublic(D);return U==null?null:function(H){for(var j in _e)if(_e.hasOwnProperty(j)){var Q=_e[j],ne=Q.length;if(H.substr(0,ne)==Q)return H.substr(ne)}return H}(U.toString(16).replace(/^1f+00/,""))==A(C).toString()},M}(),_e={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"},fe={};fe.lang={extend:function(M,C,P){if(!C||!M)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var A=function(){};if(A.prototype=C.prototype,M.prototype=new A,M.prototype.constructor=M,M.superclass=C.prototype,C.prototype.constructor==Object.prototype.constructor&&(C.prototype.constructor=C),P){var D;for(D in P)M.prototype[D]=P[D];var U=function(){},H=["toString","valueOf"];try{typeof navigator!="undefined"&&/MSIE/.test(navigator.userAgent)&&(U=function(j,Q){for(D=0;D<H.length;D+=1){var ne=H[D],ie=Q[ne];typeof ie=="function"&&ie!=Object.prototype[ne]&&(j[ne]=ie)}})}catch(j){}U(M.prototype,P)}}};var re={};re.asn1!==void 0&&re.asn1||(re.asn1={}),re.asn1.ASN1Util=new function(){this.integerToByteHex=function(M){var C=M.toString(16);return C.length%2==1&&(C="0"+C),C},this.bigIntToMinTwosComplementsHex=function(M){var C=M.toString(16);if(C.substr(0,1)!="-")C.length%2==1?C="0"+C:C.match(/^[0-7]/)||(C="00"+C);else{var P=C.substr(1).length;P%2==1?P+=1:C.match(/^[0-7]/)||(P+=2);for(var A="",D=0;D<P;D++)A+="f";C=new x(A,16).xor(M).add(x.ONE).toString(16).replace(/^-/,"")}return C},this.getPEMStringFromHex=function(M,C){return hextopem(M,C)},this.newObject=function(M){var C=re.asn1,P=C.DERBoolean,A=C.DERInteger,D=C.DERBitString,U=C.DEROctetString,H=C.DERNull,j=C.DERObjectIdentifier,Q=C.DEREnumerated,ne=C.DERUTF8String,ie=C.DERNumericString,ce=C.DERPrintableString,ue=C.DERTeletexString,ye=C.DERIA5String,Ee=C.DERUTCTime,ve=C.DERGeneralizedTime,be=C.DERSequence,Le=C.DERSet,Ce=C.DERTaggedObject,Ie=C.ASN1Util.newObject,Ae=Object.keys(M);if(Ae.length!=1)throw"key of param shall be only one.";var he=Ae[0];if(":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+he+":")==-1)throw"undefined key: "+he;if(he=="bool")return new P(M[he]);if(he=="int")return new A(M[he]);if(he=="bitstr")return new D(M[he]);if(he=="octstr")return new U(M[he]);if(he=="null")return new H(M[he]);if(he=="oid")return new j(M[he]);if(he=="enum")return new Q(M[he]);if(he=="utf8str")return new ne(M[he]);if(he=="numstr")return new ie(M[he]);if(he=="prnstr")return new ce(M[he]);if(he=="telstr")return new ue(M[he]);if(he=="ia5str")return new ye(M[he]);if(he=="utctime")return new Ee(M[he]);if(he=="gentime")return new ve(M[he]);if(he=="seq"){for(var Me=M[he],we=[],Ne=0;Ne<Me.length;Ne++){var Ue=Ie(Me[Ne]);we.push(Ue)}return new be({array:we})}if(he=="set"){for(Me=M[he],we=[],Ne=0;Ne<Me.length;Ne++)Ue=Ie(Me[Ne]),we.push(Ue);return new Le({array:we})}if(he=="tag"){var Pe=M[he];if(Object.prototype.toString.call(Pe)==="[object Array]"&&Pe.length==3){var Be=Ie(Pe[2]);return new Ce({tag:Pe[0],explicit:Pe[1],obj:Be})}var De={};if(Pe.explicit!==void 0&&(De.explicit=Pe.explicit),Pe.tag!==void 0&&(De.tag=Pe.tag),Pe.obj===void 0)throw"obj shall be specified for 'tag'.";return De.obj=Ie(Pe.obj),new Ce(De)}},this.jsonToASN1HEX=function(M){return this.newObject(M).getEncodedHex()}},re.asn1.ASN1Util.oidHexToInt=function(M){for(var C="",P=parseInt(M.substr(0,2),16),A=(C=Math.floor(P/40)+"."+P%40,""),D=2;D<M.length;D+=2){var U=("00000000"+parseInt(M.substr(D,2),16).toString(2)).slice(-8);A+=U.substr(1,7),U.substr(0,1)=="0"&&(C=C+"."+new x(A,2).toString(10),A="")}return C},re.asn1.ASN1Util.oidIntToHex=function(M){var C=function(j){var Q=j.toString(16);return Q.length==1&&(Q="0"+Q),Q},P=function(j){var Q="",ne=new x(j,10).toString(2),ie=7-ne.length%7;ie==7&&(ie=0);for(var ce="",ue=0;ue<ie;ue++)ce+="0";for(ne=ce+ne,ue=0;ue<ne.length-1;ue+=7){var ye=ne.substr(ue,7);ue!=ne.length-7&&(ye="1"+ye),Q+=C(parseInt(ye,2))}return Q};if(!M.match(/^[0-9.]+$/))throw"malformed oid string: "+M;var A="",D=M.split("."),U=40*parseInt(D[0])+parseInt(D[1]);A+=C(U),D.splice(0,2);for(var H=0;H<D.length;H++)A+=P(D[H]);return A},re.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var M=this.hV.length/2,C=M.toString(16);if(C.length%2==1&&(C="0"+C),M<128)return C;var P=C.length/2;if(P>15)throw"ASN.1 length too long to represent by 8x: n = "+M.toString(16);return(128+P).toString(16)+C},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},re.asn1.DERAbstractString=function(M){re.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(C){this.hTLV=null,this.isModified=!0,this.s=C,this.hV=stohex(this.s)},this.setStringHex=function(C){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=C},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(typeof M=="string"?this.setString(M):M.str!==void 0?this.setString(M.str):M.hex!==void 0&&this.setStringHex(M.hex))},fe.lang.extend(re.asn1.DERAbstractString,re.asn1.ASN1Object),re.asn1.DERAbstractTime=function(M){re.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(C){return utc=C.getTime()+6e4*C.getTimezoneOffset(),new Date(utc)},this.formatDate=function(C,P,A){var D=this.zeroPadding,U=this.localDateToUTC(C),H=String(U.getFullYear());P=="utc"&&(H=H.substr(2,2));var j=H+D(String(U.getMonth()+1),2)+D(String(U.getDate()),2)+D(String(U.getHours()),2)+D(String(U.getMinutes()),2)+D(String(U.getSeconds()),2);if(A===!0){var Q=U.getMilliseconds();if(Q!=0){var ne=D(String(Q),3);j=j+"."+(ne=ne.replace(/[0]+$/,""))}}return j+"Z"},this.zeroPadding=function(C,P){return C.length>=P?C:new Array(P-C.length+1).join("0")+C},this.getString=function(){return this.s},this.setString=function(C){this.hTLV=null,this.isModified=!0,this.s=C,this.hV=stohex(C)},this.setByDateValue=function(C,P,A,D,U,H){var j=new Date(Date.UTC(C,P-1,A,D,U,H,0));this.setByDate(j)},this.getFreshValueHex=function(){return this.hV}},fe.lang.extend(re.asn1.DERAbstractTime,re.asn1.ASN1Object),re.asn1.DERAbstractStructured=function(M){re.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(C){this.hTLV=null,this.isModified=!0,this.asn1Array=C},this.appendASN1Object=function(C){this.hTLV=null,this.isModified=!0,this.asn1Array.push(C)},this.asn1Array=new Array,M!==void 0&&M.array!==void 0&&(this.asn1Array=M.array)},fe.lang.extend(re.asn1.DERAbstractStructured,re.asn1.ASN1Object),re.asn1.DERBoolean=function(){re.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},fe.lang.extend(re.asn1.DERBoolean,re.asn1.ASN1Object),re.asn1.DERInteger=function(M){re.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(C){this.hTLV=null,this.isModified=!0,this.hV=re.asn1.ASN1Util.bigIntToMinTwosComplementsHex(C)},this.setByInteger=function(C){var P=new x(String(C),10);this.setByBigInteger(P)},this.setValueHex=function(C){this.hV=C},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(M.bigint!==void 0?this.setByBigInteger(M.bigint):M.int!==void 0?this.setByInteger(M.int):typeof M=="number"?this.setByInteger(M):M.hex!==void 0&&this.setValueHex(M.hex))},fe.lang.extend(re.asn1.DERInteger,re.asn1.ASN1Object),re.asn1.DERBitString=function(M){if(M!==void 0&&M.obj!==void 0){var C=re.asn1.ASN1Util.newObject(M.obj);M.hex="00"+C.getEncodedHex()}re.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(P){this.hTLV=null,this.isModified=!0,this.hV=P},this.setUnusedBitsAndHexValue=function(P,A){if(P<0||7<P)throw"unused bits shall be from 0 to 7: u = "+P;var D="0"+P;this.hTLV=null,this.isModified=!0,this.hV=D+A},this.setByBinaryString=function(P){var A=8-(P=P.replace(/0+$/,"")).length%8;A==8&&(A=0);for(var D=0;D<=A;D++)P+="0";var U="";for(D=0;D<P.length-1;D+=8){var H=P.substr(D,8),j=parseInt(H,2).toString(16);j.length==1&&(j="0"+j),U+=j}this.hTLV=null,this.isModified=!0,this.hV="0"+A+U},this.setByBooleanArray=function(P){for(var A="",D=0;D<P.length;D++)P[D]==1?A+="1":A+="0";this.setByBinaryString(A)},this.newFalseArray=function(P){for(var A=new Array(P),D=0;D<P;D++)A[D]=!1;return A},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(typeof M=="string"&&M.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(M):M.hex!==void 0?this.setHexValueIncludingUnusedBits(M.hex):M.bin!==void 0?this.setByBinaryString(M.bin):M.array!==void 0&&this.setByBooleanArray(M.array))},fe.lang.extend(re.asn1.DERBitString,re.asn1.ASN1Object),re.asn1.DEROctetString=function(M){if(M!==void 0&&M.obj!==void 0){var C=re.asn1.ASN1Util.newObject(M.obj);M.hex=C.getEncodedHex()}re.asn1.DEROctetString.superclass.constructor.call(this,M),this.hT="04"},fe.lang.extend(re.asn1.DEROctetString,re.asn1.DERAbstractString),re.asn1.DERNull=function(){re.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},fe.lang.extend(re.asn1.DERNull,re.asn1.ASN1Object),re.asn1.DERObjectIdentifier=function(M){var C=function(A){var D=A.toString(16);return D.length==1&&(D="0"+D),D},P=function(A){var D="",U=new x(A,10).toString(2),H=7-U.length%7;H==7&&(H=0);for(var j="",Q=0;Q<H;Q++)j+="0";for(U=j+U,Q=0;Q<U.length-1;Q+=7){var ne=U.substr(Q,7);Q!=U.length-7&&(ne="1"+ne),D+=C(parseInt(ne,2))}return D};re.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(A){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=A},this.setValueOidString=function(A){if(!A.match(/^[0-9.]+$/))throw"malformed oid string: "+A;var D="",U=A.split("."),H=40*parseInt(U[0])+parseInt(U[1]);D+=C(H),U.splice(0,2);for(var j=0;j<U.length;j++)D+=P(U[j]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=D},this.setValueName=function(A){var D=re.asn1.x509.OID.name2oid(A);if(D==="")throw"DERObjectIdentifier oidName undefined: "+A;this.setValueOidString(D)},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(typeof M=="string"?M.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(M):this.setValueName(M):M.oid!==void 0?this.setValueOidString(M.oid):M.hex!==void 0?this.setValueHex(M.hex):M.name!==void 0&&this.setValueName(M.name))},fe.lang.extend(re.asn1.DERObjectIdentifier,re.asn1.ASN1Object),re.asn1.DEREnumerated=function(M){re.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(C){this.hTLV=null,this.isModified=!0,this.hV=re.asn1.ASN1Util.bigIntToMinTwosComplementsHex(C)},this.setByInteger=function(C){var P=new x(String(C),10);this.setByBigInteger(P)},this.setValueHex=function(C){this.hV=C},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(M.int!==void 0?this.setByInteger(M.int):typeof M=="number"?this.setByInteger(M):M.hex!==void 0&&this.setValueHex(M.hex))},fe.lang.extend(re.asn1.DEREnumerated,re.asn1.ASN1Object),re.asn1.DERUTF8String=function(M){re.asn1.DERUTF8String.superclass.constructor.call(this,M),this.hT="0c"},fe.lang.extend(re.asn1.DERUTF8String,re.asn1.DERAbstractString),re.asn1.DERNumericString=function(M){re.asn1.DERNumericString.superclass.constructor.call(this,M),this.hT="12"},fe.lang.extend(re.asn1.DERNumericString,re.asn1.DERAbstractString),re.asn1.DERPrintableString=function(M){re.asn1.DERPrintableString.superclass.constructor.call(this,M),this.hT="13"},fe.lang.extend(re.asn1.DERPrintableString,re.asn1.DERAbstractString),re.asn1.DERTeletexString=function(M){re.asn1.DERTeletexString.superclass.constructor.call(this,M),this.hT="14"},fe.lang.extend(re.asn1.DERTeletexString,re.asn1.DERAbstractString),re.asn1.DERIA5String=function(M){re.asn1.DERIA5String.superclass.constructor.call(this,M),this.hT="16"},fe.lang.extend(re.asn1.DERIA5String,re.asn1.DERAbstractString),re.asn1.DERUTCTime=function(M){re.asn1.DERUTCTime.superclass.constructor.call(this,M),this.hT="17",this.setByDate=function(C){this.hTLV=null,this.isModified=!0,this.date=C,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},M!==void 0&&(M.str!==void 0?this.setString(M.str):typeof M=="string"&&M.match(/^[0-9]{12}Z$/)?this.setString(M):M.hex!==void 0?this.setStringHex(M.hex):M.date!==void 0&&this.setByDate(M.date))},fe.lang.extend(re.asn1.DERUTCTime,re.asn1.DERAbstractTime),re.asn1.DERGeneralizedTime=function(M){re.asn1.DERGeneralizedTime.superclass.constructor.call(this,M),this.hT="18",this.withMillis=!1,this.setByDate=function(C){this.hTLV=null,this.isModified=!0,this.date=C,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},M!==void 0&&(M.str!==void 0?this.setString(M.str):typeof M=="string"&&M.match(/^[0-9]{14}Z$/)?this.setString(M):M.hex!==void 0?this.setStringHex(M.hex):M.date!==void 0&&this.setByDate(M.date),M.millis===!0&&(this.withMillis=!0))},fe.lang.extend(re.asn1.DERGeneralizedTime,re.asn1.DERAbstractTime),re.asn1.DERSequence=function(M){re.asn1.DERSequence.superclass.constructor.call(this,M),this.hT="30",this.getFreshValueHex=function(){for(var C="",P=0;P<this.asn1Array.length;P++)C+=this.asn1Array[P].getEncodedHex();return this.hV=C,this.hV}},fe.lang.extend(re.asn1.DERSequence,re.asn1.DERAbstractStructured),re.asn1.DERSet=function(M){re.asn1.DERSet.superclass.constructor.call(this,M),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var C=new Array,P=0;P<this.asn1Array.length;P++){var A=this.asn1Array[P];C.push(A.getEncodedHex())}return this.sortFlag==1&&C.sort(),this.hV=C.join(""),this.hV},M!==void 0&&M.sortflag!==void 0&&M.sortflag==0&&(this.sortFlag=!1)},fe.lang.extend(re.asn1.DERSet,re.asn1.DERAbstractStructured),re.asn1.DERTaggedObject=function(M){re.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(C,P,A){this.hT=P,this.isExplicit=C,this.asn1Object=A,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=A.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,P),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},M!==void 0&&(M.tag!==void 0&&(this.hT=M.tag),M.explicit!==void 0&&(this.isExplicit=M.explicit),M.obj!==void 0&&(this.asn1Object=M.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},fe.lang.extend(re.asn1.DERTaggedObject,re.asn1.ASN1Object);var G,q=(G=function(M,C){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,A){P.__proto__=A}||function(P,A){for(var D in A)Object.prototype.hasOwnProperty.call(A,D)&&(P[D]=A[D])})(M,C)},function(M,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function P(){this.constructor=M}G(M,C),M.prototype=C===null?Object.create(C):(P.prototype=C.prototype,new P)}),z=function(M){function C(P){var A=M.call(this)||this;return P&&(typeof P=="string"?A.parseKey(P):(C.hasPrivateKeyProperty(P)||C.hasPublicKeyProperty(P))&&A.parsePropertiesFrom(P)),A}return q(C,M),C.prototype.parseKey=function(P){try{var A=0,D=0,U=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(P)?function(Ee){var ve;if(s===void 0){var be="0123456789ABCDEF",Le=` \f
\r	\xA0\u2028\u2029`;for(s={},ve=0;ve<16;++ve)s[be.charAt(ve)]=ve;for(be=be.toLowerCase(),ve=10;ve<16;++ve)s[be.charAt(ve)]=ve;for(ve=0;ve<Le.length;++ve)s[Le.charAt(ve)]=-1}var Ce=[],Ie=0,Ae=0;for(ve=0;ve<Ee.length;++ve){var he=Ee.charAt(ve);if(he=="=")break;if((he=s[he])!=-1){if(he===void 0)throw new Error("Illegal character at offset "+ve);Ie|=he,++Ae>=2?(Ce[Ce.length]=Ie,Ie=0,Ae=0):Ie<<=4}}if(Ae)throw new Error("Hex encoding incomplete: 4 bits missing");return Ce}(P):y.unarmor(P),H=L.decode(U);if(H.sub.length===3&&(H=H.sub[2].sub[0]),H.sub.length===9){A=H.sub[1].getHexStringValue(),this.n=K(A,16),D=H.sub[2].getHexStringValue(),this.e=parseInt(D,16);var j=H.sub[3].getHexStringValue();this.d=K(j,16);var Q=H.sub[4].getHexStringValue();this.p=K(Q,16);var ne=H.sub[5].getHexStringValue();this.q=K(ne,16);var ie=H.sub[6].getHexStringValue();this.dmp1=K(ie,16);var ce=H.sub[7].getHexStringValue();this.dmq1=K(ce,16);var ue=H.sub[8].getHexStringValue();this.coeff=K(ue,16)}else{if(H.sub.length!==2)return!1;var ye=H.sub[1].sub[0];A=ye.sub[0].getHexStringValue(),this.n=K(A,16),D=ye.sub[1].getHexStringValue(),this.e=parseInt(D,16)}return!0}catch(Ee){return!1}},C.prototype.getPrivateBaseKey=function(){var P={array:[new re.asn1.DERInteger({int:0}),new re.asn1.DERInteger({bigint:this.n}),new re.asn1.DERInteger({int:this.e}),new re.asn1.DERInteger({bigint:this.d}),new re.asn1.DERInteger({bigint:this.p}),new re.asn1.DERInteger({bigint:this.q}),new re.asn1.DERInteger({bigint:this.dmp1}),new re.asn1.DERInteger({bigint:this.dmq1}),new re.asn1.DERInteger({bigint:this.coeff})]};return new re.asn1.DERSequence(P).getEncodedHex()},C.prototype.getPrivateBaseKeyB64=function(){return p(this.getPrivateBaseKey())},C.prototype.getPublicBaseKey=function(){var P=new re.asn1.DERSequence({array:[new re.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new re.asn1.DERNull]}),A=new re.asn1.DERSequence({array:[new re.asn1.DERInteger({bigint:this.n}),new re.asn1.DERInteger({int:this.e})]}),D=new re.asn1.DERBitString({hex:"00"+A.getEncodedHex()});return new re.asn1.DERSequence({array:[P,D]}).getEncodedHex()},C.prototype.getPublicBaseKeyB64=function(){return p(this.getPublicBaseKey())},C.wordwrap=function(P,A){if(!P)return P;var D="(.{1,"+(A=A||64)+`})( +|$
?)|(.{1,`+A+"})";return P.match(RegExp(D,"g")).join(`
`)},C.prototype.getPrivateKey=function(){var P=`-----BEGIN RSA PRIVATE KEY-----
`;return(P+=C.wordwrap(this.getPrivateBaseKeyB64())+`
`)+"-----END RSA PRIVATE KEY-----"},C.prototype.getPublicKey=function(){var P=`-----BEGIN PUBLIC KEY-----
`;return(P+=C.wordwrap(this.getPublicBaseKeyB64())+`
`)+"-----END PUBLIC KEY-----"},C.hasPublicKeyProperty=function(P){return(P=P||{}).hasOwnProperty("n")&&P.hasOwnProperty("e")},C.hasPrivateKeyProperty=function(P){return(P=P||{}).hasOwnProperty("n")&&P.hasOwnProperty("e")&&P.hasOwnProperty("d")&&P.hasOwnProperty("p")&&P.hasOwnProperty("q")&&P.hasOwnProperty("dmp1")&&P.hasOwnProperty("dmq1")&&P.hasOwnProperty("coeff")},C.prototype.parsePropertiesFrom=function(P){this.n=P.n,this.e=P.e,P.hasOwnProperty("d")&&(this.d=P.d,this.p=P.p,this.q=P.q,this.dmp1=P.dmp1,this.dmq1=P.dmq1,this.coeff=P.coeff)},C}(Oe);const X=function(){function M(C){C===void 0&&(C={}),C=C||{},this.default_key_size=C.default_key_size?parseInt(C.default_key_size,10):1024,this.default_public_exponent=C.default_public_exponent||"010001",this.log=C.log||!1,this.key=null}return M.prototype.setKey=function(C){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new z(C)},M.prototype.setPrivateKey=function(C){this.setKey(C)},M.prototype.setPublicKey=function(C){this.setKey(C)},M.prototype.decrypt=function(C){try{return this.getKey().decrypt(f(C))}catch(P){return!1}},M.prototype.encrypt=function(C){try{return p(this.getKey().encrypt(C))}catch(P){return!1}},M.prototype.sign=function(C,P,A){try{return p(this.getKey().sign(C,P,A))}catch(D){return!1}},M.prototype.verify=function(C,P,A){try{return this.getKey().verify(C,f(P),A)}catch(D){return!1}},M.prototype.getKey=function(C){if(!this.key){if(this.key=new z,C&&{}.toString.call(C)==="[object Function]")return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,C);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},M.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},M.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},M.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},M.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},M.version="3.2.1",M}()}],h={d:(d,l)=>{for(var a in l)h.o(l,a)&&!h.o(d,a)&&Object.defineProperty(d,a,{enumerable:!0,get:l[a]})},o:(d,l)=>Object.prototype.hasOwnProperty.call(d,l)},_={};m[1](0,_,h),T.default=_.default},function(W,T,I){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.LiveroomProMap=void 0,T.LiveroomProMap={"/lr/login_room_rsp":"LoginRoomRsp","/lr/logout_room_rsp":"LogoutRoomRsp","/sw/push_kickout":"PushKickout","/sw/push":"PushReq","/sw/merge_push":"CmdMergePushReq","/lr/room/hb_rsp":"HbRsp","/lr/userlist/userlist_rsp":"UserlistRsp","/lr/stream/add_rsp":"StreamAddRsp","/lr/stream/delete_rsp":"StreamDeleteRsp","/lr/stream/update_rsp":"StreamUpdateRsp","/lr/stream/list_rsp":"StreamListRsp","/lr/push/stream_add":"PushStream","/lr/push/stream_delete":"PushStream","/lr/push/stream_update":"PushStream","/lr/signal/liverequest_rsp":"SignalLiveRsp","/lr/signal/liverresult_rsp":"SignalLiveResulRsp","/lr/signal/liveinvite_rsp":"SignalLiveInviteRsp","/lr/signal/livestop_rsp":"SignalLiveStopRsp","/lr/signal/livescustom_rsp":"SignalLiveCustomRsp","/lr/im/chat_rsp":"ImChatRsp","/lr/room/enter_rsp":"EnterRsp","/lr/room/quit_rsp":"QuitRsp","/lr/trans/trans_rsp":"TransRsp","/lr/trans/transfetch_rsp":"TransFetchRsp","/lr/bigim/chat_rsp":"BigimChatRsp","/lr/relay_rsp":"RelayRsp","/lr/token/renew_token_rsp":"RenewTokenRsp","/lr/push/user_updated":"PushUserInfoUpdated","/lr/push/user_token_expire":"PushUserTokenExpire","/lr/push/im_chat":"PushImChat","/lr/push/bigim_chat":"PushBigImChat","/lr/push/trans":"PushTrans","/lr/push/user_kickout":"PushUserKickout","/lr/push/user_logreport":"PushUserLogReport","/lr/push/usertrans":"PushUserTrans"}},function(W,T,I){W.exports=function(m){return d={},h.m=_=[function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ZEGO_SETTING_ACTION=void 0,(a=a.ZEGO_SETTING_ACTION||(a.ZEGO_SETTING_ACTION={})).CONSTRUCTOR="zs.0",a.SETTING_INIT="zs.ii.0",a.SETTING_FETCH_SETTING="zs.fs.0",a.SETTING__FETCH_SETTING="zs.fs.1",a.SETTING_GET_CLOUD_SETTING="zs.gcs.0",a.SETTING_POLLING_SETTING="zs.ps.0",a.SETTINGCACHEHANDLER_GET_CACHE_SETTING="zs.sch.gcs.0",a.SETTINGCACHEHANDLER_STORE_SETTING="zs.sch.ss.0",a.SETTINGFETCHHANDLER_FETCHSETTING="zs.sfh.fs.0"},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.errorList=void 0,a.errorList={NOT_INIT:{code:1001,msg:"not init"},FILE_REQUEST_FAIL:{code:1002,msg:"fetch request fail"},INFLATE_DATA_FAIL:{code:1003,msg:"inflate fail"},MULTI_FILE_NOT_EXIST:{code:1004,msg:"get multi file fail"}}},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.generateUUID=a.checkValidNumber=a.analyzeKey=a.getCurrentTime=a.getBrowser=void 0,a.getBrowser=function(){var n=window.navigator.userAgent,t=window.ActiveXObject!=null&&n.indexOf("MSIE")!=-1,e=n.indexOf("Firefox")!=-1,r=window.opr!=null,i=n.indexOf("Chrome")&&window.chrome,s=n.indexOf("Safari")!=-1&&n.indexOf("Version")!=-1;return n=n.toLowerCase().match(/MicroMessenger/i)&&n.toLowerCase().match(/MicroMessenger/i)[0]==="micromessenger",t?"IE":e?"FIREFOX":r?"OPERA":i?"CHROME":s?"SAFARI":n?"WEIXIN":"UNKOWN"};var o=["00","01","02","03","04","05","06","07","08","09"];a.getCurrentTime=function(){var n=new Date;return[n.getFullYear()+"/",(o[n.getMonth()+1]||n.getMonth()+1)+"/",(o[n.getDate()]||n.getDate())+" ",(o[n.getHours()]||n.getHours())+":",(o[n.getMinutes()]||n.getMinutes())+":",o[n.getSeconds()]||n.getSeconds(),"."+n.getTime()%1e3].join("")},a.analyzeKey=function(n){return n=n.split("_"),{level:Number(n[0]),timestamp:n[1],seq:n[2]}},a.checkValidNumber=function(n,t,e){return t=t||1,e=e||1e4,typeof n=="number"&&n%1==0&&t<=n&&n<=e},a.generateUUID=function(n){if((n=n===void 0?0:n)===0?e=localStorage.getItem("z_deviceID"):wx.getStorageSync("z_deviceID"),e)return e;var t=new Date().getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),(r=="x"?i:3&i|8).toString(36)});return n===0?localStorage.setItem("z_deviceID",e):wx.setStorageSync("z_deviceID",e),e}},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ZegoSetting=void 0;var o=c(4);Object.defineProperty(a,"ZegoSetting",{enumerable:!0,get:function(){return o.ZegoSetting}})},function(l,a,c){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(y){for(var b,S=1,k=arguments.length;S<k;S++)for(var O in b=arguments[S])Object.prototype.hasOwnProperty.call(b,O)&&(y[O]=b[O]);return y}).apply(this,arguments)},n=this&&this.__awaiter||function(y,b,S,k){return new(S=S||Promise)(function(O,g){function v(N){try{L(k.next(N))}catch(w){g(w)}}function R(N){try{L(k.throw(N))}catch(w){g(w)}}function L(N){var w;N.done?O(N.value):((w=N.value)instanceof S?w:new S(function(B){B(w)})).then(v,R)}L((k=k.apply(y,b||[])).next())})},t=this&&this.__generator||function(y,b){var S,k,O,g={label:0,sent:function(){if(1&O[0])throw O[1];return O[1]},trys:[],ops:[]},v={next:R(0),throw:R(1),return:R(2)};return typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function R(L){return function(N){return function(w){if(S)throw new TypeError("Generator is already executing.");for(;g;)try{if(S=1,k&&(O=2&w[0]?k.return:w[0]?k.throw||((O=k.return)&&O.call(k),0):k.next)&&!(O=O.call(k,w[1])).done)return O;switch(k=0,(w=O?[2&w[0],O.value]:w)[0]){case 0:case 1:O=w;break;case 4:return g.label++,{value:w[1],done:!1};case 5:g.label++,k=w[1],w=[0];continue;case 7:w=g.ops.pop(),g.trys.pop();continue;default:if(!(O=0<(O=g.trys).length&&O[O.length-1])&&(w[0]===6||w[0]===2)){g=0;continue}if(w[0]===3&&(!O||w[1]>O[0]&&w[1]<O[3])){g.label=w[1];break}if(w[0]===6&&g.label<O[1]){g.label=O[1],O=w;break}if(O&&g.label<O[2]){g.label=O[2],g.ops.push(w);break}O[2]&&g.ops.pop(),g.trys.pop();continue}w=b.call(y,g)}catch(B){w=[6,B],k=0}finally{S=O=0}if(5&w[0])throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}([L,N])}}};Object.defineProperty(a,"__esModule",{value:!0}),a.ZegoSetting=void 0;var e=c(5),r=c(6),i=c(10),s=c(0),u=c(12),p=c(1),f=c(2);function E(){this.fileList=[],this.publicEnvVariable={},this.proEnvVariable={},this.pollingTimer=null,this.pollingInterval=300,this.inited=!1,this.log=new e.ZegoLog}Object.defineProperty(E.prototype,"envVariable",{get:function(){return Object.assign({},this.publicEnvVariable,this.proEnvVariable)},enumerable:!1,configurable:!0}),E.prototype.init=function(y){var b=this;return y.pollingFreq&&!f.checkValidNumber(y.pollingFreq)?(this.log.error(s.ZEGO_SETTING_ACTION.SETTING_INIT+" pollingFreq must be integer number"),!1):(this.options=Object.assign({},u.INIT_CONFIG,y),this.getPublicEnvVariable(),this.settingFetchHandler=new i.SettingFetchHandler(this.options,this.log),this.settingFetchHandler.setDataReport(this.options.reportNotify),y=Math.round(60*Math.random()),this.log.info(s.ZEGO_SETTING_ACTION.SETTING_INIT+" delay "+y),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.options.pollingFreq&&60<=this.options.pollingFreq&&(this.pollingInterval=this.options.pollingFreq),this.delayTimer=setTimeout(function(){b.pollingSetting(1e3*b.pollingInterval)},1e3*y),this.settingCacheHandler=new r.SettingCacheHandler("setting_"+(this.options.online?"online_":"test_")+this.options.product+"_"+this.options.appID,this.log,this.options.env),this.inited=!0)},E.prototype.uninit=function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},E.prototype.setEnvVariable=function(y,b){this.proEnvVariable[y]=String(b)},E.prototype.getEnvVariable=function(y){return this.envVariable[y]},E.prototype.setEnvVariables=function(y){var b=this;Object.keys(y).forEach(function(S){typeof y[S]!="string"&&typeof y[S]!="number"&&b.log.error("zs.sev env "+S+" type error"),b.proEnvVariable[S]=String(y[S])})},E.prototype.getEnvVariables=function(){return this.envVariable},E.prototype.enablePolling=function(y,b){var S=this;b?b.forEach(function(k){var O=S.fileList.find(function(g){return g.fileName===k});O&&(O.needPolling=y)}):this.fileList.forEach(function(k){return k.needPolling=y})},E.prototype.setToken=function(y){this.token=y},E.prototype.setUserID=function(y){this.userID=y},E.prototype.getSettingCache=function(y){return n(this,void 0,void 0,function(){var b,S,k;return t(this,function(O){switch(O.label){case 0:return this.inited?(b=this.fileList.find(function(g){return g.fileName===y}))?[2,Promise.resolve({setting:b.setting,versions:b.versions})]:[3,1]:[2,Promise.reject(p.errorList.NOT_INIT)];case 1:return S=this._getFileName(y),[4,this.settingCacheHandler.getCacheSetting(S)];case 2:return(S=O.sent())&&(this.fileList.find(function(g){return g.fileName===y})||this.fileList.push({fileName:y,fetchedTime:0,needPolling:!1,setting:S.setting,versions:S.versions}),k={setting:S.setting,versions:S.versions}),[2,Promise.resolve(k)]}})})},E.prototype.fetchSetting=function(y,b,S){return b===void 0&&(b={}),S===void 0&&(S=!0),this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" call "+y),this.inited?(this.activePolling(),0<Object.keys(b).length?(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(y,o(o({},this.envVariable),b))):(b=this.fileList.find(function(k){return k.fileName===y}))?(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file exist"),new Date().getTime()-b.fetchedTime<1e3*this.pollingInterval?(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),b.needPolling=S,Promise.resolve({setting:b.setting,versions:b.versions})):this._fetchSetting(y,b,S)):(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file not found"),this._fetchSetting(y,b,S))):Promise.reject(p.errorList.NOT_INIT)},E.prototype.fetchMultiSetting=function(y,b,S){var k=this;return b===void 0&&(b={}),S===void 0&&(S=!0),this.inited?(this.activePolling(),0<Object.keys(b).length?(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(y,o(o({},this.envVariable),b))):new Promise(function(O,g){var v={},R=[];if(y.forEach(function(L){return n(k,void 0,void 0,function(){var N;return t(this,function(w){return(N=this.fileList.find(function(B){return B.fileName===L}))&&new Date().getTime()-N.fetchedTime<1e3*this.pollingInterval?(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),v[L]={setting:N.setting,versions:N.versions}):R.push(L),[2]})})}),!(0<R.length))return O(v);k._getCloudSetting(R,k.envVariable).then(function(L){return k.handleFetchFiles(L,S),Object.assign(v,L),O(v)}).catch(function(L){R.forEach(function(N){return n(k,void 0,void 0,function(){var w;return t(this,function(B){switch(B.label){case 0:return(w=this.fileList.find(function(x){return x.fileName==N}))?w.fetchedTime=new Date().getTime():this.fileList.find(function(x){return x.fileName===N})||this.fileList.push({fileName:N,fetchedTime:new Date().getTime(),needPolling:S,setting:{},versions:{}}),[4,this.settingCacheHandler.getCacheSetting(N)];case 1:return w=B.sent(),v[N]={setting:w.setting,versions:w.versions},[2]}})})}),0<Object.keys(v).length?O(v):g(L)})})):Promise.reject(p.errorList.NOT_INIT)},E.prototype.setLog=function(y){this.log=y},E.prototype._getCloudSetting=function(y,b){var S=this;return new Promise(function(k,O){return n(S,void 0,void 0,function(){var g,v,R,L,N,w;return t(this,function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),L=y instanceof Array,[4,this.settingFetchHandler.fetchSetting(L?y:[y],b,this.token,this.userID)];case 1:return v=B.sent(),g=v.data,typeof(v=v.polling_interval)=="number"&&5<=v&&this.pollingInterval!==60*v&&(this.log.warn(s.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" polling interval change"),this.pollingInterval=60*v,this.uninit(),this.activePolling()),L?(R={},y.forEach(function(x){var Z,V;((Z=g[x])===null||Z===void 0?void 0:Z.code)==0&&((V=g[x])===null||V===void 0?void 0:V.data)!==void 0&&(R[x]={setting:(V=g[x])===null||V===void 0?void 0:V.data,versions:(x=g[x])===null||x===void 0?void 0:x.versions})}),0<Object.keys(R).length?k(R):O(p.errorList.MULTI_FILE_NOT_EXIST)):((L=g[y])===null||L===void 0?void 0:L.code)===0&&(N=g[y])!==null&&N!==void 0&&N.data?k({setting:(N=g[y])===null||N===void 0?void 0:N.data,versions:(N=g[y])===null||N===void 0?void 0:N.versions}):O({code:(w=g[y])===null||w===void 0?void 0:w.code,msg:(w=g[y])===null||w===void 0?void 0:w.message}),[3,3];case 2:return w=B.sent(),O(w),this.log.info(s.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" fail"),[3,3];case 3:return[2]}})})})},E.prototype.handleFetchFiles=function(y,b){var S=this;Object.keys(y).forEach(function(k){var O=S.fileList.find(function(g){return g.fileName==k});O?(O.fetchedTime=new Date().getTime(),O.setting=y[k].setting,O.versions=y[k].versions,O.needPolling=b):S.fileList.find(function(g){return g.fileName===k})||S.fileList.push({fileName:k,fetchedTime:new Date().getTime(),needPolling:b,setting:y[k].setting,versions:y[k].versions}),O=S._getFileName(k),S.settingCacheHandler.storeSetting(O,y[k])})},E.prototype._fetchSetting=function(y,b,S){var k=this;return new Promise(function(O,g){k.log.info(s.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call"),k._getCloudSetting(y,k.envVariable).then(function(v){b?(b.fetchedTime=new Date().getTime(),b.setting=v.setting,b.versions=v.versions,b.needPolling=S):k.fileList.find(function(L){return L.fileName===y})||k.fileList.push({fileName:y,fetchedTime:new Date().getTime(),needPolling:S,setting:v.setting,versions:v.versions});var R=k._getFileName(y);k.settingCacheHandler.storeSetting(R,v),O(v),k.log.info(s.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call suc")}).catch(function(v){return n(k,void 0,void 0,function(){var R;return t(this,function(L){switch(L.label){case 0:b?b.fetchedTime=new Date().getTime():this.fileList.find(function(N){return N.fileName===y})||this.fileList.push({fileName:y,fetchedTime:new Date().getTime(),needPolling:S,setting:{},versions:{}}),R=this._getFileName(y),L.label=1;case 1:return L.trys.push([1,3,,4]),[4,this.settingCacheHandler.getCacheSetting(R)];case 2:return R=L.sent(),O(R),[3,4];case 3:return L.sent(),g(v),[3,4];case 4:return this.log.info(s.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" setting not contain or fetch file fail"),[2]}})})})})},E.prototype.getPublicEnvVariable=function(){var y;this.options.env==0?(this.publicEnvVariable.userAgent=navigator.userAgent,this.publicEnvVariable.platform=navigator.platform,this.publicEnvVariable.browser=f.getBrowser(),this.publicEnvVariable.deviceid=f.generateUUID()):this.options.env==1&&(y=wx.getSystemInfoSync(),this.publicEnvVariable.brand=y.brand,this.publicEnvVariable.model=y.model,this.publicEnvVariable.system=y.system,this.publicEnvVariable.platform=y.platform,this.publicEnvVariable.wechatVersion=y.version,this.publicEnvVariable.wechatSDKVersion=y.SDKVersion,this.publicEnvVariable.deviceid=f.generateUUID(this.options.env))},E.prototype.pollingSetting=function(y){return n(this,void 0,void 0,function(){var b,S,k,O,g=this;return t(this,function(v){switch(v.label){case 0:if(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" call "+y),b=[],this.fileList.forEach(function(R){R.fileName,R.needPolling&&b.push(R.fileName)}),S=y,!(0<b.length))return[3,5];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,this.settingFetchHandler.fetchSetting(b,this.envVariable,this.token,this.userID)];case 2:return O=v.sent(),k=O.data,typeof(O=O.polling_interval)=="number"&&5<=O&&this.pollingInterval!==60*O&&(this.log.warn(s.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling interval change"),this.pollingInterval=60*O,S=1e3*this.pollingInterval),this.fileList.forEach(function(R){return n(g,void 0,void 0,function(){var L,N,w,B;return t(this,function(x){switch(x.label){case 0:return R.fetchedTime=new Date().getTime(),L=this._getFileName(R.fileName),k[R.fileName]&&k[R.fileName].code===0&&k[R.fileName].data?(N=JSON.stringify(k[R.fileName].data),w=JSON.stringify(R.setting),B={setting:k[R.fileName].data,versions:(B=k[R.fileName])===null||B===void 0?void 0:B.versions},w!==N&&(this.log.info(s.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" "+R.fileName+" setting changed"),R.setting=B.setting,R.versions=B.versions,this.options.pollingNotify(R.fileName,B)),[4,this.settingCacheHandler.getCacheSetting(L)]):[3,2];case 1:w=x.sent(),N=JSON.stringify(w),w=JSON.stringify(B),N!==w&&this.settingCacheHandler.storeSetting(L,B),x.label=2;case 2:return[2]}})})}),[3,4];case 3:return O=v.sent(),this.log.error(s.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" fetch fail "+JSON.stringify(O)),[3,4];case 4:return[3,6];case 5:this.log.info(s.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling no file"),v.label=6;case 6:return this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingTimer=setTimeout(function(){g.pollingSetting(S)},S),[2]}})})},E.prototype._getFileName=function(y){return y},E.prototype.activePolling=function(){this.pollingTimer||this.pollingSetting(1e3*this.pollingInterval)},c=E,a.ZegoSetting=c},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ZegoLog=void 0;var o=(n.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.join(" ")},n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.join(" ")},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.join(" ")},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.join(" ")},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.join(" ")},n);function n(){}a.ZegoLog=o},function(l,a,c){"use strict";var o=this&&this.__awaiter||function(i,s,u,p){return new(u=u||Promise)(function(f,E){function y(k){try{S(p.next(k))}catch(O){E(O)}}function b(k){try{S(p.throw(k))}catch(O){E(O)}}function S(k){var O;k.done?f(k.value):((O=k.value)instanceof u?O:new u(function(g){g(O)})).then(y,b)}S((p=p.apply(i,s||[])).next())})},n=this&&this.__generator||function(i,s){var u,p,f,E={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]},y={next:b(0),throw:b(1),return:b(2)};return typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function b(S){return function(k){return function(O){if(u)throw new TypeError("Generator is already executing.");for(;E;)try{if(u=1,p&&(f=2&O[0]?p.return:O[0]?p.throw||((f=p.return)&&f.call(p),0):p.next)&&!(f=f.call(p,O[1])).done)return f;switch(p=0,(O=f?[2&O[0],f.value]:O)[0]){case 0:case 1:f=O;break;case 4:return E.label++,{value:O[1],done:!1};case 5:E.label++,p=O[1],O=[0];continue;case 7:O=E.ops.pop(),E.trys.pop();continue;default:if(!(f=0<(f=E.trys).length&&f[f.length-1])&&(O[0]===6||O[0]===2)){E=0;continue}if(O[0]===3&&(!f||O[1]>f[0]&&O[1]<f[3])){E.label=O[1];break}if(O[0]===6&&E.label<f[1]){E.label=f[1],f=O;break}if(f&&E.label<f[2]){E.label=f[2],E.ops.push(O);break}f[2]&&E.ops.pop(),E.trys.pop();continue}O=s.call(i,E)}catch(g){O=[6,g],p=0}finally{u=f=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([S,k])}}};Object.defineProperty(a,"__esModule",{value:!0}),a.SettingCacheHandler=void 0;var t=c(0),e=c(7);function r(i,s,u){u===void 0&&(u=0),this.storeName=i,this.log=s,this.store=e.createZegoStore(i,u)}r.prototype.getCacheSetting=function(i){return o(this,void 0,void 0,function(){return n(this,function(s){switch(s.label){case 0:return this.log.info(t.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_GET_CACHE_SETTING+" call"),[4,this.store.getItem(i)];case 1:return[2,s.sent()||""]}})})},r.prototype.storeSetting=function(i,s){return o(this,void 0,void 0,function(){return n(this,function(u){switch(u.label){case 0:return this.log.info(t.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_STORE_SETTING+" call"),[4,this.store.setItem(i,s)];case 1:return u.sent(),[2]}})})},c=r,a.SettingCacheHandler=c},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createZegoStore=a.ZegoWechatMiniStore=void 0;var o=c(8),n=c(9),t=(e.prototype.getItem=function(r){var i=this;return new Promise(function(s,u){try{s(wx.getStorageSync(i.keyPrefix+r))}catch(p){u(p)}})},e.prototype.setItem=function(r,i){var s=this;return new Promise(function(u,p){try{wx.setStorageSync(s.keyPrefix+r,i),u()}catch(f){p(f)}})},e.prototype.removeItem=function(r){var i=this;return new Promise(function(s,u){try{s(wx.removeStorageSync(i.keyPrefix+r))}catch(p){u(p)}})},e.prototype.clear=function(){return new Promise(function(r,i){try{wx.clearStorageSync(),r()}catch(s){i(s)}})},e.prototype.keys=function(){var r=this;return new Promise(function(i,s){try{var u=wx.getStorageInfoSync().keys,p=[];u.forEach(function(f){f.indexOf(r.keyPrefix)==0&&p.push(f.replace(r.keyPrefix,""))}),p.sort(),i(p)}catch(f){s(f)}})},e);function e(r){this.storeName=r,this.keyPrefix=r+"/",this.storeName}a.ZegoWechatMiniStore=t,a.createZegoStore=function(r,i){return i===n.ZEGO_ENV.BROWSER?o.createInstance({name:r}):new t(r)}},function(l,a){l.exports=m},function(l,a,c){"use strict";var o;Object.defineProperty(a,"__esModule",{value:!0}),a.SOCKET_DISCONNECT=a.ENUM_REMOTE_TYPE=a.ZEGO_BROWSER_TYPE=a.ZEGO_ENV=a.PROTO_VERSION=void 0,a.PROTO_VERSION="1.0.3",(o=a.ZEGO_ENV||(a.ZEGO_ENV={}))[o.BROWSER=0]="BROWSER",o[o.WEIXINMINI=1]="WEIXINMINI",(o=a.ZEGO_BROWSER_TYPE||(a.ZEGO_BROWSER_TYPE={}))[o.IE=0]="IE",o[o.FIREFOX=1]="FIREFOX",o[o.CHROME=2]="CHROME",o[o.SAFARI=3]="SAFARI",o[o.OPERA=4]="OPERA",o[o.WEIXIN=5]="WEIXIN",o[o.WEIXINMINI=6]="WEIXINMINI",o[o.UNKOWN=7]="UNKOWN",(o=a.ENUM_REMOTE_TYPE||(a.ENUM_REMOTE_TYPE={}))[o.DISABLE=0]="DISABLE",o[o.WEBSOCKET=1]="WEBSOCKET",o[o.HTTPS=2]="HTTPS",a.SOCKET_DISCONNECT=-1},function(l,a,c){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(i){for(var s,u=1,p=arguments.length;u<p;u++)for(var f in s=arguments[u])Object.prototype.hasOwnProperty.call(s,f)&&(i[f]=s[f]);return i}).apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0}),a.SettingFetchHandler=void 0;var n=c(0),t=c(11),e=c(2);function r(i,s){this.options=i,this.log=s,this.seq=0}r.prototype.setOptions=function(i){this.options=i},r.prototype.setDataReport=function(i){this.reportFunc=i},r.prototype.fetchSetting=function(i,s,u,p){var f=this;return new Promise(function(E,y){var b={product:f.options.product,files:i,param:o(o({},s),{deviceid:void 0}),appid:f.options.appID,token:u,id_name:p,timestamp:new Date().getTime(),biztype:0,deviceid:s.deviceid||e.generateUUID(f.options.env),compress:!1,mode:f.options.online?"online":"test"},S=f.seq++;f.reportFunc&&f.reportFunc(S,"request_start"),t.fetch(f.options.urls,b,f.options.env||0).then(function(k){var O,g=k.code,v=(k.msg,k.data),R=k.polling_interval;k=k.reportData,f.log.info(n.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+g),v&&(O=[],Object.keys(v).forEach(function(L){O.push({name:L,error:v[L].code})})),f.reportFunc&&f.reportFunc(S,"request_end",{code:g,reportData:k,params:b,files:O}),E({data:v,polling_interval:R})}).catch(function(k){var O=k.code,g=k.msg;k.data,k=k.reportData,f.log.warn(n.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+O),f.reportFunc&&f.reportFunc(S,"request_end",{code:O,params:b,reportData:k}),y({code:O,msg:g})})})},c=r,a.SettingFetchHandler=c},function(l,a,c){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0}),a.fetch=void 0;var n=c(1);a.fetch=function t(e,r,i,s,u,p){return s===void 0&&(s=5),u===void 0&&(u=0),p===void 0&&(p=[]),new Promise(function(f,E){u=u||new Date().getTime();var y,b,S,k=new Date().getTime();i===0?(y=new XMLHttpRequest,b=e[(s+1)%2]||e[0],y.open("post",b),r.compress==1&&(y.responseType="arraybuffer"),y.ontimeout=function(){},y.onreadystatechange=function(){var O,g,v,R,L;y.readyState==4&&(200<=y.status&&y.status<300||y.status==304?(g=void 0,r.compress==1||(g=y.responseText),L=new Date().getTime()-k,O=(v=JSON.parse(g)).code,R=v.message,g=v.data,v=v.polling_interval,p.push({timestamp:k,url:b,error:O,duration:L}),O===0?f({code:O,msg:R,data:g,polling_interval:v,reportData:p}):E({code:O,msg:R,reportData:p})):(R=new Date().getTime()-k,p.push({timestamp:k,url:b,error:y.status,duration:R}),L=new Date().getTime()-u,0<s&&L<8e3?t(e,r,i,--s,u,p).then(function(N){f(N)}).catch(function(N){E(N)}):E(o(o({},n.errorList.FILE_REQUEST_FAIL),{reportData:p}))))},y.timeout=8e3,y.send(JSON.stringify(r))):(S=e[(s+1)%2]||e[0],wx.request({url:S,data:r,method:"POST",success:function(O){var g=(L=O.data).code,v=L.message,R=L.data,L=L.polling_interval;g!==void 0?g===0?f({code:g,msg:v,data:R,polling_interval:L,reportData:p}):E({code:g,msg:v,reportData:p}):(v=new Date().getTime()-k,p.push({timestamp:k,url:S,error:n.errorList.FILE_REQUEST_FAIL.code,msg:O.data,duration:v}),0<s?t(e,r,i,--s,u,p).then(function(N){f(N)}).catch(function(N){E(N)}):E(o(o({},n.errorList.FILE_REQUEST_FAIL),{reportData:p})))},fail:function(O){var g=new Date().getTime()-k;p.push({timestamp:k,url:S,error:n.errorList.FILE_REQUEST_FAIL.code,msg:O.errMsg,duration:g}),0<s?t(e,r,i,--s,u,p).then(function(v){f(v)}).catch(function(v){E(v)}):E(o(o({},n.errorList.FILE_REQUEST_FAIL),{reportData:p}))}}))})}},function(l,a,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.INIT_CONFIG=void 0,a.INIT_CONFIG={env:0}}],h.c=d,h.d=function(l,a,c){h.o(l,a)||Object.defineProperty(l,a,{enumerable:!0,get:c})},h.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},h.t=function(l,a){if(1&a&&(l=h(l)),8&a||4&a&&typeof l=="object"&&l&&l.__esModule)return l;var c=Object.create(null);if(h.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:l}),2&a&&typeof l!="string")for(var o in l)h.d(c,o,function(n){return l[n]}.bind(null,o));return c},h.n=function(l){var a=l&&l.__esModule?function(){return l.default}:function(){return l};return h.d(a,"a",a),a},h.o=function(l,a){return Object.prototype.hasOwnProperty.call(l,a)},h.p="",h(h.s=3);function h(l){if(d[l])return d[l].exports;var a=d[l]={i:l,l:!1,exports:{}};return _[l].call(a.exports,a,a.exports,h),a.l=!0,a.exports}var _,d}(I(95))},function(W,T,I){(function(m){W.exports=function h(_,d,l){function a(n,t){if(!d[n]){if(!_[n]){if(c)return c(n,!0);var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}var r=d[n]={exports:{}};_[n][0].call(r.exports,function(i){var s=_[n][1][i];return a(s||i)},r,r.exports,h,_,d,l)}return d[n].exports}for(var c=!1,o=0;o<l.length;o++)a(l[o]);return a}({1:[function(h,_,d){(function(l){"use strict";var a,c,o=l.MutationObserver||l.WebKitMutationObserver;if(o){var n=0,t=new o(s),e=l.document.createTextNode("");t.observe(e,{characterData:!0}),a=function(){e.data=n=++n%2}}else if(l.setImmediate||l.MessageChannel===void 0)a="document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var u=l.document.createElement("script");u.onreadystatechange=function(){s(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},l.document.documentElement.appendChild(u)}:function(){setTimeout(s,0)};else{var r=new l.MessageChannel;r.port1.onmessage=s,a=function(){r.port2.postMessage(0)}}var i=[];function s(){var u,p;c=!0;for(var f=i.length;f;){for(p=i,i=[],u=-1;++u<f;)p[u]();f=i.length}c=!1}_.exports=function(u){i.push(u)!==1||c||a()}}).call(this,m!==void 0?m:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(h,_,d){"use strict";var l=h(1);function a(){}var c={},o=["REJECTED"],n=["FULFILLED"],t=["PENDING"];function e(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=t,this.queue=[],this.outcome=void 0,f!==a&&u(this,f)}function r(f,E,y){this.promise=f,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function i(f,E,y){l(function(){var b;try{b=E(y)}catch(S){return c.reject(f,S)}b===f?c.reject(f,new TypeError("Cannot resolve promise with itself")):c.resolve(f,b)})}function s(f){var E=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof E=="function")return function(){E.apply(f,arguments)}}function u(f,E){var y=!1;function b(O){y||(y=!0,c.reject(f,O))}function S(O){y||(y=!0,c.resolve(f,O))}var k=p(function(){E(S,b)});k.status==="error"&&b(k.value)}function p(f,E){var y={};try{y.value=f(E),y.status="success"}catch(b){y.status="error",y.value=b}return y}_.exports=e,e.prototype.catch=function(f){return this.then(null,f)},e.prototype.then=function(f,E){if(typeof f!="function"&&this.state===n||typeof E!="function"&&this.state===o)return this;var y=new this.constructor(a);return this.state!==t?i(y,this.state===n?f:E,this.outcome):this.queue.push(new r(y,f,E)),y},r.prototype.callFulfilled=function(f){c.resolve(this.promise,f)},r.prototype.otherCallFulfilled=function(f){i(this.promise,this.onFulfilled,f)},r.prototype.callRejected=function(f){c.reject(this.promise,f)},r.prototype.otherCallRejected=function(f){i(this.promise,this.onRejected,f)},c.resolve=function(f,E){var y=p(s,E);if(y.status==="error")return c.reject(f,y.value);var b=y.value;if(b)u(f,b);else{f.state=n,f.outcome=E;for(var S=-1,k=f.queue.length;++S<k;)f.queue[S].callFulfilled(E)}return f},c.reject=function(f,E){f.state=o,f.outcome=E;for(var y=-1,b=f.queue.length;++y<b;)f.queue[y].callRejected(E);return f},e.resolve=function(f){return f instanceof this?f:c.resolve(new this(a),f)},e.reject=function(f){var E=new this(a);return c.reject(E,f)},e.all=function(f){var E=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,b=!1;if(!y)return this.resolve([]);for(var S=new Array(y),k=0,O=-1,g=new this(a);++O<y;)v(f[O],O);return g;function v(R,L){E.resolve(R).then(function(N){S[L]=N,++k!==y||b||(b=!0,c.resolve(g,S))},function(N){b||(b=!0,c.reject(g,N))})}},e.race=function(f){var E=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,b=!1;if(!y)return this.resolve([]);for(var S,k=-1,O=new this(a);++k<y;)S=f[k],E.resolve(S).then(function(g){b||(b=!0,c.resolve(O,g))},function(g){b||(b=!0,c.reject(O,g))});return O}},{1:1}],3:[function(h,_,d){(function(l){"use strict";typeof l.Promise!="function"&&(l.Promise=h(2))}).call(this,m!==void 0?m:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{2:2}],4:[function(h,_,d){"use strict";var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(G){return typeof G}:function(G){return G&&typeof Symbol=="function"&&G.constructor===Symbol&&G!==Symbol.prototype?"symbol":typeof G},a=function(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(G){return}}();function c(G,q){G=G||[],q=q||{};try{return new Blob(G,q)}catch(M){if(M.name!=="TypeError")throw M;for(var z=new(typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder),X=0;X<G.length;X+=1)z.append(G[X]);return z.getBlob(q.type)}}typeof Promise=="undefined"&&h(3);var o=Promise;function n(G,q){q&&G.then(function(z){q(null,z)},function(z){q(z)})}function t(G,q,z){typeof q=="function"&&G.then(q),typeof z=="function"&&G.catch(z)}function e(G){return typeof G!="string"&&(console.warn(G+" used as a key, but it is not a string."),G=String(G)),G}function r(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var i=void 0,s={},u=Object.prototype.toString;function p(G){return typeof i=="boolean"?o.resolve(i):function(q){return new o(function(z){var X=q.transaction("local-forage-detect-blob-support","readwrite"),M=c([""]);X.objectStore("local-forage-detect-blob-support").put(M,"key"),X.onabort=function(C){C.preventDefault(),C.stopPropagation(),z(!1)},X.oncomplete=function(){var C=navigator.userAgent.match(/Chrome\/(\d+)/),P=navigator.userAgent.match(/Edge\//);z(P||!C||parseInt(C[1],10)>=43)}}).catch(function(){return!1})}(G).then(function(q){return i=q})}function f(G){var q=s[G.name],z={};z.promise=new o(function(X,M){z.resolve=X,z.reject=M}),q.deferredOperations.push(z),q.dbReady?q.dbReady=q.dbReady.then(function(){return z.promise}):q.dbReady=z.promise}function E(G){var q=s[G.name].deferredOperations.pop();if(q)return q.resolve(),q.promise}function y(G,q){var z=s[G.name].deferredOperations.pop();if(z)return z.reject(q),z.promise}function b(G,q){return new o(function(z,X){if(s[G.name]=s[G.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},G.db){if(!q)return z(G.db);f(G),G.db.close()}var M=[G.name];q&&M.push(G.version);var C=a.open.apply(a,M);q&&(C.onupgradeneeded=function(P){var A=C.result;try{A.createObjectStore(G.storeName),P.oldVersion<=1&&A.createObjectStore("local-forage-detect-blob-support")}catch(D){if(D.name!=="ConstraintError")throw D;console.warn('The database "'+G.name+'" has been upgraded from version '+P.oldVersion+" to version "+P.newVersion+', but the storage "'+G.storeName+'" already exists.')}}),C.onerror=function(P){P.preventDefault(),X(C.error)},C.onsuccess=function(){z(C.result),E(G)}})}function S(G){return b(G,!1)}function k(G){return b(G,!0)}function O(G,q){if(!G.db)return!0;var z=!G.db.objectStoreNames.contains(G.storeName),X=G.version<G.db.version,M=G.version>G.db.version;if(X&&(G.version!==q&&console.warn('The database "'+G.name+`" can't be downgraded from version `+G.db.version+" to version "+G.version+"."),G.version=G.db.version),M||z){if(z){var C=G.db.version+1;C>G.version&&(G.version=C)}return!0}return!1}function g(G){return c([function(q){for(var z=q.length,X=new ArrayBuffer(z),M=new Uint8Array(X),C=0;C<z;C++)M[C]=q.charCodeAt(C);return X}(atob(G.data))],{type:G.type})}function v(G){return G&&G.__local_forage_encoded_blob}function R(G){var q=this,z=q._initReady().then(function(){var X=s[q._dbInfo.name];if(X&&X.dbReady)return X.dbReady});return t(z,G,G),z}function L(G,q,z,X){X===void 0&&(X=1);try{var M=G.db.transaction(G.storeName,q);z(null,M)}catch(C){if(X>0&&(!G.db||C.name==="InvalidStateError"||C.name==="NotFoundError"))return o.resolve().then(function(){if(!G.db||C.name==="NotFoundError"&&!G.db.objectStoreNames.contains(G.storeName)&&G.version<=G.db.version)return G.db&&(G.version=G.db.version+1),k(G)}).then(function(){return function(P){f(P);for(var A=s[P.name],D=A.forages,U=0;U<D.length;U++){var H=D[U];H._dbInfo.db&&(H._dbInfo.db.close(),H._dbInfo.db=null)}return P.db=null,S(P).then(function(j){return P.db=j,O(P)?k(P):j}).then(function(j){P.db=A.db=j;for(var Q=0;Q<D.length;Q++)D[Q]._dbInfo.db=j}).catch(function(j){throw y(P,j),j})}(G).then(function(){L(G,q,z,X-1)})}).catch(z);z(C)}}var N={_driver:"asyncStorage",_initStorage:function(G){var q=this,z={db:null};if(G)for(var X in G)z[X]=G[X];var M=s[z.name];M||(M={forages:[],db:null,dbReady:null,deferredOperations:[]},s[z.name]=M),M.forages.push(q),q._initReady||(q._initReady=q.ready,q.ready=R);var C=[];function P(){return o.resolve()}for(var A=0;A<M.forages.length;A++){var D=M.forages[A];D!==q&&C.push(D._initReady().catch(P))}var U=M.forages.slice(0);return o.all(C).then(function(){return z.db=M.db,S(z)}).then(function(H){return z.db=H,O(z,q._defaultConfig.version)?k(z):H}).then(function(H){z.db=M.db=H,q._dbInfo=z;for(var j=0;j<U.length;j++){var Q=U[j];Q!==q&&(Q._dbInfo.db=z.db,Q._dbInfo.version=z.version)}})},_support:function(){try{if(!a||!a.open)return!1;var G=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),q=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!G||q)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(z){return!1}}(),iterate:function(G,q){var z=this,X=new o(function(M,C){z.ready().then(function(){L(z._dbInfo,"readonly",function(P,A){if(P)return C(P);try{var D=A.objectStore(z._dbInfo.storeName).openCursor(),U=1;D.onsuccess=function(){var H=D.result;if(H){var j=H.value;v(j)&&(j=g(j));var Q=G(j,H.key,U++);Q!==void 0?M(Q):H.continue()}else M()},D.onerror=function(){C(D.error)}}catch(H){C(H)}})}).catch(C)});return n(X,q),X},getItem:function(G,q){var z=this;G=e(G);var X=new o(function(M,C){z.ready().then(function(){L(z._dbInfo,"readonly",function(P,A){if(P)return C(P);try{var D=A.objectStore(z._dbInfo.storeName).get(G);D.onsuccess=function(){var U=D.result;U===void 0&&(U=null),v(U)&&(U=g(U)),M(U)},D.onerror=function(){C(D.error)}}catch(U){C(U)}})}).catch(C)});return n(X,q),X},setItem:function(G,q,z){var X=this;G=e(G);var M=new o(function(C,P){var A;X.ready().then(function(){return A=X._dbInfo,u.call(q)==="[object Blob]"?p(A.db).then(function(D){return D?q:(U=q,new o(function(H,j){var Q=new FileReader;Q.onerror=j,Q.onloadend=function(ne){var ie=btoa(ne.target.result||"");H({__local_forage_encoded_blob:!0,data:ie,type:U.type})},Q.readAsBinaryString(U)}));var U}):q}).then(function(D){L(X._dbInfo,"readwrite",function(U,H){if(U)return P(U);try{var j=H.objectStore(X._dbInfo.storeName);D===null&&(D=void 0);var Q=j.put(D,G);H.oncomplete=function(){D===void 0&&(D=null),C(D)},H.onabort=H.onerror=function(){var ne=Q.error?Q.error:Q.transaction.error;P(ne)}}catch(ne){P(ne)}})}).catch(P)});return n(M,z),M},removeItem:function(G,q){var z=this;G=e(G);var X=new o(function(M,C){z.ready().then(function(){L(z._dbInfo,"readwrite",function(P,A){if(P)return C(P);try{var D=A.objectStore(z._dbInfo.storeName).delete(G);A.oncomplete=function(){M()},A.onerror=function(){C(D.error)},A.onabort=function(){var U=D.error?D.error:D.transaction.error;C(U)}}catch(U){C(U)}})}).catch(C)});return n(X,q),X},clear:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){L(q._dbInfo,"readwrite",function(C,P){if(C)return M(C);try{var A=P.objectStore(q._dbInfo.storeName).clear();P.oncomplete=function(){X()},P.onabort=P.onerror=function(){var D=A.error?A.error:A.transaction.error;M(D)}}catch(D){M(D)}})}).catch(M)});return n(z,G),z},length:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){L(q._dbInfo,"readonly",function(C,P){if(C)return M(C);try{var A=P.objectStore(q._dbInfo.storeName).count();A.onsuccess=function(){X(A.result)},A.onerror=function(){M(A.error)}}catch(D){M(D)}})}).catch(M)});return n(z,G),z},key:function(G,q){var z=this,X=new o(function(M,C){G<0?M(null):z.ready().then(function(){L(z._dbInfo,"readonly",function(P,A){if(P)return C(P);try{var D=A.objectStore(z._dbInfo.storeName),U=!1,H=D.openKeyCursor();H.onsuccess=function(){var j=H.result;j?G===0||U?M(j.key):(U=!0,j.advance(G)):M(null)},H.onerror=function(){C(H.error)}}catch(j){C(j)}})}).catch(C)});return n(X,q),X},keys:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){L(q._dbInfo,"readonly",function(C,P){if(C)return M(C);try{var A=P.objectStore(q._dbInfo.storeName).openKeyCursor(),D=[];A.onsuccess=function(){var U=A.result;U?(D.push(U.key),U.continue()):X(D)},A.onerror=function(){M(A.error)}}catch(U){M(U)}})}).catch(M)});return n(z,G),z},dropInstance:function(G,q){q=r.apply(this,arguments);var z=this.config();(G=typeof G!="function"&&G||{}).name||(G.name=G.name||z.name,G.storeName=G.storeName||z.storeName);var X,M=this;if(G.name){var C=G.name===z.name&&M._dbInfo.db,P=C?o.resolve(M._dbInfo.db):S(G).then(function(A){var D=s[G.name],U=D.forages;D.db=A;for(var H=0;H<U.length;H++)U[H]._dbInfo.db=A;return A});X=G.storeName?P.then(function(A){if(A.objectStoreNames.contains(G.storeName)){var D=A.version+1;f(G);var U=s[G.name],H=U.forages;A.close();for(var j=0;j<H.length;j++){var Q=H[j];Q._dbInfo.db=null,Q._dbInfo.version=D}return new o(function(ne,ie){var ce=a.open(G.name,D);ce.onerror=function(ue){ce.result.close(),ie(ue)},ce.onupgradeneeded=function(){ce.result.deleteObjectStore(G.storeName)},ce.onsuccess=function(){var ue=ce.result;ue.close(),ne(ue)}}).then(function(ne){U.db=ne;for(var ie=0;ie<H.length;ie++){var ce=H[ie];ce._dbInfo.db=ne,E(ce._dbInfo)}}).catch(function(ne){throw(y(G,ne)||o.resolve()).catch(function(){}),ne})}}):P.then(function(A){f(G);var D=s[G.name],U=D.forages;A.close();for(var H=0;H<U.length;H++)U[H]._dbInfo.db=null;return new o(function(j,Q){var ne=a.deleteDatabase(G.name);ne.onerror=ne.onblocked=function(ie){var ce=ne.result;ce&&ce.close(),Q(ie)},ne.onsuccess=function(){var ie=ne.result;ie&&ie.close(),j(ie)}}).then(function(j){D.db=j;for(var Q=0;Q<U.length;Q++)E(U[Q]._dbInfo)}).catch(function(j){throw(y(G,j)||o.resolve()).catch(function(){}),j})})}else X=o.reject("Invalid arguments");return n(X,q),X}},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=/^~~local_forage_type~([^~]+)~/,x="__lfsc__:".length,Z=x+"arbf".length,V=Object.prototype.toString;function Y(G){var q,z,X,M,C,P=.75*G.length,A=G.length,D=0;G[G.length-1]==="="&&(P--,G[G.length-2]==="="&&P--);var U=new ArrayBuffer(P),H=new Uint8Array(U);for(q=0;q<A;q+=4)z=w.indexOf(G[q]),X=w.indexOf(G[q+1]),M=w.indexOf(G[q+2]),C=w.indexOf(G[q+3]),H[D++]=z<<2|X>>4,H[D++]=(15&X)<<4|M>>2,H[D++]=(3&M)<<6|63&C;return U}function te(G){var q,z=new Uint8Array(G),X="";for(q=0;q<z.length;q+=3)X+=w[z[q]>>2],X+=w[(3&z[q])<<4|z[q+1]>>4],X+=w[(15&z[q+1])<<2|z[q+2]>>6],X+=w[63&z[q+2]];return z.length%3==2?X=X.substring(0,X.length-1)+"=":z.length%3==1&&(X=X.substring(0,X.length-2)+"=="),X}var F={serialize:function(G,q){var z="";if(G&&(z=V.call(G)),G&&(z==="[object ArrayBuffer]"||G.buffer&&V.call(G.buffer)==="[object ArrayBuffer]")){var X,M="__lfsc__:";G instanceof ArrayBuffer?(X=G,M+="arbf"):(X=G.buffer,z==="[object Int8Array]"?M+="si08":z==="[object Uint8Array]"?M+="ui08":z==="[object Uint8ClampedArray]"?M+="uic8":z==="[object Int16Array]"?M+="si16":z==="[object Uint16Array]"?M+="ur16":z==="[object Int32Array]"?M+="si32":z==="[object Uint32Array]"?M+="ui32":z==="[object Float32Array]"?M+="fl32":z==="[object Float64Array]"?M+="fl64":q(new Error("Failed to get type for BinaryArray"))),q(M+te(X))}else if(z==="[object Blob]"){var C=new FileReader;C.onload=function(){var P="~~local_forage_type~"+G.type+"~"+te(this.result);q("__lfsc__:blob"+P)},C.readAsArrayBuffer(G)}else try{q(JSON.stringify(G))}catch(P){console.error("Couldn't convert value into a JSON string: ",G),q(null,P)}},deserialize:function(G){if(G.substring(0,x)!=="__lfsc__:")return JSON.parse(G);var q,z=G.substring(Z),X=G.substring(x,Z);if(X==="blob"&&B.test(z)){var M=z.match(B);q=M[1],z=z.substring(M[0].length)}var C=Y(z);switch(X){case"arbf":return C;case"blob":return c([C],{type:q});case"si08":return new Int8Array(C);case"ui08":return new Uint8Array(C);case"uic8":return new Uint8ClampedArray(C);case"si16":return new Int16Array(C);case"ur16":return new Uint16Array(C);case"si32":return new Int32Array(C);case"ui32":return new Uint32Array(C);case"fl32":return new Float32Array(C);case"fl64":return new Float64Array(C);default:throw new Error("Unkown type: "+X)}},stringToBuffer:Y,bufferToString:te};function K(G,q,z,X){G.executeSql("CREATE TABLE IF NOT EXISTS "+q.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],z,X)}function J(G,q,z,X,M,C){G.executeSql(z,X,M,function(P,A){A.code===A.SYNTAX_ERR?P.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[q.storeName],function(D,U){U.rows.length?C(D,A):K(D,q,function(){D.executeSql(z,X,M,C)},C)},C):C(P,A)},C)}function oe(G,q,z,X){var M=this;G=e(G);var C=new o(function(P,A){M.ready().then(function(){q===void 0&&(q=null);var D=q,U=M._dbInfo;U.serializer.serialize(q,function(H,j){j?A(j):U.db.transaction(function(Q){J(Q,U,"INSERT OR REPLACE INTO "+U.storeName+" (key, value) VALUES (?, ?)",[G,H],function(){P(D)},function(ne,ie){A(ie)})},function(Q){if(Q.code===Q.QUOTA_ERR){if(X>0)return void P(oe.apply(M,[G,D,z,X-1]));A(Q)}})})}).catch(A)});return n(C,z),C}function ae(G){return new o(function(q,z){G.transaction(function(X){X.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(M,C){for(var P=[],A=0;A<C.rows.length;A++)P.push(C.rows.item(A).name);q({db:G,storeNames:P})},function(M,C){z(C)})},function(X){z(X)})})}var ee={_driver:"webSQLStorage",_initStorage:function(G){var q=this,z={db:null};if(G)for(var X in G)z[X]=typeof G[X]!="string"?G[X].toString():G[X];var M=new o(function(C,P){try{z.db=openDatabase(z.name,String(z.version),z.description,z.size)}catch(A){return P(A)}z.db.transaction(function(A){K(A,z,function(){q._dbInfo=z,C()},function(D,U){P(U)})},P)});return z.serializer=F,M},_support:typeof openDatabase=="function",iterate:function(G,q){var z=this,X=new o(function(M,C){z.ready().then(function(){var P=z._dbInfo;P.db.transaction(function(A){J(A,P,"SELECT * FROM "+P.storeName,[],function(D,U){for(var H=U.rows,j=H.length,Q=0;Q<j;Q++){var ne=H.item(Q),ie=ne.value;if(ie&&(ie=P.serializer.deserialize(ie)),(ie=G(ie,ne.key,Q+1))!==void 0)return void M(ie)}M()},function(D,U){C(U)})})}).catch(C)});return n(X,q),X},getItem:function(G,q){var z=this;G=e(G);var X=new o(function(M,C){z.ready().then(function(){var P=z._dbInfo;P.db.transaction(function(A){J(A,P,"SELECT * FROM "+P.storeName+" WHERE key = ? LIMIT 1",[G],function(D,U){var H=U.rows.length?U.rows.item(0).value:null;H&&(H=P.serializer.deserialize(H)),M(H)},function(D,U){C(U)})})}).catch(C)});return n(X,q),X},setItem:function(G,q,z){return oe.apply(this,[G,q,z,1])},removeItem:function(G,q){var z=this;G=e(G);var X=new o(function(M,C){z.ready().then(function(){var P=z._dbInfo;P.db.transaction(function(A){J(A,P,"DELETE FROM "+P.storeName+" WHERE key = ?",[G],function(){M()},function(D,U){C(U)})})}).catch(C)});return n(X,q),X},clear:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){var C=q._dbInfo;C.db.transaction(function(P){J(P,C,"DELETE FROM "+C.storeName,[],function(){X()},function(A,D){M(D)})})}).catch(M)});return n(z,G),z},length:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){var C=q._dbInfo;C.db.transaction(function(P){J(P,C,"SELECT COUNT(key) as c FROM "+C.storeName,[],function(A,D){var U=D.rows.item(0).c;X(U)},function(A,D){M(D)})})}).catch(M)});return n(z,G),z},key:function(G,q){var z=this,X=new o(function(M,C){z.ready().then(function(){var P=z._dbInfo;P.db.transaction(function(A){J(A,P,"SELECT key FROM "+P.storeName+" WHERE id = ? LIMIT 1",[G+1],function(D,U){var H=U.rows.length?U.rows.item(0).key:null;M(H)},function(D,U){C(U)})})}).catch(C)});return n(X,q),X},keys:function(G){var q=this,z=new o(function(X,M){q.ready().then(function(){var C=q._dbInfo;C.db.transaction(function(P){J(P,C,"SELECT key FROM "+C.storeName,[],function(A,D){for(var U=[],H=0;H<D.rows.length;H++)U.push(D.rows.item(H).key);X(U)},function(A,D){M(D)})})}).catch(M)});return n(z,G),z},dropInstance:function(G,q){q=r.apply(this,arguments);var z=this.config();(G=typeof G!="function"&&G||{}).name||(G.name=G.name||z.name,G.storeName=G.storeName||z.storeName);var X,M=this;return n(X=G.name?new o(function(C){var P;P=G.name===z.name?M._dbInfo.db:openDatabase(G.name,"","",0),G.storeName?C({db:P,storeNames:[G.storeName]}):C(ae(P))}).then(function(C){return new o(function(P,A){C.db.transaction(function(D){function U(ne){return new o(function(ie,ce){D.executeSql("DROP TABLE IF EXISTS "+ne,[],function(){ie()},function(ue,ye){ce(ye)})})}for(var H=[],j=0,Q=C.storeNames.length;j<Q;j++)H.push(U(C.storeNames[j]));o.all(H).then(function(){P()}).catch(function(ne){A(ne)})},function(D){A(D)})})}):o.reject("Invalid arguments"),q),X}};function se(G,q){var z=G.name+"/";return G.storeName!==q.storeName&&(z+=G.storeName+"/"),z}function de(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(G){return!0}}()||localStorage.length>0}var ge={_driver:"localStorageWrapper",_initStorage:function(G){var q={};if(G)for(var z in G)q[z]=G[z];return q.keyPrefix=se(G,this._defaultConfig),de()?(this._dbInfo=q,q.serializer=F,o.resolve()):o.reject()},_support:function(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(G){return!1}}(),iterate:function(G,q){var z=this,X=z.ready().then(function(){for(var M=z._dbInfo,C=M.keyPrefix,P=C.length,A=localStorage.length,D=1,U=0;U<A;U++){var H=localStorage.key(U);if(H.indexOf(C)===0){var j=localStorage.getItem(H);if(j&&(j=M.serializer.deserialize(j)),(j=G(j,H.substring(P),D++))!==void 0)return j}}});return n(X,q),X},getItem:function(G,q){var z=this;G=e(G);var X=z.ready().then(function(){var M=z._dbInfo,C=localStorage.getItem(M.keyPrefix+G);return C&&(C=M.serializer.deserialize(C)),C});return n(X,q),X},setItem:function(G,q,z){var X=this;G=e(G);var M=X.ready().then(function(){q===void 0&&(q=null);var C=q;return new o(function(P,A){var D=X._dbInfo;D.serializer.serialize(q,function(U,H){if(H)A(H);else try{localStorage.setItem(D.keyPrefix+G,U),P(C)}catch(j){j.name!=="QuotaExceededError"&&j.name!=="NS_ERROR_DOM_QUOTA_REACHED"||A(j),A(j)}})})});return n(M,z),M},removeItem:function(G,q){var z=this;G=e(G);var X=z.ready().then(function(){var M=z._dbInfo;localStorage.removeItem(M.keyPrefix+G)});return n(X,q),X},clear:function(G){var q=this,z=q.ready().then(function(){for(var X=q._dbInfo.keyPrefix,M=localStorage.length-1;M>=0;M--){var C=localStorage.key(M);C.indexOf(X)===0&&localStorage.removeItem(C)}});return n(z,G),z},length:function(G){var q=this.keys().then(function(z){return z.length});return n(q,G),q},key:function(G,q){var z=this,X=z.ready().then(function(){var M,C=z._dbInfo;try{M=localStorage.key(G)}catch(P){M=null}return M&&(M=M.substring(C.keyPrefix.length)),M});return n(X,q),X},keys:function(G){var q=this,z=q.ready().then(function(){for(var X=q._dbInfo,M=localStorage.length,C=[],P=0;P<M;P++){var A=localStorage.key(P);A.indexOf(X.keyPrefix)===0&&C.push(A.substring(X.keyPrefix.length))}return C});return n(z,G),z},dropInstance:function(G,q){if(q=r.apply(this,arguments),!(G=typeof G!="function"&&G||{}).name){var z=this.config();G.name=G.name||z.name,G.storeName=G.storeName||z.storeName}var X,M=this;return n(X=G.name?new o(function(C){G.storeName?C(se(G,M._defaultConfig)):C(G.name+"/")}).then(function(C){for(var P=localStorage.length-1;P>=0;P--){var A=localStorage.key(P);A.indexOf(C)===0&&localStorage.removeItem(A)}}):o.reject("Invalid arguments"),q),X}},me=function(G,q){for(var z,X,M=G.length,C=0;C<M;){if((z=G[C])===(X=q)||typeof z=="number"&&typeof X=="number"&&isNaN(z)&&isNaN(X))return!0;C++}return!1},le=Array.isArray||function(G){return Object.prototype.toString.call(G)==="[object Array]"},Te={},Re={},pe={INDEXEDDB:N,WEBSQL:ee,LOCALSTORAGE:ge},ke=[pe.INDEXEDDB._driver,pe.WEBSQL._driver,pe.LOCALSTORAGE._driver],$=["dropInstance"],Se=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat($),Oe={description:"",driver:ke.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function _e(G,q){G[q]=function(){var z=arguments;return G.ready().then(function(){return G[q].apply(G,z)})}}function fe(){for(var G=1;G<arguments.length;G++){var q=arguments[G];if(q)for(var z in q)q.hasOwnProperty(z)&&(le(q[z])?arguments[0][z]=q[z].slice():arguments[0][z]=q[z])}return arguments[0]}var re=new(function(){function G(q){for(var z in function(C,P){if(!(C instanceof P))throw new TypeError("Cannot call a class as a function")}(this,G),pe)if(pe.hasOwnProperty(z)){var X=pe[z],M=X._driver;this[z]=M,Te[M]||this.defineDriver(X)}this._defaultConfig=fe({},Oe),this._config=fe({},this._defaultConfig,q),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return G.prototype.config=function(q){if((q===void 0?"undefined":l(q))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var z in q){if(z==="storeName"&&(q[z]=q[z].replace(/\W/g,"_")),z==="version"&&typeof q[z]!="number")return new Error("Database version must be a number.");this._config[z]=q[z]}return!("driver"in q)||!q.driver||this.setDriver(this._config.driver)}return typeof q=="string"?this._config[q]:this._config},G.prototype.defineDriver=function(q,z,X){var M=new o(function(C,P){try{var A=q._driver,D=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!q._driver)return void P(D);for(var U=Se.concat("_initStorage"),H=0,j=U.length;H<j;H++){var Q=U[H];if((!me($,Q)||q[Q])&&typeof q[Q]!="function")return void P(D)}(function(){for(var ie=function(Ee){return function(){var ve=new Error("Method "+Ee+" is not implemented by the current driver"),be=o.reject(ve);return n(be,arguments[arguments.length-1]),be}},ce=0,ue=$.length;ce<ue;ce++){var ye=$[ce];q[ye]||(q[ye]=ie(ye))}})();var ne=function(ie){Te[A]&&console.info("Redefining LocalForage driver: "+A),Te[A]=q,Re[A]=ie,C()};"_support"in q?q._support&&typeof q._support=="function"?q._support().then(ne,P):ne(!!q._support):ne(!0)}catch(ie){P(ie)}});return t(M,z,X),M},G.prototype.driver=function(){return this._driver||null},G.prototype.getDriver=function(q,z,X){var M=Te[q]?o.resolve(Te[q]):o.reject(new Error("Driver not found."));return t(M,z,X),M},G.prototype.getSerializer=function(q){var z=o.resolve(F);return t(z,q),z},G.prototype.ready=function(q){var z=this,X=z._driverSet.then(function(){return z._ready===null&&(z._ready=z._initDriver()),z._ready});return t(X,q,q),X},G.prototype.setDriver=function(q,z,X){var M=this;le(q)||(q=[q]);var C=this._getSupportedDrivers(q);function P(){M._config.driver=M.driver()}function A(U){return M._extend(U),P(),M._ready=M._initStorage(M._config),M._ready}var D=this._driverSet!==null?this._driverSet.catch(function(){return o.resolve()}):o.resolve();return this._driverSet=D.then(function(){var U=C[0];return M._dbInfo=null,M._ready=null,M.getDriver(U).then(function(H){M._driver=H._driver,P(),M._wrapLibraryMethodsWithReady(),M._initDriver=function(j){return function(){var Q=0;return function ne(){for(;Q<j.length;){var ie=j[Q];return Q++,M._dbInfo=null,M._ready=null,M.getDriver(ie).then(A).catch(ne)}P();var ce=new Error("No available storage method found.");return M._driverSet=o.reject(ce),M._driverSet}()}}(C)})}).catch(function(){P();var U=new Error("No available storage method found.");return M._driverSet=o.reject(U),M._driverSet}),t(this._driverSet,z,X),this._driverSet},G.prototype.supports=function(q){return!!Re[q]},G.prototype._extend=function(q){fe(this,q)},G.prototype._getSupportedDrivers=function(q){for(var z=[],X=0,M=q.length;X<M;X++){var C=q[X];this.supports(C)&&z.push(C)}return z},G.prototype._wrapLibraryMethodsWithReady=function(){for(var q=0,z=Se.length;q<z;q++)_e(this,Se[q])},G.prototype.createInstance=function(q){return new G(q)},G}());_.exports=re},{3:3}]},{},[4])(4)}).call(this,I(15))}])})}}]);

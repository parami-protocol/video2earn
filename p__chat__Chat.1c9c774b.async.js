(self.webpackChunkvideo2earn_app=self.webpackChunkvideo2earn_app||[]).push([[668],{41445:function(D){D.exports={theme_root:"theme_root___1W1zc",room_root:"room_root___194bK",room_user_card:"room_user_card___n6Vp1",remote_video_card:"remote_video_card___2FIKm",remote_video:"remote_video___iDcyo",local_video_card:"local_video_card___3iP0h",local_video:"local_video___AKdxJ",toolbar_root:"toolbar_root___naYcd",toolbar_column_center:"toolbar_column_center___QmSoE",toolbar_button:"toolbar_button___3rEak",toolbar_button_bottom_text:"toolbar_button_bottom_text___10uF7",matching_container:"matching_container___3e-ed",matching_text:"matching_text___2_2Un",matching_countdown:"matching_countdown___28xzP"}},39355:function(D){D.exports={on_chain_assets:"on_chain_assets___2VD25",asset:"asset___ikk3g",asset_img:"asset_img___3H4ca",coin_root:"coin_root___1eEDk",coin_card:"coin_card___3OhCs",coin_img_container:"coin_img_container___2Nuf-",coin_item_img:"coin_item_img___3y1Qp",coin_item_value_text:"coin_item_value_text___TilvN"}},78e3:function(D){D.exports={rate_container:"rate_container___2gh8b",rate_button:"rate_button___3fjhC",rate_result:"rate_result___1CRKG"}},2303:function(D,L,o){"use strict";o.r(L),o.d(L,{default:function(){return be}});var ke=o(57663),Q=o(27884),C=o(3182),E=o(8870),N=o(2824),oe=o(94043),v=o.n(oe),c=o(67294),se=o(53399),ie=o(53776),w=o(21010);function ce(t,s,r){return V.apply(this,arguments)}function V(){return V=(0,C.Z)(v().mark(function t(s,r,a){return v().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,w.WY)("/sessions",{method:"POST",headers:{"Content-Type":"application/json"},data:{account:s,channel:r,timeout:a}}));case 1:case"end":return g.stop()}},t)})),V.apply(this,arguments)}var ue=o(5977),le=o(86582),Z=o(27750);function de(t,s){return P.apply(this,arguments)}function P(){return P=(0,C.Z)(v().mark(function t(s,r){return v().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,w.WY)(Z.kX+"/api/v1/assets",{method:"GET",header:{"X-API-KEY":Z.aW},params:{owner:s,limit:r}}));case 1:case"end":return l.stop()}},t)})),P.apply(this,arguments)}var me=o(39355),b=o.n(me);function fe(t){return J.apply(this,arguments)}function J(){return J=(0,C.Z)(v().mark(function t(s){return v().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,w.WY)(Z.f_.endpoint,{method:"GET",params:{module:"account",action:"balance",address:s,tag:"latest",apikey:Z.f_.apiKey}}));case 1:case"end":return a.stop()}},t)})),J.apply(this,arguments)}function he(t,s){return M.apply(this,arguments)}function M(){return M=(0,C.Z)(v().mark(function t(s,r){return v().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,w.WY)(Z.f_.endpoint,{method:"GET",params:{module:"account",action:"tokenbalance",contractAddress:r,address:s,tag:"latest",apikey:Z.f_.apiKey}}));case 1:case"end":return l.stop()}},t)})),M.apply(this,arguments)}var e=o(85893),ve=function(s){var r=s.account;if(!r)return null;var a=(0,c.useState)([]),l=(0,N.Z)(a,2),g=l[0],O=l[1];if((0,c.useEffect)(function(){var m=[fe(r).then(function(S){return{address:"",balance:S.result,name:"Etherum",symbol:"ETH",decimal:1e19,img:"./imgs/eth.png"}})];m.push.apply(m,(0,le.Z)(Z.Ut.map(function(){var S=(0,C.Z)(v().mark(function i(y){var U;return v().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,he(r,y.address);case 2:return U=x.sent,x.abrupt("return",(0,E.Z)((0,E.Z)({},y),{},{balance:U.result}));case 4:case"end":return x.stop()}},i)}));return function(i){return S.apply(this,arguments)}}()))),Promise.all(m).then(function(S){O(S)})},[]),!g)return null;var j=g.map(function(m){return(0,e.jsxs)("div",{className:b().coin_card,children:[(0,e.jsx)("div",{className:b().coin_img_container,children:(0,e.jsx)("img",{src:m.img,className:b().coin_item_img,alt:m.name})}),(0,e.jsxs)("div",{className:b().coin_item_value_text,children:[m.symbol," ",(m.balance/m.decimal).toFixed(2)]})]},m.symbol)});return(0,e.jsx)("div",{className:b().coin_root,children:j})},ge=function(s){var r=s.account;if(!r)return null;var a=(0,c.useState)({assets:[]}),l=(0,N.Z)(a,2),g=l[0],O=l[1];if((0,c.useEffect)(function(){de(r,10).then(function(m){O(m)})},[]),!g)return null;var j=g.assets.flatMap(function(m,S){if(!m.image_url)return[];var i={backgroundColor:m.background_color};return[(0,e.jsx)("div",{style:i,className:b().asset,children:(0,e.jsx)("img",{className:b().asset_img,alt:"asset image",src:m.image_url})},m.token_id)]});return(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:b().on_chain_assets,children:j})})},_e=o(41445),f=o.n(_e),pe=o(78e3),W=o.n(pe),A;(function(t){t.GOOD="Good",t.BAD="Bad"})(A||(A={}));function xe(t){var s=t.showRate,r=t.rate,a=t.onRated;if(!s)return null;if(!r)return(0,e.jsxs)("div",{className:W().rate_container,children:[(0,e.jsx)("button",{className:W().rate_button,style:{borderColor:"red"},onClick:function(){return a(A.BAD)},children:"\u274C"}),(0,e.jsx)("button",{className:W().rate_button,style:{borderColor:"green"},onClick:function(){return a(A.GOOD)},children:"\u2705"})]});var l={borderColor:r==A.GOOD?"green":"red"};return(0,e.jsxs)("div",{className:W().rate_container,children:[" ",(0,e.jsx)("div",{className:W().rate_result,style:l,children:(0,e.jsx)("div",{children:r==A.GOOD?"\u2705":"\u274C"})})," "]})}var p=new se.ZegoExpressEngine(573234333,"wss://webliveroom573234333-api.imzego.com/ws"),je={token:"03AAAAAGJejs8AEGdsNGNubW42bmJkM3RzNjQAoI6M09ogWIqlCTBB/86KjXDmOEd8wJgWPboB542shOYZ0uqqRQY/JpS5lz8ZZ5W7URN3a4BIv94WUExV+AimuN6c/cUgzUG6J608QgDWGaRdskjenQAymFXLv+4qKbbHueQdJXHu2nKiofey+Zozke70MZhR5I3zaJUeCu8vQHNBQ5nVm2MoilZRPLAacOkJCjcKU4J9tPMYLthkZ+Bs7tU=",user:{userID:"user1"}},Se={token:"03AAAAAGJejuoAEHd0endqbmZyZGRhdHZzZTgAoI0taoAfOuaTddMCdc1eifHRonxvuF/FZ/bOBL/Zl2h1HqJNigllyi/FMeDHVwyC0biuzhIjBpQVY/v38qC3eIe3AsDjz9JSq9MBUFH27Vg57tVqW1sgDF5JvCviS5NgKt3uU3IyKPhJN82fyIy3nHiM9S7JmPbx5zS4HD5+28VyriDMqodyo9j3E8+0m3o+32e6fLwRI4Coi/AZUToTDuo=",user:{userID:"user2"}},u;(function(t){t[t.preparing=0]="preparing",t[t.matching=1]="matching",t[t.connecting=2]="connecting",t[t.chatting=3]="chatting",t[t.done=4]="done",t[t.failed=5]="failed"})(u||(u={}));var H=function(s){var r=s.videoStream;if(!r)return null;var a=(0,c.useRef)(null);return(0,c.useEffect)(function(){a.current&&(a.current.srcObject=r)},[r]),(0,e.jsx)("div",{className:f().local_video_card,children:(0,e.jsx)("video",{className:f().local_video,ref:a,autoPlay:!0,muted:!0,playsInline:!0})})},ye=function(s){var r=s.videoStream;if(!r)return null;var a=(0,c.useRef)(null);return(0,c.useEffect)(function(){a.current&&(a.current.srcObject=r)},[r]),(0,e.jsx)("div",{className:f().remote_video_card,children:(0,e.jsx)("video",{className:f().remote_video,ref:a,autoPlay:!0,muted:!0,playsInline:!0})})},Ce=function(){var s=(0,ie.t)("V2EContract"),r=s.V2EContract,a=s.Account,l=(0,c.useState)(0),g=(0,N.Z)(l,2),O=g[0],j=g[1],m=(0,c.useState)(u.preparing),S=(0,N.Z)(m,2),i=S[0],y=S[1],U=(0,c.useState)({token:"",userId:"",roomId:"",peerUserId:"",peerAccount:""}),z=(0,N.Z)(U,2),x=z[0],Y=z[1],Re=(0,c.useState)({showRate:!1}),$=(0,N.Z)(Re,2),X=$[0],q=$[1],h=(0,c.useRef)({}),Ee=(0,c.useState)(""),ee=(0,N.Z)(Ee,2),Ne=ee[0],Ze=ee[1],Ae=(0,ue.UO)();(0,c.useEffect)(function(){h.current.localStream&&(i==u.failed||i==u.done)&&(p.destroyStream(h.current.localStream),console.log("stream destroyed"))},[i]);function te(n){console.log("mock user is {}",n),Y(function(d){return(0,E.Z)((0,E.Z)({},d),{},{userId:n.user.userID,roomId:"1",token:n.token})}),Oe()}function Ie(n){q(function(d){return(0,E.Z)((0,E.Z)({},d),{},{rate:n})}),n==A.BAD&&K()}function De(){y(u.matching),j(5)}function Oe(){y(u.connecting),j(0),console.log("transition to connecting")}function ne(){!h.current.pushStreamReady||!h.current.pullStreamReady||(y(u.chatting),j(300),console.log("transition to chatting"))}function K(){y(u.done),j(0)}function re(n){y(u.failed),Ze(n.msg||n.message)}(0,c.useEffect)(function(){if(i==u.preparing){var n=[];h.current={},p.setLogConfig({logLevel:"error"}),n.push(p.createStream().then(function(d){h.current.localStream=d})),Promise.all(n).then(function(){return De()}).catch(function(d){return re(d)})}},[i]),(0,c.useEffect)(function(){i==u.matching&&ce(a,Ae.channel,5).then(function(n){if(console.log("session response"),typeof n!="object")throw new Error("response unknown");var d=(0,E.Z)({},n);Y(d)}).catch(function(n){})},[i]),(0,c.useEffect)(function(){if(i==u.connecting)return p.on("roomStateUpdate",function(){var n=(0,C.Z)(v().mark(function d(B,R,T,G){var I;return v().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(R!="CONNECTED"){_.next=7;break}if(I=new Date().getTime().toString(),h.current.localStream){_.next=4;break}throw new Error("local stream not found");case 4:p.startPublishingStream(I,h.current.localStream),h.current.pushStreamReady=!0,ne();case 7:case"end":return _.stop()}},d)}));return function(d,B,R,T){return n.apply(this,arguments)}}()),p.on("roomStreamUpdate",function(){var n=(0,C.Z)(v().mark(function d(B,R,T,G){var I;return v().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(R!="ADD"){_.next=7;break}return I=T[0].streamID,_.next=4,p.startPlayingStream(I);case 4:h.current.remoteStream=_.sent,h.current.pullStreamReady=!0,ne();case 7:case"end":return _.stop()}},d)}));return function(d,B,R,T){return n.apply(this,arguments)}}()),p.loginRoom(x.roomId,x.token,{userID:x.userId}).catch(function(n){re(n)}),function(){p.off("roomStateUpdate"),p.off("roomStreamUpdate")}},[i]),(0,c.useEffect)(function(){if(i==u.chatting){var n=setTimeout(function(){q({showRate:!0})},5*1e3),d=setTimeout(function(){K()},300*1e3);return p.on("roomStreamUpdate",function(){var B=(0,C.Z)(v().mark(function R(T,G,I,ae){var _;return v().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:G=="DELETE"&&h.current.remoteStream&&(_=h.current.remoteStream.streamId,p.stopPlayingStream(_),K());case 1:case"end":return F.stop()}},R)}));return function(R,T,G,I){return B.apply(this,arguments)}}()),function(){clearTimeout(n),clearTimeout(d),p.off("roomStreamUpdate"),p.logoutRoom("1")}}},[i]),(0,c.useEffect)(function(){var n=setInterval(function(){j(function(d){return d>0?d-1:0})},1e3);return function(){return clearInterval(n)}},[O]);var k=(0,e.jsx)("div",{children:"unexpected state"});return i==u.matching&&(k=(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{children:["mocked:",(0,e.jsx)("button",{onClick:function(){return te(je)},children:"user1"}),(0,e.jsx)("button",{onClick:function(){return te(Se)},children:"user2"})]}),(0,e.jsxs)("div",{className:f().matching_container,children:[(0,e.jsx)("div",{className:f().matching_text,children:"MATCHING..."}),(0,e.jsx)("div",{className:f().matching_countdown,children:O})]}),(0,e.jsx)(H,{videoStream:h.current.localStream})]})),i==u.connecting&&(k=(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:" connecting "}),(0,e.jsx)(H,{videoStream:h.current.localStream})]})),i==u.chatting&&(k=(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:f().theme_root,children:(0,e.jsxs)("div",{className:f().room_root,children:[(0,e.jsxs)("div",{className:f().room_user_card,children:[(0,e.jsx)(ye,{videoStream:h.current.remoteStream}),(0,e.jsx)(H,{videoStream:h.current.localStream})]}),(0,e.jsxs)("div",{className:f().toolbar_root,children:[(0,e.jsxs)("div",{className:f().toolbar_column_center,children:[(0,e.jsx)("img",{src:"./imgs/cameraOff.png",className:f().toolbar_button}),(0,e.jsx)("p",{className:f().toolbar_button_bottom_text,children:"Camera"})]}),(0,e.jsxs)("div",{className:f().toolbar_column_center,children:[(0,e.jsx)("img",{src:"./imgs/micOff.png",className:f().toolbar_button}),(0,e.jsx)("p",{className:f().toolbar_button_bottom_text,children:"Microphone"})]})]}),(0,e.jsx)(ge,{account:"0x8b684993d03cc484936cf3a688ddc9937244f1d3"}),(0,e.jsx)(ve,{account:"0xd8da6bf26964af9d7eed9e03e53415d37aa96045"}),(0,e.jsx)(xe,{showRate:X.showRate,rate:X.rate,onRated:Ie})]})})})),i==u.done&&(k=(0,e.jsxs)("div",{children:[(0,e.jsx)(Q.Z,{onClick:function(){w.m8.push("/")},children:"Back To Home"}),(0,e.jsxs)(Q.Z,{onClick:function(){y(u.preparing)},children:["Start Again"," "]})]})),i==u.failed&&(k=(0,e.jsxs)("div",{children:["failed: ",Ne," "]})),(0,e.jsx)("div",{children:k})},be=Ce}}]);
